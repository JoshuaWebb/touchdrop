(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{114:function(e,t,i){},118:function(e,t,i){},120:function(e,t,i){},122:function(e,t,i){},124:function(e,t,i){},126:function(e,t,i){},128:function(e,t,i){},130:function(e,t,i){},132:function(e,t,i){},134:function(e,t,i){},136:function(e,t,i){"use strict";i.r(t);var n=i(0),a=i.n(n),o=i(68),r=i.n(o),s=i(23),c=i(33),l=(i(79),i(85),i(88),i(108),i(114),i(3)),u=i(4),h=i(7),d=i(5),f=i(6),p=i(1),m=(i(45),function(e){var t=e.items.map(function(e){return a.a.createElement("li",{key:e.text,onClick:e.onClick,className:"button"},e.text)});return a.a.createElement("div",{className:"menu"},a.a.createElement("ul",null,t))}),v="READY",g="MAIN",b=[{fill:"#708090"},{fill:"#f5c635"},{fill:"#ee8817"},{fill:"#47b450"},{fill:"#ee575b"},{fill:"#9155f4"},{fill:"#009fd4"}],y=!1;try{var E={get passive(){return y=!0,!0}};window.addEventListener("test",E,E),window.removeEventListener("test",E,E)}catch(Xe){y=!1}var k=y,w=function(e){var t=[{text:"ZEN MODE",onClick:function(){e.setGameMode("ZEN"),e.start()}},{text:"LINE TARGET MODE",onClick:function(){e.setGameMode("LINE TARGET"),e.start()}},{text:"CUSTOMIZE STYLE",onClick:function(){e.setMenu("STYLE")}},{text:"IMPORT / EXPORT SETTINGS",onClick:function(){e.setMenu("IMPORT_EXPORT")}}];return a.a.createElement(m,{items:t})},O=i(19),x=i(2),S=(i(118),i(120),function(e){var t="grid-block "+(e.flash?"grid-block-flash ":"")+(e.piece!==M?"piece-block ":"")+(!1===e.placeable?"cannot-place ":"");return a.a.createElement("rect",{x:e.x,y:e.y,width:e.blockSize,height:e.blockSize,style:e.blockStyles[e.piece],className:t})}),M=-1,P=[[[0,1,2,3],[2,2,2,2],[3,2,1,0],[1,1,1,1]],[[2,2,1,0],[2,1,1,1],[0,0,1,2],[0,1,1,1]],[[0,1,1,0],[1,1,0,0],[1,0,0,1],[0,0,1,1]],[[0,1,1,2],[2,2,1,1],[2,1,1,0],[0,0,1,1]],[[1,0,1,2],[2,1,1,1],[1,2,1,0],[0,1,1,1]],[[0,0,1,2],[2,1,1,1],[2,2,1,0],[0,1,1,1]],[[2,1,1,0],[2,2,1,1],[0,1,1,2],[0,0,1,1]]],j=[[[1,1,1,1],[0,1,2,3],[2,2,2,2],[3,2,1,0]],[[0,1,1,1],[2,2,1,0],[2,1,1,1],[0,0,1,2]],[[0,0,1,1],[0,1,1,0],[1,1,0,0],[1,0,0,1]],[[0,0,1,1],[0,1,1,2],[2,2,1,1],[2,1,1,0]],[[0,1,1,1],[1,0,1,2],[2,1,1,1],[1,2,1,0]],[[0,1,1,1],[0,0,1,2],[2,1,1,1],[2,2,1,0]],[[0,0,1,1],[2,1,1,0],[2,2,1,1],[0,1,1,2]]];P.length;function C(e,t,i,n,a){if(i!==M&&-1!==n&&-1!==e&&-1!==t){var o=T(e,t,i,n,a),r=!o&&T(e,t+1,i,n,a);return!o&&r}return!1}function T(e,t,i,n,a){for(var o=P[i][n],r=j[i][n],s=a.blocks[0].length,c=a.length,l=N(e,t,i,n),u=l.xOffset,h=l.yOffset,d=0;d<o.length;d++){var f=u+o[d],p=h+r[d];if(f<0)return!0;if(f>=s||p>=c)return!0;var m=a.blocks[p]||a.hiddenBlocks[-1*p-1];if(void 0===m)return!0;if(m[f]!==M)return!0}return!1}function N(e,t,i,n){var a=F(i,n);return{xOffset:e-A(i,n),yOffset:t-(D(i,n)+a-1)}}function A(e,t){for(var i=P[e][t],n=i[0],a=1;a<i.length;a++){var o=i[a];n=n<o?n:o}return n}function D(e,t){for(var i=j[e][t],n=i[0],a=1;a<i.length;a++){var o=i[a];n=n<o?n:o}return n}function F(e,t){for(var i=j[e][t],n=i[0],a=i[0],o=1;o<i.length;o++){var r=i[o];n=n<r?n:r,a=a>r?a:r}return a-n+1}var I=function(e){var t=e.piece,i=e.orientation,n=e.blockSize,o=e.placeable,r=e.cx,s=e.cy,c=e.x,l=e.y,u=e.blockStyles;if(t===M||-1===i)return null;var h,d,f=P[t][i],p=j[t][i],m=function(e,t){for(var i=P[e][t],n=i[0],a=i[0],o=1;o<i.length;o++){var r=i[o];n=n<r?n:r,a=a>r?a:r}return a-n+1}(t,i),v=F(t,i),g=A(t,i),b=D(t,i);return void 0!==r&&void 0!==s?(h=r-g*n-m*n/2,d=s-b*n-v*n/2):(h=c-g*n,d=l-(b+v-1)*n),f.map(function(e,i){var r=p[i];return a.a.createElement(S,{key:i,x:h+e*n,y:d+r*n,placeable:o,piece:t,blockStyles:u,blockSize:n})})},L=function(e){function t(e){var i;return Object(l.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e))).changeHandler=function(e){var t=e.target.name,n=e.target.value;i.setState({colors:Object(x.a)({},i.state.colors,Object(O.a)({},t,{fill:n}))})},i.save=function(){var e={blockStyles:Object.values(i.state.colors)};i.props.updateConfig(e),i.props.setMenu(g)},i.reset=function(){i.setState({colors:Object.assign({},b)})},i.cancel=function(){i.props.setMenu(g)},i.state={colors:Object.assign({},e.config.blockStyles)},i}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.config.blockStyles,i=[0,0,104,104],n=t.map(function(t,n){return a.a.createElement("li",{key:n,className:"color-config-item"},a.a.createElement("svg",{shapeRendering:"crispEdges",preserveAspectRatio:"xMidYMid slice",width:78,height:58.5,viewBox:i},a.a.createElement(I,{piece:n,orientation:0,blockSize:26,blockStyles:e.state.colors,cx:52,cy:52})),a.a.createElement("label",{className:"color-picker",style:{backgroundColor:e.state.colors[n].fill,width:"30px",height:"30px"},htmlFor:"cp-"+n},a.a.createElement("input",{className:"color-picker",type:"color",id:"cp-"+n,name:n,value:e.state.colors[n].fill,onChange:e.changeHandler})),a.a.createElement("input",{type:"text",id:"ct-"+n,name:n,value:e.state.colors[n].fill,onChange:e.changeHandler}))});return a.a.createElement("div",{className:"menu"},a.a.createElement("ul",{className:"color-config-items"},n),a.a.createElement("ul",null,a.a.createElement("li",{className:"button cancel",onClick:this.cancel},"CANCEL"),a.a.createElement("li",{className:"button reset",onClick:this.reset},"RESET TO DEFAULTS"),a.a.createElement("li",{className:"button save",onClick:this.save},"SAVE")))}}]),t}(n.Component);i(122);function R(e){var t=(e%1e3).toFixed(0);t=("000"+t).slice(-3);var i=Math.floor(e/1e3).toFixed(0),n=Math.floor(i/60),a="";return n>59&&(n=(n-=60*(a=Math.floor(n/60)))>=10?n:"0"+n),i=(i=Math.floor(i%60))>=10?i:"0"+i,""!==a?a+":"+n+":"+i+"."+t:n+":"+i+"."+t}function U(e){return e&&"object"===typeof e&&!Array.isArray(e)}var G={set:function(e,t){if(e){null!==t&&void 0!==t||window.localStorage.removeItem(e);var i,n=t.constructor.name;switch(n){case"Array":case"Object":i=JSON.stringify(t);break;case"String":i=t;break;case"Number":i=t.toString();break;default:throw new Error("Type ".concat(n," not supported"))}window.localStorage.setItem(e,"pd:".concat(n,":").concat(i))}},get:function(e){var t=localStorage.getItem(e);if(null!==t){var i=function(e,t,i){var n=e.split(t),a=n.splice(0,i-1);return a.push(n.join(t)),a}(t,":",3);if(i.length<3||"pd"!==i[0])return t;var n,a=i[1],o=i[2];switch(a){case"Array":case"Object":n=JSON.parse(o);break;case"String":n=o;break;case"Number":n=Number(o);break;default:throw new Error("Non-facade value '".concat(t,"' was stored")+"but was attempted to be retrieved through the facade.")}return n}}};function z(e,t){var i=Object.keys(e),n=Object.keys(t),a=new Set(i),o=new Set(n);if(a.size!==o.size)return!1;var r=!0,s=!1,c=void 0;try{for(var l,u=a[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var h=l.value;if(!o.has(h))return!1}}catch(Xe){s=!0,c=Xe}finally{try{r||null==u.return||u.return()}finally{if(s)throw c}}return!0}var B="config";function W(e,t){var i=function e(t,i){var n=Object.assign({},t);return U(t)&&U(i)&&Object.keys(i).forEach(function(a){U(i[a])&&a in t?n[a]=e(t[a],i[a]):Object.assign(n,Object(O.a)({},a,i[a]))}),n}(e.config,t.config);return _(i)?(G.set(B,i),Object(x.a)({},e,{config:i})):e}function _(e){if(!e)return!1;if(0!==e.version)return!1;if(!e.blockStyles)return!1;if(!z(e.blockStyles,b))return!1;for(var t=Object.keys(e.blockStyles),i=0;i<t.length;i++){var n=t[i];if(!z(e.blockStyles[n],b[n]))return!1}return!0}var H=function(e){function t(e){var i;return Object(l.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e))).validateInput=function(e){var t=!0;try{t=_(JSON.parse(e))}catch(i){t=!1}return t},i.changeHandler=function(e){var t=e.target.value,n=i.validateInput(t);i.setState({config:t,valid:n})},i.save=function(){if(i.state.valid){var e=JSON.parse(i.state.config);i.props.updateConfig(e),i.props.setMenu(g)}},i.back=function(){i.props.setMenu(g)},i.state={config:JSON.stringify(e.config),valid:!0},i}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"menu"},a.a.createElement("div",{id:"config-text-holder"},a.a.createElement("textarea",{id:"config-text",value:this.state.config,className:this.state.valid?"":"invalid-input",onChange:this.changeHandler})),a.a.createElement("ul",null,a.a.createElement("li",{className:"button cancel",onClick:this.back},"BACK"),a.a.createElement("li",{className:"button save",onClick:this.save},"SAVE")))}}]),t}(n.Component),Y="SET_ACTIVE_GRID_POSITION",J="CYCLE_PIECES",X="SELECT_ORIENTATION",Z="NEXT_PIECE",V="PLACE_BLOCK",K="CHECK_PLACEABILITY",$="UPDATE_STATS",q="RESET",Q="RESIZE",ee="SET_GAME_STATE",te="SET_GAME_MODE",ie="SET_MENU",ne="UPDATE_READY",ae="UPDATE_TIMER",oe="UPDATE_CONFIG",re="LOAD_CONFIG",se=function(e){return{type:te,gameMode:e}},ce=Object(s.b)(function(e){return{config:e.config,menu:e.menu,gameMode:e.gameMode,lineTarget:e.lineTarget}},function(e){return{setMenu:function(t){e(function(e){return{type:ie,menu:e}}(t))},setGameMode:function(t){e(se(t))},updateConfig:function(t){e(function(e){return{type:oe,config:e}}(t))}}}),le=ce(w),ue=ce(L),he=ce(H),de=function(e){switch(e.menu){case"STYLE":return a.a.createElement(ue,null);case"IMPORT_EXPORT":return a.a.createElement(he,null);case g:default:return a.a.createElement(le,{start:e.start})}},fe=(i(124),function(e){var t=e.gameMode,i=e.linesCleared,n=e.blockCount,o=[{text:"NEW GAME",onClick:e.reset},{text:"MAIN MENU",onClick:e.mainMenu}],r=[{name:"Total Pieces",value:n},{name:"Total Lines",value:i},{name:"Time",value:R(e.timerMillis)}].map(function(e){return a.a.createElement("div",{className:"row",key:e.name},a.a.createElement("span",{className:"name"},e.name,": "),a.a.createElement("span",{className:"value"},e.value))});return a.a.createElement("div",{className:"end-screen"},a.a.createElement("div",null,a.a.createElement("h1",{className:"mode-name"},t),a.a.createElement("h1",null,"FINISH")),a.a.createElement("div",{className:"statistics"},r),a.a.createElement("div",null,a.a.createElement(m,{items:o})))}),pe=(i(126),function(e){function t(){return Object(l.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){for(var e=this.props,t=e.x,i=e.y,n=e.width,o=e.height,r=e.blockSize,s=e.rows,c=e.cols,l=[],u=1;u<c;u++)l.push(a.a.createElement("line",{key:"cl".concat(u),x1:t+u*r,y1:i,x2:t+u*r,y2:i+o,className:"grid-line"}));for(var h=1;h<s;h++)l.push(a.a.createElement("line",{key:"rl".concat(h),x1:t,y1:i+h*r,x2:t+n,y2:i+h*r,className:"grid-line"}));return a.a.createElement("g",null,a.a.createElement("rect",{id:"field-background",style:{fill:"#232323"},x:t,y:i,width:n,height:o,pointerEvents:"none"}),l)}}]),t}(a.a.PureComponent)),me=function(e){function t(){return Object(l.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var i=this.props,n=i.activePosition,a=i.blockCount;return n.row!==e.activePosition.row||n.col!==e.activePosition.col||a!==e.blockCount}},{key:"render",value:function(){for(var e=this.props,t=e.x,i=e.y,n=e.width,o=e.height,r=e.blockSize,s=e.rows,c=e.cols,l=e.blockStyles,u=e.activePosition,h=u.row,d=u.col,f=[],p=0;p<s;p++)for(var m=0;m<c;m++){var v=p*c+m,g=this.props.blocks[p][m],b=a.a.createElement(S,{id:v,key:v,x:t+m*r,y:i+p*r,blockSize:r,blockStyles:l,piece:g,flash:p===h&&m===d});f.push(b)}return a.a.createElement("g",{id:"field"},a.a.createElement(pe,{x:t,y:i,width:n,height:o,rows:s,cols:c,blockSize:r}),f,a.a.createElement("rect",{id:"field-border",style:{fill:"transparent",strokeWidth:1,stroke:"#FFFFFF"},x:t,y:i,width:n,height:o,pointerEvents:"none"}))}}]),t}(n.Component),ve=function(e){return a.a.createElement("text",{textAnchor:"end",x:e.x,y:e.y,style:{fontFamily:"Roboto",fontSize:30,fill:"#cfabec"}},e.linesCleared," / ",e.target)},ge=function(e){var t=e.x,i=e.y,n=R(e.timerMillis);return a.a.createElement("text",{x:t,y:i,style:{fontSize:30,fill:"#cfabec"}},n)},be=(i(128),function(e){var t=e.text,i=e.x,n=e.y,o=e.className,r=a.a.createElement("text",{x:i,y:n,className:o,textAnchor:"middle",alignmentBaseline:"central",dominantBaseline:"central"},t),s=a.a.cloneElement(r,{className:"".concat(o," text-outline")});return a.a.createElement(a.a.Fragment,null,s,r)}),ye=(i(130),function(e){var t=e.totalReadyMillis,i=e.remainingMillis,n=e.animationIndex,o=e.maskId,r=e.x,s=e.y;if(i<=0)return null;if(t<=i)return null;var c=i>t/2,l=c?"ready":"go",u=c?"ready-".concat(n):"";return a.a.createElement("g",{clipPath:"url(#".concat(o,")")},a.a.createElement("g",{className:u},a.a.createElement(be,{x:r,y:s,className:l,text:c?"READY":"GO"})))}),Ee=(i(132),function(e){function t(e){var i;return Object(l.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={pressed:!1},i.touchStart=i.touchStart.bind(Object(p.a)(Object(p.a)(i))),i.touchEnd=i.touchEnd.bind(Object(p.a)(Object(p.a)(i))),i}return Object(f.a)(t,e),Object(u.a)(t,[{key:"touchStart",value:function(e){e.stopPropagation(),this.setState({pressed:!0})}},{key:"touchMove",value:function(e){e.stopPropagation()}},{key:"touchEnd",value:function(e){e.stopPropagation(),this.setState({pressed:!1})}},{key:"render",value:function(){var e={fill:this.state.pressed&&this.props.pressedColor||this.props.color},t={pointerEvents:"none",userSelect:"none",fontFamily:"Roboto",fontSize:14,fill:this.props.textColor||"white"};return a.a.createElement("g",{onTouchStart:this.touchStart,onTouchMove:this.touchMove,onTouchEnd:this.touchEnd,onClick:this.props.onPressed},a.a.createElement("rect",{x:this.props.x,y:this.props.y,rx:6,ry:6,width:this.props.width,height:this.props.height,style:e,className:"button "+this.props.className,shapeRendering:"auto"}),a.a.createElement("text",{x:this.props.x+this.props.width/2,y:this.props.y+this.props.height/2,textAnchor:"middle",style:t,className:"button "+this.props.className,alignmentBaseline:"central",dominantBaseline:"central"},this.props.text))}}]),t}(n.Component)),ke={fill:"transparent",strokeWidth:1.5,stroke:"#FFFFFF"},we={fill:"#FFFFFF3F",strokeWidth:1.5,stroke:"#FFFFFF"},Oe=function(e){var t=e.x,i=e.y,n=e.width,o=e.height,r=e.piece,s=e.orientation,c=e.selected,l=e.blockStyles,u=(n-8)/4;return a.a.createElement("g",null,a.a.createElement("rect",{fill:"transparent",x:t,y:i,rx:6,ry:6,width:n,height:o,shapeRendering:"auto",style:c?we:ke}),a.a.createElement(I,{piece:r,orientation:s,blockSize:u,blockStyles:l,cx:t+n/2,cy:i+o/2}))},xe=function(e){var t=e.x,i=e.y,n=e.width,o=e.height,r=e.piece,s=e.blockStyles;if(void 0===r||r===M)return null;var c=(n-8)/4;return a.a.createElement(I,{piece:r,orientation:1,blockSize:c,blockStyles:s,cx:t+n/2,cy:i+o/2})},Se=(i(134),function(e){function t(){var e,i;Object(l.a)(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(i=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).preventDefault=function(e){return e.preventDefault()},i}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("touchmove",this.preventDefault,!!k&&{passive:!1})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("touchmove",this.preventDefault)}},{key:"render",value:function(){var e,t=[window.innerWidth/-2,-680,window.innerWidth,680],i=this.props,n=i.config.blockStyles,o=i.gameState,r=i.readyMillis,s=i.readyAnimationIndex,c=i.previewSlots.map(function(e,t){return a.a.createElement(xe,{key:"pp".concat(t),x:e.x,y:e.y,width:e.width,height:e.height,piece:i.nextPieces[t],blockStyles:n})}),l=i.orientationSelectors.map(function(e,t){return a.a.createElement(Oe,{key:"ori".concat(t),x:e.x,y:e.y,width:e.width,height:e.height,orientation:e.orientation,piece:i.currentPiece,blockStyles:n,selected:i.orientation===e.orientation})}),u=i.fieldDimensions,h=u.x,d=u.y,f=u.width,p=u.height,m=u.rows,v=u.cols,g=u.blockSize;switch(i.gameMode){case"LINE TARGET":var b=h+85,y=d-10,E=h+140;e=a.a.createElement(a.a.Fragment,null,a.a.createElement(ve,{x:b,y:y,linesCleared:i.linesCleared,target:i.lineTarget}),a.a.createElement(ge,{x:E,y:y,timerMillis:i.timerMillis}));break;default:e=null}var k=h+26*i.activePosition.col,w=d+26*i.activePosition.row,O="PAUSED"===o?a.a.createElement(be,{x:h+f/2,y:d+p/2,className:"pause",text:"PAUSED"}):null,x=-1!==i.activePosition.row?a.a.createElement(I,{x:k,y:w,piece:i.currentPiece,orientation:i.orientation,placeable:i.placeable,blockStyles:n,blockSize:26}):null;return a.a.createElement("svg",{id:"game-canvas",preserveAspectRatio:"xMidYMax meet",shapeRendering:"crispEdges",textRendering:"optimizeLegibility",style:{touchAction:"none",width:i.windowWidth,height:i.windowHeight},onTouchStart:i.touchStart,onTouchMove:i.touchMove,onTouchEnd:i.touchEnd,onMouseDown:i.mouseDown,onMouseMove:i.mouseMove,onMouseUp:i.mouseUp,viewBox:t},a.a.createElement("defs",null,a.a.createElement("clipPath",{id:"field-clip"},a.a.createElement("rect",{x:h,y:d,width:f,height:p}))),a.a.createElement(me,{activePosition:i.activePosition,x:h,y:d,width:f,height:p,blockSize:g,blockStyles:n,rows:m,cols:v,gameState:o,blocks:i.blocks,blockCount:i.blockCount}),x,l,c,e,a.a.createElement(Ee,{x:h+f+8,y:d+8,width:58,height:32,text:"RESET",color:"#ec3636",pressedColor:"#dc2626",onPressed:i.reset}),a.a.createElement(Ee,{x:h+f+8,y:d+8+32+8,width:58,height:32,text:"MENU",color:"#3e3e3e",pressedColor:"#292929",onPressed:i.mainMenu}),a.a.createElement(Ee,{x:h+f+8,y:d+8+32+8+32+8,width:58,height:32,text:"PAUSE",color:"#3e3e3e",pressedColor:"#292929",onPressed:i.pause}),a.a.createElement(ye,{totalReadyMillis:1500,remainingMillis:r,animationIndex:s,maskId:"field-clip",x:h+f/2,y:d+p/2}),O)}}]),t}(n.Component)),Me=function(){function e(t){Object(l.a)(this,e),this.bag=[0,1,2,3,4,5,6],this.random=t,this.index=this.bag.length}return Object(u.a)(e,[{key:"next",value:function(){return this.index===this.bag.length&&(!function(e){for(var t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random,a=e.length;a;)i=Math.floor(n()*a--),t=e[a],e[a]=e[i],e[i]=t}(this.bag,this.random),this.index=0),this.bag[this.index++]}}]),e}(),Pe=[3,0,1,2],je=function(e){function t(e){var i;return Object(l.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e))).initialiseLayout(),i.keydown=i.keydown.bind(Object(p.a)(Object(p.a)(i))),i.gameLoop=i.gameLoop.bind(Object(p.a)(Object(p.a)(i))),i.selectOrientation=i.selectOrientation.bind(Object(p.a)(Object(p.a)(i))),i.updateOrientation=i.updateOrientation.bind(Object(p.a)(Object(p.a)(i))),i.init=i.init.bind(Object(p.a)(Object(p.a)(i))),i.start=i.start.bind(Object(p.a)(Object(p.a)(i))),i.mainMenu=i.mainMenu.bind(Object(p.a)(Object(p.a)(i))),i.pause=i.pause.bind(Object(p.a)(Object(p.a)(i))),i.dragMove=i.dragMove.bind(Object(p.a)(Object(p.a)(i))),i.dragEnd=i.dragEnd.bind(Object(p.a)(Object(p.a)(i))),i.mouseDown=i.mouseDown.bind(Object(p.a)(Object(p.a)(i))),i.mouseMove=i.mouseMove.bind(Object(p.a)(Object(p.a)(i))),i.mouseUp=i.mouseUp.bind(Object(p.a)(Object(p.a)(i))),i.touchMove=i.touchMove.bind(Object(p.a)(Object(p.a)(i))),i.touchEnd=i.touchEnd.bind(Object(p.a)(Object(p.a)(i))),i.touchStart=i.touchMove,i.mouseDown=i.mouseDown.bind(Object(p.a)(Object(p.a)(i))),i.mouseMove=i.mouseMove.bind(Object(p.a)(Object(p.a)(i))),i.mouseUp=i.mouseUp.bind(Object(p.a)(Object(p.a)(i))),i.init(),e.loadConfig(),i}return Object(f.a)(t,e),Object(u.a)(t,[{key:"initialiseLayout",value:function(){this.fieldDimensions={x:-162.5,y:-620,blockSize:26,rows:20,cols:10,width:260,height:520};var e=(70*Pe.length+16*(Pe.length-1))/-2;this.orientationSelectors=Pe.map(function(t,i){return{x:e+86*i,y:-84,width:70,height:70,orientation:t}});var t=this.fieldDimensions.x+260,i=this.fieldDimensions.y+520-65;this.previewSlots=Array(this.props.previewLength).fill(0).map(function(e,n){return{x:t+(0===n?0:5),y:i-55*n,width:65-(0===n?0:10),height:65-(0===n?0:10),index:n}})}},{key:"selectOrientation",value:function(e){this.orientation=e}},{key:"keydown",value:function(e){switch(e.keyCode){case 188:this.pieceDebug.next=!1,this.pieceDebug.prev=!0;break;case 190:this.pieceDebug.next=!0,this.pieceDebug.prev=!1}}},{key:"init",value:function(){this.pieceDebug={next:!1,prev:!1},this.nextPieces=[],this.randomizer=new Me(Math.random),this.activeTouches=0,this.mouseIsDown=!1,this.activePosition={row:-1,col:-1},this.field={blocks:Array(20).fill(0).map(function(e){return Array(10).fill(M)}),hiddenBlocks:Array(3).fill(0).map(function(e){return Array(10).fill(M)}),lineClearFlags:Array(20).fill(!1),hiddenLineClearFlags:Array(3).fill(!1)},this.nextPieces.length=0,this.linesCleared=0,this.orientation=-1,this.readyTimerMillis=1500,this.readyAnimationIndex=Math.floor(4*Math.random())}},{key:"start",value:function(){this.init(),this.props.reset(),this.rollNextPiece(),this.lastPlayingTime=new Date,this.totalTimerMillis=0}},{key:"pause",value:function(){if(this.props.gameState!==v){var e="PAUSED",t=new Date;if("PAUSED"===this.props.gameState)e="PLAYING",this.lastPlayingTime=t;else{var i=t-this.lastPlayingTime;this.lastPlayingTime=t,this.totalTimerMillis+=i}this.props.setGameState(e)}}},{key:"mainMenu",value:function(){this.props.setGameState("MENU")}},{key:"canvasPoint",value:function(e){var t=document.getElementById("game-canvas"),i=t.createSVGPoint();i.x=e.clientX,i.y=e.clientY;var n=i.matrixTransform(t.getScreenCTM().inverse());return{x:n.x,y:n.y}}},{key:"fieldPoint",value:function(e){var t=e.x-this.fieldDimensions.x,i=e.y-this.fieldDimensions.y;return{col:Math.floor(t/26),row:Math.floor(i/26)}}},{key:"updateOrientation",value:function(e){for(var t=e.x,i=e.y,n=0;n<this.orientationSelectors.length;n++){var a=this.orientationSelectors[n];if(i>a.y&&i<a.y+a.height&&t>a.x&&t<a.x+a.width){this.selectOrientation(a.orientation);break}}}},{key:"dragMove",value:function(e){if("PAUSED"!==this.props.gameState){this.updateOrientation(e);var t=this.fieldPoint(e);t.col>-1&&t.col<10&&t.row>-1&&t.row<20&&(this.activePosition.row=t.row,this.activePosition.col=t.col),this.place=!1}}},{key:"dragEnd",value:function(){"PAUSED"!==this.props.gameState&&(0!==this.activeTouches||this.mouseIsDown||(this.place=!0))}},{key:"mouseDown",value:function(e){e.preventDefault(),this.mouseIsDown=!0;var t=this.canvasPoint(e);this.dragMove(t)}},{key:"mouseMove",value:function(e){if(e.preventDefault(),this.mouseIsDown){var t=this.canvasPoint(e);this.dragMove(t)}}},{key:"mouseUp",value:function(e){e.preventDefault(),this.mouseIsDown=!1,this.dragEnd()}},{key:"touchMove",value:function(e){e.preventDefault(),this.activeTouches=e.touches.length;for(var t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t],n=this.canvasPoint(i);this.dragMove(n)}}},{key:"touchEnd",value:function(e){e.preventDefault(),this.activeTouches=e.touches.length,this.dragEnd()}},{key:"isLineFilled",value:function(e){for(var t=e.length,i=0;i<t;i++){if(e[i]===M)return!1}return!0}},{key:"setLineClearedFlag",value:function(e,t,i){e>=0?t.lineClearFlags[e]=i:t.hiddenLineClearFlags[-1*e-1]=i}},{key:"getLineClearedFlag",value:function(e,t){return t.lineClearFlags[e]||t.hiddenLineClearFlags[-1*e-1]}},{key:"getRow",value:function(e,t){return t.blocks[e]||t.hiddenBlocks[-1*e-1]}},{key:"downFloatingBlocks",value:function(e){for(var t=e.blocks.length,i=e.blocks[0].length,n=t-1,a=-3;a<t;a++)if(this.getLineClearedFlag(n,e)){for(var o=n;o>-3;o--){for(var r=this.getRow(o-1,e),s=this.getRow(o,e),c=0;c<i;c++){var l=void 0===r?M:r[c];s[c]=l}this.setLineClearedFlag(o,e,this.getLineClearedFlag(o-1,e))}for(var u=0;u<i;u++){e.hiddenBlocks[2][u]=M}}else n--}},{key:"doLineClears",value:function(e){for(var t=0,i=-1,n=e.blocks.length,a=-3;a<n;a++){var o=this.getRow(a,e);if(this.isLineFilled(o)){for(var r=o.length,s=0;s<r;s++)o[s]=M;t++,this.setLineClearedFlag(a,e,!0),-1===i&&(i=a)}}return t>0&&this.downFloatingBlocks(e),t}},{key:"rollNextPiece",value:function(){var e;e=0===this.nextPieces.length?this.randomizer.next():this.nextPieces[0];for(var t=this.nextPieces=this.nextPieces.slice(1);t.length<this.props.previewLength;)t.push(this.randomizer.next());this.props.nextPiece(e,t)}},{key:"checkGameOver",value:function(e,t){if(e===M)return!1;for(var i=0;i<t.blocks.length;i++)for(var n=t.blocks[i],a=0;a<n.length;a++)for(var o=0;o<Pe.length;o++){if(C(a,i,e,Pe[o],t))return!1}return!0}},{key:"gameLoop",value:function(){var e=new Date,t=e-this.lastPlayingTime;if(this.lastPlayingTime=e,this.props.gameState===v)this.readyTimerMillis-=t,this.props.updateReady(this.readyTimerMillis),this.readyTimerMillis<=0&&this.props.setGameState("PLAYING");else if("PLAYING"===this.props.gameState){if(this.props.setActiveGridPosition(this.activePosition),this.props.checkPlaceability(this.activePosition.col,this.activePosition.row,this.props.currentPiece,this.orientation,this.field),this.totalTimerMillis+=t,this.checkGameOver(this.props.currentPiece,this.field)&&this.props.setGameState("END"),this.place){var i=!1;if(this.props.placeable){!function(e,t,i,n,a){for(var o=P[i][n],r=j[i][n],s=N(e,t,i,n),c=s.xOffset,l=s.yOffset,u=0;u<o.length;u++){var h=c+o[u],d=l+r[u];(a.blocks[d]||a.hiddenBlocks[-1*d-1])[h]=i}}(this.activePosition.col,this.activePosition.row,this.props.currentPiece,this.orientation,this.field);var n=this.doLineClears(this.field);this.linesCleared+=n,this.props.updateStats(this.linesCleared),this.props.placeBlock(this.field),i=!0}switch(this.props.gameMode){case"ZEN":break;case"LINE TARGET":this.linesCleared>=this.props.lineTarget&&this.props.setGameState("END")}this.place=!1,i&&(this.activePosition.row=-1,this.activePosition.col=-1,this.orientation=-1,this.rollNextPiece())}this.props.selectOrientation(this.orientation),this.pieceDebug.prev=!1,this.pieceDebug.next=!1}this.props.updateTimer(this.totalTimerMillis)}},{key:"componentDidMount",value:function(){var e=this;window.onresize=function(){e.props.resize(window.innerWidth,window.innerHeight)},window.onresize(),document.addEventListener("keydown",this.keydown,!1),setInterval(this.gameLoop,33)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.keydown)}},{key:"render",value:function(){return"MENU"===this.props.gameState?a.a.createElement(de,{menu:this.props.menu,start:this.start}):"END"===this.props.gameState?a.a.createElement(fe,{gameMode:this.props.gameMode,blockCount:this.props.blockCount,linesCleared:this.props.linesCleared,reset:this.start,mainMenu:this.mainMenu,timerMillis:this.props.timerMillis}):a.a.createElement(Se,{gameState:this.props.gameState,activePosition:this.props.activePosition,orientationSelectors:this.orientationSelectors,previewSlots:this.previewSlots,nextPieces:this.props.nextPieces,fieldDimensions:this.fieldDimensions,currentPiece:this.props.currentPiece,orientation:this.props.orientation,placeable:this.props.placeable,blocks:this.props.field.blocks,config:this.props.config,linesCleared:this.props.linesCleared,blockCount:this.props.blockCount,lineTarget:this.props.lineTarget,timerMillis:this.props.timerMillis,readyMillis:this.props.readyMillis,readyAnimationIndex:this.readyAnimationIndex,gameMode:this.props.gameMode,reset:this.start,mainMenu:this.mainMenu,pause:this.pause,touchStart:this.touchStart,touchMove:this.touchMove,touchEnd:this.touchEnd,mouseDown:this.mouseDown,mouseMove:this.mouseMove,mouseUp:this.mouseUp,windowWidth:this.props.windowWidth,windowHeight:this.props.windowHeight})}}]),t}(n.Component),Ce=Object(s.b)(function(e){return{menu:e.menu,config:e.config,gameState:e.gameState,gameMode:e.gameMode,activePosition:e.activePosition,currentPiece:e.currentPiece,nextPieces:e.nextPieces,previewLength:e.previewLength,orientation:e.orientation,field:e.field,blockCount:e.blockCount,placeable:e.placeable,linesCleared:e.linesCleared,lineTarget:e.lineTarget,windowWidth:e.windowWidth,windowHeight:e.windowHeight,timerMillis:e.timerMillis,readyMillis:e.readyMillis}},function(e){return{setActiveGridPosition:function(t){e({type:Y,activePosition:t})},cyclePieces:function(t){var i;e({type:J,next:(i=t).next,prev:i.prev})},selectOrientation:function(t){e({type:X,orientation:t})},nextPiece:function(t,i){e({type:Z,nextPiece:t,nextPieces:i})},placeBlock:function(t){e(function(e){return{type:V,field:e}}(t))},checkPlaceability:function(t,i,n,a,o){e(function(e,t,i,n,a){return{type:K,x:e,y:t,piece:i,orientation:n,field:a}}(t,i,n,a,o))},updateStats:function(t){e(function(e){return{type:$,linesCleared:e}}(t))},reset:function(){e({type:q})},resize:function(t,i){e(function(e,t){return{type:Q,newWidth:e,newHeight:t}}(t,i))},setGameState:function(t){e(function(e){return{type:ee,gameState:e}}(t))},setGameMode:function(t){e(se(t))},updateReady:function(t){e(function(e){return{type:ne,readyMillis:e}}(t))},updateTimer:function(t){e(function(e){return{type:ae,timerMillis:e}}(t))},loadConfig:function(){e({type:re})}}})(je);var Te=function(e,t){return e.activePosition.row===t.activePosition.row&&e.activePosition.col===t.activePosition.col?e:Object(x.a)({},e,{activePosition:Object(x.a)({},t.activePosition)})};var Ne=function(){};var Ae=function(e,t){return e.orientation===t.orientation?e:Object(x.a)({},e,{orientation:t.orientation})};var De=function(e,t){return Object(x.a)({},e,{currentPiece:t.nextPiece,nextPieces:t.nextPieces})},Fe=i(48);var Ie=function(e,t){var i=t.field.blocks,n=function(e,t){for(var i=[],n=e.length,a=0;a<n;a++)for(var o=t[a],r=e[a],s=o.length,c=0;c<s;c++){var l=o[c];if(r[c]!==l){i.push(a);break}}return i}(e.field.blocks,i);if(0===n.length)return e;var a=Object(Fe.a)(e.field.blocks),o=!0,r=!1,s=void 0;try{for(var c,l=n[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var u=c.value;a[u]=Object(Fe.a)(i[u])}}catch(Xe){r=!0,s=Xe}finally{try{o||null==l.return||l.return()}finally{if(r)throw s}}return Object(x.a)({},e,{field:Object(x.a)({},e.field,{blocks:a}),blockCount:e.blockCount+1})},Le=function(e,t){var i=t.x,n=t.y,a=t.piece,o=t.orientation,r=t.field,s=e.placeable,c=C(i,n,a,o,r);return s===c?e:Object(x.a)({},e,{placeable:c})},Re=function(e,t){return e.readyMillis===t.readyMillis?e:Object(x.a)({},e,{readyMillis:t.readyMillis})};var Ue=function(e,t){return e.linesCleared===t.linesCleared?e:Object(x.a)({},e,{linesCleared:t.linesCleared})},Ge=function(e,t){return e.timerMillis===t.timerMillis?e:Object(x.a)({},e,{timerMillis:t.timerMillis})};var ze=function(e,t){return Object(x.a)({},e,{windowWidth:t.newWidth,windowHeight:t.newHeight})},Be=function(e,t){var i=t.gameState;return"PAUSED"===t.gameState&&"PAUSED"===e.gameState&&(i="PLAYING"),Object(x.a)({},e,{gameState:i})},We=function(e,t){return Object(x.a)({},e,{gameMode:t.gameMode})},_e=function(e,t){return Object(x.a)({},e,{menu:t.menu})},He={gameState:"MENU",activePosition:{row:-1,col:-1},currentPiece:M,previewLength:5,nextPieces:[],orientation:-1,placeable:!1,blockCount:0,linesCleared:0,lineTarget:40,timerMillis:0,readyMillis:1500,field:{blocks:Array(20).fill(0).map(function(e){return Array(10).fill(M)})},config:{version:0,blockStyles:b}};var Ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:He,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Y:return Te(e,t);case J:return Ne(e,t);case X:return Ae(e,t);case Z:return De(e,t);case V:return Ie(e,t);case K:return Le(e,t);case ne:return Re(e,t);case $:return Ue(e,t);case ae:return Ge(e,t);case oe:return W(e,t);case re:return function(e){var t=G.get(B);return t?Object(x.a)({},e,{config:t}):e}(e);case Q:return ze(e,t);case ee:return Be(e,t);case te:return We(e,t);case ie:return _e(e,t);case q:return Object(x.a)({},He,{config:e.config,windowWidth:e.windowWidth,windowHeight:e.windowHeight,gameMode:e.gameMode,gameState:v});default:return e}};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Je=Object(c.b)(Ye);r.a.render(a.a.createElement(s.a,{store:Je},a.a.createElement(Ce,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},45:function(e,t,i){},70:function(e,t,i){e.exports=i(136)}},[[70,2,1]]]);
//# sourceMappingURL=main.af1d5d50.chunk.js.map