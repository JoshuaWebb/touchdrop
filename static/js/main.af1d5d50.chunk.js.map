{"version":3,"sources":["components/Menu/Menu.jsx","constants.js","components/Menu/MainMenu.jsx","components/Block.jsx","components/Piece.jsx","components/Menu/StyleConfiguration.jsx","util.js","reducers/config.js","components/Menu/ImportExportSettings.jsx","actions/index.js","containers/Menu.js","components/Menu/MenuScreen.jsx","components/EndScreen.jsx","components/FieldBackground.jsx","components/Field.jsx","components/LineCount.jsx","components/Timer.jsx","components/OutlineText.jsx","components/ReadyGo.jsx","components/Button.jsx","components/OrientationSelector.jsx","components/PreviewPiece.jsx","components/Canvas.jsx","randomizers/BagRandomizer.js","App.js","containers/Game.js","reducers/setActiveGridPosition.js","reducers/cyclePieces.js","reducers/selectOrientation.js","reducers/nextPiece.js","reducers/placeBlock.js","reducers/checkPlaceability.js","reducers/updateReady.js","reducers/updateStats.js","reducers/updateTimer.js","reducers/resize.js","reducers/setGameState.js","reducers/setGameMode.js","reducers/setMenu.js","reducers/index.js","serviceWorker.js","index.js"],"names":["Menu","props","menuItems","items","map","item","react_default","a","createElement","key","text","onClick","className","GAMESTATE_READY","MENU_MAIN","defaultStyles","fill","testPassiveSupported","options","passive","window","addEventListener","removeEventListener","err","passiveSupported","MainMenu","setGameMode","start","setMenu","components_Menu_Menu","Block","classes","flash","piece","PIECE_NONE","placeable","x","y","width","blockSize","height","style","blockStyles","allPieceDataX","allPieceDataY","length","checkPlaceability","orientation","field","collides","checkCollision","supported","blocksX","blocksY","fieldWidth","blocks","fieldHeight","_getGridOffset2","getGridOffset","xOffset","yOffset","i","x2","y2","row","hiddenBlocks","undefined","getHeight","getMinX","getMinY","min","block","max","Piece","cx","cy","pieceDataX","pieceDataY","getWidth","minX","minY","src_components_Block","StyleConfiguration","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","changeHandler","event","name","target","value","setState","colors","objectSpread","state","defineProperty","save","config","values","updateConfig","reset","assign","cancel","_this2","viewBox","p","shapeRendering","preserveAspectRatio","components_Piece","backgroundColor","htmlFor","type","id","onChange","Component","millisecondsToTimestamp","totalMs","milliseconds","toFixed","slice","seconds","Math","floor","minutes","hours","isObject","Array","isArray","persistedData","set","localStorage","removeItem","stringValue","ctor","constructor","JSON","stringify","toString","Error","concat","setItem","get","getItem","parts","string","delimiter","maxSplits","arr","split","result","splice","push","join","splitMax","objectValue","ctorName","parse","Number","objectsHaveSameKeys","b","aKeys","keys","bKeys","aSet","Set","bSet","size","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","has","return","configKey","action","newConfig","mergeDeep","source","output","forEach","validateConfig","version","_i","ImportExportSettings","validateInput","valid","e","back","SET_ACTIVE_GRID_POSITION","CYCLE_PIECES","SELECT_ORIENTATION","NEXT_PIECE","PLACE_BLOCK","CHECK_PLACEABILITY","UPDATE_STATS","RESET","RESIZE","SET_GAME_STATE","SET_GAME_MODE","SET_MENU","UPDATE_READY","UPDATE_TIMER","UPDATE_CONFIG","LOAD_CONFIG","newMode","gameMode","connectFn","connect","menu","lineTarget","dispatch","_MainMenu","_StyleConfiguration","_ImportExportSettings","MenuScreen","containers_Menu_StyleConfiguration","containers_Menu_ImportExportSettings","containers_Menu_MainMenu","EndScreen","linesCleared","blockCount","endScreenMenuItems","mainMenu","statistics","timerMillis","stat","FieldBackground","_this$props","rows","cols","gridlines","c","x1","y1","r","pointerEvents","React","PureComponent","Field","nextProps","nextState","activePosition","col","_this$props2","_this$props2$activePo","selectedRow","selectedCol","grid","currentBlock","gridBlock","src_components_FieldBackground","strokeWidth","stroke","LineCount","textAnchor","fontFamily","fontSize","Timer","timestamp","OutlineText","textFill","alignmentBaseline","dominantBaseline","textOutline","cloneElement","Fragment","ReadyGo","totalReadyMillis","remainingMillis","animationIndex","maskId","showReady","readyClass","animation","clipPath","src_components_OutlineText","Button","pressed","touchStart","bind","assertThisInitialized","touchEnd","stopPropagation","pressedColor","color","textStyle","userSelect","textColor","onTouchStart","onTouchMove","touchMove","onTouchEnd","onPressed","rx","ry","selectedStyle","OrientationSelector","selected","padding","PreviewPiece","Canvas","preventDefault","gameModeHud","innerWidth","gameState","readyMillis","readyAnimationIndex","bagDisplay","previewSlots","ps","components_PreviewPiece","nextPieces","orientationSelectors","os","components_OrientationSelector","currentPiece","_props$fieldDimension","fieldDimensions","fieldX","fieldY","fieldRows","fieldCols","lineCountPositionX","lineCountPositionY","timerPositionX","components_LineCount","components_Timer","pieceX","pieceY","pauseText","activePiece","textRendering","touchAction","windowWidth","windowHeight","onMouseDown","mouseDown","onMouseMove","mouseMove","onMouseUp","mouseUp","components_Field","src_components_Button","pause","src_components_ReadyGo","BagRandomizer","random","bag","index","array","t","arguments","m","shuffle","orientations","App","initialiseLayout","keydown","gameLoop","selectOrientation","updateOrientation","init","dragMove","dragEnd","loadConfig","blockSizeInUnits","osXStart","psXStart","psYStart","previewLength","_","minorReduction","keyCode","pieceDebug","prev","randomizer","activeTouches","mouseIsDown","lineClearFlags","hiddenLineClearFlags","readyTimerMillis","rollNextPiece","lastPlayingTime","Date","totalTimerMillis","newState","now","millisDiff","setGameState","svg","document","getElementById","point","createSVGPoint","clientX","clientY","_point$matrixTransfor","matrixTransform","getScreenCTM","inverse","canvasPoint","fcpx","fcpy","fp","fieldPoint","place","cp","touches","changedTouches","touch","line","lineLength","flag","hiddenHeight","getLineClearedFlag","k","rowUp","getRow","l","blk","setLineClearedFlag","firstLine","isLineFilled","rowLength","downFloatingBlocks","nextPiece","updateReady","setActiveGridPosition","checkGameOver","placed","_getGridOffset","placeBlock","lines","doLineClears","updateStats","updateTimer","onresize","resize","innerHeight","setInterval","Menu_MenuScreen","src_components_EndScreen","components_Canvas","Game","param","cyclePieces","debug","np","nps","newWidth","newHeight","newGameState","exportFn","data","newField","changedRows","oldField","numRows","newRow","oldRow","numCols","newBlock","getChangedRows","toConsumableArray","reducers_checkPlaceability","oldPlaceable","newPlaceable","reducers_updateReady","reducers_updateTimer","reducers_setGameState","reducers_setGameMode","reducers_setMenu","initialState","reducer","existingConfig","Boolean","location","hostname","match","store","createStore","ReactDOM","render","es","containers_Game","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"8bA0BeA,SAtBF,SAACC,GAAU,IAKhBC,EAFFD,EADFE,MAGsBC,IAAI,SAAAC,GAAI,OAC9BC,EAAAC,EAAAC,cAAA,MAAIC,IAAKJ,EAAKK,KACVC,QAASN,EAAKM,QACdC,UAAU,UACTP,EAAKK,QAIZ,OACEJ,EAAAC,EAAAC,cAAA,OAAKI,UAAU,QACbN,EAAAC,EAAAC,cAAA,UACGN,MChBIW,EAAkB,QAKlBC,EAAY,OAYZC,EAAgB,CAC3B,CAAEC,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,YAINC,GAAuB,EAE3B,IACE,IAAIC,EAAU,CACZC,cAKE,OAHAF,GAAuB,GAGhB,IAIXG,OAAOC,iBAAiB,OAAQH,EAASA,GACzCE,OAAOE,oBAAoB,OAAQJ,EAASA,GAC5C,MAAMK,IACNN,GAAuB,EAGlB,IAAMO,EAAmBP,ECFjBQ,EAtCE,SAACxB,GAChB,IAAMC,EAAY,CAChB,CACEQ,KAAM,WACNC,QAAS,WACPV,EAAMyB,YDVc,OCWpBzB,EAAM0B,UAGV,CACEjB,KAAM,mBACNC,QAAS,WACPV,EAAMyB,YDhBsB,eCoB5BzB,EAAM0B,UAGV,CACEjB,KAAM,kBACNC,QAAS,WACPV,EAAM2B,QDvBqB,WC0B/B,CACElB,KAAM,2BACNC,QAAS,WACPV,EAAM2B,QD5BoB,oBCiChC,OACEtB,EAAAC,EAAAC,cAACqB,EAAD,CAAM1B,MAAOD,oBCpBF4B,iBAnBD,SAAC7B,GACb,IAAM8B,EAAW,eACd9B,EAAM+B,MAAQ,oBAAsB,KACpC/B,EAAMgC,QAAUC,EAAa,eAAiB,MAC1B,IAApBjC,EAAMkC,UAAsB,gBAAkB,IAGjD,OACE7B,EAAAC,EAAAC,cAAA,QACE4B,EAAGnC,EAAMmC,EACTC,EAAGpC,EAAMoC,EACTC,MAAOrC,EAAMsC,UACbC,OAAQvC,EAAMsC,UACdE,MAAOxC,EAAMyC,YAAYzC,EAAMgC,OAC/BrB,UAAWmB,MChBJG,GAAc,EAerBS,EAAgB,CACpB,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,KAGlCC,EAAgB,CACpB,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,E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","file":"static/js/main.af1d5d50.chunk.js","sourcesContent":["import React from 'react';\r\n\r\nimport './Menu.css';\r\n\r\nconst Menu = (props) => {\r\n  const {\r\n    items,\r\n  } = props;\r\n\r\n  const menuItems = items.map(item =>\r\n    <li key={item.text}\r\n        onClick={item.onClick}\r\n        className=\"button\" >\r\n        {item.text}\r\n    </li>\r\n  );\r\n\r\n  return (\r\n    <div className=\"menu\">\r\n      <ul>\r\n        {menuItems}\r\n      </ul>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Menu;\r\n","export const GAMESTATE_MENU = 'MENU';\r\nexport const GAMESTATE_PLAYING = 'PLAYING';\r\nexport const GAMESTATE_PAUSED = 'PAUSED';\r\nexport const GAMESTATE_END = 'END';\r\nexport const GAMESTATE_READY = 'READY';\r\n\r\nexport const GAMEMODE_ZEN = 'ZEN';\r\nexport const GAMEMODE_LINE_TARGET = 'LINE TARGET';\r\n\r\nexport const MENU_MAIN = 'MAIN';\r\nexport const MENU_STYLE_SETTINGS = 'STYLE';\r\nexport const MENU_IMPORT_EXPORT = 'IMPORT_EXPORT';\r\n\r\nexport const blockSizeInUnits = 26;\r\n\r\nexport const fieldWidthInBlocks = 10;\r\nexport const fieldHeightInBlocks = 20;\r\nexport const hiddenHeight = 3;\r\n\r\nexport const totalReadyMillis = 1500;\r\n\r\nexport const defaultStyles = [\r\n  { fill: '#708090' }, // I\r\n  { fill: '#f5c635' }, // L\r\n  { fill: '#ee8817' }, // O\r\n  { fill: '#47b450' }, // Z\r\n  { fill: '#ee575b' }, // T\r\n  { fill: '#9155f4' }, // J\r\n  { fill: '#009fd4' }, // S\r\n];\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\r\nvar testPassiveSupported = false;\r\n\r\ntry {\r\n  var options = {\r\n    get passive() { // This function will be called when the browser\r\n                    //     attempts to access the passive property.\r\n      testPassiveSupported = true;\r\n\r\n      // make linter happy\r\n      return true;\r\n    }\r\n  };\r\n\r\n  window.addEventListener(\"test\", options, options);\r\n  window.removeEventListener(\"test\", options, options);\r\n} catch(err) {\r\n  testPassiveSupported = false;\r\n}\r\n\r\nexport const passiveSupported = testPassiveSupported;\r\n","import React from 'react';\r\n\r\nimport Menu from './Menu';\r\n\r\nimport {\r\n  GAMEMODE_ZEN,\r\n  GAMEMODE_LINE_TARGET,\r\n  MENU_STYLE_SETTINGS,\r\n  MENU_IMPORT_EXPORT,\r\n} from '../../constants';\r\n\r\nconst MainMenu = (props) => {\r\n  const menuItems = [\r\n    {\r\n      text: 'ZEN MODE',\r\n      onClick: () => {\r\n        props.setGameMode(GAMEMODE_ZEN);\r\n        props.start();\r\n      },\r\n    },\r\n    {\r\n      text: 'LINE TARGET MODE',\r\n      onClick: () => {\r\n        props.setGameMode(GAMEMODE_LINE_TARGET);\r\n        // TODO: we probably want a settings screen\r\n        // for a bunch of the different modes, rather\r\n        // than starting the game immediately.\r\n        props.start();\r\n      },\r\n    },\r\n    {\r\n      text: 'CUSTOMIZE STYLE',\r\n      onClick: () => {\r\n        props.setMenu(MENU_STYLE_SETTINGS);\r\n      },\r\n    },\r\n    {\r\n      text: 'IMPORT / EXPORT SETTINGS',\r\n      onClick: () => {\r\n        props.setMenu(MENU_IMPORT_EXPORT);\r\n      },\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <Menu items={menuItems} />\r\n  );\r\n};\r\n\r\nexport default MainMenu;\r\n","import React from 'react';\r\n\r\nimport './Block.css';\r\n\r\nimport { PIECE_NONE } from './Piece';\r\n\r\nconst Block = (props) => {\r\n  const classes = (\"grid-block \" +\r\n    (props.flash ? \"grid-block-flash \" : \"\") +\r\n    (props.piece !== PIECE_NONE ? \"piece-block \" : \"\") +\r\n    (props.placeable === false ? \"cannot-place \" : \"\")\r\n  );\r\n\r\n  return (\r\n    <rect\r\n      x={props.x}\r\n      y={props.y}\r\n      width={props.blockSize}\r\n      height={props.blockSize}\r\n      style={props.blockStyles[props.piece]}\r\n      className={classes}\r\n     />\r\n  )\r\n};\r\n\r\nexport default Block;\r\n","import React from 'react';\r\n\r\nimport Block from './Block';\r\n\r\nexport const PIECE_NONE = -1;\r\nexport const PIECE_I = 0;\r\nexport const PIECE_L = 1;\r\nexport const PIECE_O = 2;\r\nexport const PIECE_Z = 3;\r\nexport const PIECE_T = 4;\r\nexport const PIECE_J = 5;\r\nexport const PIECE_S = 6;\r\n\r\nexport const ORIENTATION_NONE  = -1;\r\nexport const ORIENTATION_UP    = 0;\r\nexport const ORIENTATION_RIGHT = 1;\r\nexport const ORIENTATION_DOWN  = 2;\r\nexport const ORIENTATION_LEFT  = 3;\r\n\r\nconst allPieceDataX = [\r\n  [[0,1,2,3],[2,2,2,2],[3,2,1,0],[1,1,1,1]],  // I\r\n  [[2,2,1,0],[2,1,1,1],[0,0,1,2],[0,1,1,1]],  // L\r\n  [[0,1,1,0],[1,1,0,0],[1,0,0,1],[0,0,1,1]],  // O\r\n  [[0,1,1,2],[2,2,1,1],[2,1,1,0],[0,0,1,1]],  // Z\r\n  [[1,0,1,2],[2,1,1,1],[1,2,1,0],[0,1,1,1]],  // T\r\n  [[0,0,1,2],[2,1,1,1],[2,2,1,0],[0,1,1,1]],  // J\r\n  [[2,1,1,0],[2,2,1,1],[0,1,1,2],[0,0,1,1]],  // S\r\n];\r\n\r\nconst allPieceDataY = [\r\n  [[1,1,1,1],[0,1,2,3],[2,2,2,2],[3,2,1,0]],  // I\r\n  [[0,1,1,1],[2,2,1,0],[2,1,1,1],[0,0,1,2]],  // L\r\n  [[0,0,1,1],[0,1,1,0],[1,1,0,0],[1,0,0,1]],  // O\r\n  [[0,0,1,1],[0,1,1,2],[2,2,1,1],[2,1,1,0]],  // Z\r\n  [[0,1,1,1],[1,0,1,2],[2,1,1,1],[1,2,1,0]],  // T\r\n  [[0,1,1,1],[0,0,1,2],[2,1,1,1],[2,2,1,0]],  // J\r\n  [[0,0,1,1],[2,1,1,0],[2,2,1,1],[0,1,1,2]],  // S\r\n];\r\n\r\nexport const PIECE_COUNT = allPieceDataX.length;\r\n\r\nexport function placeBlock(x, y, piece, orientation, field) {\r\n  const blocksX = allPieceDataX[piece][orientation];\r\n  const blocksY = allPieceDataY[piece][orientation];\r\n\r\n  const { xOffset, yOffset } = getGridOffset(x, y, piece, orientation);\r\n\r\n  for (var i = 0; i < blocksX.length; i++) {\r\n    const x2 = xOffset + blocksX[i];\r\n    const y2 = yOffset + blocksY[i];\r\n\r\n    const row = field.blocks[y2] || field.hiddenBlocks[y2 * -1 - 1];\r\n    row[x2] = piece;\r\n  }\r\n}\r\n\r\nexport function checkPlaceability(x, y, piece, orientation, field) {\r\n  if (piece !== PIECE_NONE &&\r\n      orientation !== -1 &&\r\n      x !== -1 &&\r\n      y !== -1\r\n  ) {\r\n    // TODO: check if the piece has a valid path to get\r\n    // to this position from the top.\r\n    //\r\n    // Idea: Instead of a consant reference point at the top,\r\n    // ave a regular piece dropping slowly and move it\r\n    // left/right as the player drags the destination left/right\r\n    // if the regular piece becomes obstructed, the player can\r\n    // no longer move it in that direction, and if the piece\r\n    // lands in a lockable position before the player lets go\r\n    // lock the piece. The dragging should assume optimal play\r\n    // including valid spins/kicks.\r\n    const collides = checkCollision(x, y, piece, orientation, field);\r\n    const supported = !collides && checkCollision(x, y + 1, piece, orientation, field);\r\n    return !collides && supported;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport function checkCollision(x, y, piece, orientation, field) {\r\n  const blocksX = allPieceDataX[piece][orientation];\r\n  const blocksY = allPieceDataY[piece][orientation];\r\n\r\n  const fieldWidth = field.blocks[0].length;\r\n  const fieldHeight = field.length;\r\n\r\n  const { xOffset, yOffset } = getGridOffset(x, y, piece, orientation);\r\n\r\n  for (var i = 0; i < blocksX.length; i++) {\r\n    const x2 = xOffset + blocksX[i];\r\n    const y2 = yOffset + blocksY[i];\r\n\r\n    // Off the left edge of the field\r\n    if (x2 < 0) {\r\n      return true;\r\n    }\r\n\r\n    // Off the right / bottom edge of the field\r\n    if (x2 >= fieldWidth || y2 >= fieldHeight) {\r\n      return true;\r\n    }\r\n\r\n    const row = field.blocks[y2] || field.hiddenBlocks[y2 * -1 - 1];\r\n\r\n    // Off the top edge (past the hidden blocks) of the field\r\n    if (row === undefined) {\r\n      return true;\r\n    }\r\n\r\n    // Collides with a previously placed block\r\n    if (row[x2] !== PIECE_NONE) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n// TODO: don't create a new object just to return\r\n// these values.\r\nfunction getGridOffset(x, y, piece, orientation) {\r\n  const height = getHeight(piece, orientation);\r\n\r\n  const minX = getMinX(piece, orientation);\r\n  const minY = getMinY(piece, orientation);\r\n\r\n  const xOffset = x - minX;\r\n  const yOffset = y - (minY + height - 1);\r\n\r\n  return { xOffset, yOffset };\r\n}\r\n\r\n// TODO: cache these...\r\nfunction getMinX(piece, orientation) {\r\n  const blocks = allPieceDataX[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n  }\r\n\r\n  return min;\r\n}\r\n\r\nfunction getMinY(piece, orientation) {\r\n  const blocks = allPieceDataY[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n  }\r\n\r\n  return min;\r\n}\r\n\r\nfunction getWidth (piece, orientation) {\r\n  const blocks = allPieceDataX[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n  var max = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n    max = max > block ? max : block;\r\n  }\r\n\r\n  return (max - min) + 1;\r\n}\r\n\r\nfunction getHeight (piece, orientation) {\r\n  const blocks = allPieceDataY[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n  var max = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n    max = max > block ? max : block;\r\n  }\r\n\r\n  return (max - min) + 1;\r\n}\r\n\r\nconst Piece = (props) => {\r\n  const {\r\n    piece, orientation, blockSize, placeable,\r\n    cx, cy, x, y,\r\n    blockStyles,\r\n  } = props;\r\n\r\n  if (piece === PIECE_NONE || orientation === ORIENTATION_NONE)\r\n    return null;\r\n\r\n  const pieceDataX = allPieceDataX[piece][orientation];\r\n  const pieceDataY = allPieceDataY[piece][orientation];\r\n\r\n  const width = getWidth(piece, orientation);\r\n  const height = getHeight(piece, orientation);\r\n\r\n  const minX = getMinX(piece, orientation);\r\n  const minY = getMinY(piece, orientation);\r\n\r\n  var xOffset;\r\n  var yOffset;\r\n  if (cx !== undefined && cy !== undefined) {\r\n    xOffset = (cx - minX * blockSize - (width  * blockSize / 2));\r\n    yOffset = (cy - minY * blockSize - (height * blockSize / 2));\r\n  } else {\r\n    xOffset = x - minX * blockSize;\r\n    yOffset = y - (minY + height - 1) * blockSize;\r\n  }\r\n\r\n  return (\r\n    pieceDataX.map((x, i) => {\r\n      const y = pieceDataY[i];\r\n      return (\r\n        <Block\r\n          key={i}\r\n          x={xOffset + x * blockSize}\r\n          y={yOffset + y * blockSize}\r\n          placeable={placeable}\r\n          piece={piece}\r\n          blockStyles={blockStyles}\r\n          blockSize={blockSize} />\r\n      );\r\n    })\r\n  );\r\n};\r\n\r\nexport default Piece;\r\n","import React, { Component } from 'react';\r\n\r\nimport './StyleConfiguration.css';\r\nimport './Menu.css';\r\n\r\nimport {\r\n  blockSizeInUnits,\r\n  defaultStyles,\r\n  MENU_MAIN,\r\n} from '../../constants';\r\n\r\nimport Piece, { ORIENTATION_UP } from '../Piece';\r\n\r\nclass StyleConfiguration extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      colors: Object.assign({}, props.config.blockStyles),\r\n    };\r\n  }\r\n\r\n  changeHandler = event => {\r\n    const name = event.target.name;\r\n    const value = event.target.value;\r\n\r\n    this.setState({\r\n      colors: {\r\n        ...this.state.colors,\r\n        [name]: {\r\n          fill: value,\r\n        },\r\n      }\r\n    });\r\n  }\r\n\r\n  save = () => {\r\n    const config = {\r\n      blockStyles: Object.values(this.state.colors)\r\n    };\r\n\r\n    this.props.updateConfig(config);\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  reset = () => {\r\n    this.setState({\r\n      colors: Object.assign({}, defaultStyles),\r\n    });\r\n  }\r\n\r\n  cancel = () => {\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  render() {\r\n    const { config: { blockStyles } } = this.props;\r\n    const blockSize = blockSizeInUnits;\r\n\r\n    const viewBox = [0, 0, blockSize * 4, blockSize * 4];\r\n    const items = blockStyles.map((p, i) =>\r\n      <li key={i} className=\"color-config-item\">\r\n        <svg\r\n          shapeRendering=\"crispEdges\"\r\n          preserveAspectRatio=\"xMidYMid slice\"\r\n          width={blockSize * 3}\r\n          height={blockSize * 2.25}\r\n          viewBox={viewBox}\r\n        >\r\n          <Piece\r\n            piece={i}\r\n            orientation={ORIENTATION_UP}\r\n            blockSize={blockSize}\r\n            blockStyles={this.state.colors}\r\n            cx={blockSize * 2}\r\n            cy={blockSize * 2}\r\n          />\r\n        </svg>\r\n        <label\r\n          className=\"color-picker\"\r\n          style={{\r\n            backgroundColor: this.state.colors[i].fill,\r\n            width: \"30px\",\r\n            height: \"30px\",\r\n          }}\r\n          htmlFor={\"cp-\" + i} >\r\n          <input\r\n            className=\"color-picker\"\r\n            type=\"color\"\r\n            id={\"cp-\" + i}\r\n            name={i}\r\n            value={this.state.colors[i].fill}\r\n            onChange={this.changeHandler} />\r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          id={\"ct-\" + i}\r\n          name={i}\r\n          value={this.state.colors[i].fill}\r\n          onChange={this.changeHandler} />\r\n      </li>\r\n    );\r\n\r\n    return (\r\n      <div className=\"menu\">\r\n        <ul className=\"color-config-items\">\r\n          {items}\r\n        </ul>\r\n        <ul>\r\n          <li className=\"button cancel\" onClick={this.cancel}>\r\n            CANCEL\r\n          </li>\r\n          <li className=\"button reset\" onClick={this.reset}>\r\n            RESET TO DEFAULTS\r\n          </li>\r\n          <li className=\"button save\" onClick={this.save}>\r\n            SAVE\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    )\r\n  }\r\n};\r\n\r\nexport default StyleConfiguration;\r\n","// https://bost.ocks.org/mike/shuffle/\r\nexport function shuffle(array, random = Math.random) {\r\n  var m = array.length, t, i;\r\n\r\n  // While there remain elements to shuffle\r\n  while (m) {\r\n    // Pick a remaining element\r\n    i = Math.floor(random() * m--);\r\n\r\n    // And swap it with the current element.\r\n    t = array[m];\r\n    array[m] = array[i];\r\n    array[i] = t;\r\n  }\r\n\r\n  return array;\r\n}\r\n\r\n// variation of https://stackoverflow.com/a/37168679\r\nexport function millisecondsToTimestamp(totalMs) {\r\n  var milliseconds = (totalMs % 1000).toFixed(0);\r\n  milliseconds = (\"000\" + milliseconds).slice(-3);\r\n\r\n  var seconds = Math.floor(totalMs / 1000).toFixed(0);\r\n  var minutes = Math.floor(seconds / 60);\r\n  var hours = \"\";\r\n  if (minutes > 59) {\r\n    hours = Math.floor(minutes / 60);\r\n    minutes = minutes - (hours * 60);\r\n    minutes = (minutes >= 10) ? minutes : \"0\" + minutes;\r\n  }\r\n\r\n  seconds = Math.floor(seconds % 60);\r\n  seconds = (seconds >= 10) ? seconds : \"0\" + seconds;\r\n  if (hours !== \"\") {\r\n    return hours + \":\" + minutes + \":\" + seconds + \".\" + milliseconds;\r\n  }\r\n\r\n  return minutes + \":\" + seconds + \".\" + milliseconds;\r\n}\r\n\r\n// https://stackoverflow.com/a/37164538\r\nfunction isObject(item) {\r\n  return (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\nexport function mergeDeep(target, source) {\r\n  let output = Object.assign({}, target);\r\n  if (isObject(target) && isObject(source)) {\r\n    Object.keys(source).forEach(key => {\r\n      if (isObject(source[key])) {\r\n        if (!(key in target))\r\n          Object.assign(output, { [key]: source[key] });\r\n        else\r\n          output[key] = mergeDeep(target[key], source[key]);\r\n      } else {\r\n        Object.assign(output, { [key]: source[key] });\r\n      }\r\n    });\r\n  }\r\n  return output;\r\n}\r\n\r\nfunction splitMax(string, delimiter, maxSplits) {\r\n  let arr = string.split(delimiter);\r\n  let result = arr.splice(0, maxSplits - 1);\r\n\r\n  result.push(arr.join(delimiter));\r\n\r\n  return result;\r\n}\r\n\r\n// Facade over localStorage that handles basic\r\n// numbers, strings, objects and arrays.\r\n//\r\n// Note if the object contains sub-objects of\r\n// other types, these will most likely not be\r\n// detected and lost in the conversion.\r\nexport const persistedData = {\r\n  set: function(key, value) {\r\n    if (!key) {return;}\r\n\r\n    if (value === null || value === undefined) {\r\n      window.localStorage.removeItem(key);\r\n    }\r\n\r\n    const ctor = value.constructor.name;\r\n    let stringValue;\r\n    // This handles simple property based objects\r\n    // and arrays but it doesn't support classes\r\n    // the caller should handle serialization\r\n    // themselves.\r\n    switch (ctor) {\r\n      case 'Array': // through\r\n      case 'Object': stringValue = JSON.stringify(value); break;\r\n      case 'String': stringValue = value; break;\r\n      case 'Number': stringValue = value.toString(); break;\r\n      default: throw new Error(`Type ${ctor} not supported`);\r\n    }\r\n\r\n    window.localStorage.setItem(key, `pd:${ctor}:${stringValue}`);\r\n  },\r\n\r\n  get: function(key) {\r\n    var value = localStorage.getItem(key);\r\n\r\n    // values are always strings, so if we\r\n    // get a literal null, it wasn't in there.\r\n    if (value === null) {return;}\r\n\r\n    const maxParts = 3;\r\n    const parts = splitMax(value, ':', maxParts);\r\n    if (parts.length < maxParts || parts[0] !== 'pd') {\r\n      // value was definitely not stored using this facade\r\n      return value;\r\n    }\r\n\r\n    // At this point we assume the value was stored using\r\n    // the facade, if it wasn't then we've probably got\r\n    // a bug somewhere else (OR someone has been messing\r\n    // with the data manually).\r\n    const ctorName = parts[1];\r\n    const stringValue = parts[2];\r\n    let objectValue;\r\n    switch (ctorName) {\r\n      case 'Array': // through\r\n      case 'Object': objectValue = JSON.parse(stringValue); break;\r\n      case 'String': objectValue = stringValue; break;\r\n      case 'Number': objectValue = Number(stringValue); break;\r\n      default: throw new Error(\r\n        `Non-facade value '${value}' was stored` +\r\n        `but was attempted to be retrieved through the facade.`\r\n      );\r\n    }\r\n\r\n    return objectValue;\r\n  }\r\n}\r\n\r\nexport function objectsHaveSameKeys(a, b) {\r\n  const aKeys = Object.keys(a);\r\n  const bKeys = Object.keys(b);\r\n  const aSet = new Set(aKeys);\r\n  const bSet = new Set(bKeys);\r\n\r\n  if (aSet.size !== bSet.size) return false;\r\n\r\n  for (let item of aSet) {\r\n    if (!bSet.has(item)) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n","import {\r\n  mergeDeep,\r\n  persistedData,\r\n  objectsHaveSameKeys,\r\n} from '../util';\r\n\r\nimport {\r\n  defaultStyles,\r\n} from '../constants';\r\n\r\nconst configKey = 'config';\r\n\r\nexport function loadConfig (state) {\r\n  const existingConfig = persistedData.get(configKey);\r\n  if (existingConfig) {\r\n    return {\r\n      ...state,\r\n      config: existingConfig,\r\n    }\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function updateConfig (state, action) {\r\n  const newConfig = mergeDeep(state.config, action.config);\r\n\r\n  if (!validateConfig(newConfig)) {\r\n    return state;\r\n  }\r\n\r\n  persistedData.set(configKey, newConfig);\r\n\r\n  return {\r\n    ...state,\r\n    config: newConfig,\r\n  };\r\n}\r\n\r\nexport function validateConfig(config) {\r\n  if (!config) {\r\n    return false;\r\n  }\r\n\r\n  if (config.version !== 0) {\r\n    // NOTE: when we update the version of this for reals,\r\n    // we'll probably want a facility to upgrade a config\r\n    // object through the various (supported) versions so\r\n    // any configs that players have stored offline can\r\n    // still be used and brought up to date.\r\n    return false;\r\n  }\r\n\r\n  if (!config.blockStyles) {\r\n    return false;\r\n  }\r\n\r\n  if (!objectsHaveSameKeys(config.blockStyles, defaultStyles)) {\r\n    return false;\r\n  }\r\n\r\n  const keys = Object.keys(config.blockStyles);\r\n  for (let key of keys) {\r\n    const newStyle = config.blockStyles[key];\r\n    const defaultStyle = defaultStyles[key];\r\n\r\n    if (!objectsHaveSameKeys(newStyle, defaultStyle)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n","import React, { Component } from 'react';\r\n\r\nimport './Menu.css';\r\nimport './ImportExportSettings.css';\r\n\r\nimport {\r\n  MENU_MAIN,\r\n} from '../../constants';\r\n\r\nimport { validateConfig } from '../../reducers/config';\r\n\r\nclass ImportExportSettings extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      config: JSON.stringify(props.config),\r\n      valid: true,\r\n    };\r\n  }\r\n\r\n  validateInput = (value) => {\r\n    let config;\r\n    let valid = true;\r\n\r\n    try {\r\n      config = JSON.parse(value);\r\n      valid = validateConfig(config);\r\n    } catch (e) {\r\n      valid = false;\r\n    }\r\n\r\n    return valid;\r\n  }\r\n\r\n  changeHandler = event => {\r\n    const value = event.target.value;\r\n    const valid = this.validateInput(value);\r\n    this.setState({config: value, valid: valid});\r\n  }\r\n\r\n  save = () => {\r\n    if (!this.state.valid) {\r\n      return;\r\n    }\r\n\r\n    const config = JSON.parse(this.state.config);\r\n\r\n    this.props.updateConfig(config);\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  back = () => {\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"menu\">\r\n        <div id=\"config-text-holder\">\r\n          <textarea\r\n            id=\"config-text\"\r\n            value={this.state.config}\r\n            className={this.state.valid ? \"\" : \"invalid-input\"}\r\n            onChange={this.changeHandler} />\r\n        </div>\r\n        <ul>\r\n          <li className=\"button cancel\" onClick={this.back}>\r\n            BACK\r\n          </li>\r\n          <li className=\"button save\" onClick={this.save}>\r\n            SAVE\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    )\r\n  }\r\n};\r\n\r\nexport default ImportExportSettings;\r\n","export const SET_ACTIVE_GRID_POSITION = 'SET_ACTIVE_GRID_POSITION';\r\nexport const CYCLE_PIECES = 'CYCLE_PIECES';\r\nexport const SELECT_ORIENTATION = 'SELECT_ORIENTATION';\r\nexport const NEXT_PIECE = 'NEXT_PIECE';\r\nexport const PLACE_BLOCK = 'PLACE_BLOCK';\r\nexport const CHECK_PLACEABILITY = 'CHECK_PLACEABILITY';\r\nexport const UPDATE_STATS = 'UPDATE_STATS';\r\nexport const RESET = 'RESET';\r\nexport const RESIZE = 'RESIZE';\r\nexport const SET_GAME_STATE = 'SET_GAME_STATE'\r\nexport const SET_GAME_MODE = 'SET_GAME_MODE'\r\nexport const SET_MENU = 'SET_MENU'\r\nexport const UPDATE_READY = 'UPDATE_READY'\r\nexport const UPDATE_TIMER = 'UPDATE_TIMER'\r\nexport const UPDATE_CONFIG = 'UPDATE_CONFIG'\r\nexport const LOAD_CONFIG = 'LOAD_CONFIG'\r\n\r\nexport const setActiveGridPosition = activePosition => ({\r\n  type: SET_ACTIVE_GRID_POSITION,\r\n  activePosition: activePosition,\r\n});\r\n\r\nexport const cyclePieces = debug => ({\r\n  type: CYCLE_PIECES,\r\n  next: debug.next,\r\n  prev: debug.prev,\r\n});\r\n\r\nexport const selectOrientation = orientation => ({\r\n  type: SELECT_ORIENTATION,\r\n  orientation: orientation,\r\n});\r\n\r\nexport const nextPiece = (nextPiece, nextPieces) => ({\r\n  type: NEXT_PIECE,\r\n  nextPiece: nextPiece,\r\n  nextPieces: nextPieces,\r\n});\r\n\r\nexport const placeBlock = (field) => ({\r\n  type: PLACE_BLOCK,\r\n  field: field,\r\n});\r\n\r\nexport const checkPlaceability = (x, y, piece, orientation, field) => ({\r\n  type: CHECK_PLACEABILITY,\r\n  x: x,\r\n  y: y,\r\n  piece: piece,\r\n  orientation: orientation,\r\n  field: field,\r\n});\r\n\r\nexport const updateStats = (linesCleared) => ({\r\n  type: UPDATE_STATS,\r\n  linesCleared: linesCleared,\r\n});\r\n\r\nexport const reset = () => ({\r\n  type: RESET,\r\n});\r\n\r\nexport const resize = (newWidth, newHeight) => ({\r\n  type: RESIZE,\r\n  newWidth: newWidth,\r\n  newHeight: newHeight,\r\n});\r\n\r\nexport const setGameState = (newGameState) => ({\r\n  type: SET_GAME_STATE,\r\n  gameState: newGameState,\r\n});\r\n\r\nexport const setGameMode = (newMode) => ({\r\n  type: SET_GAME_MODE,\r\n  gameMode: newMode,\r\n});\r\n\r\nexport const setMenu = (menu) => ({\r\n  type: SET_MENU,\r\n  menu: menu,\r\n});\r\n\r\nexport const updateReady = (readyMillis) => ({\r\n  type: UPDATE_READY,\r\n  readyMillis: readyMillis,\r\n});\r\n\r\nexport const updateTimer = (timerMillis) => ({\r\n  type: UPDATE_TIMER,\r\n  timerMillis: timerMillis,\r\n});\r\n\r\nexport const updateConfig = (config) => ({\r\n  type: UPDATE_CONFIG,\r\n  config: config,\r\n});\r\n\r\nexport const loadConfig = () => ({\r\n  type: LOAD_CONFIG,\r\n});\r\n","import { connect } from 'react-redux';\r\n\r\nimport _MainMenu from '../components/Menu/MainMenu';\r\nimport _StyleConfiguration from '../components/Menu/StyleConfiguration';\r\nimport _ImportExportSettings from '../components/Menu/ImportExportSettings';\r\n\r\nimport {\r\n  setMenu,\r\n  setGameMode,\r\n  updateConfig,\r\n} from '../actions/index';\r\n\r\nconst mapStateToProps = state => ({\r\n  config: state.config,\r\n  menu: state.menu,\r\n  gameMode: state.gameMode,\r\n  lineTarget: state.lineTarget,\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  setMenu: (menu) => {\r\n    dispatch(setMenu(menu));\r\n  },\r\n  setGameMode: (newMode) => {\r\n    dispatch(setGameMode(newMode));\r\n  },\r\n  updateConfig: (config) => {\r\n    dispatch(updateConfig(config));\r\n  },\r\n});\r\n\r\nconst connectFn = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps,\r\n);\r\n\r\nexport const MainMenu = connectFn(_MainMenu);\r\nexport const StyleConfiguration = connectFn(_StyleConfiguration);\r\nexport const ImportExportSettings = connectFn(_ImportExportSettings);\r\n","import React from 'react';\r\n\r\nimport {\r\n  StyleConfiguration,\r\n  MainMenu,\r\n  ImportExportSettings,\r\n} from '../../containers/Menu';\r\n\r\nimport {\r\n  MENU_MAIN,\r\n  MENU_STYLE_SETTINGS,\r\n  MENU_IMPORT_EXPORT,\r\n} from '../../constants';\r\n\r\nconst MenuScreen = (props) => {\r\n  switch (props.menu) {\r\n    case MENU_STYLE_SETTINGS: return (<StyleConfiguration />);\r\n    case MENU_IMPORT_EXPORT: return (<ImportExportSettings />);\r\n\r\n    case MENU_MAIN: // through\r\n    default: return (<MainMenu start={props.start} />);\r\n  }\r\n};\r\n\r\nexport default MenuScreen;\r\n","import React from 'react';\r\n\r\nimport './EndScreen.css';\r\nimport Menu from './Menu/Menu';\r\n\r\nimport { millisecondsToTimestamp } from '../util';\r\n\r\nconst EndScreen = (props) => {\r\n  const {\r\n    gameMode,\r\n    linesCleared,\r\n    blockCount,\r\n    reset,\r\n    mainMenu,\r\n    timerMillis,\r\n  } = props;\r\n\r\n  const endScreenMenuItems = [\r\n    {\r\n      text: \"NEW GAME\",\r\n      onClick: reset,\r\n    },\r\n    {\r\n      text: \"MAIN MENU\",\r\n      onClick: mainMenu,\r\n    },\r\n  ];\r\n\r\n  const statistics = [\r\n    {\r\n      name: \"Total Pieces\",\r\n      value: blockCount,\r\n    },\r\n    {\r\n      name: \"Total Lines\",\r\n      value: linesCleared,\r\n    },\r\n    {\r\n      name: \"Time\",\r\n      value: millisecondsToTimestamp(timerMillis),\r\n    },\r\n  ].map(stat => (\r\n      <div className=\"row\" key={stat.name}>\r\n        <span className=\"name\">{stat.name}: </span>\r\n        <span className=\"value\">{stat.value}</span>\r\n      </div>\r\n    )\r\n  );\r\n\r\n  return (\r\n    <div className=\"end-screen\">\r\n      <div>\r\n        <h1 className=\"mode-name\">{gameMode}</h1>\r\n        <h1>FINISH</h1>\r\n      </div>\r\n      <div className=\"statistics\">\r\n        {statistics}\r\n      </div>\r\n      <div>\r\n        <Menu items={endScreenMenuItems} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EndScreen;\r\n","import React from 'react';\r\n\r\nimport './FieldBackground.css';\r\n\r\nclass FieldBackground extends React.PureComponent {\r\n  render() {\r\n    const backgroundStyle = { fill: '#232323' };\r\n\r\n    const {\r\n      x, y,\r\n      width, height,\r\n      blockSize,\r\n      rows, cols,\r\n    } = this.props;\r\n\r\n    var gridlines = [];\r\n    for (let c = 1; c < cols; c++) {\r\n      gridlines.push(<line\r\n        key={`cl${c}`}\r\n        x1={x + c * blockSize} y1={y}\r\n        x2={x + c * blockSize} y2={y + height}\r\n        className=\"grid-line\"\r\n      />);\r\n    }\r\n\r\n    for (let r = 1; r < rows; r++) {\r\n      gridlines.push(<line\r\n        key={`rl${r}`}\r\n        x1={x}         y1={y + r * blockSize}\r\n        x2={x + width} y2={y + r * blockSize}\r\n        className=\"grid-line\"\r\n      />);\r\n    }\r\n\r\n    return (\r\n      <g>\r\n        <rect\r\n          id=\"field-background\"\r\n          style={backgroundStyle}\r\n          x={x}\r\n          y={y}\r\n          width={width}\r\n          height={height}\r\n          pointerEvents=\"none\"\r\n        />\r\n        {gridlines}\r\n      </g>\r\n    );\r\n  }\r\n};\r\n\r\nexport default FieldBackground;\r\n","import React, { Component } from 'react';\r\n\r\nimport Block from './Block';\r\nimport FieldBackground from './FieldBackground';\r\n\r\nclass Field extends Component {\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    const { activePosition, blockCount } = this.props;\r\n\r\n    return activePosition.row !== nextProps.activePosition.row ||\r\n           activePosition.col !== nextProps.activePosition.col ||\r\n           blockCount !== nextProps.blockCount;\r\n  }\r\n\r\n  render() {\r\n    const borderStyle = {\r\n      fill: 'transparent',\r\n      strokeWidth:1,\r\n      stroke: '#FFFFFF',\r\n    };\r\n\r\n    const {\r\n      x, y,\r\n      width, height,\r\n      blockSize,\r\n      rows, cols,\r\n      blockStyles,\r\n      activePosition: {\r\n        row: selectedRow,\r\n        col: selectedCol\r\n      }\r\n    } = this.props;\r\n\r\n\r\n    var grid = [];\r\n    for (let r = 0; r < rows; r++) {\r\n      for (let c = 0; c < cols; c++) {\r\n        const id = r * cols + c;\r\n        const currentBlock = this.props.blocks[r][c];\r\n        const gridBlock =\r\n          <Block\r\n            id={id}\r\n            key={id}\r\n            x={x + c * blockSize}\r\n            y={y + r * blockSize}\r\n            blockSize={blockSize}\r\n            blockStyles={blockStyles}\r\n            piece={currentBlock}\r\n            flash={r === selectedRow && c === selectedCol}\r\n          />;\r\n        grid.push(gridBlock);\r\n      }\r\n    }\r\n\r\n    return (\r\n      <g id=\"field\">\r\n        <FieldBackground\r\n          x={x}\r\n          y={y}\r\n          width={width}\r\n          height={height}\r\n          rows={rows}\r\n          cols={cols}\r\n          blockSize={blockSize}\r\n        />\r\n        {grid}\r\n        <rect\r\n          id=\"field-border\"\r\n          style={borderStyle}\r\n          x={x}\r\n          y={y}\r\n          width={width}\r\n          height={height}\r\n          pointerEvents=\"none\"\r\n        />\r\n      </g>\r\n    );\r\n  }\r\n};\r\n\r\nexport default Field;\r\n","import React from 'react';\r\n\r\nconst LineCount = (props) => {\r\n\r\n  const style = {\r\n    fontFamily: 'Roboto',\r\n    fontSize: 30,\r\n    fill: '#cfabec',\r\n  }\r\n\r\n  return (\r\n    <text textAnchor=\"end\" x={props.x} y={props.y} style={style}>\r\n      {props.linesCleared} / {props.target}\r\n    </text>\r\n  )\r\n};\r\n\r\nexport default LineCount;","import React from 'react';\r\n\r\nimport { millisecondsToTimestamp } from '../util';\r\n\r\nconst Timer = (props) => {\r\n  const {\r\n    x, y,\r\n    timerMillis,\r\n  } = props;\r\n\r\n  const style = {\r\n    fontSize: 30,\r\n    fill: '#cfabec',\r\n  }\r\n\r\n  const timestamp = millisecondsToTimestamp(timerMillis);\r\n\r\n  return (\r\n    <text\r\n      x={x}\r\n      y={y}\r\n      style={style}>\r\n    {timestamp}\r\n    </text>\r\n  );\r\n};\r\n\r\nexport default Timer;\r\n","import React from 'react';\r\n\r\nimport './OutlineText.css';\r\n\r\nconst OutlineText = (props) => {\r\n  const {\r\n    text,\r\n    x, y,\r\n    className,\r\n  } = props;\r\n\r\n  const textFill= (\r\n    <text\r\n      x={x}\r\n      y={y}\r\n      className={className}\r\n      textAnchor=\"middle\"\r\n      alignmentBaseline=\"central\"\r\n      dominantBaseline=\"central\"\r\n    >\r\n      {text}\r\n    </text>);\r\n\r\n  const textOutline = React.cloneElement(textFill, {className: `${className} text-outline`});\r\n  return (\r\n    <React.Fragment>\r\n      {textOutline}\r\n      {textFill}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default OutlineText;\r\n","import React from 'react';\r\n\r\nimport OutlineText from './OutlineText';\r\nimport './ReadyGo.css';\r\n\r\nconst ReadyGo = (props) => {\r\n  const {\r\n    totalReadyMillis,\r\n    remainingMillis,\r\n    animationIndex,\r\n    maskId,\r\n    x, y,\r\n  } = props;\r\n\r\n  if (remainingMillis <= 0) {\r\n    return null;\r\n  }\r\n\r\n  // ghetto hack to restart animation\r\n  // on repeated \"reset\"s\r\n  if (totalReadyMillis <= remainingMillis) {\r\n    return null;\r\n  }\r\n\r\n  const showReady = remainingMillis > (totalReadyMillis / 2);\r\n  const readyClass = showReady ? \"ready\" : \"go\";\r\n  const animation = showReady ? `ready-${animationIndex}` : \"\";\r\n\r\n  return (\r\n    <g clipPath={`url(#${maskId})`} >\r\n      <g className={animation}>\r\n        <OutlineText\r\n          x={x}\r\n          y={y}\r\n          className={readyClass}\r\n          text={showReady ? 'READY' : 'GO'}\r\n         />\r\n      </g>\r\n    </g>\r\n  );\r\n};\r\n\r\nexport default ReadyGo;\r\n","import React, { Component } from 'react';\r\n\r\nimport './Button.css';\r\n\r\nclass Button extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { pressed: false };\r\n    this.touchStart = this.touchStart.bind(this);\r\n    this.touchEnd = this.touchEnd.bind(this);\r\n  }\r\n\r\n  touchStart(event) {\r\n    event.stopPropagation();\r\n    this.setState({pressed: true})\r\n  }\r\n\r\n  touchMove(event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  touchEnd(event) {\r\n    event.stopPropagation();\r\n    this.setState({pressed: false})\r\n  }\r\n\r\n  render() {\r\n    const style = {\r\n      fill: (this.state.pressed ?\r\n              (this.props.pressedColor || this.props.color) :\r\n              this.props.color),\r\n    };\r\n\r\n    const textStyle = {\r\n      pointerEvents: \"none\",\r\n      userSelect: \"none\",\r\n      fontFamily: \"Roboto\",\r\n      // TODO: dynamic font size (or dynamic width?)\r\n      fontSize: 14,\r\n      fill: (this.props.textColor || \"white\"),\r\n    };\r\n\r\n    return (\r\n      <g onTouchStart={this.touchStart}\r\n         onTouchMove={this.touchMove}\r\n         onTouchEnd={this.touchEnd}\r\n         onClick={this.props.onPressed}>\r\n        <rect\r\n          x={this.props.x}\r\n          y={this.props.y}\r\n          rx={6}\r\n          ry={6}\r\n          width={this.props.width}\r\n          height={this.props.height}\r\n          style={style}\r\n          className={\"button \" + this.props.className}\r\n          shapeRendering=\"auto\"\r\n        />\r\n        <text\r\n          x={this.props.x + this.props.width / 2}\r\n          y={this.props.y + this.props.height / 2}\r\n          textAnchor=\"middle\"\r\n          style={textStyle}\r\n          className={\"button \" + this.props.className}\r\n          alignmentBaseline=\"central\"\r\n          dominantBaseline=\"central\"\r\n        >{this.props.text}</text>\r\n      </g>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Button;\r\n","import React from 'react';\r\n\r\nimport Piece from './Piece';\r\n\r\nconst style = {\r\n  fill: 'transparent',\r\n  strokeWidth: 1.5,\r\n  stroke: '#FFFFFF',\r\n};\r\n\r\nconst selectedStyle = {\r\n  fill: '#FFFFFF3F',\r\n  strokeWidth: 1.5,\r\n  stroke: '#FFFFFF',\r\n};\r\n\r\nconst OrientationSelector = (props) => {\r\n  const { x, y, width, height, piece, orientation, selected, blockStyles } = props;\r\n\r\n  const padding = 4;\r\n  const cornerRadius = 6;\r\n  const blockSize = (width - padding * 2) / 4;\r\n\r\n  return (\r\n    <g>\r\n      <rect\r\n        fill=\"transparent\"\r\n        x={x}\r\n        y={y}\r\n        rx={cornerRadius}\r\n        ry={cornerRadius}\r\n        width={width}\r\n        height={height}\r\n        shapeRendering=\"auto\"\r\n        style={selected ? selectedStyle : style} />\r\n      <Piece\r\n        piece={piece}\r\n        orientation={orientation}\r\n        blockSize={blockSize}\r\n        blockStyles={blockStyles}\r\n        cx={x + width / 2}\r\n        cy={y + height / 2}\r\n      />\r\n    </g>\r\n  )\r\n};\r\n\r\nexport default OrientationSelector;\r\n","import React from 'react';\r\n\r\nimport Piece, { PIECE_NONE, ORIENTATION_RIGHT } from './Piece';\r\n\r\nconst PreviewPiece = (props) => {\r\n  const { x, y, width, height, piece, blockStyles } = props;\r\n  if (piece === undefined || piece === PIECE_NONE) {\r\n    return null;\r\n  }\r\n\r\n  const orientation = ORIENTATION_RIGHT;\r\n  const padding = 4;\r\n  const blockSize = (width - padding * 2) / 4;\r\n\r\n  return (\r\n    <Piece\r\n      piece={piece}\r\n      orientation={orientation}\r\n      blockSize={blockSize}\r\n      blockStyles={blockStyles}\r\n      cx={x + width / 2}\r\n      cy={y + height / 2}\r\n    />\r\n  )\r\n};\r\n\r\nexport default PreviewPiece;\r\n","import React, { Component } from 'react';\r\n\r\nimport Field from './Field';\r\nimport Piece from './Piece';\r\nimport LineCount from './LineCount';\r\nimport Timer from './Timer';\r\nimport ReadyGo from './ReadyGo';\r\nimport Button from './Button';\r\nimport OrientationSelector from './OrientationSelector';\r\nimport PreviewPiece from './PreviewPiece';\r\nimport OutlineText from './OutlineText';\r\n\r\nimport './Pause.css';\r\n\r\nimport {\r\n  blockSizeInUnits,\r\n  GAMEMODE_LINE_TARGET,\r\n  GAMESTATE_PAUSED,\r\n  passiveSupported,\r\n  totalReadyMillis,\r\n} from '../constants';\r\n\r\nclass Canvas extends Component {\r\n  preventDefault = (e) => e.preventDefault();\r\n\r\n  componentDidMount() {\r\n    // We need this for iOS to prevent \"overscroll\" and\r\n    // \"pull down to refresh\"\r\n    window.addEventListener('touchmove', this.preventDefault,\r\n      passiveSupported ? { passive: false } : false\r\n    );\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('touchmove', this.preventDefault);\r\n  }\r\n\r\n  render() {\r\n  const gameHeight = 680;\r\n  const viewBox = [window.innerWidth / -2, -gameHeight, window.innerWidth, gameHeight];\r\n  const props = this.props;\r\n\r\n  const {\r\n    config: {\r\n      blockStyles\r\n    },\r\n    gameState,\r\n    readyMillis,\r\n    readyAnimationIndex,\r\n  } = props;\r\n\r\n  const bagDisplay = props.previewSlots.map((ps, i) =>\r\n    <PreviewPiece\r\n      key={`pp${i}`}\r\n      x={ps.x} y={ps.y}\r\n      width={ps.width} height={ps.height}\r\n      piece={props.nextPieces[i]}\r\n      blockStyles={blockStyles}\r\n    />\r\n  );\r\n\r\n  const orientationSelectors = props.orientationSelectors.map((os, i) =>\r\n    <OrientationSelector\r\n      key={`ori${i}`}\r\n      x={os.x} y={os.y}\r\n      width={os.width} height={os.height}\r\n      orientation={os.orientation}\r\n      piece={props.currentPiece}\r\n      blockStyles={blockStyles}\r\n      selected={props.orientation === os.orientation}\r\n    />\r\n  );\r\n\r\n  const {\r\n    x: fieldX, y: fieldY,\r\n    width: fieldWidth, height: fieldHeight,\r\n    rows: fieldRows, cols: fieldCols,\r\n    blockSize,\r\n  } = props.fieldDimensions;\r\n\r\n  let gameModeHud;\r\n  switch (props.gameMode) {\r\n    case GAMEMODE_LINE_TARGET: {\r\n      // TODO: calculate the position for this properly...\r\n      const lineCountPositionX = fieldX + 85;\r\n      const lineCountPositionY = fieldY - 10;\r\n      const timerPositionX = fieldX + 140;\r\n      gameModeHud = <React.Fragment>\r\n        <LineCount\r\n          x={lineCountPositionX}\r\n          y={lineCountPositionY}\r\n          linesCleared={props.linesCleared}\r\n          target={props.lineTarget}\r\n        />\r\n        <Timer\r\n          x={timerPositionX}\r\n          y={lineCountPositionY}\r\n          timerMillis={props.timerMillis}\r\n        />\r\n      </React.Fragment>\r\n    } break;\r\n    default: gameModeHud = null;\r\n  }\r\n\r\n  const pieceX = fieldX + props.activePosition.col * blockSizeInUnits;\r\n  const pieceY = fieldY + props.activePosition.row * blockSizeInUnits;\r\n\r\n  const pauseText = (gameState === GAMESTATE_PAUSED\r\n    ? <OutlineText\r\n        x={fieldX + fieldWidth/2}\r\n        y={fieldY + fieldHeight/2}\r\n        className=\"pause\"\r\n        text=\"PAUSED\" />\r\n    : null);\r\n\r\n  const activePiece = (props.activePosition.row !== -1\r\n    ? <Piece\r\n        x={pieceX}\r\n        y={pieceY}\r\n        piece={props.currentPiece}\r\n        orientation={props.orientation}\r\n        placeable={props.placeable}\r\n        blockStyles={blockStyles}\r\n        blockSize={blockSizeInUnits} />\r\n    : null);\r\n\r\n  const fieldClipId = \"field-clip\";\r\n  return (\r\n    <svg\r\n      id=\"game-canvas\"\r\n      preserveAspectRatio=\"xMidYMax meet\"\r\n      shapeRendering=\"crispEdges\"\r\n      textRendering=\"optimizeLegibility\"\r\n      style={ {\r\n        touchAction: 'none',\r\n        width: props.windowWidth,\r\n        height: props.windowHeight,\r\n      } }\r\n      onTouchStart={props.touchStart}\r\n      onTouchMove={props.touchMove}\r\n      onTouchEnd={props.touchEnd}\r\n      onMouseDown={props.mouseDown}\r\n      onMouseMove={props.mouseMove}\r\n      onMouseUp={props.mouseUp}\r\n      viewBox={viewBox}\r\n    >\r\n      <defs>\r\n        <clipPath id={fieldClipId} >\r\n          <rect\r\n            x={fieldX}\r\n            y={fieldY}\r\n            width={fieldWidth}\r\n            height={fieldHeight} />\r\n        </clipPath>\r\n      </defs>\r\n      <Field\r\n        activePosition={props.activePosition}\r\n        x={fieldX}\r\n        y={fieldY}\r\n        width={fieldWidth}\r\n        height={fieldHeight}\r\n        blockSize={blockSize}\r\n        blockStyles={blockStyles}\r\n        rows={fieldRows}\r\n        cols={fieldCols}\r\n        gameState={gameState}\r\n        blocks={props.blocks}\r\n        blockCount={props.blockCount} />\r\n      {activePiece}\r\n      {orientationSelectors}\r\n      {bagDisplay}\r\n      {gameModeHud}\r\n      <Button\r\n        // TODO: calculate the position for this properly...\r\n        x={fieldX + fieldWidth + 8} y={fieldY + 8}\r\n        width={58}\r\n        height={32}\r\n        text=\"RESET\"\r\n        color=\"#ec3636\"\r\n        pressedColor=\"#dc2626\"\r\n        onPressed={props.reset}\r\n      />\r\n      <Button\r\n        // TODO: calculate the position for this properly...\r\n        x={fieldX + fieldWidth + 8} y={fieldY + 8 + 32 + 8}\r\n        width={58}\r\n        height={32}\r\n        text=\"MENU\"\r\n        color=\"#3e3e3e\"\r\n        pressedColor=\"#292929\"\r\n        onPressed={props.mainMenu}\r\n      />\r\n      <Button\r\n        // TODO: calculate the position for this properly...\r\n        x={fieldX + fieldWidth + 8} y={fieldY + 8 + 32 + 8 + 32 + 8}\r\n        width={58}\r\n        height={32}\r\n        text=\"PAUSE\"\r\n        color=\"#3e3e3e\"\r\n        pressedColor=\"#292929\"\r\n        onPressed={props.pause}\r\n      />\r\n      <ReadyGo\r\n        totalReadyMillis={totalReadyMillis}\r\n        remainingMillis={readyMillis}\r\n        animationIndex={readyAnimationIndex}\r\n        maskId={fieldClipId}\r\n        x={fieldX + fieldWidth/2}\r\n        y={fieldY + fieldHeight/2}\r\n      />\r\n      {pauseText}\r\n    </svg>\r\n  );\r\n}\r\n}\r\n\r\nexport default Canvas;\r\n","import { shuffle } from '../util';\r\n\r\nclass BagRandomizer {\r\n  constructor(random) {\r\n    // TODO: use piece constants?\r\n    this.bag = [0, 1, 2, 3, 4, 5, 6];\r\n    this.random = random;\r\n    this.index = this.bag.length;\r\n  }\r\n\r\n  next() {\r\n   if (this.index === this.bag.length) {\r\n      shuffle(this.bag, this.random);\r\n      this.index = 0;\r\n    }\r\n\r\n    return this.bag[this.index++];\r\n  }\r\n}\r\n\r\nexport default BagRandomizer;\r\n","import React, { Component } from 'react';\r\n\r\nimport MenuScreen from './components/Menu/MenuScreen';\r\nimport EndScreen from './components/EndScreen';\r\nimport Canvas from './components/Canvas';\r\n\r\nimport BagRandomizer from './randomizers/BagRandomizer';\r\n\r\nimport {\r\n  fieldWidthInBlocks, fieldHeightInBlocks,\r\n  blockSizeInUnits, hiddenHeight,\r\n  totalReadyMillis,\r\n  GAMESTATE_PAUSED, GAMESTATE_MENU, GAMESTATE_END, GAMESTATE_PLAYING, GAMESTATE_READY,\r\n  GAMEMODE_ZEN,\r\n  GAMEMODE_LINE_TARGET,\r\n} from './constants';\r\n\r\nimport {\r\n  placeBlock, PIECE_NONE, ORIENTATION_NONE,\r\n  ORIENTATION_UP, ORIENTATION_RIGHT,\r\n  ORIENTATION_DOWN, ORIENTATION_LEFT,\r\n  checkPlaceability,\r\n} from './components/Piece';\r\n\r\nconst orientations = [\r\n  ORIENTATION_LEFT,\r\n  ORIENTATION_UP,\r\n  ORIENTATION_RIGHT,\r\n  ORIENTATION_DOWN\r\n];\r\n\r\nclass App extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.initialiseLayout();\r\n\r\n    this.keydown = this.keydown.bind(this);\r\n    this.gameLoop = this.gameLoop.bind(this);\r\n    this.selectOrientation = this.selectOrientation.bind(this);\r\n    this.updateOrientation = this.updateOrientation.bind(this);\r\n    this.init = this.init.bind(this);\r\n    this.start = this.start.bind(this);\r\n    this.mainMenu = this.mainMenu.bind(this);\r\n    this.pause = this.pause.bind(this);\r\n    this.dragMove = this.dragMove.bind(this);\r\n    this.dragEnd = this.dragEnd.bind(this);\r\n    this.mouseDown = this.mouseDown.bind(this);\r\n    this.mouseMove = this.mouseMove.bind(this);\r\n    this.mouseUp   = this.mouseUp.bind(this);\r\n    this.touchMove = this.touchMove.bind(this);\r\n    this.touchEnd = this.touchEnd.bind(this);\r\n    // we don't need any special logic for tracking\r\n    // the initial touches at the moment.\r\n    this.touchStart = this.touchMove;\r\n\r\n    this.mouseDown = this.mouseDown.bind(this);\r\n    this.mouseMove = this.mouseMove.bind(this);\r\n    this.mouseUp   = this.mouseUp.bind(this);\r\n\r\n    this.init();\r\n    props.loadConfig();\r\n  }\r\n\r\n  initialiseLayout() {\r\n    const previewSize = 65;\r\n\r\n    //\r\n    // Field\r\n    //\r\n    const yOffset = 100;\r\n    const fieldWidth  = blockSizeInUnits * fieldWidthInBlocks;\r\n    const fieldHeight = blockSizeInUnits * fieldHeightInBlocks;\r\n\r\n    this.fieldDimensions = {\r\n      // Center the field (but shift over for the preview pieces)\r\n      x: fieldWidth / -2 - previewSize/2,\r\n      y: -yOffset-fieldHeight,\r\n      blockSize: blockSizeInUnits,\r\n      rows: fieldHeightInBlocks,\r\n      cols: fieldWidthInBlocks,\r\n      width: fieldWidth,\r\n      height: fieldHeight,\r\n    };\r\n\r\n    //\r\n    // Orientation selectors\r\n    //\r\n    const osMargin = 16;\r\n    const osSize = 70;\r\n    const osYStart = -yOffset + osMargin;\r\n\r\n    const allOsWidth = (osSize * orientations.length + osMargin * (orientations.length - 1));\r\n    const osXStart = (allOsWidth / -2);\r\n\r\n    this.orientationSelectors = orientations.map((orientation, i) => ({\r\n      x: osXStart + (osSize + osMargin)*i,\r\n      y: osYStart,\r\n      width: osSize,\r\n      height: osSize,\r\n      orientation: orientation,\r\n    }));\r\n\r\n    //\r\n    // Preview pieces\r\n    //\r\n\r\n    // We want to emphasize the next piece more than the\r\n    // rest, but we still want everything to be centered.\r\n    const minorReduction = 10;\r\n\r\n    const psXStart = this.fieldDimensions.x + fieldWidth;\r\n    const psYStart = this.fieldDimensions.y + fieldHeight - previewSize;\r\n    this.previewSlots = Array(this.props.previewLength).fill(0).map((_, i) => {\r\n      return {\r\n        x: psXStart + (i === 0 ? 0 : minorReduction / 2),\r\n        y: psYStart - (previewSize - minorReduction)*i,\r\n        width: previewSize - (i === 0 ? 0 : minorReduction),\r\n        height: previewSize - (i === 0 ? 0 : minorReduction),\r\n        index: i,\r\n      }\r\n    });\r\n  }\r\n\r\n  // TODO: We should change the name of one of these\r\n  // to disambiguate it from the action that actually\r\n  // updates the state/container.\r\n  selectOrientation(orientation) {\r\n    this.orientation = orientation;\r\n  }\r\n\r\n  keydown(event) {\r\n    // TODO: configurable keys\r\n    switch (event.keyCode) {\r\n      // ',' (<)\r\n      case 188:\r\n        this.pieceDebug.next = false;\r\n        this.pieceDebug.prev = true;\r\n      break;\r\n      // '.' (>)\r\n      case 190:\r\n        this.pieceDebug.next = true;\r\n        this.pieceDebug.prev = false;\r\n      break;\r\n      // no default\r\n    }\r\n  }\r\n\r\n  init() {\r\n    // internal state\r\n    this.pieceDebug = {\r\n      next : false,\r\n      prev : false,\r\n    };\r\n\r\n    this.nextPieces = [];\r\n\r\n    // TODO: use a seedable random function\r\n    this.randomizer = new BagRandomizer(Math.random);\r\n    this.activeTouches = 0;\r\n    this.mouseIsDown = false;\r\n    this.activePosition = {\r\n      row : -1,\r\n      col : -1,\r\n    };\r\n\r\n    this.field = {\r\n      blocks:\r\n        Array(fieldHeightInBlocks).fill(0).map(r =>\r\n          Array(fieldWidthInBlocks).fill(PIECE_NONE)),\r\n      hiddenBlocks:\r\n        Array(hiddenHeight).fill(0).map(r =>\r\n          Array(fieldWidthInBlocks).fill(PIECE_NONE)),\r\n      lineClearFlags: Array(fieldHeightInBlocks).fill(false),\r\n      hiddenLineClearFlags: Array(hiddenHeight).fill(false),\r\n    };\r\n\r\n    this.nextPieces.length = 0;\r\n\r\n    // TODO: clean up the duplication / inconsistency between this\r\n    // and redux when we initialise / reset the game.\r\n    this.linesCleared = 0;\r\n    this.orientation = ORIENTATION_NONE;\r\n    this.readyTimerMillis = totalReadyMillis;\r\n    // TODO: Should the animation explicitly use the same source of\r\n    // randomness/be captured for (future) replay purposes?\r\n    this.readyAnimationIndex = Math.floor(Math.random() * 4);\r\n  }\r\n\r\n  start() {\r\n    this.init();\r\n    this.props.reset();\r\n    this.rollNextPiece();\r\n\r\n    // TODO: \"READY\" / \"GO\"\r\n    this.lastPlayingTime = new Date();\r\n    this.totalTimerMillis = 0;\r\n  }\r\n\r\n  pause() {\r\n    if (this.props.gameState === GAMESTATE_READY) {\r\n      return;\r\n    }\r\n\r\n    let newState = GAMESTATE_PAUSED;\r\n    const now = new Date();\r\n\r\n    if (this.props.gameState === GAMESTATE_PAUSED) {\r\n      newState = GAMESTATE_PLAYING;\r\n      this.lastPlayingTime = now;\r\n    } else {\r\n      const millisDiff = now - this.lastPlayingTime;\r\n      this.lastPlayingTime = now;\r\n      this.totalTimerMillis += millisDiff;\r\n    }\r\n\r\n    this.props.setGameState(newState);\r\n  }\r\n\r\n  mainMenu() {\r\n    this.props.setGameState(GAMESTATE_MENU);\r\n  }\r\n\r\n  // TODO: we probably will want to do these way more\r\n  // efficiently in the future. These are highly likely\r\n  // to cause a boat load of GC\r\n  canvasPoint(event) {\r\n    const svg = document.getElementById('game-canvas');\r\n    const point = svg.createSVGPoint();\r\n    point.x = event.clientX;\r\n    point.y = event.clientY;\r\n    const { x, y } = point.matrixTransform(svg.getScreenCTM().inverse());\r\n    return {x, y};\r\n  }\r\n\r\n  fieldPoint(canvasPoint) {\r\n    const fcpx = canvasPoint.x - this.fieldDimensions.x;\r\n    const fcpy = canvasPoint.y - this.fieldDimensions.y;\r\n\r\n    const col = Math.floor(fcpx / blockSizeInUnits);\r\n    const row = Math.floor(fcpy / blockSizeInUnits);\r\n\r\n    return {col, row};\r\n  }\r\n\r\n  updateOrientation(canvasPoint) {\r\n    const { x, y } = canvasPoint;\r\n\r\n    for (var i = 0; i < this.orientationSelectors.length; i++) {\r\n      const os = this.orientationSelectors[i];\r\n      if (y > os.y && y < os.y + os.height &&\r\n          x > os.x && x < os.x + os.width) {\r\n        this.selectOrientation(os.orientation);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  dragMove(canvasPoint) {\r\n    if (this.props.gameState === GAMESTATE_PAUSED) {\r\n      return;\r\n    }\r\n\r\n    this.updateOrientation(canvasPoint);\r\n\r\n    const fp = this.fieldPoint(canvasPoint);\r\n    if (fp.col > -1 && fp.col < fieldWidthInBlocks &&\r\n        fp.row > -1 && fp.row < fieldHeightInBlocks)\r\n    {\r\n      this.activePosition.row = fp.row;\r\n      this.activePosition.col = fp.col;\r\n    }\r\n\r\n    this.place = false;\r\n  }\r\n\r\n  dragEnd() {\r\n    if (this.props.gameState === GAMESTATE_PAUSED) {\r\n      return;\r\n    }\r\n\r\n    if (this.activeTouches === 0 && !this.mouseIsDown) {\r\n      this.place = true;\r\n    }\r\n  }\r\n\r\n  mouseDown(event) {\r\n    event.preventDefault();\r\n    this.mouseIsDown = true;\r\n\r\n    const cp = this.canvasPoint(event);\r\n    this.dragMove(cp);\r\n  }\r\n\r\n  mouseMove(event) {\r\n    event.preventDefault();\r\n    if (this.mouseIsDown) {\r\n      const cp = this.canvasPoint(event);\r\n      this.dragMove(cp);\r\n    }\r\n  }\r\n\r\n  mouseUp(event) {\r\n    event.preventDefault();\r\n    this.mouseIsDown = false;\r\n    this.dragEnd();\r\n  }\r\n\r\n  touchMove(event) {\r\n    event.preventDefault();\r\n    this.activeTouches = event.touches.length;\r\n\r\n    // Note: if multiple touches are inside the field\r\n    // then the \"last\" one wins whichever that happens\r\n    // to be.\r\n    for (let i = 0; i < event.changedTouches.length; i++) {\r\n      const touch = event.changedTouches[i];\r\n      const cp = this.canvasPoint(touch);\r\n      this.dragMove(cp);\r\n    }\r\n  }\r\n\r\n  touchEnd(event) {\r\n    event.preventDefault();\r\n    this.activeTouches = event.touches.length;\r\n    this.dragEnd();\r\n  }\r\n\r\n  isLineFilled(line) {\r\n    const lineLength = line.length;\r\n    for (let col = 0; col < lineLength; col++) {\r\n      const block = line[col];\r\n      if (block === PIECE_NONE) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  setLineClearedFlag(row, field, flag) {\r\n    if (row >= 0) {\r\n      field.lineClearFlags[row] = flag;\r\n    } else {\r\n      field.hiddenLineClearFlags[(row * -1) - 1] = flag;\r\n    }\r\n  }\r\n\r\n  getLineClearedFlag(row, field) {\r\n    return field.lineClearFlags[row] || field.hiddenLineClearFlags[(row * -1) - 1];\r\n  }\r\n\r\n  getRow(row, field) {\r\n    return field.blocks[row] || field.hiddenBlocks[(row * -1) - 1];\r\n  }\r\n\r\n  // NOTE: this was originally ported pretty directly from Nullpomino\r\n  downFloatingBlocks(field) {\r\n    const fieldHeight = field.blocks.length;\r\n    const fieldWidth = field.blocks[0].length;\r\n\r\n    var y = fieldHeight - 1;\r\n    for (let i = hiddenHeight * -1; i < fieldHeight; i++) {\r\n      if (this.getLineClearedFlag(y, field)) {\r\n        for (let k = y; k > hiddenHeight * -1; k--) {\r\n          const rowUp = this.getRow(k-1, field);\r\n          const row   = this.getRow(k, field);\r\n          for (let l = 0; l < fieldWidth; l++) {\r\n            const blk = rowUp === undefined ? PIECE_NONE : rowUp[l];\r\n            row[l] = blk;\r\n          }\r\n\r\n          this.setLineClearedFlag(k, field, this.getLineClearedFlag(k-1, field));\r\n        }\r\n\r\n        // clear the top (we really only need to do this once)\r\n        for (let l = 0; l < fieldWidth; l++) {\r\n          const topRow = field.hiddenBlocks[hiddenHeight - 1];\r\n          topRow[l] = PIECE_NONE;\r\n        }\r\n      } else {\r\n        y--;\r\n      }\r\n    }\r\n  }\r\n\r\n  doLineClears(field) {\r\n    var linesCleared = 0;\r\n    var firstLine = -1;\r\n    const fieldHeight = field.blocks.length;\r\n\r\n    for(let r = hiddenHeight * -1; r < fieldHeight; r++) {\r\n      const row = this.getRow(r, field);\r\n      const filled = this.isLineFilled(row);\r\n\r\n      if (filled) {\r\n        const rowLength = row.length;\r\n        for (let c = 0; c < rowLength; c++) {\r\n          row[c] = PIECE_NONE;\r\n        }\r\n        linesCleared++;\r\n        this.setLineClearedFlag(r, field, true);\r\n\r\n        if (firstLine === -1) {\r\n          firstLine = r;\r\n        }\r\n      }\r\n    }\r\n\r\n    // TODO: split out and do later\r\n    // after some frames for animation purposes?\r\n    if (linesCleared > 0) {\r\n      this.downFloatingBlocks(field);\r\n    }\r\n\r\n    return linesCleared;\r\n  }\r\n\r\n  rollNextPiece() {\r\n    let nextPiece;\r\n    if (this.nextPieces.length === 0) {\r\n      nextPiece = this.randomizer.next();\r\n    } else {\r\n      nextPiece = this.nextPieces[0];\r\n    }\r\n\r\n    const nextPieces = this.nextPieces = this.nextPieces.slice(1);\r\n    while (nextPieces.length < this.props.previewLength) {\r\n      nextPieces.push(this.randomizer.next());\r\n    }\r\n\r\n    this.props.nextPiece(nextPiece, nextPieces);\r\n  }\r\n\r\n  checkGameOver(piece, field) {\r\n    if (piece === PIECE_NONE) {\r\n      return false;\r\n    }\r\n\r\n    // if there's any slot we can place the piece in any orientation\r\n    // the player can still \"continue\", even if that will still lead\r\n    // to a game over.\r\n    for (let r = 0; r < field.blocks.length; r++) {\r\n      let row = field.blocks[r];\r\n      for (let c = 0; c < row.length; c++) {\r\n        for (let o of orientations) {\r\n          if (checkPlaceability(c, r, piece, o, field)) {\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  gameLoop() {\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      this.props.cyclePieces(this.pieceDebug);\r\n    }\r\n\r\n    const now = new Date();\r\n    const millisDiff = now - this.lastPlayingTime;\r\n    this.lastPlayingTime = now;\r\n\r\n    if (this.props.gameState === GAMESTATE_READY) {\r\n      this.readyTimerMillis -= millisDiff;\r\n      this.props.updateReady(this.readyTimerMillis);\r\n      if (this.readyTimerMillis <= 0) {\r\n        this.props.setGameState(GAMESTATE_PLAYING);\r\n      }\r\n    } else if (this.props.gameState === GAMESTATE_PLAYING) {\r\n      this.props.setActiveGridPosition(this.activePosition);\r\n\r\n      this.props.checkPlaceability(\r\n        this.activePosition.col, this.activePosition.row,\r\n        this.props.currentPiece, this.orientation,\r\n        this.field\r\n      );\r\n\r\n      this.totalTimerMillis += millisDiff;\r\n      // Checking more than once per piece is redundant at the moment because\r\n      // you can currently place the piece anywhere, but if we change over to\r\n      // using a reference piece we'll need to check every time the reference\r\n      // piece moves.\r\n      let gameIsOver = this.checkGameOver(this.props.currentPiece, this.field);\r\n      if (gameIsOver) {\r\n        this.props.setGameState(GAMESTATE_END);\r\n      }\r\n\r\n      if (this.place) {\r\n        var placed = false;\r\n        if (this.props.placeable) {\r\n          // update our internal field\r\n          placeBlock(\r\n            this.activePosition.col, this.activePosition.row,\r\n            this.props.currentPiece, this.orientation,\r\n            this.field\r\n          );\r\n\r\n          var lines = this.doLineClears(this.field);\r\n          this.linesCleared += lines;\r\n          this.props.updateStats(this.linesCleared);\r\n\r\n          // TODO: line clear delay / animation??\r\n          // broadcast to everyone else\r\n          this.props.placeBlock(this.field);\r\n\r\n          placed = true;\r\n        }\r\n\r\n        // Check win/end conditions\r\n        switch (this.props.gameMode) {\r\n          case GAMEMODE_ZEN: /* There is no defined goal */ break;\r\n          case GAMEMODE_LINE_TARGET:\r\n            if (this.linesCleared >= this.props.lineTarget) {\r\n              this.props.setGameState(GAMESTATE_END);\r\n            }\r\n          break;\r\n\r\n          // no default\r\n        }\r\n\r\n        // TODO: punishment for trying to drop in a\r\n        //. non-placeable space? or do we just leave\r\n        // it hanging as this currently does.\r\n        this.place = false;\r\n\r\n        // TODO: allow placing it as soon as they try\r\n        // to rotate it if that becomes a valid placement?\r\n\r\n        if (placed) {\r\n          this.activePosition.row = -1;\r\n          this.activePosition.col = -1;\r\n          this.orientation = ORIENTATION_NONE;\r\n          this.rollNextPiece();\r\n        }\r\n      }\r\n      // Only do after potentially resetting above\r\n      // so that we don't highlight the orientation\r\n      // of the _next_ piece for a single frame if\r\n      // we select the orientation and the destination\r\n      // in the same frame.\r\n      this.props.selectOrientation(this.orientation);\r\n\r\n      this.pieceDebug.prev = false;\r\n      this.pieceDebug.next = false;\r\n    }\r\n\r\n    this.props.updateTimer(this.totalTimerMillis);\r\n\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.onresize = () => {\r\n      this.props.resize(window.innerWidth, window.innerHeight);\r\n    };\r\n    window.onresize();\r\n\r\n    document.addEventListener(\"keydown\", this.keydown, false);\r\n\r\n    setInterval(this.gameLoop, 33);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keydown\", this.keydown);\r\n  }\r\n\r\n  render() {\r\n    if (this.props.gameState === GAMESTATE_MENU) {\r\n      return (\r\n        <MenuScreen\r\n          menu={this.props.menu}\r\n          start={this.start} />\r\n      );\r\n    }\r\n\r\n    if (this.props.gameState === GAMESTATE_END) {\r\n      return (\r\n        <EndScreen\r\n          gameMode={this.props.gameMode}\r\n          blockCount={this.props.blockCount}\r\n          linesCleared={this.props.linesCleared}\r\n          reset={this.start}\r\n          mainMenu={this.mainMenu}\r\n          timerMillis={this.props.timerMillis}\r\n        />\r\n      );\r\n    }\r\n\r\n    return (\r\n      <Canvas\r\n        gameState={this.props.gameState}\r\n        activePosition={this.props.activePosition}\r\n        orientationSelectors={this.orientationSelectors}\r\n        previewSlots={this.previewSlots}\r\n        nextPieces={this.props.nextPieces}\r\n        fieldDimensions={this.fieldDimensions}\r\n        currentPiece={this.props.currentPiece}\r\n        orientation={this.props.orientation}\r\n        placeable={this.props.placeable}\r\n        blocks={this.props.field.blocks}\r\n        config={this.props.config}\r\n        linesCleared={this.props.linesCleared}\r\n        blockCount={this.props.blockCount}\r\n        lineTarget={this.props.lineTarget}\r\n        timerMillis={this.props.timerMillis}\r\n        readyMillis={this.props.readyMillis}\r\n        readyAnimationIndex={this.readyAnimationIndex}\r\n        gameMode={this.props.gameMode}\r\n        reset={this.start}\r\n        mainMenu={this.mainMenu}\r\n        pause={this.pause}\r\n        touchStart={this.touchStart}\r\n        touchMove={this.touchMove}\r\n        touchEnd={this.touchEnd}\r\n        mouseDown={this.mouseDown}\r\n        mouseMove={this.mouseMove}\r\n        mouseUp={this.mouseUp}\r\n        windowWidth={this.props.windowWidth}\r\n        windowHeight={this.props.windowHeight}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import { connect } from 'react-redux';\r\n\r\nimport App from '../App';\r\nimport {\r\n  setActiveGridPosition,\r\n  cyclePieces,\r\n  selectOrientation,\r\n  nextPiece,\r\n  placeBlock,\r\n  updateStats,\r\n  checkPlaceability,\r\n  reset,\r\n  resize,\r\n  setGameState,\r\n  setGameMode,\r\n  updateReady,\r\n  updateTimer,\r\n  loadConfig,\r\n} from '../actions/index';\r\n\r\nconst mapStateToProps = state => ({\r\n  menu: state.menu,\r\n  config: state.config,\r\n  gameState: state.gameState,\r\n  gameMode: state.gameMode,\r\n  activePosition: state.activePosition,\r\n  currentPiece: state.currentPiece,\r\n  nextPieces: state.nextPieces,\r\n  previewLength: state.previewLength,\r\n  orientation: state.orientation,\r\n  field: state.field,\r\n  blockCount: state.blockCount,\r\n  placeable: state.placeable,\r\n  linesCleared: state.linesCleared,\r\n  lineTarget: state.lineTarget,\r\n  windowWidth: state.windowWidth,\r\n  windowHeight: state.windowHeight,\r\n  timerMillis: state.timerMillis,\r\n  readyMillis: state.readyMillis,\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  setActiveGridPosition: (param) => {\r\n    dispatch(setActiveGridPosition(param));\r\n  },\r\n  cyclePieces: (param) => {\r\n    dispatch(cyclePieces(param));\r\n  },\r\n  selectOrientation: (param) => {\r\n    dispatch(selectOrientation(param));\r\n  },\r\n  nextPiece: (np, nps) => {\r\n    dispatch(nextPiece(np, nps));\r\n  },\r\n  placeBlock: (field) => {\r\n    dispatch(placeBlock(field));\r\n  },\r\n  checkPlaceability: (x, y, piece, orientation, field) => {\r\n    dispatch(checkPlaceability(x, y, piece, orientation, field));\r\n  },\r\n  updateStats: (linesCleared) => {\r\n    dispatch(updateStats(linesCleared));\r\n  },\r\n  reset: () => {\r\n    dispatch(reset());\r\n  },\r\n  resize: (newWidth, newHeight) => {\r\n    dispatch(resize(newWidth, newHeight));\r\n  },\r\n  setGameState: (newGameState) => {\r\n    dispatch(setGameState(newGameState));\r\n  },\r\n  setGameMode: (newMode) => {\r\n    dispatch(setGameMode(newMode));\r\n  },\r\n  updateReady: (readyMillis) => {\r\n    dispatch(updateReady(readyMillis));\r\n  },\r\n  updateTimer: (timerMillis) => {\r\n    dispatch(updateTimer(timerMillis));\r\n  },\r\n  loadConfig: () => {\r\n    dispatch(loadConfig());\r\n  },\r\n});\r\n\r\nconst Game = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps,\r\n)(App);\r\n\r\nexport default Game;\r\n","function setActiveGridPosition(state, action) {\r\n  if (state.activePosition.row === action.activePosition.row &&\r\n      state.activePosition.col === action.activePosition.col) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    activePosition: {\r\n        ...action.activePosition\r\n    },\r\n  };\r\n}\r\n\r\nexport default setActiveGridPosition;\r\n","function cyclePieces(state, action) {\r\n  if (!action.next && !action.prev) {\r\n    return state;\r\n  }\r\n\r\n  var currentPiece;\r\n  if (action.next) {\r\n    currentPiece = state.currentPiece + 1;\r\n  } else if (action.prev) {\r\n    currentPiece = state.currentPiece - 1;\r\n  }\r\n\r\n  // Wrap around with -1 in the middle (no piece)\r\n  if (currentPiece > 6) {\r\n    currentPiece = -1;\r\n  } else if (currentPiece < -1) {\r\n    currentPiece = 6;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    currentPiece: currentPiece,\r\n  };\r\n}\r\n\r\n// replace with a dummy function in prod builds\r\n// so we don't have to worry about \"leaving\" it\r\n// in somehow.\r\nconst exportFn = ((process.env.NODE_ENV === 'production')\r\n  ? (function() {})\r\n  : cyclePieces);\r\n\r\nexport default exportFn;\r\n","function selectOrientation(state, action) {\r\n  if (state.orientation === action.orientation) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    orientation: action.orientation,\r\n  };\r\n}\r\n\r\nexport default selectOrientation;\r\n","function nextPiece(state, action) {\r\n  return {\r\n    ...state,\r\n    currentPiece: action.nextPiece,\r\n    // Note: We require this to be a \"new\" array, but I don't want\r\n    // to create a copy of a copy here.\r\n    nextPieces: action.nextPieces,\r\n  };\r\n}\r\n\r\nexport default nextPiece;\r\n","function getChangedRows(oldField, newField) {\r\n  const changedRows = [];\r\n  const numRows = oldField.length;\r\n  for (let r = 0; r < numRows; r++) {\r\n    const newRow = newField[r];\r\n    const oldRow = oldField[r];\r\n\r\n    const numCols = newRow.length;\r\n    for (let c = 0; c < numCols; c++) {\r\n      const newBlock = newRow[c];\r\n      const oldBlock = oldRow[c];\r\n\r\n      if (oldBlock !== newBlock) {\r\n        changedRows.push(r);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return changedRows;\r\n}\r\n\r\nfunction placeBlock(state, data) {\r\n  const newField = data.field.blocks;\r\n  var changedRows = getChangedRows(state.field.blocks, newField);\r\n  if (changedRows.length === 0) {\r\n    return state;\r\n  }\r\n\r\n  const blocks = [...state.field.blocks];\r\n  for (let r of changedRows) {\r\n    blocks[r] = [...newField[r]];\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    field: {\r\n      ...state.field,\r\n      blocks: blocks,\r\n    },\r\n    blockCount: state.blockCount + 1,\r\n  };\r\n}\r\n\r\nexport default placeBlock;\r\n","// TODO: I think this is probably bad style to be in the component...\r\nimport { checkPlaceability } from '../components/Piece';\r\n\r\nexport default (state, data) => {\r\n  const { x, y, piece, orientation, field } = data;\r\n  const oldPlaceable = state.placeable;\r\n  const newPlaceable = checkPlaceability(x, y, piece, orientation, field);\r\n\r\n  if (oldPlaceable === newPlaceable) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    placeable: newPlaceable,\r\n  };\r\n};\r\n","export default (state, action) => {\r\n  if (state.readyMillis === action.readyMillis) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    readyMillis: action.readyMillis,\r\n  };\r\n};\r\n","function updateStats(state, action) {\r\n  if (state.linesCleared === action.linesCleared) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    linesCleared: action.linesCleared,\r\n  };\r\n}\r\n\r\nexport default updateStats;\r\n","export default (state, action) => {\r\n  if (state.timerMillis === action.timerMillis) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    timerMillis: action.timerMillis,\r\n  };\r\n};\r\n","function resize(state, action) {\r\n  return {\r\n    ...state,\r\n    windowWidth: action.newWidth,\r\n    windowHeight: action.newHeight,\r\n  }\r\n}\r\n\r\nexport default resize;\r\n\r\n","import {\r\n  GAMESTATE_PLAYING, GAMESTATE_PAUSED,\r\n} from '../constants';\r\n\r\nexport default (state, action) => {\r\n  let newState = action.gameState;\r\n  if (action.gameState === GAMESTATE_PAUSED) {\r\n    if (state.gameState === GAMESTATE_PAUSED) {\r\n      newState = GAMESTATE_PLAYING;\r\n    }\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    gameState: newState,\r\n  };\r\n};\r\n","export default (state, action) => {\r\n  return {\r\n    ...state,\r\n    gameMode: action.gameMode,\r\n  };\r\n};\r\n","export default (state, action) => {\r\n  return {\r\n    ...state,\r\n    menu: action.menu,\r\n  };\r\n};\r\n","import {\r\n  SET_ACTIVE_GRID_POSITION,\r\n  CYCLE_PIECES,\r\n  SELECT_ORIENTATION,\r\n  NEXT_PIECE,\r\n  PLACE_BLOCK,\r\n  CHECK_PLACEABILITY,\r\n  UPDATE_READY,\r\n  UPDATE_STATS,\r\n  UPDATE_TIMER,\r\n  UPDATE_CONFIG,\r\n  LOAD_CONFIG,\r\n  RESET,\r\n  RESIZE,\r\n  SET_GAME_STATE,\r\n  SET_GAME_MODE,\r\n  SET_MENU,\r\n} from '../actions';\r\n\r\nimport setActiveGridPosition from './setActiveGridPosition';\r\nimport cyclePieces from './cyclePieces';\r\nimport selectOrientation from './selectOrientation';\r\nimport nextPiece from './nextPiece';\r\nimport placeBlock from './placeBlock';\r\nimport checkPlaceability from './checkPlaceability';\r\nimport updateReady from './updateReady';\r\nimport updateStats from './updateStats';\r\nimport updateTimer from './updateTimer';\r\nimport { loadConfig, updateConfig } from './config';\r\nimport resize from './resize';\r\nimport setGameState from './setGameState';\r\nimport setGameMode from './setGameMode';\r\nimport setMenu from './setMenu';\r\n\r\n// TODO: I think this is probably bad style to be in the component...\r\nimport { PIECE_NONE, ORIENTATION_NONE } from '../components/Piece';\r\n\r\nimport {\r\n  fieldWidthInBlocks, fieldHeightInBlocks,\r\n  GAMESTATE_MENU, GAMESTATE_READY,\r\n  defaultStyles,\r\n  totalReadyMillis,\r\n} from '../constants'\r\n\r\nconst initialState = {\r\n  gameState: GAMESTATE_MENU,\r\n  activePosition: {\r\n    row: -1,\r\n    col: -1,\r\n  },\r\n  currentPiece: PIECE_NONE,\r\n  previewLength: 5,\r\n  nextPieces: [],\r\n  orientation: ORIENTATION_NONE,\r\n  placeable: false,\r\n  blockCount: 0,\r\n  linesCleared: 0,\r\n  lineTarget: 40,\r\n  timerMillis: 0,\r\n  readyMillis: totalReadyMillis,\r\n  field: {\r\n    blocks :\r\n      Array(fieldHeightInBlocks).fill(0).map(r =>\r\n        Array(fieldWidthInBlocks).fill(PIECE_NONE))\r\n  },\r\n  config: {\r\n    version: 0,\r\n    blockStyles: defaultStyles,\r\n  },\r\n};\r\n\r\nfunction reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case SET_ACTIVE_GRID_POSITION:\r\n      return setActiveGridPosition(state, action);\r\n    case CYCLE_PIECES:\r\n      return cyclePieces(state, action);\r\n    case SELECT_ORIENTATION:\r\n      return selectOrientation(state, action);\r\n    case NEXT_PIECE:\r\n      return nextPiece(state, action);\r\n    case PLACE_BLOCK:\r\n      return placeBlock(state, action);\r\n    case CHECK_PLACEABILITY:\r\n      return checkPlaceability(state, action);\r\n    case UPDATE_READY:\r\n      return updateReady(state, action);\r\n    case UPDATE_STATS:\r\n      return updateStats(state, action);\r\n    case UPDATE_TIMER:\r\n      return updateTimer(state, action);\r\n    case UPDATE_CONFIG:\r\n      return updateConfig(state, action);\r\n    case LOAD_CONFIG:\r\n      return loadConfig(state);\r\n    case RESIZE:\r\n      return resize(state, action);\r\n    case SET_GAME_STATE:\r\n      return setGameState(state, action);\r\n    case SET_GAME_MODE:\r\n      return setGameMode(state, action);\r\n    case SET_MENU:\r\n      return setMenu(state, action);\r\n    case RESET:\r\n      // TODO: take some game options that\r\n      // override the initial state?\r\n      return {\r\n        ...initialState,\r\n        config: state.config,\r\n        windowWidth: state.windowWidth,\r\n        windowHeight: state.windowHeight,\r\n        gameMode: state.gameMode,\r\n        gameState: GAMESTATE_READY,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default reducer;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport { Provider } from 'react-redux';\r\nimport { createStore } from 'redux';\r\n\r\n// Polyfills\r\n// Required for Safari\r\nimport 'core-js/fn/object/assign';\r\nimport 'core-js/fn/object/values';\r\nimport 'core-js/es6/set';\r\nimport 'core-js/es6/symbol';\r\n\r\nimport './index.css';\r\nimport Game from './containers/Game';\r\nimport reducer from './reducers';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nconst store = createStore(\r\n  reducer,\r\n);\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <Game />\r\n  </Provider>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}