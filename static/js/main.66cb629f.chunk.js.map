{"version":3,"sources":["components/Menu/Menu.jsx","constants.js","components/Menu/MainMenu.jsx","components/Block.jsx","components/Piece.jsx","components/Menu/StyleConfiguration.jsx","util.js","reducers/config.js","components/Menu/ImportExportSettings.jsx","actions/index.js","containers/Menu.js","components/Menu/MenuScreen.jsx","components/EndScreen.jsx","components/FieldBackground.jsx","components/Field.jsx","components/LineCount.jsx","components/Timer.jsx","components/Button.jsx","components/OrientationSelector.jsx","components/PreviewPiece.jsx","components/Canvas.jsx","randomizers/BagRandomizer.js","App.js","containers/Game.js","reducers/setActiveGridPosition.js","reducers/cyclePieces.js","reducers/selectOrientation.js","reducers/nextPiece.js","reducers/placeBlock.js","reducers/checkPlaceability.js","reducers/updateStats.js","reducers/updateTimer.js","reducers/resize.js","reducers/setGameState.js","reducers/setGameMode.js","reducers/setMenu.js","reducers/index.js","serviceWorker.js","index.js"],"names":["Menu","props","menuItems","items","map","item","react_default","a","createElement","key","text","onClick","className","GAMESTATE_PLAYING","MENU_MAIN","defaultStyles","fill","MainMenu","setGameMode","start","setMenu","components_Menu_Menu","Block","classes","flash","piece","PIECE_NONE","placeable","x","y","width","blockSize","height","style","blockStyles","allPieceDataX","allPieceDataY","length","checkPlaceability","orientation","field","collides","checkCollision","supported","blocksX","blocksY","fieldWidth","blocks","fieldHeight","_getGridOffset2","getGridOffset","xOffset","yOffset","i","x2","y2","row","hiddenBlocks","undefined","getHeight","getMinX","getMinY","min","block","max","Piece","cx","cy","pieceDataX","pieceDataY","getWidth","minX","minY","src_components_Block","StyleConfiguration","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","changeHandler","event","name","target","value","setState","colors","objectSpread","state","defineProperty","save","config","values","updateConfig","reset","assign","cancel","_this2","viewBox","p","shapeRendering","preserveAspectRatio","components_Piece","backgroundColor","htmlFor","type","id","onChange","Component","millisecondsToTimestamp","totalMs","milliseconds","toFixed","slice","seconds","Math","floor","minutes","hours","isObject","Array","isArray","persistedData","set","window","localStorage","removeItem","stringValue","ctor","constructor","JSON","stringify","toString","Error","concat","setItem","get","getItem","parts","string","delimiter","maxSplits","arr","split","result","splice","push","join","splitMax","objectValue","ctorName","parse","Number","objectsHaveSameKeys","b","aKeys","keys","bKeys","aSet","Set","bSet","size","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","has","err","return","configKey","action","newConfig","mergeDeep","source","output","forEach","validateConfig","version","_i","ImportExportSettings","validateInput","valid","e","back","SET_ACTIVE_GRID_POSITION","CYCLE_PIECES","SELECT_ORIENTATION","NEXT_PIECE","PLACE_BLOCK","CHECK_PLACEABILITY","UPDATE_STATS","RESET","RESIZE","SET_GAME_STATE","SET_GAME_MODE","SET_MENU","UPDATE_TIMER","UPDATE_CONFIG","LOAD_CONFIG","newMode","gameMode","connectFn","connect","menu","lineTarget","dispatch","_MainMenu","_StyleConfiguration","_ImportExportSettings","MenuScreen","containers_Menu_StyleConfiguration","containers_Menu_ImportExportSettings","containers_Menu_MainMenu","EndScreen","linesCleared","blockCount","endScreenMenuItems","mainMenu","statistics","timerMillis","stat","FieldBackground","_this$props","rows","cols","gridlines","c","x1","y1","r","pointerEvents","React","PureComponent","Field","nextProps","nextState","activePosition","col","_this$props2","_this$props2$activePo","selectedRow","selectedCol","grid","currentBlock","gridBlock","src_components_FieldBackground","strokeWidth","stroke","LineCount","textAnchor","fontFamily","fontSize","Timer","timestamp","Button","pressed","touchStart","bind","assertThisInitialized","touchEnd","stopPropagation","pressedColor","color","textStyle","userSelect","textColor","onTouchStart","onTouchMove","touchMove","onTouchEnd","onPressed","rx","ry","alignmentBaseline","dominantBaseline","selectedStyle","OrientationSelector","selected","padding","PreviewPiece","Canvas","gameModeHud","innerWidth","bagDisplay","previewSlots","ps","components_PreviewPiece","nextPieces","orientationSelectors","os","components_OrientationSelector","currentPiece","_props$fieldDimension","fieldDimensions","fieldX","fieldY","fieldRows","fieldCols","lineCountPositionX","lineCountPositionY","timerPositionX","Fragment","components_LineCount","components_Timer","pieceX","pieceY","activePiece","textRendering","touchAction","windowWidth","windowHeight","onMouseDown","mouseDown","onMouseMove","mouseMove","onMouseUp","mouseUp","components_Field","src_components_Button","BagRandomizer","random","bag","index","array","t","arguments","m","shuffle","orientations","App","initialiseLayout","keydown","gameLoop","selectOrientation","updateOrientation","init","pause","dragMove","dragEnd","loadConfig","blockSizeInUnits","osXStart","psXStart","psYStart","previewLength","_","minorReduction","keyCode","pieceDebug","prev","randomizer","activeTouches","mouseIsDown","lineClearFlags","hiddenLineClearFlags","rollNextPiece","lastPlayingTime","Date","totalTimerMillis","newState","now","gameState","millisDiff","setGameState","svg","document","getElementById","point","createSVGPoint","clientX","clientY","_point$matrixTransfor","matrixTransform","getScreenCTM","inverse","canvasPoint","fcpx","fcpy","fp","fieldPoint","place","preventDefault","cp","touches","changedTouches","touch","line","lineLength","flag","hiddenHeight","getLineClearedFlag","k","rowUp","getRow","l","blk","setLineClearedFlag","firstLine","isLineFilled","rowLength","downFloatingBlocks","nextPiece","setActiveGridPosition","checkGameOver","placed","_getGridOffset","placeBlock","lines","doLineClears","updateStats","updateTimer","onresize","resize","innerHeight","addEventListener","setInterval","removeEventListener","Menu_MenuScreen","src_components_EndScreen","components_Canvas","Game","param","cyclePieces","debug","np","nps","newWidth","newHeight","newGameState","exportFn","data","newField","changedRows","oldField","numRows","newRow","oldRow","numCols","newBlock","getChangedRows","toConsumableArray","reducers_checkPlaceability","oldPlaceable","newPlaceable","reducers_updateTimer","reducers_setGameState","reducers_setGameMode","reducers_setMenu","initialState","reducer","existingConfig","Boolean","location","hostname","match","store","createStore","ReactDOM","render","es","containers_Game","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"4XA0BeA,SAtBF,SAACC,GAAU,IAKhBC,EAFFD,EADFE,MAGsBC,IAAI,SAAAC,GAAI,OAC9BC,EAAAC,EAAAC,cAAA,MAAIC,IAAKJ,EAAKK,KACVC,QAASN,EAAKM,QACdC,UAAU,UACTP,EAAKK,QAIZ,OACEJ,EAAAC,EAAAC,cAAA,OAAKI,UAAU,QACbN,EAAAC,EAAAC,cAAA,UACGN,MCnBIW,EAAoB,UAOpBC,EAAY,OAUZC,EAAgB,CAC3B,CAAEC,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,YCwBKC,EAtCE,SAAChB,GAChB,IAAMC,EAAY,CAChB,CACEQ,KAAM,WACNC,QAAS,WACPV,EAAMiB,YDXc,OCYpBjB,EAAMkB,UAGV,CACET,KAAM,mBACNC,QAAS,WACPV,EAAMiB,YDjBsB,eCqB5BjB,EAAMkB,UAGV,CACET,KAAM,kBACNC,QAAS,WACPV,EAAMmB,QDxBqB,WC2B/B,CACEV,KAAM,2BACNC,QAAS,WACPV,EAAMmB,QD7BoB,oBCkChC,OACEd,EAAAC,EAAAC,cAACa,EAAD,CAAMlB,MAAOD,oBCpBFoB,iBAnBD,SAACrB,GACb,IAAMsB,EAAW,eACdtB,EAAMuB,MAAQ,oBAAsB,KACpCvB,EAAMwB,QAAUC,EAAa,eAAiB,MAC1B,IAApBzB,EAAM0B,UAAsB,gBAAkB,IAGjD,OACErB,EAAAC,EAAAC,cAAA,QACEoB,EAAG3B,EAAM2B,EACTC,EAAG5B,EAAM4B,EACTC,MAAO7B,EAAM8B,UACbC,OAAQ/B,EAAM8B,UACdE,MAAOhC,EAAMiC,YAAYjC,EAAMwB,OAC/Bb,UAAWW,MChBJG,GAAc,EAerBS,EAAgB,CACpB,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,KAGlCC,EAAgB,CACpB,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,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","file":"static/js/main.66cb629f.chunk.js","sourcesContent":["import React from 'react';\r\n\r\nimport './Menu.css';\r\n\r\nconst Menu = (props) => {\r\n  const {\r\n    items,\r\n  } = props;\r\n\r\n  const menuItems = items.map(item =>\r\n    <li key={item.text}\r\n        onClick={item.onClick}\r\n        className=\"button\" >\r\n        {item.text}\r\n    </li>\r\n  );\r\n\r\n  return (\r\n    <div className=\"menu\">\r\n      <ul>\r\n        {menuItems}\r\n      </ul>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Menu;\r\n","export const GAMESTATE_MENU = 'MENU';\r\nexport const GAMESTATE_PLAYING = 'PLAYING';\r\nexport const GAMESTATE_PAUSED = 'PAUSED';\r\nexport const GAMESTATE_END = 'END';\r\n\r\nexport const GAMEMODE_ZEN = 'ZEN';\r\nexport const GAMEMODE_LINE_TARGET = 'LINE TARGET';\r\n\r\nexport const MENU_MAIN = 'MAIN';\r\nexport const MENU_STYLE_SETTINGS = 'STYLE';\r\nexport const MENU_IMPORT_EXPORT = 'IMPORT_EXPORT';\r\n\r\nexport const blockSizeInUnits = 26;\r\n\r\nexport const fieldWidthInBlocks = 10;\r\nexport const fieldHeightInBlocks = 20;\r\nexport const hiddenHeight = 3;\r\n\r\nexport const defaultStyles = [\r\n  { fill: '#708090' }, // I\r\n  { fill: '#f5c635' }, // L\r\n  { fill: '#ee8817' }, // O\r\n  { fill: '#47b450' }, // Z\r\n  { fill: '#ee575b' }, // T\r\n  { fill: '#9155f4' }, // J\r\n  { fill: '#009fd4' }, // S\r\n];\r\n","import React from 'react';\r\n\r\nimport Menu from './Menu';\r\n\r\nimport {\r\n  GAMEMODE_ZEN,\r\n  GAMEMODE_LINE_TARGET,\r\n  MENU_STYLE_SETTINGS,\r\n  MENU_IMPORT_EXPORT,\r\n} from '../../constants';\r\n\r\nconst MainMenu = (props) => {\r\n  const menuItems = [\r\n    {\r\n      text: 'ZEN MODE',\r\n      onClick: () => {\r\n        props.setGameMode(GAMEMODE_ZEN);\r\n        props.start();\r\n      },\r\n    },\r\n    {\r\n      text: 'LINE TARGET MODE',\r\n      onClick: () => {\r\n        props.setGameMode(GAMEMODE_LINE_TARGET);\r\n        // TODO: we probably want a settings screen\r\n        // for a bunch of the different modes, rather\r\n        // than starting the game immediately.\r\n        props.start();\r\n      },\r\n    },\r\n    {\r\n      text: 'CUSTOMIZE STYLE',\r\n      onClick: () => {\r\n        props.setMenu(MENU_STYLE_SETTINGS);\r\n      },\r\n    },\r\n    {\r\n      text: 'IMPORT / EXPORT SETTINGS',\r\n      onClick: () => {\r\n        props.setMenu(MENU_IMPORT_EXPORT);\r\n      },\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <Menu items={menuItems} />\r\n  );\r\n};\r\n\r\nexport default MainMenu;\r\n","import React from 'react';\r\n\r\nimport './Block.css';\r\n\r\nimport { PIECE_NONE } from './Piece';\r\n\r\nconst Block = (props) => {\r\n  const classes = (\"grid-block \" +\r\n    (props.flash ? \"grid-block-flash \" : \"\") +\r\n    (props.piece !== PIECE_NONE ? \"piece-block \" : \"\") +\r\n    (props.placeable === false ? \"cannot-place \" : \"\")\r\n  );\r\n\r\n  return (\r\n    <rect\r\n      x={props.x}\r\n      y={props.y}\r\n      width={props.blockSize}\r\n      height={props.blockSize}\r\n      style={props.blockStyles[props.piece]}\r\n      className={classes}\r\n     />\r\n  )\r\n};\r\n\r\nexport default Block;\r\n","import React from 'react';\r\n\r\nimport Block from './Block';\r\n\r\nexport const PIECE_NONE = -1;\r\nexport const PIECE_I = 0;\r\nexport const PIECE_L = 1;\r\nexport const PIECE_O = 2;\r\nexport const PIECE_Z = 3;\r\nexport const PIECE_T = 4;\r\nexport const PIECE_J = 5;\r\nexport const PIECE_S = 6;\r\n\r\nexport const ORIENTATION_NONE  = -1;\r\nexport const ORIENTATION_UP    = 0;\r\nexport const ORIENTATION_RIGHT = 1;\r\nexport const ORIENTATION_DOWN  = 2;\r\nexport const ORIENTATION_LEFT  = 3;\r\n\r\nconst allPieceDataX = [\r\n  [[0,1,2,3],[2,2,2,2],[3,2,1,0],[1,1,1,1]],  // I\r\n  [[2,2,1,0],[2,1,1,1],[0,0,1,2],[0,1,1,1]],  // L\r\n  [[0,1,1,0],[1,1,0,0],[1,0,0,1],[0,0,1,1]],  // O\r\n  [[0,1,1,2],[2,2,1,1],[2,1,1,0],[0,0,1,1]],  // Z\r\n  [[1,0,1,2],[2,1,1,1],[1,2,1,0],[0,1,1,1]],  // T\r\n  [[0,0,1,2],[2,1,1,1],[2,2,1,0],[0,1,1,1]],  // J\r\n  [[2,1,1,0],[2,2,1,1],[0,1,1,2],[0,0,1,1]],  // S\r\n];\r\n\r\nconst allPieceDataY = [\r\n  [[1,1,1,1],[0,1,2,3],[2,2,2,2],[3,2,1,0]],  // I\r\n  [[0,1,1,1],[2,2,1,0],[2,1,1,1],[0,0,1,2]],  // L\r\n  [[0,0,1,1],[0,1,1,0],[1,1,0,0],[1,0,0,1]],  // O\r\n  [[0,0,1,1],[0,1,1,2],[2,2,1,1],[2,1,1,0]],  // Z\r\n  [[0,1,1,1],[1,0,1,2],[2,1,1,1],[1,2,1,0]],  // T\r\n  [[0,1,1,1],[0,0,1,2],[2,1,1,1],[2,2,1,0]],  // J\r\n  [[0,0,1,1],[2,1,1,0],[2,2,1,1],[0,1,1,2]],  // S\r\n];\r\n\r\nexport const PIECE_COUNT = allPieceDataX.length;\r\n\r\nexport function placeBlock(x, y, piece, orientation, field) {\r\n  const blocksX = allPieceDataX[piece][orientation];\r\n  const blocksY = allPieceDataY[piece][orientation];\r\n\r\n  const { xOffset, yOffset } = getGridOffset(x, y, piece, orientation);\r\n\r\n  for (var i = 0; i < blocksX.length; i++) {\r\n    const x2 = xOffset + blocksX[i];\r\n    const y2 = yOffset + blocksY[i];\r\n\r\n    const row = field.blocks[y2] || field.hiddenBlocks[y2 * -1 - 1];\r\n    row[x2] = piece;\r\n  }\r\n}\r\n\r\nexport function checkPlaceability(x, y, piece, orientation, field) {\r\n  if (piece !== PIECE_NONE &&\r\n      orientation !== -1 &&\r\n      x !== -1 &&\r\n      y !== -1\r\n  ) {\r\n    // TODO: check if the piece has a valid path to get\r\n    // to this position from the top.\r\n    //\r\n    // Idea: Instead of a consant reference point at the top,\r\n    // ave a regular piece dropping slowly and move it\r\n    // left/right as the player drags the destination left/right\r\n    // if the regular piece becomes obstructed, the player can\r\n    // no longer move it in that direction, and if the piece\r\n    // lands in a lockable position before the player lets go\r\n    // lock the piece. The dragging should assume optimal play\r\n    // including valid spins/kicks.\r\n    const collides = checkCollision(x, y, piece, orientation, field);\r\n    const supported = !collides && checkCollision(x, y + 1, piece, orientation, field);\r\n    return !collides && supported;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport function checkCollision(x, y, piece, orientation, field) {\r\n  const blocksX = allPieceDataX[piece][orientation];\r\n  const blocksY = allPieceDataY[piece][orientation];\r\n\r\n  const fieldWidth = field.blocks[0].length;\r\n  const fieldHeight = field.length;\r\n\r\n  const { xOffset, yOffset } = getGridOffset(x, y, piece, orientation);\r\n\r\n  for (var i = 0; i < blocksX.length; i++) {\r\n    const x2 = xOffset + blocksX[i];\r\n    const y2 = yOffset + blocksY[i];\r\n\r\n    // Off the left edge of the field\r\n    if (x2 < 0) {\r\n      return true;\r\n    }\r\n\r\n    // Off the right / bottom edge of the field\r\n    if (x2 >= fieldWidth || y2 >= fieldHeight) {\r\n      return true;\r\n    }\r\n\r\n    const row = field.blocks[y2] || field.hiddenBlocks[y2 * -1 - 1];\r\n\r\n    // Off the top edge (past the hidden blocks) of the field\r\n    if (row === undefined) {\r\n      return true;\r\n    }\r\n\r\n    // Collides with a previously placed block\r\n    if (row[x2] !== PIECE_NONE) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n// TODO: don't create a new object just to return\r\n// these values.\r\nfunction getGridOffset(x, y, piece, orientation) {\r\n  const height = getHeight(piece, orientation);\r\n\r\n  const minX = getMinX(piece, orientation);\r\n  const minY = getMinY(piece, orientation);\r\n\r\n  const xOffset = x - minX;\r\n  const yOffset = y - (minY + height - 1);\r\n\r\n  return { xOffset, yOffset };\r\n}\r\n\r\n// TODO: cache these...\r\nfunction getMinX(piece, orientation) {\r\n  const blocks = allPieceDataX[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n  }\r\n\r\n  return min;\r\n}\r\n\r\nfunction getMinY(piece, orientation) {\r\n  const blocks = allPieceDataY[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n  }\r\n\r\n  return min;\r\n}\r\n\r\nfunction getWidth (piece, orientation) {\r\n  const blocks = allPieceDataX[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n  var max = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n    max = max > block ? max : block;\r\n  }\r\n\r\n  return (max - min) + 1;\r\n}\r\n\r\nfunction getHeight (piece, orientation) {\r\n  const blocks = allPieceDataY[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n  var max = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n    max = max > block ? max : block;\r\n  }\r\n\r\n  return (max - min) + 1;\r\n}\r\n\r\nconst Piece = (props) => {\r\n  const {\r\n    piece, orientation, blockSize, placeable,\r\n    cx, cy, x, y,\r\n    blockStyles,\r\n  } = props;\r\n\r\n  if (piece === PIECE_NONE || orientation === ORIENTATION_NONE)\r\n    return null;\r\n\r\n  const pieceDataX = allPieceDataX[piece][orientation];\r\n  const pieceDataY = allPieceDataY[piece][orientation];\r\n\r\n  const width = getWidth(piece, orientation);\r\n  const height = getHeight(piece, orientation);\r\n\r\n  const minX = getMinX(piece, orientation);\r\n  const minY = getMinY(piece, orientation);\r\n\r\n  var xOffset;\r\n  var yOffset;\r\n  if (cx !== undefined && cy !== undefined) {\r\n    xOffset = (cx - minX * blockSize - (width  * blockSize / 2));\r\n    yOffset = (cy - minY * blockSize - (height * blockSize / 2));\r\n  } else {\r\n    xOffset = x - minX * blockSize;\r\n    yOffset = y - (minY + height - 1) * blockSize;\r\n  }\r\n\r\n  return (\r\n    pieceDataX.map((x, i) => {\r\n      const y = pieceDataY[i];\r\n      return (\r\n        <Block\r\n          key={i}\r\n          x={xOffset + x * blockSize}\r\n          y={yOffset + y * blockSize}\r\n          placeable={placeable}\r\n          piece={piece}\r\n          blockStyles={blockStyles}\r\n          blockSize={blockSize} />\r\n      );\r\n    })\r\n  );\r\n};\r\n\r\nexport default Piece;\r\n","import React, { Component } from 'react';\r\n\r\nimport './StyleConfiguration.css';\r\nimport './Menu.css';\r\n\r\nimport {\r\n  blockSizeInUnits,\r\n  defaultStyles,\r\n  MENU_MAIN,\r\n} from '../../constants';\r\n\r\nimport Piece, { ORIENTATION_UP } from '../Piece';\r\n\r\nclass StyleConfiguration extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      colors: Object.assign({}, props.config.blockStyles),\r\n    };\r\n  }\r\n\r\n  changeHandler = event => {\r\n    const name = event.target.name;\r\n    const value = event.target.value;\r\n\r\n    this.setState({\r\n      colors: {\r\n        ...this.state.colors,\r\n        [name]: {\r\n          fill: value,\r\n        },\r\n      }\r\n    });\r\n  }\r\n\r\n  save = () => {\r\n    const config = {\r\n      blockStyles: Object.values(this.state.colors)\r\n    };\r\n\r\n    this.props.updateConfig(config);\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  reset = () => {\r\n    this.setState({\r\n      colors: Object.assign({}, defaultStyles),\r\n    });\r\n  }\r\n\r\n  cancel = () => {\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  render() {\r\n    const { config: { blockStyles } } = this.props;\r\n    const blockSize = blockSizeInUnits;\r\n\r\n    const viewBox = [0, 0, blockSize * 4, blockSize * 4];\r\n    const items = blockStyles.map((p, i) =>\r\n      <li key={i} className=\"color-config-item\">\r\n        <svg\r\n          shapeRendering=\"crispEdges\"\r\n          preserveAspectRatio=\"xMidYMid slice\"\r\n          width={blockSize * 3}\r\n          height={blockSize * 2.25}\r\n          viewBox={viewBox}\r\n        >\r\n          <Piece\r\n            piece={i}\r\n            orientation={ORIENTATION_UP}\r\n            blockSize={blockSize}\r\n            blockStyles={this.state.colors}\r\n            cx={blockSize * 2}\r\n            cy={blockSize * 2}\r\n          />\r\n        </svg>\r\n        <label\r\n          className=\"color-picker\"\r\n          style={{\r\n            backgroundColor: this.state.colors[i].fill,\r\n            width: \"30px\",\r\n            height: \"30px\",\r\n          }}\r\n          htmlFor={\"cp-\" + i} >\r\n          <input\r\n            className=\"color-picker\"\r\n            type=\"color\"\r\n            id={\"cp-\" + i}\r\n            name={i}\r\n            value={this.state.colors[i].fill}\r\n            onChange={this.changeHandler} />\r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          id={\"ct-\" + i}\r\n          name={i}\r\n          value={this.state.colors[i].fill}\r\n          onChange={this.changeHandler} />\r\n      </li>\r\n    );\r\n\r\n    return (\r\n      <div className=\"menu\">\r\n        <ul className=\"color-config-items\">\r\n          {items}\r\n        </ul>\r\n        <ul>\r\n          <li className=\"button cancel\" onClick={this.cancel}>\r\n            CANCEL\r\n          </li>\r\n          <li className=\"button reset\" onClick={this.reset}>\r\n            RESET TO DEFAULTS\r\n          </li>\r\n          <li className=\"button save\" onClick={this.save}>\r\n            SAVE\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    )\r\n  }\r\n};\r\n\r\nexport default StyleConfiguration;\r\n","// https://bost.ocks.org/mike/shuffle/\r\nexport function shuffle(array, random = Math.random) {\r\n  var m = array.length, t, i;\r\n\r\n  // While there remain elements to shuffle\r\n  while (m) {\r\n    // Pick a remaining element\r\n    i = Math.floor(random() * m--);\r\n\r\n    // And swap it with the current element.\r\n    t = array[m];\r\n    array[m] = array[i];\r\n    array[i] = t;\r\n  }\r\n\r\n  return array;\r\n}\r\n\r\n// variation of https://stackoverflow.com/a/37168679\r\nexport function millisecondsToTimestamp(totalMs) {\r\n  var milliseconds = (totalMs % 1000).toFixed(0);\r\n  milliseconds = (\"000\" + milliseconds).slice(-3);\r\n\r\n  var seconds = Math.floor(totalMs / 1000).toFixed(0);\r\n  var minutes = Math.floor(seconds / 60);\r\n  var hours = \"\";\r\n  if (minutes > 59) {\r\n    hours = Math.floor(minutes / 60);\r\n    minutes = minutes - (hours * 60);\r\n    minutes = (minutes >= 10) ? minutes : \"0\" + minutes;\r\n  }\r\n\r\n  seconds = Math.floor(seconds % 60);\r\n  seconds = (seconds >= 10) ? seconds : \"0\" + seconds;\r\n  if (hours !== \"\") {\r\n    return hours + \":\" + minutes + \":\" + seconds + \".\" + milliseconds;\r\n  }\r\n\r\n  return minutes + \":\" + seconds + \".\" + milliseconds;\r\n}\r\n\r\n// https://stackoverflow.com/a/37164538\r\nfunction isObject(item) {\r\n  return (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\nexport function mergeDeep(target, source) {\r\n  let output = Object.assign({}, target);\r\n  if (isObject(target) && isObject(source)) {\r\n    Object.keys(source).forEach(key => {\r\n      if (isObject(source[key])) {\r\n        if (!(key in target))\r\n          Object.assign(output, { [key]: source[key] });\r\n        else\r\n          output[key] = mergeDeep(target[key], source[key]);\r\n      } else {\r\n        Object.assign(output, { [key]: source[key] });\r\n      }\r\n    });\r\n  }\r\n  return output;\r\n}\r\n\r\nfunction splitMax(string, delimiter, maxSplits) {\r\n  let arr = string.split(delimiter);\r\n  let result = arr.splice(0, maxSplits - 1);\r\n\r\n  result.push(arr.join(delimiter));\r\n\r\n  return result;\r\n}\r\n\r\n// Facade over localStorage that handles basic\r\n// numbers, strings, objects and arrays.\r\n//\r\n// Note if the object contains sub-objects of\r\n// other types, these will most likely not be\r\n// detected and lost in the conversion.\r\nexport const persistedData = {\r\n  set: function(key, value) {\r\n    if (!key) {return;}\r\n\r\n    if (value === null || value === undefined) {\r\n      window.localStorage.removeItem(key);\r\n    }\r\n\r\n    const ctor = value.constructor.name;\r\n    let stringValue;\r\n    // This handles simple property based objects\r\n    // and arrays but it doesn't support classes\r\n    // the caller should handle serialization\r\n    // themselves.\r\n    switch (ctor) {\r\n      case 'Array': // through\r\n      case 'Object': stringValue = JSON.stringify(value); break;\r\n      case 'String': stringValue = value; break;\r\n      case 'Number': stringValue = value.toString(); break;\r\n      default: throw new Error(`Type ${ctor} not supported`);\r\n    }\r\n\r\n    window.localStorage.setItem(key, `pd:${ctor}:${stringValue}`);\r\n  },\r\n\r\n  get: function(key) {\r\n    var value = localStorage.getItem(key);\r\n\r\n    // values are always strings, so if we\r\n    // get a literal null, it wasn't in there.\r\n    if (value === null) {return;}\r\n\r\n    const maxParts = 3;\r\n    const parts = splitMax(value, ':', maxParts);\r\n    if (parts.length < maxParts || parts[0] !== 'pd') {\r\n      // value was definitely not stored using this facade\r\n      return value;\r\n    }\r\n\r\n    // At this point we assume the value was stored using\r\n    // the facade, if it wasn't then we've probably got\r\n    // a bug somewhere else (OR someone has been messing\r\n    // with the data manually).\r\n    const ctorName = parts[1];\r\n    const stringValue = parts[2];\r\n    let objectValue;\r\n    switch (ctorName) {\r\n      case 'Array': // through\r\n      case 'Object': objectValue = JSON.parse(stringValue); break;\r\n      case 'String': objectValue = stringValue; break;\r\n      case 'Number': objectValue = Number(stringValue); break;\r\n      default: throw new Error(\r\n        `Non-facade value '${value}' was stored` +\r\n        `but was attempted to be retrieved through the facade.`\r\n      );\r\n    }\r\n\r\n    return objectValue;\r\n  }\r\n}\r\n\r\nexport function objectsHaveSameKeys(a, b) {\r\n  const aKeys = Object.keys(a);\r\n  const bKeys = Object.keys(b);\r\n  const aSet = new Set(aKeys);\r\n  const bSet = new Set(bKeys);\r\n\r\n  if (aSet.size !== bSet.size) return false;\r\n\r\n  for (let item of aSet) {\r\n    if (!bSet.has(item)) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n","import {\r\n  mergeDeep,\r\n  persistedData,\r\n  objectsHaveSameKeys,\r\n} from '../util';\r\n\r\nimport {\r\n  defaultStyles,\r\n} from '../constants';\r\n\r\nconst configKey = 'config';\r\n\r\nexport function loadConfig (state) {\r\n  const existingConfig = persistedData.get(configKey);\r\n  if (existingConfig) {\r\n    return {\r\n      ...state,\r\n      config: existingConfig,\r\n    }\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function updateConfig (state, action) {\r\n  const newConfig = mergeDeep(state.config, action.config);\r\n\r\n  if (!validateConfig(newConfig)) {\r\n    return state;\r\n  }\r\n\r\n  persistedData.set(configKey, newConfig);\r\n\r\n  return {\r\n    ...state,\r\n    config: newConfig,\r\n  };\r\n}\r\n\r\nexport function validateConfig(config) {\r\n  if (!config) {\r\n    return false;\r\n  }\r\n\r\n  if (config.version !== 0) {\r\n    // NOTE: when we update the version of this for reals,\r\n    // we'll probably want a facility to upgrade a config\r\n    // object through the various (supported) versions so\r\n    // any configs that players have stored offline can\r\n    // still be used and brought up to date.\r\n    return false;\r\n  }\r\n\r\n  if (!config.blockStyles) {\r\n    return false;\r\n  }\r\n\r\n  if (!objectsHaveSameKeys(config.blockStyles, defaultStyles)) {\r\n    return false;\r\n  }\r\n\r\n  const keys = Object.keys(config.blockStyles);\r\n  for (let key of keys) {\r\n    const newStyle = config.blockStyles[key];\r\n    const defaultStyle = defaultStyles[key];\r\n\r\n    if (!objectsHaveSameKeys(newStyle, defaultStyle)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n","import React, { Component } from 'react';\r\n\r\nimport './Menu.css';\r\nimport './ImportExportSettings.css';\r\n\r\nimport {\r\n  MENU_MAIN,\r\n} from '../../constants';\r\n\r\nimport { validateConfig } from '../../reducers/config';\r\n\r\nclass ImportExportSettings extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      config: JSON.stringify(props.config),\r\n      valid: true,\r\n    };\r\n  }\r\n\r\n  validateInput = (value) => {\r\n    let config;\r\n    let valid = true;\r\n\r\n    try {\r\n      config = JSON.parse(value);\r\n      valid = validateConfig(config);\r\n    } catch (e) {\r\n      valid = false;\r\n    }\r\n\r\n    return valid;\r\n  }\r\n\r\n  changeHandler = event => {\r\n    const value = event.target.value;\r\n    const valid = this.validateInput(value);\r\n    this.setState({config: value, valid: valid});\r\n  }\r\n\r\n  save = () => {\r\n    if (!this.state.valid) {\r\n      return;\r\n    }\r\n\r\n    const config = JSON.parse(this.state.config);\r\n\r\n    this.props.updateConfig(config);\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  back = () => {\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"menu\">\r\n        <div id=\"config-text-holder\">\r\n          <textarea\r\n            id=\"config-text\"\r\n            value={this.state.config}\r\n            className={this.state.valid ? \"\" : \"invalid-input\"}\r\n            onChange={this.changeHandler} />\r\n        </div>\r\n        <ul>\r\n          <li className=\"button cancel\" onClick={this.back}>\r\n            BACK\r\n          </li>\r\n          <li className=\"button save\" onClick={this.save}>\r\n            SAVE\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    )\r\n  }\r\n};\r\n\r\nexport default ImportExportSettings;\r\n","export const SET_ACTIVE_GRID_POSITION = 'SET_ACTIVE_GRID_POSITION';\r\nexport const CYCLE_PIECES = 'CYCLE_PIECES';\r\nexport const SELECT_ORIENTATION = 'SELECT_ORIENTATION';\r\nexport const NEXT_PIECE = 'NEXT_PIECE';\r\nexport const PLACE_BLOCK = 'PLACE_BLOCK';\r\nexport const CHECK_PLACEABILITY = 'CHECK_PLACEABILITY';\r\nexport const UPDATE_STATS = 'UPDATE_STATS';\r\nexport const RESET = 'RESET';\r\nexport const RESIZE = 'RESIZE';\r\nexport const SET_GAME_STATE = 'SET_GAME_STATE'\r\nexport const SET_GAME_MODE = 'SET_GAME_MODE'\r\nexport const SET_MENU = 'SET_MENU'\r\nexport const UPDATE_TIMER = 'UPDATE_TIMER'\r\nexport const UPDATE_CONFIG = 'UPDATE_CONFIG'\r\nexport const LOAD_CONFIG = 'LOAD_CONFIG'\r\n\r\nexport const setActiveGridPosition = activePosition => ({\r\n  type: SET_ACTIVE_GRID_POSITION,\r\n  activePosition: activePosition,\r\n});\r\n\r\nexport const cyclePieces = debug => ({\r\n  type: CYCLE_PIECES,\r\n  next: debug.next,\r\n  prev: debug.prev,\r\n});\r\n\r\nexport const selectOrientation = orientation => ({\r\n  type: SELECT_ORIENTATION,\r\n  orientation: orientation,\r\n});\r\n\r\nexport const nextPiece = (nextPiece, nextPieces) => ({\r\n  type: NEXT_PIECE,\r\n  nextPiece: nextPiece,\r\n  nextPieces: nextPieces,\r\n});\r\n\r\nexport const placeBlock = (field) => ({\r\n  type: PLACE_BLOCK,\r\n  field: field,\r\n});\r\n\r\nexport const checkPlaceability = (x, y, piece, orientation, field) => ({\r\n  type: CHECK_PLACEABILITY,\r\n  x: x,\r\n  y: y,\r\n  piece: piece,\r\n  orientation: orientation,\r\n  field: field,\r\n});\r\n\r\nexport const updateStats = (linesCleared) => ({\r\n  type: UPDATE_STATS,\r\n  linesCleared: linesCleared,\r\n});\r\n\r\nexport const reset = () => ({\r\n  type: RESET,\r\n});\r\n\r\nexport const resize = (newWidth, newHeight) => ({\r\n  type: RESIZE,\r\n  newWidth: newWidth,\r\n  newHeight: newHeight,\r\n});\r\n\r\nexport const setGameState = (newGameState) => ({\r\n  type: SET_GAME_STATE,\r\n  gameState: newGameState,\r\n});\r\n\r\nexport const setGameMode = (newMode) => ({\r\n  type: SET_GAME_MODE,\r\n  gameMode: newMode,\r\n});\r\n\r\nexport const setMenu = (menu) => ({\r\n  type: SET_MENU,\r\n  menu: menu,\r\n});\r\n\r\nexport const updateTimer = (timerMillis) => ({\r\n  type: UPDATE_TIMER,\r\n  timerMillis: timerMillis,\r\n});\r\n\r\nexport const updateConfig = (config) => ({\r\n  type: UPDATE_CONFIG,\r\n  config: config,\r\n});\r\n\r\nexport const loadConfig = () => ({\r\n  type: LOAD_CONFIG,\r\n});\r\n","import { connect } from 'react-redux';\r\n\r\nimport _MainMenu from '../components/Menu/MainMenu';\r\nimport _StyleConfiguration from '../components/Menu/StyleConfiguration';\r\nimport _ImportExportSettings from '../components/Menu/ImportExportSettings';\r\n\r\nimport {\r\n  setMenu,\r\n  setGameMode,\r\n  updateConfig,\r\n} from '../actions/index';\r\n\r\nconst mapStateToProps = state => ({\r\n  config: state.config,\r\n  menu: state.menu,\r\n  gameMode: state.gameMode,\r\n  lineTarget: state.lineTarget,\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  setMenu: (menu) => {\r\n    dispatch(setMenu(menu));\r\n  },\r\n  setGameMode: (newMode) => {\r\n    dispatch(setGameMode(newMode));\r\n  },\r\n  updateConfig: (config) => {\r\n    dispatch(updateConfig(config));\r\n  },\r\n});\r\n\r\nconst connectFn = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps,\r\n);\r\n\r\nexport const MainMenu = connectFn(_MainMenu);\r\nexport const StyleConfiguration = connectFn(_StyleConfiguration);\r\nexport const ImportExportSettings = connectFn(_ImportExportSettings);\r\n","import React from 'react';\r\n\r\nimport {\r\n  StyleConfiguration,\r\n  MainMenu,\r\n  ImportExportSettings,\r\n} from '../../containers/Menu';\r\n\r\nimport {\r\n  MENU_MAIN,\r\n  MENU_STYLE_SETTINGS,\r\n  MENU_IMPORT_EXPORT,\r\n} from '../../constants';\r\n\r\nconst MenuScreen = (props) => {\r\n  switch (props.menu) {\r\n    case MENU_STYLE_SETTINGS: return (<StyleConfiguration />);\r\n    case MENU_IMPORT_EXPORT: return (<ImportExportSettings />);\r\n\r\n    case MENU_MAIN: // through\r\n    default: return (<MainMenu start={props.start} />);\r\n  }\r\n};\r\n\r\nexport default MenuScreen;\r\n","import React from 'react';\r\n\r\nimport './EndScreen.css';\r\nimport Menu from './Menu/Menu';\r\n\r\nimport { millisecondsToTimestamp } from '../util';\r\n\r\nconst EndScreen = (props) => {\r\n  const {\r\n    gameMode,\r\n    linesCleared,\r\n    blockCount,\r\n    reset,\r\n    mainMenu,\r\n    timerMillis,\r\n  } = props;\r\n\r\n  const endScreenMenuItems = [\r\n    {\r\n      text: \"NEW GAME\",\r\n      onClick: reset,\r\n    },\r\n    {\r\n      text: \"MAIN MENU\",\r\n      onClick: mainMenu,\r\n    },\r\n  ];\r\n\r\n  const statistics = [\r\n    {\r\n      name: \"Total Pieces\",\r\n      value: blockCount,\r\n    },\r\n    {\r\n      name: \"Total Lines\",\r\n      value: linesCleared,\r\n    },\r\n    {\r\n      name: \"Time\",\r\n      value: millisecondsToTimestamp(timerMillis),\r\n    },\r\n  ].map(stat => (\r\n      <div className=\"row\" key={stat.name}>\r\n        <span className=\"name\">{stat.name}: </span>\r\n        <span className=\"value\">{stat.value}</span>\r\n      </div>\r\n    )\r\n  );\r\n\r\n  return (\r\n    <div className=\"end-screen\">\r\n      <div>\r\n        <h1 className=\"mode-name\">{gameMode}</h1>\r\n        <h1>FINISH</h1>\r\n      </div>\r\n      <div className=\"statistics\">\r\n        {statistics}\r\n      </div>\r\n      <div>\r\n        <Menu items={endScreenMenuItems} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EndScreen;\r\n","import React from 'react';\r\n\r\nimport './FieldBackground.css';\r\n\r\nclass FieldBackground extends React.PureComponent {\r\n  render() {\r\n    const backgroundStyle = { fill: '#232323' };\r\n\r\n    const {\r\n      x, y,\r\n      width, height,\r\n      blockSize,\r\n      rows, cols,\r\n    } = this.props;\r\n\r\n    var gridlines = [];\r\n    for (let c = 1; c < cols; c++) {\r\n      gridlines.push(<line\r\n        key={`cl${c}`}\r\n        x1={x + c * blockSize} y1={y}\r\n        x2={x + c * blockSize} y2={y + height}\r\n        className=\"grid-line\"\r\n      />);\r\n    }\r\n\r\n    for (let r = 1; r < rows; r++) {\r\n      gridlines.push(<line\r\n        key={`rl${r}`}\r\n        x1={x}         y1={y + r * blockSize}\r\n        x2={x + width} y2={y + r * blockSize}\r\n        className=\"grid-line\"\r\n      />);\r\n    }\r\n\r\n    return (\r\n      <g>\r\n        <rect\r\n          id=\"field-background\"\r\n          style={backgroundStyle}\r\n          x={x}\r\n          y={y}\r\n          width={width}\r\n          height={height}\r\n          pointerEvents=\"none\"\r\n        />\r\n        {gridlines}\r\n      </g>\r\n    );\r\n  }\r\n};\r\n\r\nexport default FieldBackground;\r\n","import React, { Component } from 'react';\r\n\r\nimport Block from './Block';\r\nimport FieldBackground from './FieldBackground';\r\n\r\nclass Field extends Component {\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    const { activePosition, blockCount } = this.props;\r\n\r\n    return activePosition.row !== nextProps.activePosition.row ||\r\n           activePosition.col !== nextProps.activePosition.col ||\r\n           blockCount !== nextProps.blockCount;\r\n  }\r\n\r\n  render() {\r\n    const borderStyle = {\r\n      fill: 'transparent',\r\n      strokeWidth:1,\r\n      stroke: '#FFFFFF',\r\n    };\r\n\r\n    const {\r\n      x, y,\r\n      width, height,\r\n      blockSize,\r\n      rows, cols,\r\n      blockStyles,\r\n      activePosition: {\r\n        row: selectedRow,\r\n        col: selectedCol\r\n      }\r\n    } = this.props;\r\n\r\n\r\n    var grid = [];\r\n    for (let r = 0; r < rows; r++) {\r\n      for (let c = 0; c < cols; c++) {\r\n        const id = r * cols + c;\r\n        const currentBlock = this.props.blocks[r][c];\r\n        const gridBlock =\r\n          <Block\r\n            id={id}\r\n            key={id}\r\n            x={x + c * blockSize}\r\n            y={y + r * blockSize}\r\n            blockSize={blockSize}\r\n            blockStyles={blockStyles}\r\n            piece={currentBlock}\r\n            flash={r === selectedRow && c === selectedCol}\r\n          />;\r\n        grid.push(gridBlock);\r\n      }\r\n    }\r\n\r\n    return (\r\n      <g id=\"field\">\r\n        <FieldBackground\r\n          x={x}\r\n          y={y}\r\n          width={width}\r\n          height={height}\r\n          rows={rows}\r\n          cols={cols}\r\n          blockSize={blockSize}\r\n        />\r\n        {grid}\r\n        <rect\r\n          id=\"field-border\"\r\n          style={borderStyle}\r\n          x={x}\r\n          y={y}\r\n          width={width}\r\n          height={height}\r\n          pointerEvents=\"none\"\r\n        />\r\n      </g>\r\n    );\r\n  }\r\n};\r\n\r\nexport default Field;\r\n","import React from 'react';\r\n\r\nconst LineCount = (props) => {\r\n\r\n  const style = {\r\n    fontFamily: 'Roboto',\r\n    fontSize: 30,\r\n    fill: '#cfabec',\r\n  }\r\n\r\n  return (\r\n    <text textAnchor=\"end\" x={props.x} y={props.y} style={style}>\r\n      {props.linesCleared} / {props.target}\r\n    </text>\r\n  )\r\n};\r\n\r\nexport default LineCount;","import React from 'react';\r\n\r\nimport { millisecondsToTimestamp } from '../util';\r\n\r\nconst Timer = (props) => {\r\n  const {\r\n    x, y,\r\n    timerMillis,\r\n  } = props;\r\n\r\n  const style = {\r\n    fontSize: 30,\r\n    fill: '#cfabec',\r\n  }\r\n\r\n  const timestamp = millisecondsToTimestamp(timerMillis);\r\n\r\n  return (\r\n    <text\r\n      x={x}\r\n      y={y}\r\n      style={style}>\r\n    {timestamp}\r\n    </text>\r\n  );\r\n};\r\n\r\nexport default Timer;\r\n","import React, { Component } from 'react';\r\n\r\nimport './Button.css';\r\n\r\nclass Button extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { pressed: false };\r\n    this.touchStart = this.touchStart.bind(this);\r\n    this.touchEnd = this.touchEnd.bind(this);\r\n  }\r\n\r\n  touchStart(event) {\r\n    event.stopPropagation();\r\n    this.setState({pressed: true})\r\n  }\r\n\r\n  touchMove(event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  touchEnd(event) {\r\n    event.stopPropagation();\r\n    this.setState({pressed: false})\r\n  }\r\n\r\n  render() {\r\n    const style = {\r\n      fill: (this.state.pressed ?\r\n              (this.props.pressedColor || this.props.color) :\r\n              this.props.color),\r\n    };\r\n\r\n    const textStyle = {\r\n      pointerEvents: \"none\",\r\n      userSelect: \"none\",\r\n      fontFamily: \"Roboto\",\r\n      // TODO: dynamic font size (or dynamic width?)\r\n      fontSize: 14,\r\n      fill: (this.props.textColor || \"white\"),\r\n    };\r\n\r\n    return (\r\n      <g onTouchStart={this.touchStart}\r\n         onTouchMove={this.touchMove}\r\n         onTouchEnd={this.touchEnd}\r\n         onClick={this.props.onPressed}>\r\n        <rect\r\n          x={this.props.x}\r\n          y={this.props.y}\r\n          rx={6}\r\n          ry={6}\r\n          width={this.props.width}\r\n          height={this.props.height}\r\n          style={style}\r\n          className={\"button \" + this.props.className}\r\n          shapeRendering=\"auto\"\r\n        />\r\n        <text\r\n          x={this.props.x + this.props.width / 2}\r\n          y={this.props.y + this.props.height / 2}\r\n          textAnchor=\"middle\"\r\n          style={textStyle}\r\n          className={\"button \" + this.props.className}\r\n          alignmentBaseline=\"central\"\r\n          dominantBaseline=\"central\"\r\n        >{this.props.text}</text>\r\n      </g>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Button;\r\n","import React from 'react';\r\n\r\nimport Piece from './Piece';\r\n\r\nconst style = {\r\n  fill: 'transparent',\r\n  strokeWidth: 1.5,\r\n  stroke: '#FFFFFF',\r\n};\r\n\r\nconst selectedStyle = {\r\n  fill: '#FFFFFF3F',\r\n  strokeWidth: 1.5,\r\n  stroke: '#FFFFFF',\r\n};\r\n\r\nconst OrientationSelector = (props) => {\r\n  const { x, y, width, height, piece, orientation, selected, blockStyles } = props;\r\n\r\n  const padding = 4;\r\n  const cornerRadius = 6;\r\n  const blockSize = (width - padding * 2) / 4;\r\n\r\n  return (\r\n    <g>\r\n      <rect\r\n        fill=\"transparent\"\r\n        x={x}\r\n        y={y}\r\n        rx={cornerRadius}\r\n        ry={cornerRadius}\r\n        width={width}\r\n        height={height}\r\n        shapeRendering=\"auto\"\r\n        style={selected ? selectedStyle : style} />\r\n      <Piece\r\n        piece={piece}\r\n        orientation={orientation}\r\n        blockSize={blockSize}\r\n        blockStyles={blockStyles}\r\n        cx={x + width / 2}\r\n        cy={y + height / 2}\r\n      />\r\n    </g>\r\n  )\r\n};\r\n\r\nexport default OrientationSelector;\r\n","import React from 'react';\r\n\r\nimport Piece, { PIECE_NONE, ORIENTATION_RIGHT } from './Piece';\r\n\r\nconst PreviewPiece = (props) => {\r\n  const { x, y, width, height, piece, blockStyles } = props;\r\n  if (piece === undefined || piece === PIECE_NONE) {\r\n    return null;\r\n  }\r\n\r\n  const orientation = ORIENTATION_RIGHT;\r\n  const padding = 4;\r\n  const blockSize = (width - padding * 2) / 4;\r\n\r\n  return (\r\n    <Piece\r\n      piece={piece}\r\n      orientation={orientation}\r\n      blockSize={blockSize}\r\n      blockStyles={blockStyles}\r\n      cx={x + width / 2}\r\n      cy={y + height / 2}\r\n    />\r\n  )\r\n};\r\n\r\nexport default PreviewPiece;\r\n","import React from 'react';\r\n\r\nimport Field from './Field';\r\nimport Piece from './Piece';\r\nimport LineCount from './LineCount';\r\nimport Timer from './Timer';\r\nimport Button from './Button';\r\nimport OrientationSelector from './OrientationSelector';\r\nimport PreviewPiece from './PreviewPiece';\r\n\r\nimport {\r\n  blockSizeInUnits,\r\n  GAMEMODE_LINE_TARGET,\r\n} from '../constants';\r\n\r\nconst Canvas = (props) => {\r\n  const gameHeight = 680;\r\n  const viewBox = [window.innerWidth / -2, -gameHeight, window.innerWidth, gameHeight];\r\n\r\n  const {\r\n    config: {\r\n      blockStyles\r\n    },\r\n\r\n  } = props;\r\n\r\n  const bagDisplay = props.previewSlots.map((ps, i) =>\r\n    <PreviewPiece\r\n      key={`pp${i}`}\r\n      x={ps.x} y={ps.y}\r\n      width={ps.width} height={ps.height}\r\n      piece={props.nextPieces[i]}\r\n      blockStyles={blockStyles}\r\n    />\r\n  );\r\n\r\n  const orientationSelectors = props.orientationSelectors.map((os, i) =>\r\n    <OrientationSelector\r\n      key={`ori${i}`}\r\n      x={os.x} y={os.y}\r\n      width={os.width} height={os.height}\r\n      orientation={os.orientation}\r\n      piece={props.currentPiece}\r\n      blockStyles={blockStyles}\r\n      selected={props.orientation === os.orientation}\r\n    />\r\n  );\r\n\r\n  const {\r\n    x: fieldX, y: fieldY,\r\n    width: fieldWidth, height: fieldHeight,\r\n    rows: fieldRows, cols: fieldCols,\r\n    blockSize,\r\n  } = props.fieldDimensions;\r\n\r\n  let gameModeHud;\r\n  switch (props.gameMode) {\r\n    case GAMEMODE_LINE_TARGET: {\r\n      // TODO: calculate the position for this properly...\r\n      const lineCountPositionX = fieldX + 85;\r\n      const lineCountPositionY = fieldY - 10;\r\n      const timerPositionX = fieldX + 140;\r\n      gameModeHud = <React.Fragment>\r\n        <LineCount\r\n          x={lineCountPositionX}\r\n          y={lineCountPositionY}\r\n          linesCleared={props.linesCleared}\r\n          target={props.lineTarget}\r\n        />\r\n        <Timer\r\n          x={timerPositionX}\r\n          y={lineCountPositionY}\r\n          timerMillis={props.timerMillis}\r\n        />\r\n      </React.Fragment>\r\n    } break;\r\n    default: gameModeHud = null;\r\n  }\r\n\r\n  const pieceX = fieldX + props.activePosition.col * blockSizeInUnits;\r\n  const pieceY = fieldY + props.activePosition.row * blockSizeInUnits;\r\n\r\n  const activePiece = (props.activePosition.row !== -1\r\n    ? <Piece\r\n        x={pieceX}\r\n        y={pieceY}\r\n        piece={props.currentPiece}\r\n        orientation={props.orientation}\r\n        placeable={props.placeable}\r\n        blockStyles={blockStyles}\r\n        blockSize={blockSizeInUnits} />\r\n    : null);\r\n\r\n  return (\r\n    <svg\r\n      id=\"game-canvas\"\r\n      preserveAspectRatio=\"xMidYMax meet\"\r\n      shapeRendering=\"crispEdges\"\r\n      textRendering=\"optimizeLegibility\"\r\n      style={ {\r\n        touchAction: 'none',\r\n        width: props.windowWidth,\r\n        height: props.windowHeight,\r\n      } }\r\n      onTouchStart={props.touchStart}\r\n      onTouchMove={props.touchMove}\r\n      onTouchEnd={props.touchEnd}\r\n      onMouseDown={props.mouseDown}\r\n      onMouseMove={props.mouseMove}\r\n      onMouseUp={props.mouseUp}\r\n      viewBox={viewBox}\r\n    >\r\n      <Field\r\n        activePosition={props.activePosition}\r\n        x={fieldX}\r\n        y={fieldY}\r\n        width={fieldWidth}\r\n        height={fieldHeight}\r\n        blockSize={blockSize}\r\n        blockStyles={blockStyles}\r\n        rows={fieldRows}\r\n        cols={fieldCols}\r\n        blocks={props.blocks}\r\n        blockCount={props.blockCount} />\r\n      {activePiece}\r\n      {orientationSelectors}\r\n      {bagDisplay}\r\n      {gameModeHud}\r\n      <Button\r\n        // TODO: calculate the position for this properly...\r\n        x={fieldX + fieldWidth + 8} y={fieldY + 8}\r\n        width={58}\r\n        height={32}\r\n        text=\"RESET\"\r\n        color=\"#ec3636\"\r\n        pressedColor=\"#dc2626\"\r\n        onPressed={props.reset}\r\n      />\r\n      <Button\r\n        // TODO: calculate the position for this properly...\r\n        x={fieldX + fieldWidth + 8} y={fieldY + 8 + 32 + 8}\r\n        width={58}\r\n        height={32}\r\n        text=\"MENU\"\r\n        color=\"#3e3e3e\"\r\n        pressedColor=\"#292929\"\r\n        onPressed={props.mainMenu}\r\n      />\r\n    </svg>\r\n  );\r\n};\r\n\r\nexport default Canvas;\r\n","import { shuffle } from '../util';\r\n\r\nclass BagRandomizer {\r\n  constructor(random) {\r\n    // TODO: use piece constants?\r\n    this.bag = [0, 1, 2, 3, 4, 5, 6];\r\n    this.random = random;\r\n    this.index = this.bag.length;\r\n  }\r\n\r\n  next() {\r\n   if (this.index === this.bag.length) {\r\n      shuffle(this.bag, this.random);\r\n      this.index = 0;\r\n    }\r\n\r\n    return this.bag[this.index++];\r\n  }\r\n}\r\n\r\nexport default BagRandomizer;\r\n","import React, { Component } from 'react';\r\n\r\nimport MenuScreen from './components/Menu/MenuScreen';\r\nimport EndScreen from './components/EndScreen';\r\nimport Canvas from './components/Canvas';\r\n\r\nimport BagRandomizer from './randomizers/BagRandomizer';\r\n\r\nimport {\r\n  fieldWidthInBlocks, fieldHeightInBlocks,\r\n  blockSizeInUnits, hiddenHeight,\r\n  GAMESTATE_PAUSED, GAMESTATE_MENU, GAMESTATE_END, GAMESTATE_PLAYING,\r\n  GAMEMODE_ZEN,\r\n  GAMEMODE_LINE_TARGET,\r\n} from './constants';\r\n\r\nimport {\r\n  placeBlock, PIECE_NONE, ORIENTATION_NONE,\r\n  ORIENTATION_UP, ORIENTATION_RIGHT,\r\n  ORIENTATION_DOWN, ORIENTATION_LEFT,\r\n  checkPlaceability,\r\n} from './components/Piece';\r\n\r\nconst orientations = [\r\n  ORIENTATION_LEFT,\r\n  ORIENTATION_UP,\r\n  ORIENTATION_RIGHT,\r\n  ORIENTATION_DOWN\r\n];\r\n\r\nclass App extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.initialiseLayout();\r\n\r\n    this.keydown = this.keydown.bind(this);\r\n    this.gameLoop = this.gameLoop.bind(this);\r\n    this.selectOrientation = this.selectOrientation.bind(this);\r\n    this.updateOrientation = this.updateOrientation.bind(this);\r\n    this.init = this.init.bind(this);\r\n    this.start = this.start.bind(this);\r\n    this.mainMenu = this.mainMenu.bind(this);\r\n    this.pause = this.pause.bind(this);\r\n    this.dragMove = this.dragMove.bind(this);\r\n    this.dragEnd = this.dragEnd.bind(this);\r\n    this.mouseDown = this.mouseDown.bind(this);\r\n    this.mouseMove = this.mouseMove.bind(this);\r\n    this.mouseUp   = this.mouseUp.bind(this);\r\n    this.touchMove = this.touchMove.bind(this);\r\n    this.touchEnd = this.touchEnd.bind(this);\r\n    // we don't need any special logic for tracking\r\n    // the initial touches at the moment.\r\n    this.touchStart = this.touchMove;\r\n\r\n    this.mouseDown = this.mouseDown.bind(this);\r\n    this.mouseMove = this.mouseMove.bind(this);\r\n    this.mouseUp   = this.mouseUp.bind(this);\r\n\r\n    this.init();\r\n    props.loadConfig();\r\n  }\r\n\r\n  initialiseLayout() {\r\n    const previewSize = 65;\r\n\r\n    //\r\n    // Field\r\n    //\r\n    const yOffset = 100;\r\n    const fieldWidth  = blockSizeInUnits * fieldWidthInBlocks;\r\n    const fieldHeight = blockSizeInUnits * fieldHeightInBlocks;\r\n\r\n    this.fieldDimensions = {\r\n      // Center the field (but shift over for the preview pieces)\r\n      x: fieldWidth / -2 - previewSize/2,\r\n      y: -yOffset-fieldHeight,\r\n      blockSize: blockSizeInUnits,\r\n      rows: fieldHeightInBlocks,\r\n      cols: fieldWidthInBlocks,\r\n      width: fieldWidth,\r\n      height: fieldHeight,\r\n    };\r\n\r\n    //\r\n    // Orientation selectors\r\n    //\r\n    const osMargin = 16;\r\n    const osSize = 70;\r\n    const osYStart = -yOffset + osMargin;\r\n\r\n    const allOsWidth = (osSize * orientations.length + osMargin * (orientations.length - 1));\r\n    const osXStart = (allOsWidth / -2);\r\n\r\n    this.orientationSelectors = orientations.map((orientation, i) => ({\r\n      x: osXStart + (osSize + osMargin)*i,\r\n      y: osYStart,\r\n      width: osSize,\r\n      height: osSize,\r\n      orientation: orientation,\r\n    }));\r\n\r\n    //\r\n    // Preview pieces\r\n    //\r\n\r\n    // We want to emphasize the next piece more than the\r\n    // rest, but we still want everything to be centered.\r\n    const minorReduction = 10;\r\n\r\n    const psXStart = this.fieldDimensions.x + fieldWidth;\r\n    const psYStart = this.fieldDimensions.y + fieldHeight - previewSize;\r\n    this.previewSlots = Array(this.props.previewLength).fill(0).map((_, i) => {\r\n      return {\r\n        x: psXStart + (i === 0 ? 0 : minorReduction / 2),\r\n        y: psYStart - (previewSize - minorReduction)*i,\r\n        width: previewSize - (i === 0 ? 0 : minorReduction),\r\n        height: previewSize - (i === 0 ? 0 : minorReduction),\r\n        index: i,\r\n      }\r\n    });\r\n  }\r\n\r\n  // TODO: We should change the name of one of these\r\n  // to disambiguate it from the action that actually\r\n  // updates the state/container.\r\n  selectOrientation(orientation) {\r\n    this.orientation = orientation;\r\n  }\r\n\r\n  keydown(event) {\r\n    // TODO: configurable keys\r\n    switch (event.keyCode) {\r\n      // ',' (<)\r\n      case 188:\r\n        this.pieceDebug.next = false;\r\n        this.pieceDebug.prev = true;\r\n      break;\r\n      // '.' (>)\r\n      case 190:\r\n        this.pieceDebug.next = true;\r\n        this.pieceDebug.prev = false;\r\n      break;\r\n      // no default\r\n    }\r\n  }\r\n\r\n  init() {\r\n    // internal state\r\n    this.pieceDebug = {\r\n      next : false,\r\n      prev : false,\r\n    };\r\n\r\n    this.nextPieces = [];\r\n\r\n    // TODO: use a seedable random function\r\n    this.randomizer = new BagRandomizer(Math.random);\r\n    this.activeTouches = 0;\r\n    this.mouseIsDown = false;\r\n    this.activePosition = {\r\n      row : -1,\r\n      col : -1,\r\n    };\r\n\r\n    this.field = {\r\n      blocks:\r\n        Array(fieldHeightInBlocks).fill(0).map(r =>\r\n          Array(fieldWidthInBlocks).fill(PIECE_NONE)),\r\n      hiddenBlocks:\r\n        Array(hiddenHeight).fill(0).map(r =>\r\n          Array(fieldWidthInBlocks).fill(PIECE_NONE)),\r\n      lineClearFlags: Array(fieldHeightInBlocks).fill(false),\r\n      hiddenLineClearFlags: Array(hiddenHeight).fill(false),\r\n    };\r\n\r\n    this.nextPieces.length = 0;\r\n\r\n    // TODO: clean up the duplication / inconsistency between this\r\n    // and redux when we initialise / reset the game.\r\n    this.linesCleared = 0;\r\n    this.orientation = ORIENTATION_NONE;\r\n  }\r\n\r\n  start() {\r\n    this.init();\r\n    this.props.reset();\r\n    this.rollNextPiece();\r\n\r\n    // TODO: \"READY\" / \"GO\"\r\n    this.lastPlayingTime = new Date();\r\n    this.totalTimerMillis = 0;\r\n  }\r\n\r\n  pause() {\r\n    let newState = GAMESTATE_PAUSED;\r\n    const now = new Date();\r\n\r\n    if (this.props.gameState === GAMESTATE_PAUSED) {\r\n      newState = GAMESTATE_PLAYING;\r\n      this.lastPlayingTime = now;\r\n    } else {\r\n      const millisDiff = now - this.lastPlayingTime;\r\n      this.lastPlayingTime = now;\r\n      this.totalTimerMillis += millisDiff;\r\n    }\r\n\r\n    this.props.setGameState(newState);\r\n  }\r\n\r\n  mainMenu() {\r\n    this.props.setGameState(GAMESTATE_MENU);\r\n  }\r\n\r\n  // TODO: we probably will want to do these way more\r\n  // efficiently in the future. These are highly likely\r\n  // to cause a boat load of GC\r\n  canvasPoint(event) {\r\n    const svg = document.getElementById('game-canvas');\r\n    const point = svg.createSVGPoint();\r\n    point.x = event.clientX;\r\n    point.y = event.clientY;\r\n    const { x, y } = point.matrixTransform(svg.getScreenCTM().inverse());\r\n    return {x, y};\r\n  }\r\n\r\n  fieldPoint(canvasPoint) {\r\n    const fcpx = canvasPoint.x - this.fieldDimensions.x;\r\n    const fcpy = canvasPoint.y - this.fieldDimensions.y;\r\n\r\n    const col = Math.floor(fcpx / blockSizeInUnits);\r\n    const row = Math.floor(fcpy / blockSizeInUnits);\r\n\r\n    return {col, row};\r\n  }\r\n\r\n  updateOrientation(canvasPoint) {\r\n    const { x, y } = canvasPoint;\r\n\r\n    for (var i = 0; i < this.orientationSelectors.length; i++) {\r\n      const os = this.orientationSelectors[i];\r\n      if (y > os.y && y < os.y + os.height &&\r\n          x > os.x && x < os.x + os.width) {\r\n        this.selectOrientation(os.orientation);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  dragMove(canvasPoint) {\r\n    this.updateOrientation(canvasPoint);\r\n\r\n    const fp = this.fieldPoint(canvasPoint);\r\n    if (fp.col > -1 && fp.col < fieldWidthInBlocks &&\r\n        fp.row > -1 && fp.row < fieldHeightInBlocks)\r\n    {\r\n      this.activePosition.row = fp.row;\r\n      this.activePosition.col = fp.col;\r\n    }\r\n  }\r\n\r\n  dragEnd() {\r\n    if (this.activeTouches === 0 && !this.mouseIsDown) {\r\n      this.place = true;\r\n    }\r\n  }\r\n\r\n  mouseDown(event) {\r\n    event.preventDefault();\r\n    this.mouseIsDown = true;\r\n\r\n    const cp = this.canvasPoint(event);\r\n    this.dragMove(cp);\r\n  }\r\n\r\n  mouseMove(event) {\r\n    event.preventDefault();\r\n    if (this.mouseIsDown) {\r\n      const cp = this.canvasPoint(event);\r\n      this.dragMove(cp);\r\n    }\r\n  }\r\n\r\n  mouseUp(event) {\r\n    event.preventDefault();\r\n    this.mouseIsDown = false;\r\n    this.dragEnd();\r\n  }\r\n\r\n  touchMove(event) {\r\n    event.preventDefault();\r\n    this.activeTouches = event.touches.length;\r\n\r\n    // Note: if multiple touches are inside the field\r\n    // then the \"last\" one wins whichever that happens\r\n    // to be.\r\n    for (let i = 0; i < event.changedTouches.length; i++) {\r\n      const touch = event.changedTouches[i];\r\n      const cp = this.canvasPoint(touch);\r\n      this.dragMove(cp);\r\n    }\r\n  }\r\n\r\n  touchEnd(event) {\r\n    event.preventDefault();\r\n    this.activeTouches = event.touches.length;\r\n    this.dragEnd();\r\n  }\r\n\r\n  isLineFilled(line) {\r\n    const lineLength = line.length;\r\n    for (let col = 0; col < lineLength; col++) {\r\n      const block = line[col];\r\n      if (block === PIECE_NONE) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  setLineClearedFlag(row, field, flag) {\r\n    if (row >= 0) {\r\n      field.lineClearFlags[row] = flag;\r\n    } else {\r\n      field.hiddenLineClearFlags[(row * -1) - 1] = flag;\r\n    }\r\n  }\r\n\r\n  getLineClearedFlag(row, field) {\r\n    return field.lineClearFlags[row] || field.hiddenLineClearFlags[(row * -1) - 1];\r\n  }\r\n\r\n  getRow(row, field) {\r\n    return field.blocks[row] || field.hiddenBlocks[(row * -1) - 1];\r\n  }\r\n\r\n  // NOTE: this was originally ported pretty directly from Nullpomino\r\n  downFloatingBlocks(field) {\r\n    const fieldHeight = field.blocks.length;\r\n    const fieldWidth = field.blocks[0].length;\r\n\r\n    var y = fieldHeight - 1;\r\n    for (let i = hiddenHeight * -1; i < fieldHeight; i++) {\r\n      if (this.getLineClearedFlag(y, field)) {\r\n        for (let k = y; k > hiddenHeight * -1; k--) {\r\n          const rowUp = this.getRow(k-1, field);\r\n          const row   = this.getRow(k, field);\r\n          for (let l = 0; l < fieldWidth; l++) {\r\n            const blk = rowUp === undefined ? PIECE_NONE : rowUp[l];\r\n            row[l] = blk;\r\n          }\r\n\r\n          this.setLineClearedFlag(k, field, this.getLineClearedFlag(k-1, field));\r\n        }\r\n\r\n        // clear the top (we really only need to do this once)\r\n        for (let l = 0; l < fieldWidth; l++) {\r\n          const topRow = field.hiddenBlocks[hiddenHeight - 1];\r\n          topRow[l] = PIECE_NONE;\r\n        }\r\n      } else {\r\n        y--;\r\n      }\r\n    }\r\n  }\r\n\r\n  doLineClears(field) {\r\n    var linesCleared = 0;\r\n    var firstLine = -1;\r\n    const fieldHeight = field.blocks.length;\r\n\r\n    for(let r = hiddenHeight * -1; r < fieldHeight; r++) {\r\n      const row = this.getRow(r, field);\r\n      const filled = this.isLineFilled(row);\r\n\r\n      if (filled) {\r\n        const rowLength = row.length;\r\n        for (let c = 0; c < rowLength; c++) {\r\n          row[c] = PIECE_NONE;\r\n        }\r\n        linesCleared++;\r\n        this.setLineClearedFlag(r, field, true);\r\n\r\n        if (firstLine === -1) {\r\n          firstLine = r;\r\n        }\r\n      }\r\n    }\r\n\r\n    // TODO: split out and do later\r\n    // after some frames for animation purposes?\r\n    if (linesCleared > 0) {\r\n      this.downFloatingBlocks(field);\r\n    }\r\n\r\n    return linesCleared;\r\n  }\r\n\r\n  rollNextPiece() {\r\n    let nextPiece;\r\n    if (this.nextPieces.length === 0) {\r\n      nextPiece = this.randomizer.next();\r\n    } else {\r\n      nextPiece = this.nextPieces[0];\r\n    }\r\n\r\n    const nextPieces = this.nextPieces = this.nextPieces.slice(1);\r\n    while (nextPieces.length < this.props.previewLength) {\r\n      nextPieces.push(this.randomizer.next());\r\n    }\r\n\r\n    this.props.nextPiece(nextPiece, nextPieces);\r\n  }\r\n\r\n  checkGameOver(piece, field) {\r\n    if (piece === PIECE_NONE) {\r\n      return false;\r\n    }\r\n\r\n    // if there's any slot we can place the piece in any orientation\r\n    // the player can still \"continue\", even if that will still lead\r\n    // to a game over.\r\n    for (let r = 0; r < field.blocks.length; r++) {\r\n      let row = field.blocks[r];\r\n      for (let c = 0; c < row.length; c++) {\r\n        for (let o of orientations) {\r\n          if (checkPlaceability(c, r, piece, o, field)) {\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  gameLoop() {\r\n    this.props.setActiveGridPosition(this.activePosition);\r\n\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      this.props.cyclePieces(this.pieceDebug);\r\n    }\r\n\r\n    this.props.checkPlaceability(\r\n      this.activePosition.col, this.activePosition.row,\r\n      this.props.currentPiece, this.orientation,\r\n      this.field\r\n    );\r\n\r\n    if (this.props.gameState === GAMESTATE_PLAYING) {\r\n      const now = new Date();\r\n      const millisDiff = now - this.lastPlayingTime;\r\n      this.lastPlayingTime = now;\r\n      this.totalTimerMillis += millisDiff;\r\n      // Checking more than once per piece is redundant at the moment because\r\n      // you can currently place the piece anywhere, but if we change over to\r\n      // using a reference piece we'll need to check every time the reference\r\n      // piece moves.\r\n      let gameIsOver = this.checkGameOver(this.props.currentPiece, this.field);\r\n      if (gameIsOver) {\r\n        this.props.setGameState(GAMESTATE_END);\r\n      }\r\n\r\n      if (this.place) {\r\n        var placed = false;\r\n        if (this.props.placeable) {\r\n          // update our internal field\r\n          placeBlock(\r\n            this.activePosition.col, this.activePosition.row,\r\n            this.props.currentPiece, this.orientation,\r\n            this.field\r\n          );\r\n\r\n          var lines = this.doLineClears(this.field);\r\n          this.linesCleared += lines;\r\n          this.props.updateStats(this.linesCleared);\r\n\r\n          // TODO: line clear delay / animation??\r\n          // broadcast to everyone else\r\n          this.props.placeBlock(this.field);\r\n\r\n          placed = true;\r\n        }\r\n\r\n        // Check win/end conditions\r\n        switch (this.props.gameMode) {\r\n          case GAMEMODE_ZEN: /* There is no defined goal */ break;\r\n          case GAMEMODE_LINE_TARGET:\r\n            if (this.linesCleared >= this.props.lineTarget) {\r\n              this.props.setGameState(GAMESTATE_END);\r\n            }\r\n          break;\r\n\r\n          // no default\r\n        }\r\n\r\n        // TODO: punishment for trying to drop in a\r\n        //. non-placeable space? or do we just leave\r\n        // it hanging as this currently does.\r\n        this.place = false;\r\n\r\n        // TODO: allow placing it as soon as they try\r\n        // to rotate it if that becomes a valid placement?\r\n\r\n        if (placed) {\r\n          this.activePosition.row = -1;\r\n          this.activePosition.col = -1;\r\n          this.orientation = ORIENTATION_NONE;\r\n          this.rollNextPiece();\r\n        }\r\n      }\r\n      // Only do after potentially resetting above\r\n      // so that we don't highlight the orientation\r\n      // of the _next_ piece for a single frame if\r\n      // we select the orientation and the destination\r\n      // in the same frame.\r\n      this.props.selectOrientation(this.orientation);\r\n\r\n      this.pieceDebug.prev = false;\r\n      this.pieceDebug.next = false;\r\n    }\r\n\r\n    this.props.updateTimer(this.totalTimerMillis);\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.onresize = () => {\r\n      this.props.resize(window.innerWidth, window.innerHeight);\r\n    };\r\n    window.onresize();\r\n\r\n    document.addEventListener(\"keydown\", this.keydown, false);\r\n\r\n    setInterval(this.gameLoop, 33);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keydown\", this.keydown);\r\n  }\r\n\r\n  render() {\r\n    if (this.props.gameState === GAMESTATE_MENU) {\r\n      return (\r\n        <MenuScreen\r\n          menu={this.props.menu}\r\n          start={this.start} />\r\n      );\r\n    }\r\n\r\n    if (this.props.gameState === GAMESTATE_END) {\r\n      return (\r\n        <EndScreen\r\n          gameMode={this.props.gameMode}\r\n          blockCount={this.props.blockCount}\r\n          linesCleared={this.props.linesCleared}\r\n          reset={this.start}\r\n          mainMenu={this.mainMenu}\r\n          timerMillis={this.props.timerMillis}\r\n        />\r\n      );\r\n    }\r\n\r\n    return (\r\n      <Canvas\r\n        gameState={this.props.gameState}\r\n        activePosition={this.props.activePosition}\r\n        orientationSelectors={this.orientationSelectors}\r\n        previewSlots={this.previewSlots}\r\n        nextPieces={this.props.nextPieces}\r\n        fieldDimensions={this.fieldDimensions}\r\n        currentPiece={this.props.currentPiece}\r\n        orientation={this.props.orientation}\r\n        placeable={this.props.placeable}\r\n        blocks={this.props.field.blocks}\r\n        config={this.props.config}\r\n        linesCleared={this.props.linesCleared}\r\n        blockCount={this.props.blockCount}\r\n        lineTarget={this.props.lineTarget}\r\n        timerMillis={this.props.timerMillis}\r\n        gameMode={this.props.gameMode}\r\n        reset={this.start}\r\n        mainMenu={this.mainMenu}\r\n        pause={this.pause}\r\n        touchStart={this.touchStart}\r\n        touchMove={this.touchMove}\r\n        touchEnd={this.touchEnd}\r\n        mouseDown={this.mouseDown}\r\n        mouseMove={this.mouseMove}\r\n        mouseUp={this.mouseUp}\r\n        windowWidth={this.props.windowWidth}\r\n        windowHeight={this.props.windowHeight}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import { connect } from 'react-redux';\r\n\r\nimport App from '../App';\r\nimport {\r\n  setActiveGridPosition,\r\n  cyclePieces,\r\n  selectOrientation,\r\n  nextPiece,\r\n  placeBlock,\r\n  updateStats,\r\n  checkPlaceability,\r\n  reset,\r\n  resize,\r\n  setGameState,\r\n  setGameMode,\r\n  updateTimer,\r\n  loadConfig,\r\n} from '../actions/index';\r\n\r\nconst mapStateToProps = state => ({\r\n  menu: state.menu,\r\n  config: state.config,\r\n  gameState: state.gameState,\r\n  gameMode: state.gameMode,\r\n  activePosition: state.activePosition,\r\n  currentPiece: state.currentPiece,\r\n  nextPieces: state.nextPieces,\r\n  previewLength: state.previewLength,\r\n  orientation: state.orientation,\r\n  field: state.field,\r\n  blockCount: state.blockCount,\r\n  placeable: state.placeable,\r\n  linesCleared: state.linesCleared,\r\n  lineTarget: state.lineTarget,\r\n  windowWidth: state.windowWidth,\r\n  windowHeight: state.windowHeight,\r\n  timerMillis: state.timerMillis,\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  setActiveGridPosition: (param) => {\r\n    dispatch(setActiveGridPosition(param));\r\n  },\r\n  cyclePieces: (param) => {\r\n    dispatch(cyclePieces(param));\r\n  },\r\n  selectOrientation: (param) => {\r\n    dispatch(selectOrientation(param));\r\n  },\r\n  nextPiece: (np, nps) => {\r\n    dispatch(nextPiece(np, nps));\r\n  },\r\n  placeBlock: (field) => {\r\n    dispatch(placeBlock(field));\r\n  },\r\n  checkPlaceability: (x, y, piece, orientation, field) => {\r\n    dispatch(checkPlaceability(x, y, piece, orientation, field));\r\n  },\r\n  updateStats: (linesCleared) => {\r\n    dispatch(updateStats(linesCleared));\r\n  },\r\n  reset: () => {\r\n    dispatch(reset());\r\n  },\r\n  resize: (newWidth, newHeight) => {\r\n    dispatch(resize(newWidth, newHeight));\r\n  },\r\n  setGameState: (newGameState) => {\r\n    dispatch(setGameState(newGameState));\r\n  },\r\n  setGameMode: (newMode) => {\r\n    dispatch(setGameMode(newMode));\r\n  },\r\n  updateTimer: (timerMillis) => {\r\n    dispatch(updateTimer(timerMillis));\r\n  },\r\n  loadConfig: () => {\r\n    dispatch(loadConfig());\r\n  },\r\n});\r\n\r\nconst Game = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps,\r\n)(App);\r\n\r\nexport default Game;\r\n","function setActiveGridPosition(state, action) {\r\n  if (state.activePosition.row === action.activePosition.row &&\r\n      state.activePosition.col === action.activePosition.col) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    activePosition: {\r\n        ...action.activePosition\r\n    },\r\n  };\r\n}\r\n\r\nexport default setActiveGridPosition;\r\n","function cyclePieces(state, action) {\r\n  if (!action.next && !action.prev) {\r\n    return state;\r\n  }\r\n\r\n  var currentPiece;\r\n  if (action.next) {\r\n    currentPiece = state.currentPiece + 1;\r\n  } else if (action.prev) {\r\n    currentPiece = state.currentPiece - 1;\r\n  }\r\n\r\n  // Wrap around with -1 in the middle (no piece)\r\n  if (currentPiece > 6) {\r\n    currentPiece = -1;\r\n  } else if (currentPiece < -1) {\r\n    currentPiece = 6;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    currentPiece: currentPiece,\r\n  };\r\n}\r\n\r\n// replace with a dummy function in prod builds\r\n// so we don't have to worry about \"leaving\" it\r\n// in somehow.\r\nconst exportFn = ((process.env.NODE_ENV === 'production')\r\n  ? (function() {})\r\n  : cyclePieces);\r\n\r\nexport default exportFn;\r\n","function selectOrientation(state, action) {\r\n  if (state.orientation === action.orientation) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    orientation: action.orientation,\r\n  };\r\n}\r\n\r\nexport default selectOrientation;\r\n","function nextPiece(state, action) {\r\n  return {\r\n    ...state,\r\n    currentPiece: action.nextPiece,\r\n    // Note: We require this to be a \"new\" array, but I don't want\r\n    // to create a copy of a copy here.\r\n    nextPieces: action.nextPieces,\r\n  };\r\n}\r\n\r\nexport default nextPiece;\r\n","function getChangedRows(oldField, newField) {\r\n  const changedRows = [];\r\n  const numRows = oldField.length;\r\n  for (let r = 0; r < numRows; r++) {\r\n    const newRow = newField[r];\r\n    const oldRow = oldField[r];\r\n\r\n    const numCols = newRow.length;\r\n    for (let c = 0; c < numCols; c++) {\r\n      const newBlock = newRow[c];\r\n      const oldBlock = oldRow[c];\r\n\r\n      if (oldBlock !== newBlock) {\r\n        changedRows.push(r);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return changedRows;\r\n}\r\n\r\nfunction placeBlock(state, data) {\r\n  const newField = data.field.blocks;\r\n  var changedRows = getChangedRows(state.field.blocks, newField);\r\n  if (changedRows.length === 0) {\r\n    return state;\r\n  }\r\n\r\n  const blocks = [...state.field.blocks];\r\n  for (let r of changedRows) {\r\n    blocks[r] = [...newField[r]];\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    field: {\r\n      ...state.field,\r\n      blocks: blocks,\r\n    },\r\n    blockCount: state.blockCount + 1,\r\n  };\r\n}\r\n\r\nexport default placeBlock;\r\n","// TODO: I think this is probably bad style to be in the component...\r\nimport { checkPlaceability } from '../components/Piece';\r\n\r\nexport default (state, data) => {\r\n  const { x, y, piece, orientation, field } = data;\r\n  const oldPlaceable = state.placeable;\r\n  const newPlaceable = checkPlaceability(x, y, piece, orientation, field);\r\n\r\n  if (oldPlaceable === newPlaceable) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    placeable: newPlaceable,\r\n  };\r\n};\r\n","function updateStats(state, action) {\r\n  if (state.linesCleared === action.linesCleared) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    linesCleared: action.linesCleared,\r\n  };\r\n}\r\n\r\nexport default updateStats;\r\n","export default (state, action) => {\r\n  if (state.timerMillis === action.timerMillis) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    timerMillis: action.timerMillis,\r\n  };\r\n};\r\n","function resize(state, action) {\r\n  return {\r\n    ...state,\r\n    windowWidth: action.newWidth,\r\n    windowHeight: action.newHeight,\r\n  }\r\n}\r\n\r\nexport default resize;\r\n\r\n","import {\r\n  GAMESTATE_PLAYING, GAMESTATE_PAUSED,\r\n} from '../constants';\r\n\r\nexport default (state, action) => {\r\n  let newState = action.gameState;\r\n  if (action.gameState === GAMESTATE_PAUSED) {\r\n    if (state.gameState === GAMESTATE_PAUSED) {\r\n      newState = GAMESTATE_PLAYING;\r\n    }\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    gameState: newState,\r\n  };\r\n};\r\n","export default (state, action) => {\r\n  return {\r\n    ...state,\r\n    gameMode: action.gameMode,\r\n  };\r\n};\r\n","export default (state, action) => {\r\n  return {\r\n    ...state,\r\n    menu: action.menu,\r\n  };\r\n};\r\n","import {\r\n  SET_ACTIVE_GRID_POSITION,\r\n  CYCLE_PIECES,\r\n  SELECT_ORIENTATION,\r\n  NEXT_PIECE,\r\n  PLACE_BLOCK,\r\n  CHECK_PLACEABILITY,\r\n  UPDATE_STATS,\r\n  UPDATE_TIMER,\r\n  UPDATE_CONFIG,\r\n  LOAD_CONFIG,\r\n  RESET,\r\n  RESIZE,\r\n  SET_GAME_STATE,\r\n  SET_GAME_MODE,\r\n  SET_MENU,\r\n} from '../actions';\r\n\r\nimport setActiveGridPosition from './setActiveGridPosition';\r\nimport cyclePieces from './cyclePieces';\r\nimport selectOrientation from './selectOrientation';\r\nimport nextPiece from './nextPiece';\r\nimport placeBlock from './placeBlock';\r\nimport checkPlaceability from './checkPlaceability';\r\nimport updateStats from './updateStats';\r\nimport updateTimer from './updateTimer';\r\nimport { loadConfig, updateConfig } from './config';\r\nimport resize from './resize';\r\nimport setGameState from './setGameState';\r\nimport setGameMode from './setGameMode';\r\nimport setMenu from './setMenu';\r\n\r\n// TODO: I think this is probably bad style to be in the component...\r\nimport { PIECE_NONE, ORIENTATION_NONE } from '../components/Piece';\r\n\r\nimport {\r\n  fieldWidthInBlocks, fieldHeightInBlocks,\r\n  GAMESTATE_MENU, GAMESTATE_PLAYING,\r\n  defaultStyles,\r\n} from '../constants'\r\n\r\nconst initialState = {\r\n  gameState: GAMESTATE_MENU,\r\n  activePosition: {\r\n    row: -1,\r\n    col: -1,\r\n  },\r\n  currentPiece: PIECE_NONE,\r\n  previewLength: 5,\r\n  nextPieces: [],\r\n  orientation: ORIENTATION_NONE,\r\n  placeable: false,\r\n  blockCount: 0,\r\n  linesCleared: 0,\r\n  lineTarget: 40,\r\n  timerMillis: 0,\r\n  field: {\r\n    blocks :\r\n      Array(fieldHeightInBlocks).fill(0).map(r =>\r\n        Array(fieldWidthInBlocks).fill(PIECE_NONE))\r\n  },\r\n  config: {\r\n    version: 0,\r\n    blockStyles: defaultStyles,\r\n  },\r\n};\r\n\r\nfunction reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case SET_ACTIVE_GRID_POSITION:\r\n      return setActiveGridPosition(state, action);\r\n    case CYCLE_PIECES:\r\n      return cyclePieces(state, action);\r\n    case SELECT_ORIENTATION:\r\n      return selectOrientation(state, action);\r\n    case NEXT_PIECE:\r\n      return nextPiece(state, action);\r\n    case PLACE_BLOCK:\r\n      return placeBlock(state, action);\r\n    case CHECK_PLACEABILITY:\r\n      return checkPlaceability(state, action);\r\n    case UPDATE_STATS:\r\n      return updateStats(state, action);\r\n    case UPDATE_TIMER:\r\n      return updateTimer(state, action);\r\n    case UPDATE_CONFIG:\r\n      return updateConfig(state, action);\r\n    case LOAD_CONFIG:\r\n      return loadConfig(state);\r\n    case RESIZE:\r\n      return resize(state, action);\r\n    case SET_GAME_STATE:\r\n      return setGameState(state, action);\r\n    case SET_GAME_MODE:\r\n      return setGameMode(state, action);\r\n    case SET_MENU:\r\n      return setMenu(state, action);\r\n    case RESET:\r\n      // TODO: take some game options that\r\n      // override the initial state?\r\n      return {\r\n        ...initialState,\r\n        config: state.config,\r\n        windowWidth: state.windowWidth,\r\n        windowHeight: state.windowHeight,\r\n        gameMode: state.gameMode,\r\n        gameState: GAMESTATE_PLAYING,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default reducer;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport { Provider } from 'react-redux';\r\nimport { createStore } from 'redux';\r\n\r\n// Polyfills\r\n// Required for Safari\r\nimport 'core-js/fn/object/assign';\r\nimport 'core-js/fn/object/values';\r\nimport 'core-js/es6/set';\r\nimport 'core-js/es6/symbol';\r\n\r\nimport './index.css';\r\nimport Game from './containers/Game';\r\nimport reducer from './reducers';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nconst store = createStore(\r\n  reducer,\r\n);\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <Game />\r\n  </Provider>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}