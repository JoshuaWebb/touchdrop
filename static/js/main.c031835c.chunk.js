(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{114:function(e,t,n){},117:function(e,t,n){},119:function(e,t,n){},121:function(e,t,n){},123:function(e,t,n){},125:function(e,t,n){},127:function(e,t,n){},129:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(68),r=n.n(o),c=n(23),s=n(33),l=(n(79),n(85),n(88),n(108),n(114),n(3)),u=n(4),h=n(7),d=n(5),f=n(6),p=n(1),v=(n(45),function(e){var t=e.items.map(function(e){return a.a.createElement("li",{key:e.text,onClick:e.onClick,className:"button"},e.text)});return a.a.createElement("div",{className:"menu"},a.a.createElement("ul",null,t))}),m="PLAYING",b="MAIN",g=[{fill:"#708090"},{fill:"#f5c635"},{fill:"#ee8817"},{fill:"#47b450"},{fill:"#ee575b"},{fill:"#9155f4"},{fill:"#009fd4"}],y=!1;try{var k={get passive(){return y=!0,!0}};window.addEventListener("test",k,k),window.removeEventListener("test",k,k)}catch(_e){y=!1}var w=y,E=function(e){var t=[{text:"ZEN MODE",onClick:function(){e.setGameMode("ZEN"),e.start()}},{text:"LINE TARGET MODE",onClick:function(){e.setGameMode("LINE TARGET"),e.start()}},{text:"CUSTOMIZE STYLE",onClick:function(){e.setMenu("STYLE")}},{text:"IMPORT / EXPORT SETTINGS",onClick:function(){e.setMenu("IMPORT_EXPORT")}}];return a.a.createElement(v,{items:t})},O=n(19),S=n(2),x=(n(117),n(119),function(e){var t="grid-block "+(e.flash?"grid-block-flash ":"")+(e.piece!==M?"piece-block ":"")+(!1===e.placeable?"cannot-place ":"");return a.a.createElement("rect",{x:e.x,y:e.y,width:e.blockSize,height:e.blockSize,style:e.blockStyles[e.piece],className:t})}),M=-1,j=[[[0,1,2,3],[2,2,2,2],[3,2,1,0],[1,1,1,1]],[[2,2,1,0],[2,1,1,1],[0,0,1,2],[0,1,1,1]],[[0,1,1,0],[1,1,0,0],[1,0,0,1],[0,0,1,1]],[[0,1,1,2],[2,2,1,1],[2,1,1,0],[0,0,1,1]],[[1,0,1,2],[2,1,1,1],[1,2,1,0],[0,1,1,1]],[[0,0,1,2],[2,1,1,1],[2,2,1,0],[0,1,1,1]],[[2,1,1,0],[2,2,1,1],[0,1,1,2],[0,0,1,1]]],P=[[[1,1,1,1],[0,1,2,3],[2,2,2,2],[3,2,1,0]],[[0,1,1,1],[2,2,1,0],[2,1,1,1],[0,0,1,2]],[[0,0,1,1],[0,1,1,0],[1,1,0,0],[1,0,0,1]],[[0,0,1,1],[0,1,1,2],[2,2,1,1],[2,1,1,0]],[[0,1,1,1],[1,0,1,2],[2,1,1,1],[1,2,1,0]],[[0,1,1,1],[0,0,1,2],[2,1,1,1],[2,2,1,0]],[[0,0,1,1],[2,1,1,0],[2,2,1,1],[0,1,1,2]]];j.length;function C(e,t,n,i,a){if(n!==M&&-1!==i&&-1!==e&&-1!==t){var o=T(e,t,n,i,a),r=!o&&T(e,t+1,n,i,a);return!o&&r}return!1}function T(e,t,n,i,a){for(var o=j[n][i],r=P[n][i],c=a.blocks[0].length,s=a.length,l=N(e,t,n,i),u=l.xOffset,h=l.yOffset,d=0;d<o.length;d++){var f=u+o[d],p=h+r[d];if(f<0)return!0;if(f>=c||p>=s)return!0;var v=a.blocks[p]||a.hiddenBlocks[-1*p-1];if(void 0===v)return!0;if(v[f]!==M)return!0}return!1}function N(e,t,n,i){var a=F(n,i);return{xOffset:e-D(n,i),yOffset:t-(A(n,i)+a-1)}}function D(e,t){for(var n=j[e][t],i=n[0],a=1;a<n.length;a++){var o=n[a];i=i<o?i:o}return i}function A(e,t){for(var n=P[e][t],i=n[0],a=1;a<n.length;a++){var o=n[a];i=i<o?i:o}return i}function F(e,t){for(var n=P[e][t],i=n[0],a=n[0],o=1;o<n.length;o++){var r=n[o];i=i<r?i:r,a=a>r?a:r}return a-i+1}var L=function(e){var t=e.piece,n=e.orientation,i=e.blockSize,o=e.placeable,r=e.cx,c=e.cy,s=e.x,l=e.y,u=e.blockStyles;if(t===M||-1===n)return null;var h,d,f=j[t][n],p=P[t][n],v=function(e,t){for(var n=j[e][t],i=n[0],a=n[0],o=1;o<n.length;o++){var r=n[o];i=i<r?i:r,a=a>r?a:r}return a-i+1}(t,n),m=F(t,n),b=D(t,n),g=A(t,n);return void 0!==r&&void 0!==c?(h=r-b*i-v*i/2,d=c-g*i-m*i/2):(h=s-b*i,d=l-(g+m-1)*i),f.map(function(e,n){var r=p[n];return a.a.createElement(x,{key:n,x:h+e*i,y:d+r*i,placeable:o,piece:t,blockStyles:u,blockSize:i})})},I=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).changeHandler=function(e){var t=e.target.name,i=e.target.value;n.setState({colors:Object(S.a)({},n.state.colors,Object(O.a)({},t,{fill:i}))})},n.save=function(){var e={blockStyles:Object.values(n.state.colors)};n.props.updateConfig(e),n.props.setMenu(b)},n.reset=function(){n.setState({colors:Object.assign({},g)})},n.cancel=function(){n.props.setMenu(b)},n.state={colors:Object.assign({},e.config.blockStyles)},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.config.blockStyles,n=[0,0,104,104],i=t.map(function(t,i){return a.a.createElement("li",{key:i,className:"color-config-item"},a.a.createElement("svg",{shapeRendering:"crispEdges",preserveAspectRatio:"xMidYMid slice",width:78,height:58.5,viewBox:n},a.a.createElement(L,{piece:i,orientation:0,blockSize:26,blockStyles:e.state.colors,cx:52,cy:52})),a.a.createElement("label",{className:"color-picker",style:{backgroundColor:e.state.colors[i].fill,width:"30px",height:"30px"},htmlFor:"cp-"+i},a.a.createElement("input",{className:"color-picker",type:"color",id:"cp-"+i,name:i,value:e.state.colors[i].fill,onChange:e.changeHandler})),a.a.createElement("input",{type:"text",id:"ct-"+i,name:i,value:e.state.colors[i].fill,onChange:e.changeHandler}))});return a.a.createElement("div",{className:"menu"},a.a.createElement("ul",{className:"color-config-items"},i),a.a.createElement("ul",null,a.a.createElement("li",{className:"button cancel",onClick:this.cancel},"CANCEL"),a.a.createElement("li",{className:"button reset",onClick:this.reset},"RESET TO DEFAULTS"),a.a.createElement("li",{className:"button save",onClick:this.save},"SAVE")))}}]),t}(i.Component);n(121);function R(e){var t=(e%1e3).toFixed(0);t=("000"+t).slice(-3);var n=Math.floor(e/1e3).toFixed(0),i=Math.floor(n/60),a="";return i>59&&(i=(i-=60*(a=Math.floor(i/60)))>=10?i:"0"+i),n=(n=Math.floor(n%60))>=10?n:"0"+n,""!==a?a+":"+i+":"+n+"."+t:i+":"+n+"."+t}function z(e){return e&&"object"===typeof e&&!Array.isArray(e)}var U={set:function(e,t){if(e){null!==t&&void 0!==t||window.localStorage.removeItem(e);var n,i=t.constructor.name;switch(i){case"Array":case"Object":n=JSON.stringify(t);break;case"String":n=t;break;case"Number":n=t.toString();break;default:throw new Error("Type ".concat(i," not supported"))}window.localStorage.setItem(e,"pd:".concat(i,":").concat(n))}},get:function(e){var t=localStorage.getItem(e);if(null!==t){var n=function(e,t,n){var i=e.split(t),a=i.splice(0,n-1);return a.push(i.join(t)),a}(t,":",3);if(n.length<3||"pd"!==n[0])return t;var i,a=n[1],o=n[2];switch(a){case"Array":case"Object":i=JSON.parse(o);break;case"String":i=o;break;case"Number":i=Number(o);break;default:throw new Error("Non-facade value '".concat(t,"' was stored")+"but was attempted to be retrieved through the facade.")}return i}}};function G(e,t){var n=Object.keys(e),i=Object.keys(t),a=new Set(n),o=new Set(i);if(a.size!==o.size)return!1;var r=!0,c=!1,s=void 0;try{for(var l,u=a[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var h=l.value;if(!o.has(h))return!1}}catch(_e){c=!0,s=_e}finally{try{r||null==u.return||u.return()}finally{if(c)throw s}}return!0}var W="config";function B(e,t){var n=function e(t,n){var i=Object.assign({},t);return z(t)&&z(n)&&Object.keys(n).forEach(function(a){z(n[a])&&a in t?i[a]=e(t[a],n[a]):Object.assign(i,Object(O.a)({},a,n[a]))}),i}(e.config,t.config);return _(n)?(U.set(W,n),Object(S.a)({},e,{config:n})):e}function _(e){if(!e)return!1;if(0!==e.version)return!1;if(!e.blockStyles)return!1;if(!G(e.blockStyles,g))return!1;for(var t=Object.keys(e.blockStyles),n=0;n<t.length;n++){var i=t[n];if(!G(e.blockStyles[i],g[i]))return!1}return!0}var H=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).validateInput=function(e){var t=!0;try{t=_(JSON.parse(e))}catch(n){t=!1}return t},n.changeHandler=function(e){var t=e.target.value,i=n.validateInput(t);n.setState({config:t,valid:i})},n.save=function(){if(n.state.valid){var e=JSON.parse(n.state.config);n.props.updateConfig(e),n.props.setMenu(b)}},n.back=function(){n.props.setMenu(b)},n.state={config:JSON.stringify(e.config),valid:!0},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"menu"},a.a.createElement("div",{id:"config-text-holder"},a.a.createElement("textarea",{id:"config-text",value:this.state.config,className:this.state.valid?"":"invalid-input",onChange:this.changeHandler})),a.a.createElement("ul",null,a.a.createElement("li",{className:"button cancel",onClick:this.back},"BACK"),a.a.createElement("li",{className:"button save",onClick:this.save},"SAVE")))}}]),t}(i.Component),Y="SET_ACTIVE_GRID_POSITION",J="CYCLE_PIECES",X="SELECT_ORIENTATION",Z="NEXT_PIECE",V="PLACE_BLOCK",K="CHECK_PLACEABILITY",$="UPDATE_STATS",q="RESET",Q="RESIZE",ee="SET_GAME_STATE",te="SET_GAME_MODE",ne="SET_MENU",ie="UPDATE_TIMER",ae="UPDATE_CONFIG",oe="LOAD_CONFIG",re=function(e){return{type:te,gameMode:e}},ce=Object(c.b)(function(e){return{config:e.config,menu:e.menu,gameMode:e.gameMode,lineTarget:e.lineTarget}},function(e){return{setMenu:function(t){e(function(e){return{type:ne,menu:e}}(t))},setGameMode:function(t){e(re(t))},updateConfig:function(t){e(function(e){return{type:ae,config:e}}(t))}}}),se=ce(E),le=ce(I),ue=ce(H),he=function(e){switch(e.menu){case"STYLE":return a.a.createElement(le,null);case"IMPORT_EXPORT":return a.a.createElement(ue,null);case b:default:return a.a.createElement(se,{start:e.start})}},de=(n(123),function(e){var t=e.gameMode,n=e.linesCleared,i=e.blockCount,o=[{text:"NEW GAME",onClick:e.reset},{text:"MAIN MENU",onClick:e.mainMenu}],r=[{name:"Total Pieces",value:i},{name:"Total Lines",value:n},{name:"Time",value:R(e.timerMillis)}].map(function(e){return a.a.createElement("div",{className:"row",key:e.name},a.a.createElement("span",{className:"name"},e.name,": "),a.a.createElement("span",{className:"value"},e.value))});return a.a.createElement("div",{className:"end-screen"},a.a.createElement("div",null,a.a.createElement("h1",{className:"mode-name"},t),a.a.createElement("h1",null,"FINISH")),a.a.createElement("div",{className:"statistics"},r),a.a.createElement("div",null,a.a.createElement(v,{items:o})))}),fe=(n(125),function(e){function t(){return Object(l.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){for(var e=this.props,t=e.x,n=e.y,i=e.width,o=e.height,r=e.blockSize,c=e.rows,s=e.cols,l=[],u=1;u<s;u++)l.push(a.a.createElement("line",{key:"cl".concat(u),x1:t+u*r,y1:n,x2:t+u*r,y2:n+o,className:"grid-line"}));for(var h=1;h<c;h++)l.push(a.a.createElement("line",{key:"rl".concat(h),x1:t,y1:n+h*r,x2:t+i,y2:n+h*r,className:"grid-line"}));return a.a.createElement("g",null,a.a.createElement("rect",{id:"field-background",style:{fill:"#232323"},x:t,y:n,width:i,height:o,pointerEvents:"none"}),l)}}]),t}(a.a.PureComponent)),pe=function(e){function t(){return Object(l.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,i=n.activePosition,a=n.blockCount;return i.row!==e.activePosition.row||i.col!==e.activePosition.col||a!==e.blockCount}},{key:"render",value:function(){for(var e=this.props,t=e.x,n=e.y,i=e.width,o=e.height,r=e.blockSize,c=e.rows,s=e.cols,l=e.blockStyles,u=e.activePosition,h=u.row,d=u.col,f=[],p=0;p<c;p++)for(var v=0;v<s;v++){var m=p*s+v,b=this.props.blocks[p][v],g=a.a.createElement(x,{id:m,key:m,x:t+v*r,y:n+p*r,blockSize:r,blockStyles:l,piece:b,flash:p===h&&v===d});f.push(g)}return a.a.createElement("g",{id:"field"},a.a.createElement(fe,{x:t,y:n,width:i,height:o,rows:c,cols:s,blockSize:r}),f,a.a.createElement("rect",{id:"field-border",style:{fill:"transparent",strokeWidth:1,stroke:"#FFFFFF"},x:t,y:n,width:i,height:o,pointerEvents:"none"}))}}]),t}(i.Component),ve=function(e){return a.a.createElement("text",{textAnchor:"end",x:e.x,y:e.y,style:{fontFamily:"Roboto",fontSize:30,fill:"#cfabec"}},e.linesCleared," / ",e.target)},me=function(e){var t=e.x,n=e.y,i=R(e.timerMillis);return a.a.createElement("text",{x:t,y:n,style:{fontSize:30,fill:"#cfabec"}},i)},be=(n(127),function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={pressed:!1},n.touchStart=n.touchStart.bind(Object(p.a)(Object(p.a)(n))),n.touchEnd=n.touchEnd.bind(Object(p.a)(Object(p.a)(n))),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"touchStart",value:function(e){e.stopPropagation(),this.setState({pressed:!0})}},{key:"touchMove",value:function(e){e.stopPropagation()}},{key:"touchEnd",value:function(e){e.stopPropagation(),this.setState({pressed:!1})}},{key:"render",value:function(){var e={fill:this.state.pressed&&this.props.pressedColor||this.props.color},t={pointerEvents:"none",userSelect:"none",fontFamily:"Roboto",fontSize:14,fill:this.props.textColor||"white"};return a.a.createElement("g",{onTouchStart:this.touchStart,onTouchMove:this.touchMove,onTouchEnd:this.touchEnd,onClick:this.props.onPressed},a.a.createElement("rect",{x:this.props.x,y:this.props.y,rx:6,ry:6,width:this.props.width,height:this.props.height,style:e,className:"button "+this.props.className,shapeRendering:"auto"}),a.a.createElement("text",{x:this.props.x+this.props.width/2,y:this.props.y+this.props.height/2,textAnchor:"middle",style:t,className:"button "+this.props.className,alignmentBaseline:"central",dominantBaseline:"central"},this.props.text))}}]),t}(i.Component)),ge={fill:"transparent",strokeWidth:1.5,stroke:"#FFFFFF"},ye={fill:"#FFFFFF3F",strokeWidth:1.5,stroke:"#FFFFFF"},ke=function(e){var t=e.x,n=e.y,i=e.width,o=e.height,r=e.piece,c=e.orientation,s=e.selected,l=e.blockStyles,u=(i-8)/4;return a.a.createElement("g",null,a.a.createElement("rect",{fill:"transparent",x:t,y:n,rx:6,ry:6,width:i,height:o,shapeRendering:"auto",style:s?ye:ge}),a.a.createElement(L,{piece:r,orientation:c,blockSize:u,blockStyles:l,cx:t+i/2,cy:n+o/2}))},we=function(e){var t=e.x,n=e.y,i=e.width,o=e.height,r=e.piece,c=e.blockStyles;if(void 0===r||r===M)return null;var s=(i-8)/4;return a.a.createElement(L,{piece:r,orientation:1,blockSize:s,blockStyles:c,cx:t+i/2,cy:n+o/2})},Ee=function(e){function t(){var e,n;Object(l.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).preventDefault=function(e){return e.preventDefault()},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("touchmove",this.preventDefault,!!w&&{passive:!1})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("touchmove",this.preventDefault)}},{key:"render",value:function(){var e,t=[window.innerWidth/-2,-680,window.innerWidth,680],n=this.props,i=n.config.blockStyles,o=n.previewSlots.map(function(e,t){return a.a.createElement(we,{key:"pp".concat(t),x:e.x,y:e.y,width:e.width,height:e.height,piece:n.nextPieces[t],blockStyles:i})}),r=n.orientationSelectors.map(function(e,t){return a.a.createElement(ke,{key:"ori".concat(t),x:e.x,y:e.y,width:e.width,height:e.height,orientation:e.orientation,piece:n.currentPiece,blockStyles:i,selected:n.orientation===e.orientation})}),c=n.fieldDimensions,s=c.x,l=c.y,u=c.width,h=c.height,d=c.rows,f=c.cols,p=c.blockSize;switch(n.gameMode){case"LINE TARGET":var v=s+85,m=l-10,b=s+140;e=a.a.createElement(a.a.Fragment,null,a.a.createElement(ve,{x:v,y:m,linesCleared:n.linesCleared,target:n.lineTarget}),a.a.createElement(me,{x:b,y:m,timerMillis:n.timerMillis}));break;default:e=null}var g=s+26*n.activePosition.col,y=l+26*n.activePosition.row,k=-1!==n.activePosition.row?a.a.createElement(L,{x:g,y:y,piece:n.currentPiece,orientation:n.orientation,placeable:n.placeable,blockStyles:i,blockSize:26}):null;return a.a.createElement("svg",{id:"game-canvas",preserveAspectRatio:"xMidYMax meet",shapeRendering:"crispEdges",textRendering:"optimizeLegibility",style:{touchAction:"none",width:n.windowWidth,height:n.windowHeight},onTouchStart:n.touchStart,onTouchMove:n.touchMove,onTouchEnd:n.touchEnd,onMouseDown:n.mouseDown,onMouseMove:n.mouseMove,onMouseUp:n.mouseUp,viewBox:t},a.a.createElement(pe,{activePosition:n.activePosition,x:s,y:l,width:u,height:h,blockSize:p,blockStyles:i,rows:d,cols:f,blocks:n.blocks,blockCount:n.blockCount}),k,r,o,e,a.a.createElement(be,{x:s+u+8,y:l+8,width:58,height:32,text:"RESET",color:"#ec3636",pressedColor:"#dc2626",onPressed:n.reset}),a.a.createElement(be,{x:s+u+8,y:l+8+32+8,width:58,height:32,text:"MENU",color:"#3e3e3e",pressedColor:"#292929",onPressed:n.mainMenu}))}}]),t}(i.Component),Oe=function(){function e(t){Object(l.a)(this,e),this.bag=[0,1,2,3,4,5,6],this.random=t,this.index=this.bag.length}return Object(u.a)(e,[{key:"next",value:function(){return this.index===this.bag.length&&(!function(e){for(var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random,a=e.length;a;)n=Math.floor(i()*a--),t=e[a],e[a]=e[n],e[n]=t}(this.bag,this.random),this.index=0),this.bag[this.index++]}}]),e}(),Se=[3,0,1,2],xe=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).initialiseLayout(),n.keydown=n.keydown.bind(Object(p.a)(Object(p.a)(n))),n.gameLoop=n.gameLoop.bind(Object(p.a)(Object(p.a)(n))),n.selectOrientation=n.selectOrientation.bind(Object(p.a)(Object(p.a)(n))),n.updateOrientation=n.updateOrientation.bind(Object(p.a)(Object(p.a)(n))),n.init=n.init.bind(Object(p.a)(Object(p.a)(n))),n.start=n.start.bind(Object(p.a)(Object(p.a)(n))),n.mainMenu=n.mainMenu.bind(Object(p.a)(Object(p.a)(n))),n.pause=n.pause.bind(Object(p.a)(Object(p.a)(n))),n.dragMove=n.dragMove.bind(Object(p.a)(Object(p.a)(n))),n.dragEnd=n.dragEnd.bind(Object(p.a)(Object(p.a)(n))),n.mouseDown=n.mouseDown.bind(Object(p.a)(Object(p.a)(n))),n.mouseMove=n.mouseMove.bind(Object(p.a)(Object(p.a)(n))),n.mouseUp=n.mouseUp.bind(Object(p.a)(Object(p.a)(n))),n.touchMove=n.touchMove.bind(Object(p.a)(Object(p.a)(n))),n.touchEnd=n.touchEnd.bind(Object(p.a)(Object(p.a)(n))),n.touchStart=n.touchMove,n.mouseDown=n.mouseDown.bind(Object(p.a)(Object(p.a)(n))),n.mouseMove=n.mouseMove.bind(Object(p.a)(Object(p.a)(n))),n.mouseUp=n.mouseUp.bind(Object(p.a)(Object(p.a)(n))),n.init(),e.loadConfig(),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"initialiseLayout",value:function(){this.fieldDimensions={x:-162.5,y:-620,blockSize:26,rows:20,cols:10,width:260,height:520};var e=(70*Se.length+16*(Se.length-1))/-2;this.orientationSelectors=Se.map(function(t,n){return{x:e+86*n,y:-84,width:70,height:70,orientation:t}});var t=this.fieldDimensions.x+260,n=this.fieldDimensions.y+520-65;this.previewSlots=Array(this.props.previewLength).fill(0).map(function(e,i){return{x:t+(0===i?0:5),y:n-55*i,width:65-(0===i?0:10),height:65-(0===i?0:10),index:i}})}},{key:"selectOrientation",value:function(e){this.orientation=e}},{key:"keydown",value:function(e){switch(e.keyCode){case 188:this.pieceDebug.next=!1,this.pieceDebug.prev=!0;break;case 190:this.pieceDebug.next=!0,this.pieceDebug.prev=!1}}},{key:"init",value:function(){this.pieceDebug={next:!1,prev:!1},this.nextPieces=[],this.randomizer=new Oe(Math.random),this.activeTouches=0,this.mouseIsDown=!1,this.activePosition={row:-1,col:-1},this.field={blocks:Array(20).fill(0).map(function(e){return Array(10).fill(M)}),hiddenBlocks:Array(3).fill(0).map(function(e){return Array(10).fill(M)}),lineClearFlags:Array(20).fill(!1),hiddenLineClearFlags:Array(3).fill(!1)},this.nextPieces.length=0,this.linesCleared=0,this.orientation=-1}},{key:"start",value:function(){this.init(),this.props.reset(),this.rollNextPiece(),this.lastPlayingTime=new Date,this.totalTimerMillis=0}},{key:"pause",value:function(){var e="PAUSED",t=new Date;if("PAUSED"===this.props.gameState)e=m,this.lastPlayingTime=t;else{var n=t-this.lastPlayingTime;this.lastPlayingTime=t,this.totalTimerMillis+=n}this.props.setGameState(e)}},{key:"mainMenu",value:function(){this.props.setGameState("MENU")}},{key:"canvasPoint",value:function(e){var t=document.getElementById("game-canvas"),n=t.createSVGPoint();n.x=e.clientX,n.y=e.clientY;var i=n.matrixTransform(t.getScreenCTM().inverse());return{x:i.x,y:i.y}}},{key:"fieldPoint",value:function(e){var t=e.x-this.fieldDimensions.x,n=e.y-this.fieldDimensions.y;return{col:Math.floor(t/26),row:Math.floor(n/26)}}},{key:"updateOrientation",value:function(e){for(var t=e.x,n=e.y,i=0;i<this.orientationSelectors.length;i++){var a=this.orientationSelectors[i];if(n>a.y&&n<a.y+a.height&&t>a.x&&t<a.x+a.width){this.selectOrientation(a.orientation);break}}}},{key:"dragMove",value:function(e){this.updateOrientation(e);var t=this.fieldPoint(e);t.col>-1&&t.col<10&&t.row>-1&&t.row<20&&(this.activePosition.row=t.row,this.activePosition.col=t.col)}},{key:"dragEnd",value:function(){0!==this.activeTouches||this.mouseIsDown||(this.place=!0)}},{key:"mouseDown",value:function(e){e.preventDefault(),this.mouseIsDown=!0;var t=this.canvasPoint(e);this.dragMove(t)}},{key:"mouseMove",value:function(e){if(e.preventDefault(),this.mouseIsDown){var t=this.canvasPoint(e);this.dragMove(t)}}},{key:"mouseUp",value:function(e){e.preventDefault(),this.mouseIsDown=!1,this.dragEnd()}},{key:"touchMove",value:function(e){e.preventDefault(),this.activeTouches=e.touches.length;for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t],i=this.canvasPoint(n);this.dragMove(i)}}},{key:"touchEnd",value:function(e){e.preventDefault(),this.activeTouches=e.touches.length,this.dragEnd()}},{key:"isLineFilled",value:function(e){for(var t=e.length,n=0;n<t;n++){if(e[n]===M)return!1}return!0}},{key:"setLineClearedFlag",value:function(e,t,n){e>=0?t.lineClearFlags[e]=n:t.hiddenLineClearFlags[-1*e-1]=n}},{key:"getLineClearedFlag",value:function(e,t){return t.lineClearFlags[e]||t.hiddenLineClearFlags[-1*e-1]}},{key:"getRow",value:function(e,t){return t.blocks[e]||t.hiddenBlocks[-1*e-1]}},{key:"downFloatingBlocks",value:function(e){for(var t=e.blocks.length,n=e.blocks[0].length,i=t-1,a=-3;a<t;a++)if(this.getLineClearedFlag(i,e)){for(var o=i;o>-3;o--){for(var r=this.getRow(o-1,e),c=this.getRow(o,e),s=0;s<n;s++){var l=void 0===r?M:r[s];c[s]=l}this.setLineClearedFlag(o,e,this.getLineClearedFlag(o-1,e))}for(var u=0;u<n;u++){e.hiddenBlocks[2][u]=M}}else i--}},{key:"doLineClears",value:function(e){for(var t=0,n=-1,i=e.blocks.length,a=-3;a<i;a++){var o=this.getRow(a,e);if(this.isLineFilled(o)){for(var r=o.length,c=0;c<r;c++)o[c]=M;t++,this.setLineClearedFlag(a,e,!0),-1===n&&(n=a)}}return t>0&&this.downFloatingBlocks(e),t}},{key:"rollNextPiece",value:function(){var e;e=0===this.nextPieces.length?this.randomizer.next():this.nextPieces[0];for(var t=this.nextPieces=this.nextPieces.slice(1);t.length<this.props.previewLength;)t.push(this.randomizer.next());this.props.nextPiece(e,t)}},{key:"checkGameOver",value:function(e,t){if(e===M)return!1;for(var n=0;n<t.blocks.length;n++)for(var i=t.blocks[n],a=0;a<i.length;a++)for(var o=0;o<Se.length;o++){if(C(a,n,e,Se[o],t))return!1}return!0}},{key:"gameLoop",value:function(){if(this.props.setActiveGridPosition(this.activePosition),this.props.checkPlaceability(this.activePosition.col,this.activePosition.row,this.props.currentPiece,this.orientation,this.field),this.props.gameState===m){var e=new Date,t=e-this.lastPlayingTime;if(this.lastPlayingTime=e,this.totalTimerMillis+=t,this.checkGameOver(this.props.currentPiece,this.field)&&this.props.setGameState("END"),this.place){var n=!1;if(this.props.placeable){!function(e,t,n,i,a){for(var o=j[n][i],r=P[n][i],c=N(e,t,n,i),s=c.xOffset,l=c.yOffset,u=0;u<o.length;u++){var h=s+o[u],d=l+r[u];(a.blocks[d]||a.hiddenBlocks[-1*d-1])[h]=n}}(this.activePosition.col,this.activePosition.row,this.props.currentPiece,this.orientation,this.field);var i=this.doLineClears(this.field);this.linesCleared+=i,this.props.updateStats(this.linesCleared),this.props.placeBlock(this.field),n=!0}switch(this.props.gameMode){case"ZEN":break;case"LINE TARGET":this.linesCleared>=this.props.lineTarget&&this.props.setGameState("END")}this.place=!1,n&&(this.activePosition.row=-1,this.activePosition.col=-1,this.orientation=-1,this.rollNextPiece())}this.props.selectOrientation(this.orientation),this.pieceDebug.prev=!1,this.pieceDebug.next=!1}this.props.updateTimer(this.totalTimerMillis)}},{key:"componentDidMount",value:function(){var e=this;window.onresize=function(){e.props.resize(window.innerWidth,window.innerHeight)},window.onresize(),document.addEventListener("keydown",this.keydown,!1),setInterval(this.gameLoop,33)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.keydown)}},{key:"render",value:function(){return"MENU"===this.props.gameState?a.a.createElement(he,{menu:this.props.menu,start:this.start}):"END"===this.props.gameState?a.a.createElement(de,{gameMode:this.props.gameMode,blockCount:this.props.blockCount,linesCleared:this.props.linesCleared,reset:this.start,mainMenu:this.mainMenu,timerMillis:this.props.timerMillis}):a.a.createElement(Ee,{gameState:this.props.gameState,activePosition:this.props.activePosition,orientationSelectors:this.orientationSelectors,previewSlots:this.previewSlots,nextPieces:this.props.nextPieces,fieldDimensions:this.fieldDimensions,currentPiece:this.props.currentPiece,orientation:this.props.orientation,placeable:this.props.placeable,blocks:this.props.field.blocks,config:this.props.config,linesCleared:this.props.linesCleared,blockCount:this.props.blockCount,lineTarget:this.props.lineTarget,timerMillis:this.props.timerMillis,gameMode:this.props.gameMode,reset:this.start,mainMenu:this.mainMenu,pause:this.pause,touchStart:this.touchStart,touchMove:this.touchMove,touchEnd:this.touchEnd,mouseDown:this.mouseDown,mouseMove:this.mouseMove,mouseUp:this.mouseUp,windowWidth:this.props.windowWidth,windowHeight:this.props.windowHeight})}}]),t}(i.Component),Me=Object(c.b)(function(e){return{menu:e.menu,config:e.config,gameState:e.gameState,gameMode:e.gameMode,activePosition:e.activePosition,currentPiece:e.currentPiece,nextPieces:e.nextPieces,previewLength:e.previewLength,orientation:e.orientation,field:e.field,blockCount:e.blockCount,placeable:e.placeable,linesCleared:e.linesCleared,lineTarget:e.lineTarget,windowWidth:e.windowWidth,windowHeight:e.windowHeight,timerMillis:e.timerMillis}},function(e){return{setActiveGridPosition:function(t){e({type:Y,activePosition:t})},cyclePieces:function(t){var n;e({type:J,next:(n=t).next,prev:n.prev})},selectOrientation:function(t){e({type:X,orientation:t})},nextPiece:function(t,n){e({type:Z,nextPiece:t,nextPieces:n})},placeBlock:function(t){e(function(e){return{type:V,field:e}}(t))},checkPlaceability:function(t,n,i,a,o){e(function(e,t,n,i,a){return{type:K,x:e,y:t,piece:n,orientation:i,field:a}}(t,n,i,a,o))},updateStats:function(t){e(function(e){return{type:$,linesCleared:e}}(t))},reset:function(){e({type:q})},resize:function(t,n){e(function(e,t){return{type:Q,newWidth:e,newHeight:t}}(t,n))},setGameState:function(t){e(function(e){return{type:ee,gameState:e}}(t))},setGameMode:function(t){e(re(t))},updateTimer:function(t){e(function(e){return{type:ie,timerMillis:e}}(t))},loadConfig:function(){e({type:oe})}}})(xe);var je=function(e,t){return e.activePosition.row===t.activePosition.row&&e.activePosition.col===t.activePosition.col?e:Object(S.a)({},e,{activePosition:Object(S.a)({},t.activePosition)})};var Pe=function(){};var Ce=function(e,t){return e.orientation===t.orientation?e:Object(S.a)({},e,{orientation:t.orientation})};var Te=function(e,t){return Object(S.a)({},e,{currentPiece:t.nextPiece,nextPieces:t.nextPieces})},Ne=n(48);var De=function(e,t){var n=t.field.blocks,i=function(e,t){for(var n=[],i=e.length,a=0;a<i;a++)for(var o=t[a],r=e[a],c=o.length,s=0;s<c;s++){var l=o[s];if(r[s]!==l){n.push(a);break}}return n}(e.field.blocks,n);if(0===i.length)return e;var a=Object(Ne.a)(e.field.blocks),o=!0,r=!1,c=void 0;try{for(var s,l=i[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value;a[u]=Object(Ne.a)(n[u])}}catch(_e){r=!0,c=_e}finally{try{o||null==l.return||l.return()}finally{if(r)throw c}}return Object(S.a)({},e,{field:Object(S.a)({},e.field,{blocks:a}),blockCount:e.blockCount+1})},Ae=function(e,t){var n=t.x,i=t.y,a=t.piece,o=t.orientation,r=t.field,c=e.placeable,s=C(n,i,a,o,r);return c===s?e:Object(S.a)({},e,{placeable:s})};var Fe=function(e,t){return e.linesCleared===t.linesCleared?e:Object(S.a)({},e,{linesCleared:t.linesCleared})},Le=function(e,t){return e.timerMillis===t.timerMillis?e:Object(S.a)({},e,{timerMillis:t.timerMillis})};var Ie=function(e,t){return Object(S.a)({},e,{windowWidth:t.newWidth,windowHeight:t.newHeight})},Re=function(e,t){var n=t.gameState;return"PAUSED"===t.gameState&&"PAUSED"===e.gameState&&(n=m),Object(S.a)({},e,{gameState:n})},ze=function(e,t){return Object(S.a)({},e,{gameMode:t.gameMode})},Ue=function(e,t){return Object(S.a)({},e,{menu:t.menu})},Ge={gameState:"MENU",activePosition:{row:-1,col:-1},currentPiece:M,previewLength:5,nextPieces:[],orientation:-1,placeable:!1,blockCount:0,linesCleared:0,lineTarget:40,timerMillis:0,field:{blocks:Array(20).fill(0).map(function(e){return Array(10).fill(M)})},config:{version:0,blockStyles:g}};var We=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Y:return je(e,t);case J:return Pe(e,t);case X:return Ce(e,t);case Z:return Te(e,t);case V:return De(e,t);case K:return Ae(e,t);case $:return Fe(e,t);case ie:return Le(e,t);case ae:return B(e,t);case oe:return function(e){var t=U.get(W);return t?Object(S.a)({},e,{config:t}):e}(e);case Q:return Ie(e,t);case ee:return Re(e,t);case te:return ze(e,t);case ne:return Ue(e,t);case q:return Object(S.a)({},Ge,{config:e.config,windowWidth:e.windowWidth,windowHeight:e.windowHeight,gameMode:e.gameMode,gameState:m});default:return e}};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Be=Object(s.b)(We);r.a.render(a.a.createElement(c.a,{store:Be},a.a.createElement(Me,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},45:function(e,t,n){},70:function(e,t,n){e.exports=n(129)}},[[70,2,1]]]);
//# sourceMappingURL=main.c031835c.chunk.js.map