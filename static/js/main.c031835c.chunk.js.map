{"version":3,"sources":["components/Menu/Menu.jsx","constants.js","components/Menu/MainMenu.jsx","components/Block.jsx","components/Piece.jsx","components/Menu/StyleConfiguration.jsx","util.js","reducers/config.js","components/Menu/ImportExportSettings.jsx","actions/index.js","containers/Menu.js","components/Menu/MenuScreen.jsx","components/EndScreen.jsx","components/FieldBackground.jsx","components/Field.jsx","components/LineCount.jsx","components/Timer.jsx","components/Button.jsx","components/OrientationSelector.jsx","components/PreviewPiece.jsx","components/Canvas.jsx","randomizers/BagRandomizer.js","App.js","containers/Game.js","reducers/setActiveGridPosition.js","reducers/cyclePieces.js","reducers/selectOrientation.js","reducers/nextPiece.js","reducers/placeBlock.js","reducers/checkPlaceability.js","reducers/updateStats.js","reducers/updateTimer.js","reducers/resize.js","reducers/setGameState.js","reducers/setGameMode.js","reducers/setMenu.js","reducers/index.js","serviceWorker.js","index.js"],"names":["Menu","props","menuItems","items","map","item","react_default","a","createElement","key","text","onClick","className","GAMESTATE_PLAYING","MENU_MAIN","defaultStyles","fill","testPassiveSupported","options","passive","window","addEventListener","removeEventListener","err","passiveSupported","MainMenu","setGameMode","start","setMenu","components_Menu_Menu","Block","classes","flash","piece","PIECE_NONE","placeable","x","y","width","blockSize","height","style","blockStyles","allPieceDataX","allPieceDataY","length","checkPlaceability","orientation","field","collides","checkCollision","supported","blocksX","blocksY","fieldWidth","blocks","fieldHeight","_getGridOffset2","getGridOffset","xOffset","yOffset","i","x2","y2","row","hiddenBlocks","undefined","getHeight","getMinX","getMinY","min","block","max","Piece","cx","cy","pieceDataX","pieceDataY","getWidth","minX","minY","src_components_Block","StyleConfiguration","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","changeHandler","event","name","target","value","setState","colors","objectSpread","state","defineProperty","save","config","values","updateConfig","reset","assign","cancel","_this2","viewBox","p","shapeRendering","preserveAspectRatio","components_Piece","backgroundColor","htmlFor","type","id","onChange","Component","millisecondsToTimestamp","totalMs","milliseconds","toFixed","slice","seconds","Math","floor","minutes","hours","isObject","Array","isArray","persistedData","set","localStorage","removeItem","stringValue","ctor","constructor","JSON","stringify","toString","Error","concat","setItem","get","getItem","parts","string","delimiter","maxSplits","arr","split","result","splice","push","join","splitMax","objectValue","ctorName","parse","Number","objectsHaveSameKeys","b","aKeys","keys","bKeys","aSet","Set","bSet","size","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","has","return","configKey","action","newConfig","mergeDeep","source","output","forEach","validateConfig","version","_i","ImportExportSettings","validateInput","valid","e","back","SET_ACTIVE_GRID_POSITION","CYCLE_PIECES","SELECT_ORIENTATION","NEXT_PIECE","PLACE_BLOCK","CHECK_PLACEABILITY","UPDATE_STATS","RESET","RESIZE","SET_GAME_STATE","SET_GAME_MODE","SET_MENU","UPDATE_TIMER","UPDATE_CONFIG","LOAD_CONFIG","newMode","gameMode","connectFn","connect","menu","lineTarget","dispatch","_MainMenu","_StyleConfiguration","_ImportExportSettings","MenuScreen","containers_Menu_StyleConfiguration","containers_Menu_ImportExportSettings","containers_Menu_MainMenu","EndScreen","linesCleared","blockCount","endScreenMenuItems","mainMenu","statistics","timerMillis","stat","FieldBackground","_this$props","rows","cols","gridlines","c","x1","y1","r","pointerEvents","React","PureComponent","Field","nextProps","nextState","activePosition","col","_this$props2","_this$props2$activePo","selectedRow","selectedCol","grid","currentBlock","gridBlock","src_components_FieldBackground","strokeWidth","stroke","LineCount","textAnchor","fontFamily","fontSize","Timer","timestamp","Button","pressed","touchStart","bind","assertThisInitialized","touchEnd","stopPropagation","pressedColor","color","textStyle","userSelect","textColor","onTouchStart","onTouchMove","touchMove","onTouchEnd","onPressed","rx","ry","alignmentBaseline","dominantBaseline","selectedStyle","OrientationSelector","selected","padding","PreviewPiece","Canvas","preventDefault","gameModeHud","innerWidth","bagDisplay","previewSlots","ps","components_PreviewPiece","nextPieces","orientationSelectors","os","components_OrientationSelector","currentPiece","_props$fieldDimension","fieldDimensions","fieldX","fieldY","fieldRows","fieldCols","lineCountPositionX","lineCountPositionY","timerPositionX","Fragment","components_LineCount","components_Timer","pieceX","pieceY","activePiece","textRendering","touchAction","windowWidth","windowHeight","onMouseDown","mouseDown","onMouseMove","mouseMove","onMouseUp","mouseUp","components_Field","src_components_Button","BagRandomizer","random","bag","index","array","t","arguments","m","shuffle","orientations","App","initialiseLayout","keydown","gameLoop","selectOrientation","updateOrientation","init","pause","dragMove","dragEnd","loadConfig","blockSizeInUnits","osXStart","psXStart","psYStart","previewLength","_","minorReduction","keyCode","pieceDebug","prev","randomizer","activeTouches","mouseIsDown","lineClearFlags","hiddenLineClearFlags","rollNextPiece","lastPlayingTime","Date","totalTimerMillis","newState","now","gameState","millisDiff","setGameState","svg","document","getElementById","point","createSVGPoint","clientX","clientY","_point$matrixTransfor","matrixTransform","getScreenCTM","inverse","canvasPoint","fcpx","fcpy","fp","fieldPoint","place","cp","touches","changedTouches","touch","line","lineLength","flag","hiddenHeight","getLineClearedFlag","k","rowUp","getRow","l","blk","setLineClearedFlag","firstLine","isLineFilled","rowLength","downFloatingBlocks","nextPiece","setActiveGridPosition","checkGameOver","placed","_getGridOffset","placeBlock","lines","doLineClears","updateStats","updateTimer","onresize","resize","innerHeight","setInterval","Menu_MenuScreen","src_components_EndScreen","components_Canvas","Game","param","cyclePieces","debug","np","nps","newWidth","newHeight","newGameState","exportFn","data","newField","changedRows","oldField","numRows","newRow","oldRow","numCols","newBlock","getChangedRows","toConsumableArray","reducers_checkPlaceability","oldPlaceable","newPlaceable","reducers_updateTimer","reducers_setGameState","reducers_setGameMode","reducers_setMenu","initialState","reducer","existingConfig","Boolean","location","hostname","match","store","createStore","ReactDOM","render","es","containers_Game","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"4XA0BeA,SAtBF,SAACC,GAAU,IAKhBC,EAFFD,EADFE,MAGsBC,IAAI,SAAAC,GAAI,OAC9BC,EAAAC,EAAAC,cAAA,MAAIC,IAAKJ,EAAKK,KACVC,QAASN,EAAKM,QACdC,UAAU,UACTP,EAAKK,QAIZ,OACEJ,EAAAC,EAAAC,cAAA,OAAKI,UAAU,QACbN,EAAAC,EAAAC,cAAA,UACGN,MCnBIW,EAAoB,UAOpBC,EAAY,OAUZC,EAAgB,CAC3B,CAAEC,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,WACR,CAAEA,KAAM,YAINC,GAAuB,EAE3B,IACE,IAAIC,EAAU,CACZC,cAKE,OAHAF,GAAuB,GAGhB,IAIXG,OAAOC,iBAAiB,OAAQH,EAASA,GACzCE,OAAOE,oBAAoB,OAAQJ,EAASA,GAC5C,MAAMK,IACNN,GAAuB,EAGlB,IAAMO,EAAmBP,ECCjBQ,EAtCE,SAACxB,GAChB,IAAMC,EAAY,CAChB,CACEQ,KAAM,WACNC,QAAS,WACPV,EAAMyB,YDXc,OCYpBzB,EAAM0B,UAGV,CACEjB,KAAM,mBACNC,QAAS,WACPV,EAAMyB,YDjBsB,eCqB5BzB,EAAM0B,UAGV,CACEjB,KAAM,kBACNC,QAAS,WACPV,EAAM2B,QDxBqB,WC2B/B,CACElB,KAAM,2BACNC,QAAS,WACPV,EAAM2B,QD7BoB,oBCkChC,OACEtB,EAAAC,EAAAC,cAACqB,EAAD,CAAM1B,MAAOD,oBCpBF4B,iBAnBD,SAAC7B,GACb,IAAM8B,EAAW,eACd9B,EAAM+B,MAAQ,oBAAsB,KACpC/B,EAAMgC,QAAUC,EAAa,eAAiB,MAC1B,IAApBjC,EAAMkC,UAAsB,gBAAkB,IAGjD,OACE7B,EAAAC,EAAAC,cAAA,QACE4B,EAAGnC,EAAMmC,EACTC,EAAGpC,EAAMoC,EACTC,MAAOrC,EAAMsC,UACbC,OAAQvC,EAAMsC,UACdE,MAAOxC,EAAMyC,YAAYzC,EAAMgC,OAC/BrB,UAAWmB,MChBJG,GAAc,EAerBS,EAAgB,CACpB,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,KAGlCC,EAAgB,CACpB,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,IACtC,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,KAGbD,EAAcE,OAiBlC,SAASC,EAAkBV,EAAGC,EAAGJ,EAAOc,EAAaC,GAC1D,GAAIf,IAAUC,IACO,IAAjBa,IACO,IAAPX,IACO,IAAPC,EACF,CAYA,IAAMY,EAAWC,EAAed,EAAGC,EAAGJ,EAAOc,EAAaC,GACpDG,GAAaF,GAAYC,EAAed,EAAGC,EAAI,EAAGJ,EAAOc,EAAaC,GAC5E,OAAQC,GAAYE,EAGtB,OAAO,EAGF,SAASD,EAAed,EAAGC,EAAGJ,EAAOc,EAAaC,GASvD,IARA,IAAMI,EAAUT,EAAcV,GAAOc,GAC/BM,EAAUT,EAAcX,GAAOc,GAE/BO,EAAaN,EAAMO,OAAO,GAAGV,OAC7BW,EAAcR,EAAMH,OALoCY,EAOjCC,EAActB,EAAGC,EAAGJ,EAAOc,GAAhDY,EAPsDF,EAOtDE,QAASC,EAP6CH,EAO7CG,QAERC,EAAI,EAAGA,EAAIT,EAAQP,OAAQgB,IAAK,CACvC,IAAMC,EAAKH,EAAUP,EAAQS,GACvBE,EAAKH,EAAUP,EAAQQ,GAG7B,GAAIC,EAAK,EACP,OAAO,EAIT,GAAIA,GAAMR,GAAcS,GAAMP,EAC5B,OAAO,EAGT,IAAMQ,EAAMhB,EAAMO,OAAOQ,IAAOf,EAAMiB,cAAmB,EAANF,EAAU,GAG7D,QAAYG,IAARF,EACF,OAAO,EAIT,GAAIA,EAAIF,KAAQ5B,EACd,OAAO,EAIX,OAAO,EAKT,SAASwB,EAActB,EAAGC,EAAGJ,EAAOc,GAClC,IAAMP,EAAS2B,EAAUlC,EAAOc,GAQhC,MAAO,CAAEY,QAHOvB,EAHHgC,EAAQnC,EAAOc,GAMVa,QAFFvB,GAHHgC,EAAQpC,EAAOc,GAGAP,EAAS,IAMvC,SAAS4B,EAAQnC,EAAOc,GAKtB,IAJA,IAAMQ,EAASZ,EAAcV,GAAOc,GAEhCuB,EAAMf,EAAO,GAERM,EAAI,EAAGA,EAAIN,EAAOV,OAAQgB,IAAK,CACtC,IAAMU,EAAQhB,EAAOM,GACrBS,EAAMA,EAAMC,EAAQD,EAAMC,EAG5B,OAAOD,EAGT,SAASD,EAAQpC,EAAOc,GAKtB,IAJA,IAAMQ,EAASX,EAAcX,GAAOc,GAEhCuB,EAAMf,EAAO,GAERM,EAAI,EAAGA,EAAIN,EAAOV,OAAQgB,IAAK,CACtC,IAAMU,EAAQhB,EAAOM,GACrBS,EAAMA,EAAMC,EAAQD,EAAMC,EAG5B,OAAOD,EAkBT,SAASH,EAAWlC,EAAOc,GAMzB,IALA,IAAMQ,EAASX,EAAcX,GAAOc,GAEhCuB,EAAMf,EAAO,GACbiB,EAAMjB,EAAO,GAERM,EAAI,EAAGA,EAAIN,EAAOV,OAAQgB,IAAK,CACtC,IAAMU,EAAQhB,EAAOM,GACrBS,EAAMA,EAAMC,EAAQD,EAAMC,EAC1BC,EAAMA,EAAMD,EAAQC,EAAMD,EAG5B,OAAQC,EAAMF,EAAO,EAGvB,IA8CeG,EA9CD,SAACxE,GAAU,IAErBgC,EAGEhC,EAHFgC,MAAOc,EAGL9C,EAHK8C,YAAaR,EAGlBtC,EAHkBsC,UAAWJ,EAG7BlC,EAH6BkC,UAC/BuC,EAEEzE,EAFFyE,GAAIC,EAEF1E,EAFE0E,GAAIvC,EAENnC,EAFMmC,EAAGC,EAETpC,EAFSoC,EACXK,EACEzC,EADFyC,YAGF,GAAIT,IAAUC,IAzLiB,IAyLHa,EAC1B,OAAO,KAET,IASIY,EACAC,EAVEgB,EAAajC,EAAcV,GAAOc,GAClC8B,EAAajC,EAAcX,GAAOc,GAElCT,EA3CR,SAAmBL,EAAOc,GAMxB,IALA,IAAMQ,EAASZ,EAAcV,GAAOc,GAEhCuB,EAAMf,EAAO,GACbiB,EAAMjB,EAAO,GAERM,EAAI,EAAGA,EAAIN,EAAOV,OAAQgB,IAAK,CACtC,IAAMU,EAAQhB,EAAOM,GACrBS,EAAMA,EAAMC,EAAQD,EAAMC,EAC1BC,EAAMA,EAAMD,EAAQC,EAAMD,EAG5B,OAAQC,EAAMF,EAAO,EA+BPQ,CAAS7C,EAAOc,GACxBP,EAAS2B,EAAUlC,EAAOc,GAE1BgC,EAAOX,EAAQnC,EAAOc,GACtBiC,EAAOX,EAAQpC,EAAOc,GAY5B,YARWmB,IAAPQ,QAA2BR,IAAPS,GACtBhB,EAAWe,EAAKK,EAAOxC,EAAaD,EAASC,EAAY,EACzDqB,EAAWe,EAAKK,EAAOzC,EAAaC,EAASD,EAAY,IAEzDoB,EAAUvB,EAAI2C,EAAOxC,EACrBqB,EAAUvB,GAAK2C,EAAOxC,EAAS,GAAKD,GAIpCqC,EAAWxE,IAAI,SAACgC,EAAGyB,GACjB,IAAMxB,EAAIwC,EAAWhB,GACrB,OACEvD,EAAAC,EAAAC,cAACyE,EAAD,CACExE,IAAKoD,EACLzB,EAAGuB,EAAUvB,EAAIG,EACjBF,EAAGuB,EAAUvB,EAAIE,EACjBJ,UAAWA,EACXF,MAAOA,EACPS,YAAaA,EACbH,UAAWA,OC5GN2C,cA7Gb,SAAAA,EAAYjF,GAAO,IAAAkF,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAJ,IACjBC,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAF,GAAAO,KAAAH,KAAMrF,KAMRyF,cAAgB,SAAAC,GACd,IAAMC,EAAOD,EAAME,OAAOD,KACpBE,EAAQH,EAAME,OAAOC,MAE3BX,EAAKY,SAAS,CACZC,OAAOZ,OAAAa,EAAA,EAAAb,CAAA,GACFD,EAAKe,MAAMF,OADVZ,OAAAe,EAAA,EAAAf,CAAA,GAEHQ,EAAO,CACN5E,KAAM8E,QAfKX,EAqBnBiB,KAAO,WACL,IAAMC,EAAS,CACb3D,YAAa0C,OAAOkB,OAAOnB,EAAKe,MAAMF,SAGxCb,EAAKlF,MAAMsG,aAAaF,GACxBlB,EAAKlF,MAAM2B,QAAQd,IA3BFqE,EA8BnBqB,MAAQ,WACNrB,EAAKY,SAAS,CACZC,OAAQZ,OAAOqB,OAAO,GAAI1F,MAhCXoE,EAoCnBuB,OAAS,WACPvB,EAAKlF,MAAM2B,QAAQd,IAnCnBqE,EAAKe,MAAQ,CACXF,OAAQZ,OAAOqB,OAAO,GAAIxG,EAAMoG,OAAO3D,cAHxByC,wEAwCV,IAAAwB,EAAArB,KACW5C,EAAkB4C,KAAKrF,MAAjCoG,OAAU3D,YAGZkE,EAAU,CAAC,EAAG,EAAGrE,IAAeA,KAChCpC,EAAQuC,EAAYtC,IAAI,SAACyG,EAAGhD,GAAJ,OAC5BvD,EAAAC,EAAAC,cAAA,MAAIC,IAAKoD,EAAGjD,UAAU,qBACpBN,EAAAC,EAAAC,cAAA,OACEsG,eAAe,aACfC,oBAAoB,iBACpBzE,MAAOC,GACPC,OAAQD,KACRqE,QAASA,GAETtG,EAAAC,EAAAC,cAACwG,EAAD,CACE/E,MAAO4B,EACPd,YDxDqB,ECyDrBR,UJ3DoB,GI4DpBG,YAAaiE,EAAKT,MAAMF,OACxBtB,GAAInC,GACJoC,GAAIpC,MAGRjC,EAAAC,EAAAC,cAAA,SACEI,UAAU,eACV6B,MAAO,CACLwE,gBAAiBN,EAAKT,MAAMF,OAAOnC,GAAG7C,KACtCsB,MAAO,OACPE,OAAQ,QAEV0E,QAAS,MAAQrD,GACjBvD,EAAAC,EAAAC,cAAA,SACEI,UAAU,eACVuG,KAAK,QACLC,GAAI,MAAQvD,EACZ+B,KAAM/B,EACNiC,MAAOa,EAAKT,MAAMF,OAAOnC,GAAG7C,KAC5BqG,SAAUV,EAAKjB,iBAEnBpF,EAAAC,EAAAC,cAAA,SACE2G,KAAK,OACLC,GAAI,MAAQvD,EACZ+B,KAAM/B,EACNiC,MAAOa,EAAKT,MAAMF,OAAOnC,GAAG7C,KAC5BqG,SAAUV,EAAKjB,mBAIrB,OACEpF,EAAAC,EAAAC,cAAA,OAAKI,UAAU,QACbN,EAAAC,EAAAC,cAAA,MAAII,UAAU,sBACXT,GAEHG,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,MAAII,UAAU,gBAAgBD,QAAS2E,KAAKoB,QAA5C,UAGApG,EAAAC,EAAAC,cAAA,MAAII,UAAU,eAAeD,QAAS2E,KAAKkB,OAA3C,qBAGAlG,EAAAC,EAAAC,cAAA,MAAII,UAAU,cAAcD,QAAS2E,KAAKc,MAA1C,iBArGuBkB,oBCM1B,SAASC,EAAwBC,GACtC,IAAIC,GAAgBD,EAAU,KAAME,QAAQ,GAC5CD,GAAgB,MAAQA,GAAcE,OAAO,GAE7C,IAAIC,EAAUC,KAAKC,MAAMN,EAAU,KAAME,QAAQ,GAC7CK,EAAUF,KAAKC,MAAMF,EAAU,IAC/BI,EAAQ,GASZ,OARID,EAAU,KAGZA,GADAA,GAA6B,IAD7BC,EAAQH,KAAKC,MAAMC,EAAU,OAEP,GAAMA,EAAU,IAAMA,GAI9CH,GADAA,EAAUC,KAAKC,MAAMF,EAAU,MACT,GAAMA,EAAU,IAAMA,EAC9B,KAAVI,EACKA,EAAQ,IAAMD,EAAU,IAAMH,EAAU,IAAMH,EAGhDM,EAAU,IAAMH,EAAU,IAAMH,EAIzC,SAASQ,EAAS5H,GAChB,OAAQA,GAAwB,kBAATA,IAAsB6H,MAAMC,QAAQ9H,GAkCtD,IAAM+H,EAAgB,CAC3BC,IAAK,SAAS5H,EAAKqF,GACjB,GAAKrF,EAAL,CAEc,OAAVqF,QAA4B5B,IAAV4B,GACpB1E,OAAOkH,aAAaC,WAAW9H,GAGjC,IACI+H,EADEC,EAAO3C,EAAM4C,YAAY9C,KAM/B,OAAQ6C,GACN,IAAK,QACL,IAAK,SAAUD,EAAcG,KAAKC,UAAU9C,GAAQ,MACpD,IAAK,SAAU0C,EAAc1C,EAAO,MACpC,IAAK,SAAU0C,EAAc1C,EAAM+C,WAAY,MAC/C,QAAS,MAAM,IAAIC,MAAJ,QAAAC,OAAkBN,EAAlB,mBAGjBrH,OAAOkH,aAAaU,QAAQvI,EAA5B,MAAAsI,OAAuCN,EAAvC,KAAAM,OAA+CP,MAGjDS,IAAK,SAASxI,GACZ,IAAIqF,EAAQwC,aAAaY,QAAQzI,GAIjC,GAAc,OAAVqF,EAAJ,CAEA,IACMqD,EAhDV,SAAkBC,EAAQC,EAAWC,GACnC,IAAIC,EAAMH,EAAOI,MAAMH,GACnBI,EAASF,EAAIG,OAAO,EAAGJ,EAAY,GAIvC,OAFAG,EAAOE,KAAKJ,EAAIK,KAAKP,IAEdI,EA0CSI,CAAS/D,EAAO,IADb,GAEjB,GAAIqD,EAAMtG,OAFO,GAE2B,OAAbsG,EAAM,GAEnC,OAAOrD,EAOT,IAEIgE,EAFEC,EAAWZ,EAAM,GACjBX,EAAcW,EAAM,GAE1B,OAAQY,GACN,IAAK,QACL,IAAK,SAAUD,EAAcnB,KAAKqB,MAAMxB,GAAc,MACtD,IAAK,SAAUsB,EAActB,EAAa,MAC1C,IAAK,SAAUsB,EAAcG,OAAOzB,GAAc,MAClD,QAAS,MAAM,IAAIM,MACjB,qBAAAC,OAAqBjD,EAArB,yEAKJ,OAAOgE,KAIJ,SAASI,EAAoB3J,EAAG4J,GACrC,IAAMC,EAAQhF,OAAOiF,KAAK9J,GACpB+J,EAAQlF,OAAOiF,KAAKF,GACpBI,EAAO,IAAIC,IAAIJ,GACfK,EAAO,IAAID,IAAIF,GAErB,GAAIC,EAAKG,OAASD,EAAKC,KAAM,OAAO,EANI,IAAAC,GAAA,EAAAC,GAAA,EAAAC,OAAA3G,EAAA,IAQxC,QAAA4G,EAAAC,EAAiBR,EAAjBS,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAuB,KAAdtK,EAAcyK,EAAAhF,MACrB,IAAK2E,EAAKW,IAAI/K,GAAO,OAAO,GATU,MAAAkB,IAAAqJ,GAAA,EAAAC,EAAAtJ,GAAA,YAAAoJ,GAAA,MAAAI,EAAAM,QAAAN,EAAAM,SAAA,WAAAT,EAAA,MAAAC,GAYxC,OAAO,EC5IT,IAAMS,EAAY,SAcX,SAAS/E,EAAcL,EAAOqF,GACnC,IAAMC,EDoBD,SAASC,EAAU5F,EAAQ6F,GAChC,IAAIC,EAASvG,OAAOqB,OAAO,GAAIZ,GAa/B,OAZIoC,EAASpC,IAAWoC,EAASyD,IAC/BtG,OAAOiF,KAAKqB,GAAQE,QAAQ,SAAAnL,GACtBwH,EAASyD,EAAOjL,KACZA,KAAOoF,EAGX8F,EAAOlL,GAAOgL,EAAU5F,EAAOpF,GAAMiL,EAAOjL,IAE9C2E,OAAOqB,OAAOkF,EAAdvG,OAAAe,EAAA,EAAAf,CAAA,GAAyB3E,EAAMiL,EAAOjL,OAIrCkL,EClCWF,CAAUvF,EAAMG,OAAQkF,EAAOlF,QAEjD,OAAKwF,EAAeL,IAIpBpD,EAAcC,IAAIiD,EAAWE,GAEtBpG,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEEG,OAAQmF,KAPDtF,EAWJ,SAAS2F,EAAexF,GAC7B,IAAKA,EACH,OAAO,EAGT,GAAuB,IAAnBA,EAAOyF,QAMT,OAAO,EAGT,IAAKzF,EAAO3D,YACV,OAAO,EAGT,IAAKwH,EAAoB7D,EAAO3D,YAAa3B,GAC3C,OAAO,EAIT,IADA,IAAMsJ,EAAOjF,OAAOiF,KAAKhE,EAAO3D,aAChCqJ,EAAA,EAAAA,EAAgB1B,EAAhBxH,OAAAkJ,IAAsB,CAAjB,IAAItL,EAAO4J,EAAJ0B,GAIV,IAAK7B,EAHY7D,EAAO3D,YAAYjC,GACfM,EAAcN,IAGjC,OAAO,EAIX,OAAO,MCOMuL,cAlEb,SAAAA,EAAY/L,GAAO,IAAAkF,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAA0G,IACjB7G,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA4G,GAAAvG,KAAAH,KAAMrF,KAORgM,cAAgB,SAACnG,GACf,IACIoG,GAAQ,EAEZ,IAEEA,EAAQL,EADClD,KAAKqB,MAAMlE,IAEpB,MAAOqG,GACPD,GAAQ,EAGV,OAAOA,GAnBU/G,EAsBnBO,cAAgB,SAAAC,GACd,IAAMG,EAAQH,EAAME,OAAOC,MACrBoG,EAAQ/G,EAAK8G,cAAcnG,GACjCX,EAAKY,SAAS,CAACM,OAAQP,EAAOoG,MAAOA,KAzBpB/G,EA4BnBiB,KAAO,WACL,GAAKjB,EAAKe,MAAMgG,MAAhB,CAIA,IAAM7F,EAASsC,KAAKqB,MAAM7E,EAAKe,MAAMG,QAErClB,EAAKlF,MAAMsG,aAAaF,GACxBlB,EAAKlF,MAAM2B,QAAQd,KApCFqE,EAuCnBiH,KAAO,WACLjH,EAAKlF,MAAM2B,QAAQd,IAtCnBqE,EAAKe,MAAQ,CACXG,OAAQsC,KAAKC,UAAU3I,EAAMoG,QAC7B6F,OAAO,GAJQ/G,wEA4CjB,OACE7E,EAAAC,EAAAC,cAAA,OAAKI,UAAU,QACbN,EAAAC,EAAAC,cAAA,OAAK4G,GAAG,sBACN9G,EAAAC,EAAAC,cAAA,YACE4G,GAAG,cACHtB,MAAOR,KAAKY,MAAMG,OAClBzF,UAAW0E,KAAKY,MAAMgG,MAAQ,GAAK,gBACnC7E,SAAU/B,KAAKI,iBAEnBpF,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,MAAII,UAAU,gBAAgBD,QAAS2E,KAAK8G,MAA5C,QAGA9L,EAAAC,EAAAC,cAAA,MAAII,UAAU,cAAcD,QAAS2E,KAAKc,MAA1C,iBA1DyBkB,aCXtB+E,EAA2B,2BAC3BC,EAAe,eACfC,EAAqB,qBACrBC,EAAa,aACbC,EAAc,cACdC,EAAqB,qBACrBC,EAAe,eACfC,EAAQ,QACRC,EAAS,SACTC,GAAiB,iBACjBC,GAAgB,gBAChBC,GAAW,WACXC,GAAe,eACfC,GAAgB,gBAChBC,GAAc,cA0DdzL,GAAc,SAAC0L,GAAD,MAAc,CACvCjG,KAAM4F,GACNM,SAAUD,IC3CNE,GAAYC,YAnBM,SAAArH,GAAK,MAAK,CAChCG,OAAQH,EAAMG,OACdmH,KAAMtH,EAAMsH,KACZH,SAAUnH,EAAMmH,SAChBI,WAAYvH,EAAMuH,aAGO,SAAAC,GAAQ,MAAK,CACtC9L,QAAS,SAAC4L,GACRE,EDwDmB,SAACF,GAAD,MAAW,CAChCrG,KAAM6F,GACNQ,KAAMA,GC1DK5L,CAAQ4L,KAEnB9L,YAAa,SAAC0L,GACZM,EAAShM,GAAY0L,KAEvB7G,aAAc,SAACF,GACbqH,ED4DwB,SAACrH,GAAD,MAAa,CACvCc,KAAM+F,GACN7G,OAAQA,GC9DGE,CAAaF,QASb5E,GAAW6L,GAAUK,GACrBzI,GAAqBoI,GAAUM,GAC/B5B,GAAuBsB,GAAUO,GCd/BC,GAVI,SAAC7N,GAClB,OAAQA,EAAMuN,MACZ,IVP+B,QUOL,OAAQlN,EAAAC,EAAAC,cAACuN,GAAD,MAClC,IVP8B,gBUOL,OAAQzN,EAAAC,EAAAC,cAACwN,GAAD,MAEjC,KAAKlN,EACL,QAAS,OAAQR,EAAAC,EAAAC,cAACyN,GAAD,CAAUtM,MAAO1B,EAAM0B,UC6C7BuM,WA1DG,SAACjO,GAAU,IAEzBoN,EAMEpN,EANFoN,SACAc,EAKElO,EALFkO,aACAC,EAIEnO,EAJFmO,WAMIC,EAAqB,CACzB,CACE3N,KAAM,WACNC,QALAV,EAHFuG,OAUA,CACE9F,KAAM,YACNC,QATAV,EAFFqO,WAeIC,EAAa,CACjB,CACE3I,KAAM,eACNE,MAAOsI,GAET,CACExI,KAAM,cACNE,MAAOqI,GAET,CACEvI,KAAM,OACNE,MAAOyB,EAxBPtH,EADFuO,eA2BApO,IAAI,SAAAqO,GAAI,OACNnO,EAAAC,EAAAC,cAAA,OAAKI,UAAU,MAAMH,IAAKgO,EAAK7I,MAC7BtF,EAAAC,EAAAC,cAAA,QAAMI,UAAU,QAAQ6N,EAAK7I,KAA7B,MACAtF,EAAAC,EAAAC,cAAA,QAAMI,UAAU,SAAS6N,EAAK3I,UAKpC,OACExF,EAAAC,EAAAC,cAAA,OAAKI,UAAU,cACbN,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,MAAII,UAAU,aAAayM,GAC3B/M,EAAAC,EAAAC,cAAA,qBAEFF,EAAAC,EAAAC,cAAA,OAAKI,UAAU,cACZ2N,GAEHjO,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAACqB,EAAD,CAAM1B,MAAOkO,QCRNK,4LAnCX,IAVA,IADOC,EAQHrJ,KAAKrF,MAJPmC,EAJKuM,EAILvM,EAAGC,EAJEsM,EAIFtM,EACHC,EALKqM,EAKLrM,MAAOE,EALFmM,EAKEnM,OACPD,EANKoM,EAMLpM,UACAqM,EAPKD,EAOLC,KAAMC,EAPDF,EAOCE,KAGJC,EAAY,GACPC,EAAI,EAAGA,EAAIF,EAAME,IACxBD,EAAUnF,KAAKrJ,EAAAC,EAAAC,cAAA,QACbC,IAAG,KAAAsI,OAAOgG,GACVC,GAAI5M,EAAI2M,EAAIxM,EAAW0M,GAAI5M,EAC3ByB,GAAI1B,EAAI2M,EAAIxM,EAAWwB,GAAI1B,EAAIG,EAC/B5B,UAAU,eAId,IAAK,IAAIsO,EAAI,EAAGA,EAAIN,EAAMM,IACxBJ,EAAUnF,KAAKrJ,EAAAC,EAAAC,cAAA,QACbC,IAAG,KAAAsI,OAAOmG,GACVF,GAAI5M,EAAW6M,GAAI5M,EAAI6M,EAAI3M,EAC3BuB,GAAI1B,EAAIE,EAAOyB,GAAI1B,EAAI6M,EAAI3M,EAC3B3B,UAAU,eAId,OACEN,EAAAC,EAAAC,cAAA,SACEF,EAAAC,EAAAC,cAAA,QACE4G,GAAG,mBACH3E,MAhCkB,CAAEzB,KAAM,WAiC1BoB,EAAGA,EACHC,EAAGA,EACHC,MAAOA,EACPE,OAAQA,EACR2M,cAAc,SAEfL,UAzCqBM,IAAMC,gBC6ErBC,iMA1ESC,EAAWC,GAAW,IAAAb,EACHrJ,KAAKrF,MAApCwP,EADkCd,EAClCc,eAAgBrB,EADkBO,EAClBP,WAExB,OAAOqB,EAAezL,MAAQuL,EAAUE,eAAezL,KAChDyL,EAAeC,MAAQH,EAAUE,eAAeC,KAChDtB,IAAemB,EAAUnB,4CAwBhC,IApBA,IADOuB,EAiBHrK,KAAKrF,MATPmC,EARKuN,EAQLvN,EAAGC,EAREsN,EAQFtN,EACHC,EATKqN,EASLrN,MAAOE,EATFmN,EASEnN,OACPD,EAVKoN,EAULpN,UACAqM,EAXKe,EAWLf,KAAMC,EAXDc,EAWCd,KACNnM,EAZKiN,EAYLjN,YAZKkN,EAAAD,EAaLF,eACOI,EAdFD,EAcH5L,IACK8L,EAfFF,EAeHF,IAKAK,EAAO,GACFb,EAAI,EAAGA,EAAIN,EAAMM,IACxB,IAAK,IAAIH,EAAI,EAAGA,EAAIF,EAAME,IAAK,CAC7B,IAAM3H,EAAK8H,EAAIL,EAAOE,EAChBiB,EAAe1K,KAAKrF,MAAMsD,OAAO2L,GAAGH,GACpCkB,EACJ3P,EAAAC,EAAAC,cAACyE,EAAD,CACEmC,GAAIA,EACJ3G,IAAK2G,EACLhF,EAAGA,EAAI2M,EAAIxM,EACXF,EAAGA,EAAI6M,EAAI3M,EACXA,UAAWA,EACXG,YAAaA,EACbT,MAAO+N,EACPhO,MAAOkN,IAAMW,GAAed,IAAMe,IAEtCC,EAAKpG,KAAKsG,GAId,OACE3P,EAAAC,EAAAC,cAAA,KAAG4G,GAAG,SACJ9G,EAAAC,EAAAC,cAAC0P,GAAD,CACE9N,EAAGA,EACHC,EAAGA,EACHC,MAAOA,EACPE,OAAQA,EACRoM,KAAMA,EACNC,KAAMA,EACNtM,UAAWA,IAEZwN,EACDzP,EAAAC,EAAAC,cAAA,QACE4G,GAAG,eACH3E,MArDc,CAClBzB,KAAM,cACNmP,YAAY,EACZC,OAAQ,WAmDJhO,EAAGA,EACHC,EAAGA,EACHC,MAAOA,EACPE,OAAQA,EACR2M,cAAc,iBArEJ7H,aCYL+I,GAfG,SAACpQ,GAQjB,OACEK,EAAAC,EAAAC,cAAA,QAAM8P,WAAW,MAAMlO,EAAGnC,EAAMmC,EAAGC,EAAGpC,EAAMoC,EAAGI,MAPnC,CACZ8N,WAAY,SACZC,SAAU,GACVxP,KAAM,YAKHf,EAAMkO,aADT,MAC0BlO,EAAM4F,SCerB4K,GAvBD,SAACxQ,GAAU,IAErBmC,EAEEnC,EAFFmC,EAAGC,EAEDpC,EAFCoC,EASCqO,EAAYnJ,EAPdtH,EADFuO,aAUF,OACElO,EAAAC,EAAAC,cAAA,QACE4B,EAAGA,EACHC,EAAGA,EACHI,MAXU,CACZ+N,SAAU,GACVxP,KAAM,YAUL0P,ICkDUC,uBAnEb,SAAAA,EAAY1Q,GAAO,IAAAkF,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAqL,IACjBxL,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAuL,GAAAlL,KAAAH,KAAMrF,KACDiG,MAAQ,CAAE0K,SAAS,GACxBzL,EAAK0L,WAAa1L,EAAK0L,WAAWC,KAAhB1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KAClBA,EAAK6L,SAAW7L,EAAK6L,SAASF,KAAd1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KAJCA,0EAORQ,GACTA,EAAMsL,kBACN3L,KAAKS,SAAS,CAAC6K,SAAS,sCAGhBjL,GACRA,EAAMsL,mDAGCtL,GACPA,EAAMsL,kBACN3L,KAAKS,SAAS,CAAC6K,SAAS,qCAIxB,IAAMnO,EAAQ,CACZzB,KAAOsE,KAAKY,MAAM0K,SACTtL,KAAKrF,MAAMiR,cACZ5L,KAAKrF,MAAMkR,OAGfC,EAAY,CAChBjC,cAAe,OACfkC,WAAY,OACZd,WAAY,SAEZC,SAAU,GACVxP,KAAOsE,KAAKrF,MAAMqR,WAAa,SAGjC,OACEhR,EAAAC,EAAAC,cAAA,KAAG+Q,aAAcjM,KAAKuL,WACnBW,YAAalM,KAAKmM,UAClBC,WAAYpM,KAAK0L,SACjBrQ,QAAS2E,KAAKrF,MAAM0R,WACrBrR,EAAAC,EAAAC,cAAA,QACE4B,EAAGkD,KAAKrF,MAAMmC,EACdC,EAAGiD,KAAKrF,MAAMoC,EACduP,GAAI,EACJC,GAAI,EACJvP,MAAOgD,KAAKrF,MAAMqC,MAClBE,OAAQ8C,KAAKrF,MAAMuC,OACnBC,MAAOA,EACP7B,UAAW,UAAY0E,KAAKrF,MAAMW,UAClCkG,eAAe,SAEjBxG,EAAAC,EAAAC,cAAA,QACE4B,EAAGkD,KAAKrF,MAAMmC,EAAIkD,KAAKrF,MAAMqC,MAAQ,EACrCD,EAAGiD,KAAKrF,MAAMoC,EAAIiD,KAAKrF,MAAMuC,OAAS,EACtC8N,WAAW,SACX7N,MAAO2O,EACPxQ,UAAW,UAAY0E,KAAKrF,MAAMW,UAClCkR,kBAAkB,UAClBC,iBAAiB,WACjBzM,KAAKrF,MAAMS,cA9DA4G,cCAf7E,GAAQ,CACZzB,KAAM,cACNmP,YAAa,IACbC,OAAQ,WAGJ4B,GAAgB,CACpBhR,KAAM,YACNmP,YAAa,IACbC,OAAQ,WAkCK6B,GA/Ba,SAAChS,GAAU,IAC7BmC,EAAmEnC,EAAnEmC,EAAGC,EAAgEpC,EAAhEoC,EAAGC,EAA6DrC,EAA7DqC,MAAOE,EAAsDvC,EAAtDuC,OAAQP,EAA8ChC,EAA9CgC,MAAOc,EAAuC9C,EAAvC8C,YAAamP,EAA0BjS,EAA1BiS,SAAUxP,EAAgBzC,EAAhByC,YAIrDH,GAAaD,EAAQ6P,GAAe,EAE1C,OACE7R,EAAAC,EAAAC,cAAA,SACEF,EAAAC,EAAAC,cAAA,QACEQ,KAAK,cACLoB,EAAGA,EACHC,EAAGA,EACHuP,GATe,EAUfC,GAVe,EAWfvP,MAAOA,EACPE,OAAQA,EACRsE,eAAe,OACfrE,MAAOyP,EAAWF,GAAgBvP,KACpCnC,EAAAC,EAAAC,cAACwG,EAAD,CACE/E,MAAOA,EACPc,YAAaA,EACbR,UAAWA,EACXG,YAAaA,EACbgC,GAAItC,EAAIE,EAAQ,EAChBqC,GAAItC,EAAIG,EAAS,MCfV4P,GAtBM,SAACnS,GAAU,IACtBmC,EAA4CnC,EAA5CmC,EAAGC,EAAyCpC,EAAzCoC,EAAGC,EAAsCrC,EAAtCqC,MAAOE,EAA+BvC,EAA/BuC,OAAQP,EAAuBhC,EAAvBgC,MAAOS,EAAgBzC,EAAhByC,YACpC,QAAcwB,IAAVjC,GAAuBA,IAAUC,EACnC,OAAO,KAGT,IAEMK,GAAaD,EAAQ6P,GAAe,EAE1C,OACE7R,EAAAC,EAAAC,cAACwG,EAAD,CACE/E,MAAOA,EACPc,YfF2B,EeG3BR,UAAWA,EACXG,YAAaA,EACbgC,GAAItC,EAAIE,EAAQ,EAChBqC,GAAItC,EAAIG,EAAS,KCoJR6P,8MAxJbC,eAAiB,SAACnG,GAAD,OAAOA,EAAEmG,qGAKxBlR,OAAOC,iBAAiB,YAAaiE,KAAKgN,iBACxC9Q,GAAmB,CAAEL,SAAS,mDAKhCC,OAAOE,oBAAoB,YAAagE,KAAKgN,iDAI/C,IAuCIC,EAtCE3L,EAAU,CAACxF,OAAOoR,YAAc,GADnB,IACmCpR,OAAOoR,WAD1C,KAEbvS,EAAQqF,KAAKrF,MAIfyC,EAEAzC,EAHFoG,OACE3D,YAIE+P,EAAaxS,EAAMyS,aAAatS,IAAI,SAACuS,EAAI9O,GAAL,OACxCvD,EAAAC,EAAAC,cAACoS,GAAD,CACEnS,IAAG,KAAAsI,OAAOlF,GACVzB,EAAGuQ,EAAGvQ,EAAGC,EAAGsQ,EAAGtQ,EACfC,MAAOqQ,EAAGrQ,MAAOE,OAAQmQ,EAAGnQ,OAC5BP,MAAOhC,EAAM4S,WAAWhP,GACxBnB,YAAaA,MAIXoQ,EAAuB7S,EAAM6S,qBAAqB1S,IAAI,SAAC2S,EAAIlP,GAAL,OAC1DvD,EAAAC,EAAAC,cAACwS,GAAD,CACEvS,IAAG,MAAAsI,OAAQlF,GACXzB,EAAG2Q,EAAG3Q,EAAGC,EAAG0Q,EAAG1Q,EACfC,MAAOyQ,EAAGzQ,MAAOE,OAAQuQ,EAAGvQ,OAC5BO,YAAagQ,EAAGhQ,YAChBd,MAAOhC,EAAMgT,aACbvQ,YAAaA,EACbwP,SAAUjS,EAAM8C,cAAgBgQ,EAAGhQ,gBA7B9BmQ,EAsCLjT,EAAMkT,gBAJLC,EAlCIF,EAkCP9Q,EAAciR,EAlCPH,EAkCI7Q,EACJiB,EAnCA4P,EAmCP5Q,MAA2BkB,EAnCpB0P,EAmCY1Q,OACb8Q,EApCCJ,EAoCPtE,KAAuB2E,EApChBL,EAoCUrE,KACjBtM,EArCO2Q,EAqCP3Q,UAIF,OAAQtC,EAAMoN,UACZ,InBnEgC,cmBqE9B,IAAMmG,EAAqBJ,EAAS,GAC9BK,EAAqBJ,EAAS,GAC9BK,EAAiBN,EAAS,IAChCb,EAAcjS,EAAAC,EAAAC,cAACF,EAAAC,EAAMoT,SAAP,KACZrT,EAAAC,EAAAC,cAACoT,GAAD,CACExR,EAAGoR,EACHnR,EAAGoR,EACHtF,aAAclO,EAAMkO,aACpBtI,OAAQ5F,EAAMwN,aAEhBnN,EAAAC,EAAAC,cAACqT,GAAD,CACEzR,EAAGsR,EACHrR,EAAGoR,EACHjF,YAAavO,EAAMuO,eAGvB,MACF,QAAS+D,EAAc,KAGzB,IAAMuB,EAASV,EnBnFe,GmBmFNnT,EAAMwP,eAAeC,IACvCqE,EAASV,EnBpFe,GmBoFNpT,EAAMwP,eAAezL,IAEvCgQ,GAA6C,IAA9B/T,EAAMwP,eAAezL,IACtC1D,EAAAC,EAAAC,cAACwG,EAAD,CACE5E,EAAG0R,EACHzR,EAAG0R,EACH9R,MAAOhC,EAAMgT,aACblQ,YAAa9C,EAAM8C,YACnBZ,UAAWlC,EAAMkC,UACjBO,YAAaA,EACbH,UnB9FwB,KmB+F1B,KAEJ,OACEjC,EAAAC,EAAAC,cAAA,OACE4G,GAAG,cACHL,oBAAoB,gBACpBD,eAAe,aACfmN,cAAc,qBACdxR,MAAQ,CACNyR,YAAa,OACb5R,MAAOrC,EAAMkU,YACb3R,OAAQvC,EAAMmU,cAEhB7C,aAActR,EAAM4Q,WACpBW,YAAavR,EAAMwR,UACnBC,WAAYzR,EAAM+Q,SAClBqD,YAAapU,EAAMqU,UACnBC,YAAatU,EAAMuU,UACnBC,UAAWxU,EAAMyU,QACjB9N,QAASA,GAETtG,EAAAC,EAAAC,cAACmU,GAAD,CACElF,eAAgBxP,EAAMwP,eACtBrN,EAAGgR,EACH/Q,EAAGgR,EACH/Q,MAAOgB,EACPd,OAAQgB,EACRjB,UAAWA,EACXG,YAAaA,EACbkM,KAAM0E,EACNzE,KAAM0E,EACNhQ,OAAQtD,EAAMsD,OACd6K,WAAYnO,EAAMmO,aACnB4F,EACAlB,EACAL,EACAF,EACDjS,EAAAC,EAAAC,cAACoU,GAAD,CAEExS,EAAGgR,EAAS9P,EAAa,EAAGjB,EAAGgR,EAAS,EACxC/Q,MAAO,GACPE,OAAQ,GACR9B,KAAK,QACLyQ,MAAM,UACND,aAAa,UACbS,UAAW1R,EAAMuG,QAEnBlG,EAAAC,EAAAC,cAACoU,GAAD,CAEExS,EAAGgR,EAAS9P,EAAa,EAAGjB,EAAGgR,EAAS,EAAI,GAAK,EACjD/Q,MAAO,GACPE,OAAQ,GACR9B,KAAK,OACLyQ,MAAM,UACND,aAAa,UACbS,UAAW1R,EAAMqO,mBAlJJhH,aCINuN,cAjBb,SAAAA,EAAYC,GAAS1P,OAAAC,EAAA,EAAAD,CAAAE,KAAAuP,GAEnBvP,KAAKyP,IAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAC9BzP,KAAKwP,OAASA,EACdxP,KAAK0P,MAAQ1P,KAAKyP,IAAIlS,0DAStB,OALGyC,KAAK0P,QAAU1P,KAAKyP,IAAIlS,UfVxB,SAAiBoS,GAItB,IAJmD,IAC7BC,EAAGrR,EADIiR,EAAsBK,UAAAtS,OAAA,QAAAqB,IAAAiR,UAAA,GAAAA,UAAA,GAAbtN,KAAKiN,OACvCM,EAAIH,EAAMpS,OAGPuS,GAELvR,EAAIgE,KAAKC,MAAMgN,IAAWM,KAG1BF,EAAID,EAAMG,GACVH,EAAMG,GAAKH,EAAMpR,GACjBoR,EAAMpR,GAAKqR,EeATG,CAAQ/P,KAAKyP,IAAKzP,KAAKwP,QACvBxP,KAAK0P,MAAQ,GAGR1P,KAAKyP,IAAIzP,KAAK0P,kBCOnBM,GAAe,ClBNY,EAHA,EACA,EACA,GkBskBlBC,eAvjBb,SAAAA,EAAYtV,GAAO,IAAAkF,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAiQ,IACjBpQ,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAmQ,GAAA9P,KAAAH,KAAMrF,KAEDuV,mBAELrQ,EAAKsQ,QAAUtQ,EAAKsQ,QAAQ3E,KAAb1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACfA,EAAKuQ,SAAWvQ,EAAKuQ,SAAS5E,KAAd1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KAChBA,EAAKwQ,kBAAoBxQ,EAAKwQ,kBAAkB7E,KAAvB1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACzBA,EAAKyQ,kBAAoBzQ,EAAKyQ,kBAAkB9E,KAAvB1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACzBA,EAAK0Q,KAAO1Q,EAAK0Q,KAAK/E,KAAV1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACZA,EAAKxD,MAAQwD,EAAKxD,MAAMmP,KAAX1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACbA,EAAKmJ,SAAWnJ,EAAKmJ,SAASwC,KAAd1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KAChBA,EAAK2Q,MAAQ3Q,EAAK2Q,MAAMhF,KAAX1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACbA,EAAK4Q,SAAW5Q,EAAK4Q,SAASjF,KAAd1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KAChBA,EAAK6Q,QAAU7Q,EAAK6Q,QAAQlF,KAAb1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACfA,EAAKmP,UAAYnP,EAAKmP,UAAUxD,KAAf1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACjBA,EAAKqP,UAAYrP,EAAKqP,UAAU1D,KAAf1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACjBA,EAAKuP,QAAYvP,EAAKuP,QAAQ5D,KAAb1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACjBA,EAAKsM,UAAYtM,EAAKsM,UAAUX,KAAf1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACjBA,EAAK6L,SAAW7L,EAAK6L,SAASF,KAAd1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KAGhBA,EAAK0L,WAAa1L,EAAKsM,UAEvBtM,EAAKmP,UAAYnP,EAAKmP,UAAUxD,KAAf1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACjBA,EAAKqP,UAAYrP,EAAKqP,UAAU1D,KAAf1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KACjBA,EAAKuP,QAAYvP,EAAKuP,QAAQ5D,KAAb1L,OAAA2L,EAAA,EAAA3L,QAAA2L,EAAA,EAAA3L,CAAAD,KAEjBA,EAAK0Q,OACL5V,EAAMgW,aA7BW9Q,kFA0CjBG,KAAK6N,gBAAkB,CAErB/Q,GAAGkB,MACHjB,GAAG,IACHE,UrBjE0B,GqBkE1BqM,KrB/D6B,GqBgE7BC,KrBjE4B,GqBkE5BvM,MAVkB4T,IAWlB1T,OAVkB0T,KAgBpB,IAKMC,GAJS,GAGcb,GAAazS,OAJzB,IAI8CyS,GAAazS,OAAS,KACrD,EAEhCyC,KAAKwN,qBAAuBwC,GAAalV,IAAI,SAAC2C,EAAac,GAAd,MAAqB,CAChEzB,EAAG+T,EAAW,GAAoBtS,EAClCxB,GAPe,GAQfC,MATa,GAUbE,OAVa,GAWbO,YAAaA,KASf,IAEMqT,EAAW9Q,KAAK6N,gBAAgB/Q,EAxClB8T,IAyCdG,EAAW/Q,KAAK6N,gBAAgB9Q,EAxClB6T,IAPA,GAgDpB5Q,KAAKoN,aAAexK,MAAM5C,KAAKrF,MAAMqW,eAAetV,KAAK,GAAGZ,IAAI,SAACmW,EAAG1S,GAClE,MAAO,CACLzB,EAAGgU,GAAkB,IAANvS,EAAU,EAAI2S,GAC7BnU,EAAGgU,EAAW,GAA+BxS,EAC7CvB,MApDgB,IAoDY,IAANuB,EAAU,EARb,IASnBrB,OArDgB,IAqDa,IAANqB,EAAU,EATd,IAUnBmR,MAAOnR,+CAQKd,GAChBuC,KAAKvC,YAAcA,kCAGb4C,GAEN,OAAQA,EAAM8Q,SAEZ,KAAK,IACHnR,KAAKoR,WAAWxL,MAAO,EACvB5F,KAAKoR,WAAWC,MAAO,EACzB,MAEA,KAAK,IACHrR,KAAKoR,WAAWxL,MAAO,EACvB5F,KAAKoR,WAAWC,MAAO,kCAQ3BrR,KAAKoR,WAAa,CAChBxL,MAAO,EACPyL,MAAO,GAGTrR,KAAKuN,WAAa,GAGlBvN,KAAKsR,WAAa,IAAI/B,GAAchN,KAAKiN,QACzCxP,KAAKuR,cAAgB,EACrBvR,KAAKwR,aAAc,EACnBxR,KAAKmK,eAAiB,CACpBzL,KAAO,EACP0L,KAAO,GAGTpK,KAAKtC,MAAQ,CACXO,OACE2E,MrBxJ2B,IqBwJAlH,KAAK,GAAGZ,IAAI,SAAA8O,GAAC,OACtChH,MrB1JwB,IqB0JElH,KAAKkB,KACnC+B,aACEiE,MrB1JoB,GqB0JAlH,KAAK,GAAGZ,IAAI,SAAA8O,GAAC,OAC/BhH,MrB7JwB,IqB6JElH,KAAKkB,KACnC6U,eAAgB7O,MrB7Ja,IqB6JclH,MAAK,GAChDgW,qBAAsB9O,MrB7JA,GqB6JoBlH,MAAK,IAGjDsE,KAAKuN,WAAWhQ,OAAS,EAIzByC,KAAK6I,aAAe,EACpB7I,KAAKvC,alBxKwB,kCkB4K7BuC,KAAKuQ,OACLvQ,KAAKrF,MAAMuG,QACXlB,KAAK2R,gBAGL3R,KAAK4R,gBAAkB,IAAIC,KAC3B7R,KAAK8R,iBAAmB,kCAIxB,IAAIC,ErBjMwB,SqBkMtBC,EAAM,IAAIH,KAEhB,GrBpM4B,WqBoMxB7R,KAAKrF,MAAMsX,UACbF,EAAWxW,EACXyE,KAAK4R,gBAAkBI,MAClB,CACL,IAAME,EAAaF,EAAMhS,KAAK4R,gBAC9B5R,KAAK4R,gBAAkBI,EACvBhS,KAAK8R,kBAAoBI,EAG3BlS,KAAKrF,MAAMwX,aAAaJ,sCAIxB/R,KAAKrF,MAAMwX,arBnNe,4CqByNhB9R,GACV,IAAM+R,EAAMC,SAASC,eAAe,eAC9BC,EAAQH,EAAII,iBAClBD,EAAMzV,EAAIuD,EAAMoS,QAChBF,EAAMxV,EAAIsD,EAAMqS,QAJC,IAAAC,EAKAJ,EAAMK,gBAAgBR,EAAIS,eAAeC,WAC1D,MAAO,CAAChW,EANS6V,EAKT7V,EACGC,EANM4V,EAKN5V,sCAIFgW,GACT,IAAMC,EAAOD,EAAYjW,EAAIkD,KAAK6N,gBAAgB/Q,EAC5CmW,EAAOF,EAAYhW,EAAIiD,KAAK6N,gBAAgB9Q,EAKlD,MAAO,CAACqN,IAHI7H,KAAKC,MAAMwQ,ErB1NK,IqB6NftU,IAFD6D,KAAKC,MAAMyQ,ErB3NK,+CqBgOZF,GAGhB,IAH6B,IACrBjW,EAASiW,EAATjW,EAAGC,EAAMgW,EAANhW,EAEFwB,EAAI,EAAGA,EAAIyB,KAAKwN,qBAAqBjQ,OAAQgB,IAAK,CACzD,IAAMkP,EAAKzN,KAAKwN,qBAAqBjP,GACrC,GAAIxB,EAAI0Q,EAAG1Q,GAAKA,EAAI0Q,EAAG1Q,EAAI0Q,EAAGvQ,QAC1BJ,EAAI2Q,EAAG3Q,GAAKA,EAAI2Q,EAAG3Q,EAAI2Q,EAAGzQ,MAAO,CACnCgD,KAAKqQ,kBAAkB5C,EAAGhQ,aAC1B,yCAKGsV,GACP/S,KAAKsQ,kBAAkByC,GAEvB,IAAMG,EAAKlT,KAAKmT,WAAWJ,GACvBG,EAAG9I,KAAO,GAAK8I,EAAG9I,IrB/OQ,IqBgP1B8I,EAAGxU,KAAO,GAAKwU,EAAGxU,IrB/OS,KqBiP7BsB,KAAKmK,eAAezL,IAAMwU,EAAGxU,IAC7BsB,KAAKmK,eAAeC,IAAM8I,EAAG9I,uCAKJ,IAAvBpK,KAAKuR,eAAwBvR,KAAKwR,cACpCxR,KAAKoT,OAAQ,qCAIP/S,GACRA,EAAM2M,iBACNhN,KAAKwR,aAAc,EAEnB,IAAM6B,EAAKrT,KAAK+S,YAAY1S,GAC5BL,KAAKyQ,SAAS4C,qCAGNhT,GAER,GADAA,EAAM2M,iBACFhN,KAAKwR,YAAa,CACpB,IAAM6B,EAAKrT,KAAK+S,YAAY1S,GAC5BL,KAAKyQ,SAAS4C,oCAIVhT,GACNA,EAAM2M,iBACNhN,KAAKwR,aAAc,EACnBxR,KAAK0Q,4CAGGrQ,GACRA,EAAM2M,iBACNhN,KAAKuR,cAAgBlR,EAAMiT,QAAQ/V,OAKnC,IAAK,IAAIgB,EAAI,EAAGA,EAAI8B,EAAMkT,eAAehW,OAAQgB,IAAK,CACpD,IAAMiV,EAAQnT,EAAMkT,eAAehV,GAC7B8U,EAAKrT,KAAK+S,YAAYS,GAC5BxT,KAAKyQ,SAAS4C,qCAIThT,GACPA,EAAM2M,iBACNhN,KAAKuR,cAAgBlR,EAAMiT,QAAQ/V,OACnCyC,KAAK0Q,+CAGM+C,GAEX,IADA,IAAMC,EAAaD,EAAKlW,OACf6M,EAAM,EAAGA,EAAMsJ,EAAYtJ,IAAO,CAEzC,GADcqJ,EAAKrJ,KACLxN,EACZ,OAAO,EAIX,OAAO,6CAGU8B,EAAKhB,EAAOiW,GACzBjV,GAAO,EACThB,EAAM+T,eAAe/S,GAAOiV,EAE5BjW,EAAMgU,sBAA6B,EAAPhT,EAAY,GAAKiV,6CAI9BjV,EAAKhB,GACtB,OAAOA,EAAM+T,eAAe/S,IAAQhB,EAAMgU,sBAA6B,EAAPhT,EAAY,kCAGvEA,EAAKhB,GACV,OAAOA,EAAMO,OAAOS,IAAQhB,EAAMiB,cAAqB,EAAPD,EAAY,8CAI3ChB,GAKjB,IAJA,IAAMQ,EAAcR,EAAMO,OAAOV,OAC3BS,EAAaN,EAAMO,OAAO,GAAGV,OAE/BR,EAAImB,EAAc,EACbK,GAAIqV,EAAmBrV,EAAIL,EAAaK,IAC/C,GAAIyB,KAAK6T,mBAAmB9W,EAAGW,GAAQ,CACrC,IAAK,IAAIoW,EAAI/W,EAAG+W,GAAIF,EAAmBE,IAAK,CAG1C,IAFA,IAAMC,EAAQ/T,KAAKgU,OAAOF,EAAE,EAAGpW,GACzBgB,EAAQsB,KAAKgU,OAAOF,EAAGpW,GACpBuW,EAAI,EAAGA,EAAIjW,EAAYiW,IAAK,CACnC,IAAMC,OAAgBtV,IAAVmV,EAAsBnX,EAAamX,EAAME,GACrDvV,EAAIuV,GAAKC,EAGXlU,KAAKmU,mBAAmBL,EAAGpW,EAAOsC,KAAK6T,mBAAmBC,EAAE,EAAGpW,IAIjE,IAAK,IAAIuW,EAAI,EAAGA,EAAIjW,EAAYiW,IAAK,CACpBvW,EAAMiB,aAAaiV,GAC3BK,GAAKrX,QAGdG,yCAKOW,GAKX,IAJA,IAAImL,EAAe,EACfuL,GAAa,EACXlW,EAAcR,EAAMO,OAAOV,OAEzBqM,GAAIgK,EAAmBhK,EAAI1L,EAAa0L,IAAK,CACnD,IAAMlL,EAAMsB,KAAKgU,OAAOpK,EAAGlM,GAG3B,GAFesC,KAAKqU,aAAa3V,GAErB,CAEV,IADA,IAAM4V,EAAY5V,EAAInB,OACbkM,EAAI,EAAGA,EAAI6K,EAAW7K,IAC7B/K,EAAI+K,GAAK7M,EAEXiM,IACA7I,KAAKmU,mBAAmBvK,EAAGlM,GAAO,IAEf,IAAf0W,IACFA,EAAYxK,IAWlB,OAJIf,EAAe,GACjB7I,KAAKuU,mBAAmB7W,GAGnBmL,0CAIP,IAAI2L,EAEFA,EAD6B,IAA3BxU,KAAKuN,WAAWhQ,OACNyC,KAAKsR,WAAW1L,OAEhB5F,KAAKuN,WAAW,GAI9B,IADA,IAAMA,EAAavN,KAAKuN,WAAavN,KAAKuN,WAAWlL,MAAM,GACpDkL,EAAWhQ,OAASyC,KAAKrF,MAAMqW,eACpCzD,EAAWlJ,KAAKrE,KAAKsR,WAAW1L,QAGlC5F,KAAKrF,MAAM6Z,UAAUA,EAAWjH,yCAGpB5Q,EAAOe,GACnB,GAAIf,IAAUC,EACZ,OAAO,EAMT,IAAK,IAAIgN,EAAI,EAAGA,EAAIlM,EAAMO,OAAOV,OAAQqM,IAEvC,IADA,IAAIlL,EAAMhB,EAAMO,OAAO2L,GACdH,EAAI,EAAGA,EAAI/K,EAAInB,OAAQkM,IAC9B,QAAAhD,EAAA,EAAAA,EAAcuJ,GAAdzS,OAAAkJ,IAA4B,CAC1B,GAAIjJ,EAAkBiM,EAAGG,EAAGjN,EADhBqT,GAAJvJ,GAC8B/I,GACpC,OAAO,EAMf,OAAO,qCAgBP,GAZAsC,KAAKrF,MAAM8Z,sBAAsBzU,KAAKmK,gBAMtCnK,KAAKrF,MAAM6C,kBACTwC,KAAKmK,eAAeC,IAAKpK,KAAKmK,eAAezL,IAC7CsB,KAAKrF,MAAMgT,aAAc3N,KAAKvC,YAC9BuC,KAAKtC,OAGHsC,KAAKrF,MAAMsX,YAAc1W,EAAmB,CAC9C,IAAMyW,EAAM,IAAIH,KACVK,EAAaF,EAAMhS,KAAK4R,gBAY9B,GAXA5R,KAAK4R,gBAAkBI,EACvBhS,KAAK8R,kBAAoBI,EAKRlS,KAAK0U,cAAc1U,KAAKrF,MAAMgT,aAAc3N,KAAKtC,QAEhEsC,KAAKrF,MAAMwX,arB1cU,OqB6cnBnS,KAAKoT,MAAO,CACd,IAAIuB,GAAS,EACb,GAAI3U,KAAKrF,MAAMkC,UAAW,ElBza3B,SAAoBC,EAAGC,EAAGJ,EAAOc,EAAaC,GAMnD,IALA,IAAMI,EAAUT,EAAcV,GAAOc,GAC/BM,EAAUT,EAAcX,GAAOc,GAFqBmX,EAI7BxW,EAActB,EAAGC,EAAGJ,EAAOc,GAAhDY,EAJkDuW,EAIlDvW,QAASC,EAJyCsW,EAIzCtW,QAERC,EAAI,EAAGA,EAAIT,EAAQP,OAAQgB,IAAK,CACvC,IAAMC,EAAKH,EAAUP,EAAQS,GACvBE,EAAKH,EAAUP,EAAQQ,IAEjBb,EAAMO,OAAOQ,IAAOf,EAAMiB,cAAmB,EAANF,EAAU,IACzDD,GAAM7B,GkBgaJkY,CACE7U,KAAKmK,eAAeC,IAAKpK,KAAKmK,eAAezL,IAC7CsB,KAAKrF,MAAMgT,aAAc3N,KAAKvC,YAC9BuC,KAAKtC,OAGP,IAAIoX,EAAQ9U,KAAK+U,aAAa/U,KAAKtC,OACnCsC,KAAK6I,cAAgBiM,EACrB9U,KAAKrF,MAAMqa,YAAYhV,KAAK6I,cAI5B7I,KAAKrF,MAAMka,WAAW7U,KAAKtC,OAE3BiX,GAAS,EAIX,OAAQ3U,KAAKrF,MAAMoN,UACjB,IrBlekB,MqBkegC,MAClD,IrBle0B,cqBmepB/H,KAAK6I,cAAgB7I,KAAKrF,MAAMwN,YAClCnI,KAAKrF,MAAMwX,arBveI,OqBifrBnS,KAAKoT,OAAQ,EAKTuB,IACF3U,KAAKmK,eAAezL,KAAO,EAC3BsB,KAAKmK,eAAeC,KAAO,EAC3BpK,KAAKvC,alB/ekB,EkBgfvBuC,KAAK2R,iBAQT3R,KAAKrF,MAAM0V,kBAAkBrQ,KAAKvC,aAElCuC,KAAKoR,WAAWC,MAAO,EACvBrR,KAAKoR,WAAWxL,MAAO,EAGzB5F,KAAKrF,MAAMsa,YAAYjV,KAAK8R,8DAIV,IAAAzQ,EAAArB,KAClBlE,OAAOoZ,SAAW,WAChB7T,EAAK1G,MAAMwa,OAAOrZ,OAAOoR,WAAYpR,OAAOsZ,cAE9CtZ,OAAOoZ,WAEP7C,SAAStW,iBAAiB,UAAWiE,KAAKmQ,SAAS,GAEnDkF,YAAYrV,KAAKoQ,SAAU,mDAI3BiC,SAASrW,oBAAoB,UAAWgE,KAAKmQ,0CAI7C,MrB/hB0B,SqB+hBtBnQ,KAAKrF,MAAMsX,UAEXjX,EAAAC,EAAAC,cAACoa,GAAD,CACEpN,KAAMlI,KAAKrF,MAAMuN,KACjB7L,MAAO2D,KAAK3D,QrBhiBO,QqBoiBrB2D,KAAKrF,MAAMsX,UAEXjX,EAAAC,EAAAC,cAACqa,GAAD,CACExN,SAAU/H,KAAKrF,MAAMoN,SACrBe,WAAY9I,KAAKrF,MAAMmO,WACvBD,aAAc7I,KAAKrF,MAAMkO,aACzB3H,MAAOlB,KAAK3D,MACZ2M,SAAUhJ,KAAKgJ,SACfE,YAAalJ,KAAKrF,MAAMuO,cAM5BlO,EAAAC,EAAAC,cAACsa,GAAD,CACEvD,UAAWjS,KAAKrF,MAAMsX,UACtB9H,eAAgBnK,KAAKrF,MAAMwP,eAC3BqD,qBAAsBxN,KAAKwN,qBAC3BJ,aAAcpN,KAAKoN,aACnBG,WAAYvN,KAAKrF,MAAM4S,WACvBM,gBAAiB7N,KAAK6N,gBACtBF,aAAc3N,KAAKrF,MAAMgT,aACzBlQ,YAAauC,KAAKrF,MAAM8C,YACxBZ,UAAWmD,KAAKrF,MAAMkC,UACtBoB,OAAQ+B,KAAKrF,MAAM+C,MAAMO,OACzB8C,OAAQf,KAAKrF,MAAMoG,OACnB8H,aAAc7I,KAAKrF,MAAMkO,aACzBC,WAAY9I,KAAKrF,MAAMmO,WACvBX,WAAYnI,KAAKrF,MAAMwN,WACvBe,YAAalJ,KAAKrF,MAAMuO,YACxBnB,SAAU/H,KAAKrF,MAAMoN,SACrB7G,MAAOlB,KAAK3D,MACZ2M,SAAUhJ,KAAKgJ,SACfwH,MAAOxQ,KAAKwQ,MACZjF,WAAYvL,KAAKuL,WACjBY,UAAWnM,KAAKmM,UAChBT,SAAU1L,KAAK0L,SACfsD,UAAWhP,KAAKgP,UAChBE,UAAWlP,KAAKkP,UAChBE,QAASpP,KAAKoP,QACdP,YAAa7O,KAAKrF,MAAMkU,YACxBC,aAAc9O,KAAKrF,MAAMmU,sBAljBf9M,aCwDHyT,GALFxN,YA9DW,SAAArH,GAAK,MAAK,CAChCsH,KAAMtH,EAAMsH,KACZnH,OAAQH,EAAMG,OACdkR,UAAWrR,EAAMqR,UACjBlK,SAAUnH,EAAMmH,SAChBoC,eAAgBvJ,EAAMuJ,eACtBwD,aAAc/M,EAAM+M,aACpBJ,WAAY3M,EAAM2M,WAClByD,cAAepQ,EAAMoQ,cACrBvT,YAAamD,EAAMnD,YACnBC,MAAOkD,EAAMlD,MACboL,WAAYlI,EAAMkI,WAClBjM,UAAW+D,EAAM/D,UACjBgM,aAAcjI,EAAMiI,aACpBV,WAAYvH,EAAMuH,WAClB0G,YAAajO,EAAMiO,YACnBC,aAAclO,EAAMkO,aACpB5F,YAAatI,EAAMsI,cAGM,SAAAd,GAAQ,MAAK,CACtCqM,sBAAuB,SAACiB,GACtBtN,EdzBoD,CACtDvG,KAAMkF,EACNoD,ecuBiCuL,KAEjCC,YAAa,SAACD,GdtBW,IAAAE,EcuBvBxN,EdvBiC,CACnCvG,KAAMmF,EACNpB,MAFyBgQ,EcuBFF,GdrBX9P,KACZyL,KAAMuE,EAAMvE,QcsBZhB,kBAAmB,SAACqF,GAClBtN,EdpB6C,CAC/CvG,KAAMoF,EACNxJ,YckB6BiY,KAE7BlB,UAAW,SAACqB,EAAIC,GACd1N,EdlBiD,CACnDvG,KAAMqF,EACNsN,UcgBqBqB,EdfrBtI,WceyBuI,KAEzBjB,WAAY,SAACnX,GACX0K,EdfsB,SAAC1K,GAAD,MAAY,CACpCmE,KAAMsF,EACNzJ,MAAOA,GcaImX,CAAWnX,KAEtBF,kBAAmB,SAACV,EAAGC,EAAGJ,EAAOc,EAAaC,GAC5C0K,Edb6B,SAACtL,EAAGC,EAAGJ,EAAOc,EAAaC,GAA3B,MAAsC,CACrEmE,KAAMuF,EACNtK,EAAGA,EACHC,EAAGA,EACHJ,MAAOA,EACPc,YAAaA,EACbC,MAAOA,GcOIF,CAAkBV,EAAGC,EAAGJ,EAAOc,EAAaC,KAEvDsX,YAAa,SAACnM,GACZT,EdPuB,SAACS,GAAD,MAAmB,CAC5ChH,KAAMwF,EACNwB,aAAcA,GcKHmM,CAAYnM,KAEvB3H,MAAO,WACLkH,EdLwB,CAC1BvG,KAAMyF,KcMN6N,OAAQ,SAACY,EAAUC,GACjB5N,EdJkB,SAAC2N,EAAUC,GAAX,MAA0B,CAC9CnU,KAAM0F,EACNwO,SAAUA,EACVC,UAAWA,GcCAb,CAAOY,EAAUC,KAE5B7D,aAAc,SAAC8D,GACb7N,EdDwB,SAAC6N,GAAD,MAAmB,CAC7CpU,KAAM2F,GACNyK,UAAWgE,GcDA9D,CAAa8D,KAExB7Z,YAAa,SAAC0L,GACZM,EAAShM,GAAY0L,KAEvBmN,YAAa,SAAC/L,GACZd,EdQuB,SAACc,GAAD,MAAkB,CAC3CrH,KAAM8F,GACNuB,YAAaA,GcVF+L,CAAY/L,KAEvByH,WAAY,WACVvI,Ede6B,CAC/BvG,KAAMgG,QcZKI,CAGXgI,ICtEawE,OAdf,SAA+B7T,EAAOqF,GACpC,OAAIrF,EAAMuJ,eAAezL,MAAQuH,EAAOkE,eAAezL,KACnDkC,EAAMuJ,eAAeC,MAAQnE,EAAOkE,eAAeC,IAC9CxJ,EAGFd,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEEuJ,eAAerK,OAAAa,EAAA,EAAAb,CAAA,GACRmG,EAAOkE,mBCmBlB,IAIe+L,GAHV,aClBU7F,OAXf,SAA2BzP,EAAOqF,GAChC,OAAIrF,EAAMnD,cAAgBwI,EAAOxI,YACxBmD,EAGFd,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEEnD,YAAawI,EAAOxI,eCGT+W,OAVf,SAAmB5T,EAAOqF,GACxB,OAAOnG,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEE+M,aAAc1H,EAAOuO,UAGrBjH,WAAYtH,EAAOsH,uBCsCRsH,OAtBf,SAAoBjU,EAAOuV,GACzB,IAAMC,EAAWD,EAAKzY,MAAMO,OACxBoY,EAxBN,SAAwBC,EAAUF,GAGhC,IAFA,IAAMC,EAAc,GACdE,EAAUD,EAAS/Y,OAChBqM,EAAI,EAAGA,EAAI2M,EAAS3M,IAK3B,IAJA,IAAM4M,EAASJ,EAASxM,GAClB6M,EAASH,EAAS1M,GAElB8M,EAAUF,EAAOjZ,OACdkM,EAAI,EAAGA,EAAIiN,EAASjN,IAAK,CAChC,IAAMkN,EAAWH,EAAO/M,GAGxB,GAFiBgN,EAAOhN,KAEPkN,EAAU,CACzBN,EAAYhS,KAAKuF,GACjB,OAKN,OAAOyM,EAKWO,CAAehW,EAAMlD,MAAMO,OAAQmY,GACrD,GAA2B,IAAvBC,EAAY9Y,OACd,OAAOqD,EAGT,IAAM3C,EAAM6B,OAAA+W,GAAA,EAAA/W,CAAOc,EAAMlD,MAAMO,QAPAoH,GAAA,EAAAC,GAAA,EAAAC,OAAA3G,EAAA,IAQ/B,QAAA4G,EAAAC,EAAc4Q,EAAd3Q,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAA2B,KAAlBuE,EAAkBpE,EAAAhF,MACzBvC,EAAO2L,GAAP9J,OAAA+W,GAAA,EAAA/W,CAAgBsW,EAASxM,KATI,MAAA3N,IAAAqJ,GAAA,EAAAC,EAAAtJ,GAAA,YAAAoJ,GAAA,MAAAI,EAAAM,QAAAN,EAAAM,SAAA,WAAAT,EAAA,MAAAC,GAY/B,OAAOzF,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEElD,MAAMoC,OAAAa,EAAA,EAAAb,CAAA,GACDc,EAAMlD,MADN,CAEHO,OAAQA,IAEV6K,WAAYlI,EAAMkI,WAAa,KCrCpBgO,GAAA,SAAClW,EAAOuV,GAAS,IACtBrZ,EAAoCqZ,EAApCrZ,EAAGC,EAAiCoZ,EAAjCpZ,EAAGJ,EAA8BwZ,EAA9BxZ,MAAOc,EAAuB0Y,EAAvB1Y,YAAaC,EAAUyY,EAAVzY,MAC5BqZ,EAAenW,EAAM/D,UACrBma,EAAexZ,EAAkBV,EAAGC,EAAGJ,EAAOc,EAAaC,GAEjE,OAAIqZ,IAAiBC,EACZpW,EAGFd,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEE/D,UAAWma,KCHAhC,OAXf,SAAqBpU,EAAOqF,GAC1B,OAAIrF,EAAMiI,eAAiB5C,EAAO4C,aACzBjI,EAGFd,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEEiI,aAAc5C,EAAO4C,gBCPVoO,GAAA,SAACrW,EAAOqF,GACrB,OAAIrF,EAAMsI,cAAgBjD,EAAOiD,YACxBtI,EAGFd,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEEsI,YAAajD,EAAOiD,eCCTiM,OARf,SAAgBvU,EAAOqF,GACrB,OAAOnG,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEEiO,YAAa5I,EAAO8P,SACpBjH,aAAc7I,EAAO+P,aCAzBkB,GAAA,SAAgBtW,EAAOqF,GACrB,IAAI8L,EAAW9L,EAAOgM,UAOtB,MhCV8B,WgCI1BhM,EAAOgM,WhCJmB,WgCKxBrR,EAAMqR,YACRF,EAAWxW,GAIRuE,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEEqR,UAAWF,KCdAoF,GAAA,SAACvW,EAAOqF,GACrB,OAAOnG,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEEmH,SAAU9B,EAAO8B,YCHNqP,GAAA,SAACxW,EAAOqF,GACrB,OAAOnG,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEEsH,KAAMjC,EAAOiC,QCsCXmP,GAAe,CACnBpF,UnC1C4B,OmC2C5B9H,eAAgB,CACdzL,KAAM,EACN0L,KAAM,GAERuD,aAAc/Q,EACdoU,cAAe,EACfzD,WAAY,GACZ9P,ahCrC+B,EgCsC/BZ,WAAW,EACXiM,WAAY,EACZD,aAAc,EACdV,WAAY,GACZe,YAAa,EACbxL,MAAO,CACLO,OACE2E,MnC3C6B,ImC2CFlH,KAAK,GAAGZ,IAAI,SAAA8O,GAAC,OACtChH,MnC7C0B,ImC6CAlH,KAAKkB,MAErCmE,OAAQ,CACNyF,QAAS,EACTpJ,YAAa3B,IAkDF6b,OA9Cf,WAA+C,IAA9B1W,EAA8BiP,UAAAtS,OAAA,QAAAqB,IAAAiR,UAAA,GAAAA,UAAA,GAAtBwH,GAAcpR,EAAQ4J,UAAAtS,OAAA,EAAAsS,UAAA,QAAAjR,EAC7C,OAAQqH,EAAOpE,MACb,KAAKkF,EACH,OAAO0N,GAAsB7T,EAAOqF,GACtC,KAAKe,EACH,OAAO2O,GAAY/U,EAAOqF,GAC5B,KAAKgB,EACH,OAAOoJ,GAAkBzP,EAAOqF,GAClC,KAAKiB,EACH,OAAOsN,GAAU5T,EAAOqF,GAC1B,KAAKkB,EACH,OAAO0N,GAAWjU,EAAOqF,GAC3B,KAAKmB,EACH,OAAO5J,GAAkBoD,EAAOqF,GAClC,KAAKoB,EACH,OAAO2N,GAAYpU,EAAOqF,GAC5B,KAAK0B,GACH,OAAOsN,GAAYrU,EAAOqF,GAC5B,KAAK2B,GACH,OAAO3G,EAAaL,EAAOqF,GAC7B,KAAK4B,GACH,O7B5EC,SAAqBjH,GAC1B,IAAM2W,EAAiBzU,EAAca,IAAIqC,GACzC,OAAIuR,EACKzX,OAAAa,EAAA,EAAAb,CAAA,GACFc,EADL,CAEEG,OAAQwW,IAIL3W,E6BmEI+P,CAAW/P,GACpB,KAAK2G,EACH,OAAO4N,GAAOvU,EAAOqF,GACvB,KAAKuB,GACH,OAAO2K,GAAavR,EAAOqF,GAC7B,KAAKwB,GACH,OAAOrL,GAAYwE,EAAOqF,GAC5B,KAAKyB,GACH,OAAOpL,GAAQsE,EAAOqF,GACxB,KAAKqB,EAGH,OAAOxH,OAAAa,EAAA,EAAAb,CAAA,GACFuX,GADL,CAEEtW,OAAQH,EAAMG,OACd8N,YAAajO,EAAMiO,YACnBC,aAAclO,EAAMkO,aACpB/G,SAAUnH,EAAMmH,SAChBkK,UAAW1W,IAEf,QACE,OAAOqF,ICjGO4W,QACW,cAA7B1b,OAAO2b,SAASC,UAEe,UAA7B5b,OAAO2b,SAASC,UAEhB5b,OAAO2b,SAASC,SAASC,MACvB,2DCAN,IAAMC,GAAQC,YACZP,IAGFQ,IAASC,OACP/c,EAAAC,EAAAC,cAAC8c,EAAA,EAAD,CAAUJ,MAAOA,IACf5c,EAAAC,EAAAC,cAAC+c,GAAD,OAEF5F,SAASC,eAAe,SDuGpB,kBAAmB4F,WACrBA,UAAUC,cAAcC,MAAMC,KAAK,SAAAC,GACjCA,EAAaC","file":"static/js/main.c031835c.chunk.js","sourcesContent":["import React from 'react';\r\n\r\nimport './Menu.css';\r\n\r\nconst Menu = (props) => {\r\n  const {\r\n    items,\r\n  } = props;\r\n\r\n  const menuItems = items.map(item =>\r\n    <li key={item.text}\r\n        onClick={item.onClick}\r\n        className=\"button\" >\r\n        {item.text}\r\n    </li>\r\n  );\r\n\r\n  return (\r\n    <div className=\"menu\">\r\n      <ul>\r\n        {menuItems}\r\n      </ul>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Menu;\r\n","export const GAMESTATE_MENU = 'MENU';\r\nexport const GAMESTATE_PLAYING = 'PLAYING';\r\nexport const GAMESTATE_PAUSED = 'PAUSED';\r\nexport const GAMESTATE_END = 'END';\r\n\r\nexport const GAMEMODE_ZEN = 'ZEN';\r\nexport const GAMEMODE_LINE_TARGET = 'LINE TARGET';\r\n\r\nexport const MENU_MAIN = 'MAIN';\r\nexport const MENU_STYLE_SETTINGS = 'STYLE';\r\nexport const MENU_IMPORT_EXPORT = 'IMPORT_EXPORT';\r\n\r\nexport const blockSizeInUnits = 26;\r\n\r\nexport const fieldWidthInBlocks = 10;\r\nexport const fieldHeightInBlocks = 20;\r\nexport const hiddenHeight = 3;\r\n\r\nexport const defaultStyles = [\r\n  { fill: '#708090' }, // I\r\n  { fill: '#f5c635' }, // L\r\n  { fill: '#ee8817' }, // O\r\n  { fill: '#47b450' }, // Z\r\n  { fill: '#ee575b' }, // T\r\n  { fill: '#9155f4' }, // J\r\n  { fill: '#009fd4' }, // S\r\n];\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\r\nvar testPassiveSupported = false;\r\n\r\ntry {\r\n  var options = {\r\n    get passive() { // This function will be called when the browser\r\n                    //     attempts to access the passive property.\r\n      testPassiveSupported = true;\r\n\r\n      // make linter happy\r\n      return true;\r\n    }\r\n  };\r\n\r\n  window.addEventListener(\"test\", options, options);\r\n  window.removeEventListener(\"test\", options, options);\r\n} catch(err) {\r\n  testPassiveSupported = false;\r\n}\r\n\r\nexport const passiveSupported = testPassiveSupported;\r\n","import React from 'react';\r\n\r\nimport Menu from './Menu';\r\n\r\nimport {\r\n  GAMEMODE_ZEN,\r\n  GAMEMODE_LINE_TARGET,\r\n  MENU_STYLE_SETTINGS,\r\n  MENU_IMPORT_EXPORT,\r\n} from '../../constants';\r\n\r\nconst MainMenu = (props) => {\r\n  const menuItems = [\r\n    {\r\n      text: 'ZEN MODE',\r\n      onClick: () => {\r\n        props.setGameMode(GAMEMODE_ZEN);\r\n        props.start();\r\n      },\r\n    },\r\n    {\r\n      text: 'LINE TARGET MODE',\r\n      onClick: () => {\r\n        props.setGameMode(GAMEMODE_LINE_TARGET);\r\n        // TODO: we probably want a settings screen\r\n        // for a bunch of the different modes, rather\r\n        // than starting the game immediately.\r\n        props.start();\r\n      },\r\n    },\r\n    {\r\n      text: 'CUSTOMIZE STYLE',\r\n      onClick: () => {\r\n        props.setMenu(MENU_STYLE_SETTINGS);\r\n      },\r\n    },\r\n    {\r\n      text: 'IMPORT / EXPORT SETTINGS',\r\n      onClick: () => {\r\n        props.setMenu(MENU_IMPORT_EXPORT);\r\n      },\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <Menu items={menuItems} />\r\n  );\r\n};\r\n\r\nexport default MainMenu;\r\n","import React from 'react';\r\n\r\nimport './Block.css';\r\n\r\nimport { PIECE_NONE } from './Piece';\r\n\r\nconst Block = (props) => {\r\n  const classes = (\"grid-block \" +\r\n    (props.flash ? \"grid-block-flash \" : \"\") +\r\n    (props.piece !== PIECE_NONE ? \"piece-block \" : \"\") +\r\n    (props.placeable === false ? \"cannot-place \" : \"\")\r\n  );\r\n\r\n  return (\r\n    <rect\r\n      x={props.x}\r\n      y={props.y}\r\n      width={props.blockSize}\r\n      height={props.blockSize}\r\n      style={props.blockStyles[props.piece]}\r\n      className={classes}\r\n     />\r\n  )\r\n};\r\n\r\nexport default Block;\r\n","import React from 'react';\r\n\r\nimport Block from './Block';\r\n\r\nexport const PIECE_NONE = -1;\r\nexport const PIECE_I = 0;\r\nexport const PIECE_L = 1;\r\nexport const PIECE_O = 2;\r\nexport const PIECE_Z = 3;\r\nexport const PIECE_T = 4;\r\nexport const PIECE_J = 5;\r\nexport const PIECE_S = 6;\r\n\r\nexport const ORIENTATION_NONE  = -1;\r\nexport const ORIENTATION_UP    = 0;\r\nexport const ORIENTATION_RIGHT = 1;\r\nexport const ORIENTATION_DOWN  = 2;\r\nexport const ORIENTATION_LEFT  = 3;\r\n\r\nconst allPieceDataX = [\r\n  [[0,1,2,3],[2,2,2,2],[3,2,1,0],[1,1,1,1]],  // I\r\n  [[2,2,1,0],[2,1,1,1],[0,0,1,2],[0,1,1,1]],  // L\r\n  [[0,1,1,0],[1,1,0,0],[1,0,0,1],[0,0,1,1]],  // O\r\n  [[0,1,1,2],[2,2,1,1],[2,1,1,0],[0,0,1,1]],  // Z\r\n  [[1,0,1,2],[2,1,1,1],[1,2,1,0],[0,1,1,1]],  // T\r\n  [[0,0,1,2],[2,1,1,1],[2,2,1,0],[0,1,1,1]],  // J\r\n  [[2,1,1,0],[2,2,1,1],[0,1,1,2],[0,0,1,1]],  // S\r\n];\r\n\r\nconst allPieceDataY = [\r\n  [[1,1,1,1],[0,1,2,3],[2,2,2,2],[3,2,1,0]],  // I\r\n  [[0,1,1,1],[2,2,1,0],[2,1,1,1],[0,0,1,2]],  // L\r\n  [[0,0,1,1],[0,1,1,0],[1,1,0,0],[1,0,0,1]],  // O\r\n  [[0,0,1,1],[0,1,1,2],[2,2,1,1],[2,1,1,0]],  // Z\r\n  [[0,1,1,1],[1,0,1,2],[2,1,1,1],[1,2,1,0]],  // T\r\n  [[0,1,1,1],[0,0,1,2],[2,1,1,1],[2,2,1,0]],  // J\r\n  [[0,0,1,1],[2,1,1,0],[2,2,1,1],[0,1,1,2]],  // S\r\n];\r\n\r\nexport const PIECE_COUNT = allPieceDataX.length;\r\n\r\nexport function placeBlock(x, y, piece, orientation, field) {\r\n  const blocksX = allPieceDataX[piece][orientation];\r\n  const blocksY = allPieceDataY[piece][orientation];\r\n\r\n  const { xOffset, yOffset } = getGridOffset(x, y, piece, orientation);\r\n\r\n  for (var i = 0; i < blocksX.length; i++) {\r\n    const x2 = xOffset + blocksX[i];\r\n    const y2 = yOffset + blocksY[i];\r\n\r\n    const row = field.blocks[y2] || field.hiddenBlocks[y2 * -1 - 1];\r\n    row[x2] = piece;\r\n  }\r\n}\r\n\r\nexport function checkPlaceability(x, y, piece, orientation, field) {\r\n  if (piece !== PIECE_NONE &&\r\n      orientation !== -1 &&\r\n      x !== -1 &&\r\n      y !== -1\r\n  ) {\r\n    // TODO: check if the piece has a valid path to get\r\n    // to this position from the top.\r\n    //\r\n    // Idea: Instead of a consant reference point at the top,\r\n    // ave a regular piece dropping slowly and move it\r\n    // left/right as the player drags the destination left/right\r\n    // if the regular piece becomes obstructed, the player can\r\n    // no longer move it in that direction, and if the piece\r\n    // lands in a lockable position before the player lets go\r\n    // lock the piece. The dragging should assume optimal play\r\n    // including valid spins/kicks.\r\n    const collides = checkCollision(x, y, piece, orientation, field);\r\n    const supported = !collides && checkCollision(x, y + 1, piece, orientation, field);\r\n    return !collides && supported;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport function checkCollision(x, y, piece, orientation, field) {\r\n  const blocksX = allPieceDataX[piece][orientation];\r\n  const blocksY = allPieceDataY[piece][orientation];\r\n\r\n  const fieldWidth = field.blocks[0].length;\r\n  const fieldHeight = field.length;\r\n\r\n  const { xOffset, yOffset } = getGridOffset(x, y, piece, orientation);\r\n\r\n  for (var i = 0; i < blocksX.length; i++) {\r\n    const x2 = xOffset + blocksX[i];\r\n    const y2 = yOffset + blocksY[i];\r\n\r\n    // Off the left edge of the field\r\n    if (x2 < 0) {\r\n      return true;\r\n    }\r\n\r\n    // Off the right / bottom edge of the field\r\n    if (x2 >= fieldWidth || y2 >= fieldHeight) {\r\n      return true;\r\n    }\r\n\r\n    const row = field.blocks[y2] || field.hiddenBlocks[y2 * -1 - 1];\r\n\r\n    // Off the top edge (past the hidden blocks) of the field\r\n    if (row === undefined) {\r\n      return true;\r\n    }\r\n\r\n    // Collides with a previously placed block\r\n    if (row[x2] !== PIECE_NONE) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n// TODO: don't create a new object just to return\r\n// these values.\r\nfunction getGridOffset(x, y, piece, orientation) {\r\n  const height = getHeight(piece, orientation);\r\n\r\n  const minX = getMinX(piece, orientation);\r\n  const minY = getMinY(piece, orientation);\r\n\r\n  const xOffset = x - minX;\r\n  const yOffset = y - (minY + height - 1);\r\n\r\n  return { xOffset, yOffset };\r\n}\r\n\r\n// TODO: cache these...\r\nfunction getMinX(piece, orientation) {\r\n  const blocks = allPieceDataX[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n  }\r\n\r\n  return min;\r\n}\r\n\r\nfunction getMinY(piece, orientation) {\r\n  const blocks = allPieceDataY[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n  }\r\n\r\n  return min;\r\n}\r\n\r\nfunction getWidth (piece, orientation) {\r\n  const blocks = allPieceDataX[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n  var max = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n    max = max > block ? max : block;\r\n  }\r\n\r\n  return (max - min) + 1;\r\n}\r\n\r\nfunction getHeight (piece, orientation) {\r\n  const blocks = allPieceDataY[piece][orientation];\r\n\r\n  var min = blocks[0];\r\n  var max = blocks[0];\r\n\r\n  for (var i = 1; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    min = min < block ? min : block;\r\n    max = max > block ? max : block;\r\n  }\r\n\r\n  return (max - min) + 1;\r\n}\r\n\r\nconst Piece = (props) => {\r\n  const {\r\n    piece, orientation, blockSize, placeable,\r\n    cx, cy, x, y,\r\n    blockStyles,\r\n  } = props;\r\n\r\n  if (piece === PIECE_NONE || orientation === ORIENTATION_NONE)\r\n    return null;\r\n\r\n  const pieceDataX = allPieceDataX[piece][orientation];\r\n  const pieceDataY = allPieceDataY[piece][orientation];\r\n\r\n  const width = getWidth(piece, orientation);\r\n  const height = getHeight(piece, orientation);\r\n\r\n  const minX = getMinX(piece, orientation);\r\n  const minY = getMinY(piece, orientation);\r\n\r\n  var xOffset;\r\n  var yOffset;\r\n  if (cx !== undefined && cy !== undefined) {\r\n    xOffset = (cx - minX * blockSize - (width  * blockSize / 2));\r\n    yOffset = (cy - minY * blockSize - (height * blockSize / 2));\r\n  } else {\r\n    xOffset = x - minX * blockSize;\r\n    yOffset = y - (minY + height - 1) * blockSize;\r\n  }\r\n\r\n  return (\r\n    pieceDataX.map((x, i) => {\r\n      const y = pieceDataY[i];\r\n      return (\r\n        <Block\r\n          key={i}\r\n          x={xOffset + x * blockSize}\r\n          y={yOffset + y * blockSize}\r\n          placeable={placeable}\r\n          piece={piece}\r\n          blockStyles={blockStyles}\r\n          blockSize={blockSize} />\r\n      );\r\n    })\r\n  );\r\n};\r\n\r\nexport default Piece;\r\n","import React, { Component } from 'react';\r\n\r\nimport './StyleConfiguration.css';\r\nimport './Menu.css';\r\n\r\nimport {\r\n  blockSizeInUnits,\r\n  defaultStyles,\r\n  MENU_MAIN,\r\n} from '../../constants';\r\n\r\nimport Piece, { ORIENTATION_UP } from '../Piece';\r\n\r\nclass StyleConfiguration extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      colors: Object.assign({}, props.config.blockStyles),\r\n    };\r\n  }\r\n\r\n  changeHandler = event => {\r\n    const name = event.target.name;\r\n    const value = event.target.value;\r\n\r\n    this.setState({\r\n      colors: {\r\n        ...this.state.colors,\r\n        [name]: {\r\n          fill: value,\r\n        },\r\n      }\r\n    });\r\n  }\r\n\r\n  save = () => {\r\n    const config = {\r\n      blockStyles: Object.values(this.state.colors)\r\n    };\r\n\r\n    this.props.updateConfig(config);\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  reset = () => {\r\n    this.setState({\r\n      colors: Object.assign({}, defaultStyles),\r\n    });\r\n  }\r\n\r\n  cancel = () => {\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  render() {\r\n    const { config: { blockStyles } } = this.props;\r\n    const blockSize = blockSizeInUnits;\r\n\r\n    const viewBox = [0, 0, blockSize * 4, blockSize * 4];\r\n    const items = blockStyles.map((p, i) =>\r\n      <li key={i} className=\"color-config-item\">\r\n        <svg\r\n          shapeRendering=\"crispEdges\"\r\n          preserveAspectRatio=\"xMidYMid slice\"\r\n          width={blockSize * 3}\r\n          height={blockSize * 2.25}\r\n          viewBox={viewBox}\r\n        >\r\n          <Piece\r\n            piece={i}\r\n            orientation={ORIENTATION_UP}\r\n            blockSize={blockSize}\r\n            blockStyles={this.state.colors}\r\n            cx={blockSize * 2}\r\n            cy={blockSize * 2}\r\n          />\r\n        </svg>\r\n        <label\r\n          className=\"color-picker\"\r\n          style={{\r\n            backgroundColor: this.state.colors[i].fill,\r\n            width: \"30px\",\r\n            height: \"30px\",\r\n          }}\r\n          htmlFor={\"cp-\" + i} >\r\n          <input\r\n            className=\"color-picker\"\r\n            type=\"color\"\r\n            id={\"cp-\" + i}\r\n            name={i}\r\n            value={this.state.colors[i].fill}\r\n            onChange={this.changeHandler} />\r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          id={\"ct-\" + i}\r\n          name={i}\r\n          value={this.state.colors[i].fill}\r\n          onChange={this.changeHandler} />\r\n      </li>\r\n    );\r\n\r\n    return (\r\n      <div className=\"menu\">\r\n        <ul className=\"color-config-items\">\r\n          {items}\r\n        </ul>\r\n        <ul>\r\n          <li className=\"button cancel\" onClick={this.cancel}>\r\n            CANCEL\r\n          </li>\r\n          <li className=\"button reset\" onClick={this.reset}>\r\n            RESET TO DEFAULTS\r\n          </li>\r\n          <li className=\"button save\" onClick={this.save}>\r\n            SAVE\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    )\r\n  }\r\n};\r\n\r\nexport default StyleConfiguration;\r\n","// https://bost.ocks.org/mike/shuffle/\r\nexport function shuffle(array, random = Math.random) {\r\n  var m = array.length, t, i;\r\n\r\n  // While there remain elements to shuffle\r\n  while (m) {\r\n    // Pick a remaining element\r\n    i = Math.floor(random() * m--);\r\n\r\n    // And swap it with the current element.\r\n    t = array[m];\r\n    array[m] = array[i];\r\n    array[i] = t;\r\n  }\r\n\r\n  return array;\r\n}\r\n\r\n// variation of https://stackoverflow.com/a/37168679\r\nexport function millisecondsToTimestamp(totalMs) {\r\n  var milliseconds = (totalMs % 1000).toFixed(0);\r\n  milliseconds = (\"000\" + milliseconds).slice(-3);\r\n\r\n  var seconds = Math.floor(totalMs / 1000).toFixed(0);\r\n  var minutes = Math.floor(seconds / 60);\r\n  var hours = \"\";\r\n  if (minutes > 59) {\r\n    hours = Math.floor(minutes / 60);\r\n    minutes = minutes - (hours * 60);\r\n    minutes = (minutes >= 10) ? minutes : \"0\" + minutes;\r\n  }\r\n\r\n  seconds = Math.floor(seconds % 60);\r\n  seconds = (seconds >= 10) ? seconds : \"0\" + seconds;\r\n  if (hours !== \"\") {\r\n    return hours + \":\" + minutes + \":\" + seconds + \".\" + milliseconds;\r\n  }\r\n\r\n  return minutes + \":\" + seconds + \".\" + milliseconds;\r\n}\r\n\r\n// https://stackoverflow.com/a/37164538\r\nfunction isObject(item) {\r\n  return (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\nexport function mergeDeep(target, source) {\r\n  let output = Object.assign({}, target);\r\n  if (isObject(target) && isObject(source)) {\r\n    Object.keys(source).forEach(key => {\r\n      if (isObject(source[key])) {\r\n        if (!(key in target))\r\n          Object.assign(output, { [key]: source[key] });\r\n        else\r\n          output[key] = mergeDeep(target[key], source[key]);\r\n      } else {\r\n        Object.assign(output, { [key]: source[key] });\r\n      }\r\n    });\r\n  }\r\n  return output;\r\n}\r\n\r\nfunction splitMax(string, delimiter, maxSplits) {\r\n  let arr = string.split(delimiter);\r\n  let result = arr.splice(0, maxSplits - 1);\r\n\r\n  result.push(arr.join(delimiter));\r\n\r\n  return result;\r\n}\r\n\r\n// Facade over localStorage that handles basic\r\n// numbers, strings, objects and arrays.\r\n//\r\n// Note if the object contains sub-objects of\r\n// other types, these will most likely not be\r\n// detected and lost in the conversion.\r\nexport const persistedData = {\r\n  set: function(key, value) {\r\n    if (!key) {return;}\r\n\r\n    if (value === null || value === undefined) {\r\n      window.localStorage.removeItem(key);\r\n    }\r\n\r\n    const ctor = value.constructor.name;\r\n    let stringValue;\r\n    // This handles simple property based objects\r\n    // and arrays but it doesn't support classes\r\n    // the caller should handle serialization\r\n    // themselves.\r\n    switch (ctor) {\r\n      case 'Array': // through\r\n      case 'Object': stringValue = JSON.stringify(value); break;\r\n      case 'String': stringValue = value; break;\r\n      case 'Number': stringValue = value.toString(); break;\r\n      default: throw new Error(`Type ${ctor} not supported`);\r\n    }\r\n\r\n    window.localStorage.setItem(key, `pd:${ctor}:${stringValue}`);\r\n  },\r\n\r\n  get: function(key) {\r\n    var value = localStorage.getItem(key);\r\n\r\n    // values are always strings, so if we\r\n    // get a literal null, it wasn't in there.\r\n    if (value === null) {return;}\r\n\r\n    const maxParts = 3;\r\n    const parts = splitMax(value, ':', maxParts);\r\n    if (parts.length < maxParts || parts[0] !== 'pd') {\r\n      // value was definitely not stored using this facade\r\n      return value;\r\n    }\r\n\r\n    // At this point we assume the value was stored using\r\n    // the facade, if it wasn't then we've probably got\r\n    // a bug somewhere else (OR someone has been messing\r\n    // with the data manually).\r\n    const ctorName = parts[1];\r\n    const stringValue = parts[2];\r\n    let objectValue;\r\n    switch (ctorName) {\r\n      case 'Array': // through\r\n      case 'Object': objectValue = JSON.parse(stringValue); break;\r\n      case 'String': objectValue = stringValue; break;\r\n      case 'Number': objectValue = Number(stringValue); break;\r\n      default: throw new Error(\r\n        `Non-facade value '${value}' was stored` +\r\n        `but was attempted to be retrieved through the facade.`\r\n      );\r\n    }\r\n\r\n    return objectValue;\r\n  }\r\n}\r\n\r\nexport function objectsHaveSameKeys(a, b) {\r\n  const aKeys = Object.keys(a);\r\n  const bKeys = Object.keys(b);\r\n  const aSet = new Set(aKeys);\r\n  const bSet = new Set(bKeys);\r\n\r\n  if (aSet.size !== bSet.size) return false;\r\n\r\n  for (let item of aSet) {\r\n    if (!bSet.has(item)) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n","import {\r\n  mergeDeep,\r\n  persistedData,\r\n  objectsHaveSameKeys,\r\n} from '../util';\r\n\r\nimport {\r\n  defaultStyles,\r\n} from '../constants';\r\n\r\nconst configKey = 'config';\r\n\r\nexport function loadConfig (state) {\r\n  const existingConfig = persistedData.get(configKey);\r\n  if (existingConfig) {\r\n    return {\r\n      ...state,\r\n      config: existingConfig,\r\n    }\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function updateConfig (state, action) {\r\n  const newConfig = mergeDeep(state.config, action.config);\r\n\r\n  if (!validateConfig(newConfig)) {\r\n    return state;\r\n  }\r\n\r\n  persistedData.set(configKey, newConfig);\r\n\r\n  return {\r\n    ...state,\r\n    config: newConfig,\r\n  };\r\n}\r\n\r\nexport function validateConfig(config) {\r\n  if (!config) {\r\n    return false;\r\n  }\r\n\r\n  if (config.version !== 0) {\r\n    // NOTE: when we update the version of this for reals,\r\n    // we'll probably want a facility to upgrade a config\r\n    // object through the various (supported) versions so\r\n    // any configs that players have stored offline can\r\n    // still be used and brought up to date.\r\n    return false;\r\n  }\r\n\r\n  if (!config.blockStyles) {\r\n    return false;\r\n  }\r\n\r\n  if (!objectsHaveSameKeys(config.blockStyles, defaultStyles)) {\r\n    return false;\r\n  }\r\n\r\n  const keys = Object.keys(config.blockStyles);\r\n  for (let key of keys) {\r\n    const newStyle = config.blockStyles[key];\r\n    const defaultStyle = defaultStyles[key];\r\n\r\n    if (!objectsHaveSameKeys(newStyle, defaultStyle)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n","import React, { Component } from 'react';\r\n\r\nimport './Menu.css';\r\nimport './ImportExportSettings.css';\r\n\r\nimport {\r\n  MENU_MAIN,\r\n} from '../../constants';\r\n\r\nimport { validateConfig } from '../../reducers/config';\r\n\r\nclass ImportExportSettings extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      config: JSON.stringify(props.config),\r\n      valid: true,\r\n    };\r\n  }\r\n\r\n  validateInput = (value) => {\r\n    let config;\r\n    let valid = true;\r\n\r\n    try {\r\n      config = JSON.parse(value);\r\n      valid = validateConfig(config);\r\n    } catch (e) {\r\n      valid = false;\r\n    }\r\n\r\n    return valid;\r\n  }\r\n\r\n  changeHandler = event => {\r\n    const value = event.target.value;\r\n    const valid = this.validateInput(value);\r\n    this.setState({config: value, valid: valid});\r\n  }\r\n\r\n  save = () => {\r\n    if (!this.state.valid) {\r\n      return;\r\n    }\r\n\r\n    const config = JSON.parse(this.state.config);\r\n\r\n    this.props.updateConfig(config);\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  back = () => {\r\n    this.props.setMenu(MENU_MAIN);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"menu\">\r\n        <div id=\"config-text-holder\">\r\n          <textarea\r\n            id=\"config-text\"\r\n            value={this.state.config}\r\n            className={this.state.valid ? \"\" : \"invalid-input\"}\r\n            onChange={this.changeHandler} />\r\n        </div>\r\n        <ul>\r\n          <li className=\"button cancel\" onClick={this.back}>\r\n            BACK\r\n          </li>\r\n          <li className=\"button save\" onClick={this.save}>\r\n            SAVE\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    )\r\n  }\r\n};\r\n\r\nexport default ImportExportSettings;\r\n","export const SET_ACTIVE_GRID_POSITION = 'SET_ACTIVE_GRID_POSITION';\r\nexport const CYCLE_PIECES = 'CYCLE_PIECES';\r\nexport const SELECT_ORIENTATION = 'SELECT_ORIENTATION';\r\nexport const NEXT_PIECE = 'NEXT_PIECE';\r\nexport const PLACE_BLOCK = 'PLACE_BLOCK';\r\nexport const CHECK_PLACEABILITY = 'CHECK_PLACEABILITY';\r\nexport const UPDATE_STATS = 'UPDATE_STATS';\r\nexport const RESET = 'RESET';\r\nexport const RESIZE = 'RESIZE';\r\nexport const SET_GAME_STATE = 'SET_GAME_STATE'\r\nexport const SET_GAME_MODE = 'SET_GAME_MODE'\r\nexport const SET_MENU = 'SET_MENU'\r\nexport const UPDATE_TIMER = 'UPDATE_TIMER'\r\nexport const UPDATE_CONFIG = 'UPDATE_CONFIG'\r\nexport const LOAD_CONFIG = 'LOAD_CONFIG'\r\n\r\nexport const setActiveGridPosition = activePosition => ({\r\n  type: SET_ACTIVE_GRID_POSITION,\r\n  activePosition: activePosition,\r\n});\r\n\r\nexport const cyclePieces = debug => ({\r\n  type: CYCLE_PIECES,\r\n  next: debug.next,\r\n  prev: debug.prev,\r\n});\r\n\r\nexport const selectOrientation = orientation => ({\r\n  type: SELECT_ORIENTATION,\r\n  orientation: orientation,\r\n});\r\n\r\nexport const nextPiece = (nextPiece, nextPieces) => ({\r\n  type: NEXT_PIECE,\r\n  nextPiece: nextPiece,\r\n  nextPieces: nextPieces,\r\n});\r\n\r\nexport const placeBlock = (field) => ({\r\n  type: PLACE_BLOCK,\r\n  field: field,\r\n});\r\n\r\nexport const checkPlaceability = (x, y, piece, orientation, field) => ({\r\n  type: CHECK_PLACEABILITY,\r\n  x: x,\r\n  y: y,\r\n  piece: piece,\r\n  orientation: orientation,\r\n  field: field,\r\n});\r\n\r\nexport const updateStats = (linesCleared) => ({\r\n  type: UPDATE_STATS,\r\n  linesCleared: linesCleared,\r\n});\r\n\r\nexport const reset = () => ({\r\n  type: RESET,\r\n});\r\n\r\nexport const resize = (newWidth, newHeight) => ({\r\n  type: RESIZE,\r\n  newWidth: newWidth,\r\n  newHeight: newHeight,\r\n});\r\n\r\nexport const setGameState = (newGameState) => ({\r\n  type: SET_GAME_STATE,\r\n  gameState: newGameState,\r\n});\r\n\r\nexport const setGameMode = (newMode) => ({\r\n  type: SET_GAME_MODE,\r\n  gameMode: newMode,\r\n});\r\n\r\nexport const setMenu = (menu) => ({\r\n  type: SET_MENU,\r\n  menu: menu,\r\n});\r\n\r\nexport const updateTimer = (timerMillis) => ({\r\n  type: UPDATE_TIMER,\r\n  timerMillis: timerMillis,\r\n});\r\n\r\nexport const updateConfig = (config) => ({\r\n  type: UPDATE_CONFIG,\r\n  config: config,\r\n});\r\n\r\nexport const loadConfig = () => ({\r\n  type: LOAD_CONFIG,\r\n});\r\n","import { connect } from 'react-redux';\r\n\r\nimport _MainMenu from '../components/Menu/MainMenu';\r\nimport _StyleConfiguration from '../components/Menu/StyleConfiguration';\r\nimport _ImportExportSettings from '../components/Menu/ImportExportSettings';\r\n\r\nimport {\r\n  setMenu,\r\n  setGameMode,\r\n  updateConfig,\r\n} from '../actions/index';\r\n\r\nconst mapStateToProps = state => ({\r\n  config: state.config,\r\n  menu: state.menu,\r\n  gameMode: state.gameMode,\r\n  lineTarget: state.lineTarget,\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  setMenu: (menu) => {\r\n    dispatch(setMenu(menu));\r\n  },\r\n  setGameMode: (newMode) => {\r\n    dispatch(setGameMode(newMode));\r\n  },\r\n  updateConfig: (config) => {\r\n    dispatch(updateConfig(config));\r\n  },\r\n});\r\n\r\nconst connectFn = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps,\r\n);\r\n\r\nexport const MainMenu = connectFn(_MainMenu);\r\nexport const StyleConfiguration = connectFn(_StyleConfiguration);\r\nexport const ImportExportSettings = connectFn(_ImportExportSettings);\r\n","import React from 'react';\r\n\r\nimport {\r\n  StyleConfiguration,\r\n  MainMenu,\r\n  ImportExportSettings,\r\n} from '../../containers/Menu';\r\n\r\nimport {\r\n  MENU_MAIN,\r\n  MENU_STYLE_SETTINGS,\r\n  MENU_IMPORT_EXPORT,\r\n} from '../../constants';\r\n\r\nconst MenuScreen = (props) => {\r\n  switch (props.menu) {\r\n    case MENU_STYLE_SETTINGS: return (<StyleConfiguration />);\r\n    case MENU_IMPORT_EXPORT: return (<ImportExportSettings />);\r\n\r\n    case MENU_MAIN: // through\r\n    default: return (<MainMenu start={props.start} />);\r\n  }\r\n};\r\n\r\nexport default MenuScreen;\r\n","import React from 'react';\r\n\r\nimport './EndScreen.css';\r\nimport Menu from './Menu/Menu';\r\n\r\nimport { millisecondsToTimestamp } from '../util';\r\n\r\nconst EndScreen = (props) => {\r\n  const {\r\n    gameMode,\r\n    linesCleared,\r\n    blockCount,\r\n    reset,\r\n    mainMenu,\r\n    timerMillis,\r\n  } = props;\r\n\r\n  const endScreenMenuItems = [\r\n    {\r\n      text: \"NEW GAME\",\r\n      onClick: reset,\r\n    },\r\n    {\r\n      text: \"MAIN MENU\",\r\n      onClick: mainMenu,\r\n    },\r\n  ];\r\n\r\n  const statistics = [\r\n    {\r\n      name: \"Total Pieces\",\r\n      value: blockCount,\r\n    },\r\n    {\r\n      name: \"Total Lines\",\r\n      value: linesCleared,\r\n    },\r\n    {\r\n      name: \"Time\",\r\n      value: millisecondsToTimestamp(timerMillis),\r\n    },\r\n  ].map(stat => (\r\n      <div className=\"row\" key={stat.name}>\r\n        <span className=\"name\">{stat.name}: </span>\r\n        <span className=\"value\">{stat.value}</span>\r\n      </div>\r\n    )\r\n  );\r\n\r\n  return (\r\n    <div className=\"end-screen\">\r\n      <div>\r\n        <h1 className=\"mode-name\">{gameMode}</h1>\r\n        <h1>FINISH</h1>\r\n      </div>\r\n      <div className=\"statistics\">\r\n        {statistics}\r\n      </div>\r\n      <div>\r\n        <Menu items={endScreenMenuItems} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EndScreen;\r\n","import React from 'react';\r\n\r\nimport './FieldBackground.css';\r\n\r\nclass FieldBackground extends React.PureComponent {\r\n  render() {\r\n    const backgroundStyle = { fill: '#232323' };\r\n\r\n    const {\r\n      x, y,\r\n      width, height,\r\n      blockSize,\r\n      rows, cols,\r\n    } = this.props;\r\n\r\n    var gridlines = [];\r\n    for (let c = 1; c < cols; c++) {\r\n      gridlines.push(<line\r\n        key={`cl${c}`}\r\n        x1={x + c * blockSize} y1={y}\r\n        x2={x + c * blockSize} y2={y + height}\r\n        className=\"grid-line\"\r\n      />);\r\n    }\r\n\r\n    for (let r = 1; r < rows; r++) {\r\n      gridlines.push(<line\r\n        key={`rl${r}`}\r\n        x1={x}         y1={y + r * blockSize}\r\n        x2={x + width} y2={y + r * blockSize}\r\n        className=\"grid-line\"\r\n      />);\r\n    }\r\n\r\n    return (\r\n      <g>\r\n        <rect\r\n          id=\"field-background\"\r\n          style={backgroundStyle}\r\n          x={x}\r\n          y={y}\r\n          width={width}\r\n          height={height}\r\n          pointerEvents=\"none\"\r\n        />\r\n        {gridlines}\r\n      </g>\r\n    );\r\n  }\r\n};\r\n\r\nexport default FieldBackground;\r\n","import React, { Component } from 'react';\r\n\r\nimport Block from './Block';\r\nimport FieldBackground from './FieldBackground';\r\n\r\nclass Field extends Component {\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    const { activePosition, blockCount } = this.props;\r\n\r\n    return activePosition.row !== nextProps.activePosition.row ||\r\n           activePosition.col !== nextProps.activePosition.col ||\r\n           blockCount !== nextProps.blockCount;\r\n  }\r\n\r\n  render() {\r\n    const borderStyle = {\r\n      fill: 'transparent',\r\n      strokeWidth:1,\r\n      stroke: '#FFFFFF',\r\n    };\r\n\r\n    const {\r\n      x, y,\r\n      width, height,\r\n      blockSize,\r\n      rows, cols,\r\n      blockStyles,\r\n      activePosition: {\r\n        row: selectedRow,\r\n        col: selectedCol\r\n      }\r\n    } = this.props;\r\n\r\n\r\n    var grid = [];\r\n    for (let r = 0; r < rows; r++) {\r\n      for (let c = 0; c < cols; c++) {\r\n        const id = r * cols + c;\r\n        const currentBlock = this.props.blocks[r][c];\r\n        const gridBlock =\r\n          <Block\r\n            id={id}\r\n            key={id}\r\n            x={x + c * blockSize}\r\n            y={y + r * blockSize}\r\n            blockSize={blockSize}\r\n            blockStyles={blockStyles}\r\n            piece={currentBlock}\r\n            flash={r === selectedRow && c === selectedCol}\r\n          />;\r\n        grid.push(gridBlock);\r\n      }\r\n    }\r\n\r\n    return (\r\n      <g id=\"field\">\r\n        <FieldBackground\r\n          x={x}\r\n          y={y}\r\n          width={width}\r\n          height={height}\r\n          rows={rows}\r\n          cols={cols}\r\n          blockSize={blockSize}\r\n        />\r\n        {grid}\r\n        <rect\r\n          id=\"field-border\"\r\n          style={borderStyle}\r\n          x={x}\r\n          y={y}\r\n          width={width}\r\n          height={height}\r\n          pointerEvents=\"none\"\r\n        />\r\n      </g>\r\n    );\r\n  }\r\n};\r\n\r\nexport default Field;\r\n","import React from 'react';\r\n\r\nconst LineCount = (props) => {\r\n\r\n  const style = {\r\n    fontFamily: 'Roboto',\r\n    fontSize: 30,\r\n    fill: '#cfabec',\r\n  }\r\n\r\n  return (\r\n    <text textAnchor=\"end\" x={props.x} y={props.y} style={style}>\r\n      {props.linesCleared} / {props.target}\r\n    </text>\r\n  )\r\n};\r\n\r\nexport default LineCount;","import React from 'react';\r\n\r\nimport { millisecondsToTimestamp } from '../util';\r\n\r\nconst Timer = (props) => {\r\n  const {\r\n    x, y,\r\n    timerMillis,\r\n  } = props;\r\n\r\n  const style = {\r\n    fontSize: 30,\r\n    fill: '#cfabec',\r\n  }\r\n\r\n  const timestamp = millisecondsToTimestamp(timerMillis);\r\n\r\n  return (\r\n    <text\r\n      x={x}\r\n      y={y}\r\n      style={style}>\r\n    {timestamp}\r\n    </text>\r\n  );\r\n};\r\n\r\nexport default Timer;\r\n","import React, { Component } from 'react';\r\n\r\nimport './Button.css';\r\n\r\nclass Button extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { pressed: false };\r\n    this.touchStart = this.touchStart.bind(this);\r\n    this.touchEnd = this.touchEnd.bind(this);\r\n  }\r\n\r\n  touchStart(event) {\r\n    event.stopPropagation();\r\n    this.setState({pressed: true})\r\n  }\r\n\r\n  touchMove(event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  touchEnd(event) {\r\n    event.stopPropagation();\r\n    this.setState({pressed: false})\r\n  }\r\n\r\n  render() {\r\n    const style = {\r\n      fill: (this.state.pressed ?\r\n              (this.props.pressedColor || this.props.color) :\r\n              this.props.color),\r\n    };\r\n\r\n    const textStyle = {\r\n      pointerEvents: \"none\",\r\n      userSelect: \"none\",\r\n      fontFamily: \"Roboto\",\r\n      // TODO: dynamic font size (or dynamic width?)\r\n      fontSize: 14,\r\n      fill: (this.props.textColor || \"white\"),\r\n    };\r\n\r\n    return (\r\n      <g onTouchStart={this.touchStart}\r\n         onTouchMove={this.touchMove}\r\n         onTouchEnd={this.touchEnd}\r\n         onClick={this.props.onPressed}>\r\n        <rect\r\n          x={this.props.x}\r\n          y={this.props.y}\r\n          rx={6}\r\n          ry={6}\r\n          width={this.props.width}\r\n          height={this.props.height}\r\n          style={style}\r\n          className={\"button \" + this.props.className}\r\n          shapeRendering=\"auto\"\r\n        />\r\n        <text\r\n          x={this.props.x + this.props.width / 2}\r\n          y={this.props.y + this.props.height / 2}\r\n          textAnchor=\"middle\"\r\n          style={textStyle}\r\n          className={\"button \" + this.props.className}\r\n          alignmentBaseline=\"central\"\r\n          dominantBaseline=\"central\"\r\n        >{this.props.text}</text>\r\n      </g>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Button;\r\n","import React from 'react';\r\n\r\nimport Piece from './Piece';\r\n\r\nconst style = {\r\n  fill: 'transparent',\r\n  strokeWidth: 1.5,\r\n  stroke: '#FFFFFF',\r\n};\r\n\r\nconst selectedStyle = {\r\n  fill: '#FFFFFF3F',\r\n  strokeWidth: 1.5,\r\n  stroke: '#FFFFFF',\r\n};\r\n\r\nconst OrientationSelector = (props) => {\r\n  const { x, y, width, height, piece, orientation, selected, blockStyles } = props;\r\n\r\n  const padding = 4;\r\n  const cornerRadius = 6;\r\n  const blockSize = (width - padding * 2) / 4;\r\n\r\n  return (\r\n    <g>\r\n      <rect\r\n        fill=\"transparent\"\r\n        x={x}\r\n        y={y}\r\n        rx={cornerRadius}\r\n        ry={cornerRadius}\r\n        width={width}\r\n        height={height}\r\n        shapeRendering=\"auto\"\r\n        style={selected ? selectedStyle : style} />\r\n      <Piece\r\n        piece={piece}\r\n        orientation={orientation}\r\n        blockSize={blockSize}\r\n        blockStyles={blockStyles}\r\n        cx={x + width / 2}\r\n        cy={y + height / 2}\r\n      />\r\n    </g>\r\n  )\r\n};\r\n\r\nexport default OrientationSelector;\r\n","import React from 'react';\r\n\r\nimport Piece, { PIECE_NONE, ORIENTATION_RIGHT } from './Piece';\r\n\r\nconst PreviewPiece = (props) => {\r\n  const { x, y, width, height, piece, blockStyles } = props;\r\n  if (piece === undefined || piece === PIECE_NONE) {\r\n    return null;\r\n  }\r\n\r\n  const orientation = ORIENTATION_RIGHT;\r\n  const padding = 4;\r\n  const blockSize = (width - padding * 2) / 4;\r\n\r\n  return (\r\n    <Piece\r\n      piece={piece}\r\n      orientation={orientation}\r\n      blockSize={blockSize}\r\n      blockStyles={blockStyles}\r\n      cx={x + width / 2}\r\n      cy={y + height / 2}\r\n    />\r\n  )\r\n};\r\n\r\nexport default PreviewPiece;\r\n","import React, { Component } from 'react';\r\n\r\nimport Field from './Field';\r\nimport Piece from './Piece';\r\nimport LineCount from './LineCount';\r\nimport Timer from './Timer';\r\nimport Button from './Button';\r\nimport OrientationSelector from './OrientationSelector';\r\nimport PreviewPiece from './PreviewPiece';\r\n\r\nimport {\r\n  blockSizeInUnits,\r\n  GAMEMODE_LINE_TARGET,\r\n  passiveSupported,\r\n} from '../constants';\r\n\r\nclass Canvas extends Component {\r\n  preventDefault = (e) => e.preventDefault();\r\n\r\n  componentDidMount() {\r\n    // We need this for iOS to prevent \"overscroll\" and\r\n    // \"pull down to refresh\"\r\n    window.addEventListener('touchmove', this.preventDefault,\r\n      passiveSupported ? { passive: false } : false\r\n    );\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('touchmove', this.preventDefault);\r\n  }\r\n\r\n  render() {\r\n  const gameHeight = 680;\r\n  const viewBox = [window.innerWidth / -2, -gameHeight, window.innerWidth, gameHeight];\r\n  const props = this.props;\r\n\r\n  const {\r\n    config: {\r\n      blockStyles\r\n    },\r\n  } = props;\r\n\r\n  const bagDisplay = props.previewSlots.map((ps, i) =>\r\n    <PreviewPiece\r\n      key={`pp${i}`}\r\n      x={ps.x} y={ps.y}\r\n      width={ps.width} height={ps.height}\r\n      piece={props.nextPieces[i]}\r\n      blockStyles={blockStyles}\r\n    />\r\n  );\r\n\r\n  const orientationSelectors = props.orientationSelectors.map((os, i) =>\r\n    <OrientationSelector\r\n      key={`ori${i}`}\r\n      x={os.x} y={os.y}\r\n      width={os.width} height={os.height}\r\n      orientation={os.orientation}\r\n      piece={props.currentPiece}\r\n      blockStyles={blockStyles}\r\n      selected={props.orientation === os.orientation}\r\n    />\r\n  );\r\n\r\n  const {\r\n    x: fieldX, y: fieldY,\r\n    width: fieldWidth, height: fieldHeight,\r\n    rows: fieldRows, cols: fieldCols,\r\n    blockSize,\r\n  } = props.fieldDimensions;\r\n\r\n  let gameModeHud;\r\n  switch (props.gameMode) {\r\n    case GAMEMODE_LINE_TARGET: {\r\n      // TODO: calculate the position for this properly...\r\n      const lineCountPositionX = fieldX + 85;\r\n      const lineCountPositionY = fieldY - 10;\r\n      const timerPositionX = fieldX + 140;\r\n      gameModeHud = <React.Fragment>\r\n        <LineCount\r\n          x={lineCountPositionX}\r\n          y={lineCountPositionY}\r\n          linesCleared={props.linesCleared}\r\n          target={props.lineTarget}\r\n        />\r\n        <Timer\r\n          x={timerPositionX}\r\n          y={lineCountPositionY}\r\n          timerMillis={props.timerMillis}\r\n        />\r\n      </React.Fragment>\r\n    } break;\r\n    default: gameModeHud = null;\r\n  }\r\n\r\n  const pieceX = fieldX + props.activePosition.col * blockSizeInUnits;\r\n  const pieceY = fieldY + props.activePosition.row * blockSizeInUnits;\r\n\r\n  const activePiece = (props.activePosition.row !== -1\r\n    ? <Piece\r\n        x={pieceX}\r\n        y={pieceY}\r\n        piece={props.currentPiece}\r\n        orientation={props.orientation}\r\n        placeable={props.placeable}\r\n        blockStyles={blockStyles}\r\n        blockSize={blockSizeInUnits} />\r\n    : null);\r\n\r\n  return (\r\n    <svg\r\n      id=\"game-canvas\"\r\n      preserveAspectRatio=\"xMidYMax meet\"\r\n      shapeRendering=\"crispEdges\"\r\n      textRendering=\"optimizeLegibility\"\r\n      style={ {\r\n        touchAction: 'none',\r\n        width: props.windowWidth,\r\n        height: props.windowHeight,\r\n      } }\r\n      onTouchStart={props.touchStart}\r\n      onTouchMove={props.touchMove}\r\n      onTouchEnd={props.touchEnd}\r\n      onMouseDown={props.mouseDown}\r\n      onMouseMove={props.mouseMove}\r\n      onMouseUp={props.mouseUp}\r\n      viewBox={viewBox}\r\n    >\r\n      <Field\r\n        activePosition={props.activePosition}\r\n        x={fieldX}\r\n        y={fieldY}\r\n        width={fieldWidth}\r\n        height={fieldHeight}\r\n        blockSize={blockSize}\r\n        blockStyles={blockStyles}\r\n        rows={fieldRows}\r\n        cols={fieldCols}\r\n        blocks={props.blocks}\r\n        blockCount={props.blockCount} />\r\n      {activePiece}\r\n      {orientationSelectors}\r\n      {bagDisplay}\r\n      {gameModeHud}\r\n      <Button\r\n        // TODO: calculate the position for this properly...\r\n        x={fieldX + fieldWidth + 8} y={fieldY + 8}\r\n        width={58}\r\n        height={32}\r\n        text=\"RESET\"\r\n        color=\"#ec3636\"\r\n        pressedColor=\"#dc2626\"\r\n        onPressed={props.reset}\r\n      />\r\n      <Button\r\n        // TODO: calculate the position for this properly...\r\n        x={fieldX + fieldWidth + 8} y={fieldY + 8 + 32 + 8}\r\n        width={58}\r\n        height={32}\r\n        text=\"MENU\"\r\n        color=\"#3e3e3e\"\r\n        pressedColor=\"#292929\"\r\n        onPressed={props.mainMenu}\r\n      />\r\n    </svg>\r\n  );\r\n}\r\n}\r\n\r\nexport default Canvas;\r\n","import { shuffle } from '../util';\r\n\r\nclass BagRandomizer {\r\n  constructor(random) {\r\n    // TODO: use piece constants?\r\n    this.bag = [0, 1, 2, 3, 4, 5, 6];\r\n    this.random = random;\r\n    this.index = this.bag.length;\r\n  }\r\n\r\n  next() {\r\n   if (this.index === this.bag.length) {\r\n      shuffle(this.bag, this.random);\r\n      this.index = 0;\r\n    }\r\n\r\n    return this.bag[this.index++];\r\n  }\r\n}\r\n\r\nexport default BagRandomizer;\r\n","import React, { Component } from 'react';\r\n\r\nimport MenuScreen from './components/Menu/MenuScreen';\r\nimport EndScreen from './components/EndScreen';\r\nimport Canvas from './components/Canvas';\r\n\r\nimport BagRandomizer from './randomizers/BagRandomizer';\r\n\r\nimport {\r\n  fieldWidthInBlocks, fieldHeightInBlocks,\r\n  blockSizeInUnits, hiddenHeight,\r\n  GAMESTATE_PAUSED, GAMESTATE_MENU, GAMESTATE_END, GAMESTATE_PLAYING,\r\n  GAMEMODE_ZEN,\r\n  GAMEMODE_LINE_TARGET,\r\n} from './constants';\r\n\r\nimport {\r\n  placeBlock, PIECE_NONE, ORIENTATION_NONE,\r\n  ORIENTATION_UP, ORIENTATION_RIGHT,\r\n  ORIENTATION_DOWN, ORIENTATION_LEFT,\r\n  checkPlaceability,\r\n} from './components/Piece';\r\n\r\nconst orientations = [\r\n  ORIENTATION_LEFT,\r\n  ORIENTATION_UP,\r\n  ORIENTATION_RIGHT,\r\n  ORIENTATION_DOWN\r\n];\r\n\r\nclass App extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.initialiseLayout();\r\n\r\n    this.keydown = this.keydown.bind(this);\r\n    this.gameLoop = this.gameLoop.bind(this);\r\n    this.selectOrientation = this.selectOrientation.bind(this);\r\n    this.updateOrientation = this.updateOrientation.bind(this);\r\n    this.init = this.init.bind(this);\r\n    this.start = this.start.bind(this);\r\n    this.mainMenu = this.mainMenu.bind(this);\r\n    this.pause = this.pause.bind(this);\r\n    this.dragMove = this.dragMove.bind(this);\r\n    this.dragEnd = this.dragEnd.bind(this);\r\n    this.mouseDown = this.mouseDown.bind(this);\r\n    this.mouseMove = this.mouseMove.bind(this);\r\n    this.mouseUp   = this.mouseUp.bind(this);\r\n    this.touchMove = this.touchMove.bind(this);\r\n    this.touchEnd = this.touchEnd.bind(this);\r\n    // we don't need any special logic for tracking\r\n    // the initial touches at the moment.\r\n    this.touchStart = this.touchMove;\r\n\r\n    this.mouseDown = this.mouseDown.bind(this);\r\n    this.mouseMove = this.mouseMove.bind(this);\r\n    this.mouseUp   = this.mouseUp.bind(this);\r\n\r\n    this.init();\r\n    props.loadConfig();\r\n  }\r\n\r\n  initialiseLayout() {\r\n    const previewSize = 65;\r\n\r\n    //\r\n    // Field\r\n    //\r\n    const yOffset = 100;\r\n    const fieldWidth  = blockSizeInUnits * fieldWidthInBlocks;\r\n    const fieldHeight = blockSizeInUnits * fieldHeightInBlocks;\r\n\r\n    this.fieldDimensions = {\r\n      // Center the field (but shift over for the preview pieces)\r\n      x: fieldWidth / -2 - previewSize/2,\r\n      y: -yOffset-fieldHeight,\r\n      blockSize: blockSizeInUnits,\r\n      rows: fieldHeightInBlocks,\r\n      cols: fieldWidthInBlocks,\r\n      width: fieldWidth,\r\n      height: fieldHeight,\r\n    };\r\n\r\n    //\r\n    // Orientation selectors\r\n    //\r\n    const osMargin = 16;\r\n    const osSize = 70;\r\n    const osYStart = -yOffset + osMargin;\r\n\r\n    const allOsWidth = (osSize * orientations.length + osMargin * (orientations.length - 1));\r\n    const osXStart = (allOsWidth / -2);\r\n\r\n    this.orientationSelectors = orientations.map((orientation, i) => ({\r\n      x: osXStart + (osSize + osMargin)*i,\r\n      y: osYStart,\r\n      width: osSize,\r\n      height: osSize,\r\n      orientation: orientation,\r\n    }));\r\n\r\n    //\r\n    // Preview pieces\r\n    //\r\n\r\n    // We want to emphasize the next piece more than the\r\n    // rest, but we still want everything to be centered.\r\n    const minorReduction = 10;\r\n\r\n    const psXStart = this.fieldDimensions.x + fieldWidth;\r\n    const psYStart = this.fieldDimensions.y + fieldHeight - previewSize;\r\n    this.previewSlots = Array(this.props.previewLength).fill(0).map((_, i) => {\r\n      return {\r\n        x: psXStart + (i === 0 ? 0 : minorReduction / 2),\r\n        y: psYStart - (previewSize - minorReduction)*i,\r\n        width: previewSize - (i === 0 ? 0 : minorReduction),\r\n        height: previewSize - (i === 0 ? 0 : minorReduction),\r\n        index: i,\r\n      }\r\n    });\r\n  }\r\n\r\n  // TODO: We should change the name of one of these\r\n  // to disambiguate it from the action that actually\r\n  // updates the state/container.\r\n  selectOrientation(orientation) {\r\n    this.orientation = orientation;\r\n  }\r\n\r\n  keydown(event) {\r\n    // TODO: configurable keys\r\n    switch (event.keyCode) {\r\n      // ',' (<)\r\n      case 188:\r\n        this.pieceDebug.next = false;\r\n        this.pieceDebug.prev = true;\r\n      break;\r\n      // '.' (>)\r\n      case 190:\r\n        this.pieceDebug.next = true;\r\n        this.pieceDebug.prev = false;\r\n      break;\r\n      // no default\r\n    }\r\n  }\r\n\r\n  init() {\r\n    // internal state\r\n    this.pieceDebug = {\r\n      next : false,\r\n      prev : false,\r\n    };\r\n\r\n    this.nextPieces = [];\r\n\r\n    // TODO: use a seedable random function\r\n    this.randomizer = new BagRandomizer(Math.random);\r\n    this.activeTouches = 0;\r\n    this.mouseIsDown = false;\r\n    this.activePosition = {\r\n      row : -1,\r\n      col : -1,\r\n    };\r\n\r\n    this.field = {\r\n      blocks:\r\n        Array(fieldHeightInBlocks).fill(0).map(r =>\r\n          Array(fieldWidthInBlocks).fill(PIECE_NONE)),\r\n      hiddenBlocks:\r\n        Array(hiddenHeight).fill(0).map(r =>\r\n          Array(fieldWidthInBlocks).fill(PIECE_NONE)),\r\n      lineClearFlags: Array(fieldHeightInBlocks).fill(false),\r\n      hiddenLineClearFlags: Array(hiddenHeight).fill(false),\r\n    };\r\n\r\n    this.nextPieces.length = 0;\r\n\r\n    // TODO: clean up the duplication / inconsistency between this\r\n    // and redux when we initialise / reset the game.\r\n    this.linesCleared = 0;\r\n    this.orientation = ORIENTATION_NONE;\r\n  }\r\n\r\n  start() {\r\n    this.init();\r\n    this.props.reset();\r\n    this.rollNextPiece();\r\n\r\n    // TODO: \"READY\" / \"GO\"\r\n    this.lastPlayingTime = new Date();\r\n    this.totalTimerMillis = 0;\r\n  }\r\n\r\n  pause() {\r\n    let newState = GAMESTATE_PAUSED;\r\n    const now = new Date();\r\n\r\n    if (this.props.gameState === GAMESTATE_PAUSED) {\r\n      newState = GAMESTATE_PLAYING;\r\n      this.lastPlayingTime = now;\r\n    } else {\r\n      const millisDiff = now - this.lastPlayingTime;\r\n      this.lastPlayingTime = now;\r\n      this.totalTimerMillis += millisDiff;\r\n    }\r\n\r\n    this.props.setGameState(newState);\r\n  }\r\n\r\n  mainMenu() {\r\n    this.props.setGameState(GAMESTATE_MENU);\r\n  }\r\n\r\n  // TODO: we probably will want to do these way more\r\n  // efficiently in the future. These are highly likely\r\n  // to cause a boat load of GC\r\n  canvasPoint(event) {\r\n    const svg = document.getElementById('game-canvas');\r\n    const point = svg.createSVGPoint();\r\n    point.x = event.clientX;\r\n    point.y = event.clientY;\r\n    const { x, y } = point.matrixTransform(svg.getScreenCTM().inverse());\r\n    return {x, y};\r\n  }\r\n\r\n  fieldPoint(canvasPoint) {\r\n    const fcpx = canvasPoint.x - this.fieldDimensions.x;\r\n    const fcpy = canvasPoint.y - this.fieldDimensions.y;\r\n\r\n    const col = Math.floor(fcpx / blockSizeInUnits);\r\n    const row = Math.floor(fcpy / blockSizeInUnits);\r\n\r\n    return {col, row};\r\n  }\r\n\r\n  updateOrientation(canvasPoint) {\r\n    const { x, y } = canvasPoint;\r\n\r\n    for (var i = 0; i < this.orientationSelectors.length; i++) {\r\n      const os = this.orientationSelectors[i];\r\n      if (y > os.y && y < os.y + os.height &&\r\n          x > os.x && x < os.x + os.width) {\r\n        this.selectOrientation(os.orientation);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  dragMove(canvasPoint) {\r\n    this.updateOrientation(canvasPoint);\r\n\r\n    const fp = this.fieldPoint(canvasPoint);\r\n    if (fp.col > -1 && fp.col < fieldWidthInBlocks &&\r\n        fp.row > -1 && fp.row < fieldHeightInBlocks)\r\n    {\r\n      this.activePosition.row = fp.row;\r\n      this.activePosition.col = fp.col;\r\n    }\r\n  }\r\n\r\n  dragEnd() {\r\n    if (this.activeTouches === 0 && !this.mouseIsDown) {\r\n      this.place = true;\r\n    }\r\n  }\r\n\r\n  mouseDown(event) {\r\n    event.preventDefault();\r\n    this.mouseIsDown = true;\r\n\r\n    const cp = this.canvasPoint(event);\r\n    this.dragMove(cp);\r\n  }\r\n\r\n  mouseMove(event) {\r\n    event.preventDefault();\r\n    if (this.mouseIsDown) {\r\n      const cp = this.canvasPoint(event);\r\n      this.dragMove(cp);\r\n    }\r\n  }\r\n\r\n  mouseUp(event) {\r\n    event.preventDefault();\r\n    this.mouseIsDown = false;\r\n    this.dragEnd();\r\n  }\r\n\r\n  touchMove(event) {\r\n    event.preventDefault();\r\n    this.activeTouches = event.touches.length;\r\n\r\n    // Note: if multiple touches are inside the field\r\n    // then the \"last\" one wins whichever that happens\r\n    // to be.\r\n    for (let i = 0; i < event.changedTouches.length; i++) {\r\n      const touch = event.changedTouches[i];\r\n      const cp = this.canvasPoint(touch);\r\n      this.dragMove(cp);\r\n    }\r\n  }\r\n\r\n  touchEnd(event) {\r\n    event.preventDefault();\r\n    this.activeTouches = event.touches.length;\r\n    this.dragEnd();\r\n  }\r\n\r\n  isLineFilled(line) {\r\n    const lineLength = line.length;\r\n    for (let col = 0; col < lineLength; col++) {\r\n      const block = line[col];\r\n      if (block === PIECE_NONE) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  setLineClearedFlag(row, field, flag) {\r\n    if (row >= 0) {\r\n      field.lineClearFlags[row] = flag;\r\n    } else {\r\n      field.hiddenLineClearFlags[(row * -1) - 1] = flag;\r\n    }\r\n  }\r\n\r\n  getLineClearedFlag(row, field) {\r\n    return field.lineClearFlags[row] || field.hiddenLineClearFlags[(row * -1) - 1];\r\n  }\r\n\r\n  getRow(row, field) {\r\n    return field.blocks[row] || field.hiddenBlocks[(row * -1) - 1];\r\n  }\r\n\r\n  // NOTE: this was originally ported pretty directly from Nullpomino\r\n  downFloatingBlocks(field) {\r\n    const fieldHeight = field.blocks.length;\r\n    const fieldWidth = field.blocks[0].length;\r\n\r\n    var y = fieldHeight - 1;\r\n    for (let i = hiddenHeight * -1; i < fieldHeight; i++) {\r\n      if (this.getLineClearedFlag(y, field)) {\r\n        for (let k = y; k > hiddenHeight * -1; k--) {\r\n          const rowUp = this.getRow(k-1, field);\r\n          const row   = this.getRow(k, field);\r\n          for (let l = 0; l < fieldWidth; l++) {\r\n            const blk = rowUp === undefined ? PIECE_NONE : rowUp[l];\r\n            row[l] = blk;\r\n          }\r\n\r\n          this.setLineClearedFlag(k, field, this.getLineClearedFlag(k-1, field));\r\n        }\r\n\r\n        // clear the top (we really only need to do this once)\r\n        for (let l = 0; l < fieldWidth; l++) {\r\n          const topRow = field.hiddenBlocks[hiddenHeight - 1];\r\n          topRow[l] = PIECE_NONE;\r\n        }\r\n      } else {\r\n        y--;\r\n      }\r\n    }\r\n  }\r\n\r\n  doLineClears(field) {\r\n    var linesCleared = 0;\r\n    var firstLine = -1;\r\n    const fieldHeight = field.blocks.length;\r\n\r\n    for(let r = hiddenHeight * -1; r < fieldHeight; r++) {\r\n      const row = this.getRow(r, field);\r\n      const filled = this.isLineFilled(row);\r\n\r\n      if (filled) {\r\n        const rowLength = row.length;\r\n        for (let c = 0; c < rowLength; c++) {\r\n          row[c] = PIECE_NONE;\r\n        }\r\n        linesCleared++;\r\n        this.setLineClearedFlag(r, field, true);\r\n\r\n        if (firstLine === -1) {\r\n          firstLine = r;\r\n        }\r\n      }\r\n    }\r\n\r\n    // TODO: split out and do later\r\n    // after some frames for animation purposes?\r\n    if (linesCleared > 0) {\r\n      this.downFloatingBlocks(field);\r\n    }\r\n\r\n    return linesCleared;\r\n  }\r\n\r\n  rollNextPiece() {\r\n    let nextPiece;\r\n    if (this.nextPieces.length === 0) {\r\n      nextPiece = this.randomizer.next();\r\n    } else {\r\n      nextPiece = this.nextPieces[0];\r\n    }\r\n\r\n    const nextPieces = this.nextPieces = this.nextPieces.slice(1);\r\n    while (nextPieces.length < this.props.previewLength) {\r\n      nextPieces.push(this.randomizer.next());\r\n    }\r\n\r\n    this.props.nextPiece(nextPiece, nextPieces);\r\n  }\r\n\r\n  checkGameOver(piece, field) {\r\n    if (piece === PIECE_NONE) {\r\n      return false;\r\n    }\r\n\r\n    // if there's any slot we can place the piece in any orientation\r\n    // the player can still \"continue\", even if that will still lead\r\n    // to a game over.\r\n    for (let r = 0; r < field.blocks.length; r++) {\r\n      let row = field.blocks[r];\r\n      for (let c = 0; c < row.length; c++) {\r\n        for (let o of orientations) {\r\n          if (checkPlaceability(c, r, piece, o, field)) {\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  gameLoop() {\r\n    this.props.setActiveGridPosition(this.activePosition);\r\n\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      this.props.cyclePieces(this.pieceDebug);\r\n    }\r\n\r\n    this.props.checkPlaceability(\r\n      this.activePosition.col, this.activePosition.row,\r\n      this.props.currentPiece, this.orientation,\r\n      this.field\r\n    );\r\n\r\n    if (this.props.gameState === GAMESTATE_PLAYING) {\r\n      const now = new Date();\r\n      const millisDiff = now - this.lastPlayingTime;\r\n      this.lastPlayingTime = now;\r\n      this.totalTimerMillis += millisDiff;\r\n      // Checking more than once per piece is redundant at the moment because\r\n      // you can currently place the piece anywhere, but if we change over to\r\n      // using a reference piece we'll need to check every time the reference\r\n      // piece moves.\r\n      let gameIsOver = this.checkGameOver(this.props.currentPiece, this.field);\r\n      if (gameIsOver) {\r\n        this.props.setGameState(GAMESTATE_END);\r\n      }\r\n\r\n      if (this.place) {\r\n        var placed = false;\r\n        if (this.props.placeable) {\r\n          // update our internal field\r\n          placeBlock(\r\n            this.activePosition.col, this.activePosition.row,\r\n            this.props.currentPiece, this.orientation,\r\n            this.field\r\n          );\r\n\r\n          var lines = this.doLineClears(this.field);\r\n          this.linesCleared += lines;\r\n          this.props.updateStats(this.linesCleared);\r\n\r\n          // TODO: line clear delay / animation??\r\n          // broadcast to everyone else\r\n          this.props.placeBlock(this.field);\r\n\r\n          placed = true;\r\n        }\r\n\r\n        // Check win/end conditions\r\n        switch (this.props.gameMode) {\r\n          case GAMEMODE_ZEN: /* There is no defined goal */ break;\r\n          case GAMEMODE_LINE_TARGET:\r\n            if (this.linesCleared >= this.props.lineTarget) {\r\n              this.props.setGameState(GAMESTATE_END);\r\n            }\r\n          break;\r\n\r\n          // no default\r\n        }\r\n\r\n        // TODO: punishment for trying to drop in a\r\n        //. non-placeable space? or do we just leave\r\n        // it hanging as this currently does.\r\n        this.place = false;\r\n\r\n        // TODO: allow placing it as soon as they try\r\n        // to rotate it if that becomes a valid placement?\r\n\r\n        if (placed) {\r\n          this.activePosition.row = -1;\r\n          this.activePosition.col = -1;\r\n          this.orientation = ORIENTATION_NONE;\r\n          this.rollNextPiece();\r\n        }\r\n      }\r\n      // Only do after potentially resetting above\r\n      // so that we don't highlight the orientation\r\n      // of the _next_ piece for a single frame if\r\n      // we select the orientation and the destination\r\n      // in the same frame.\r\n      this.props.selectOrientation(this.orientation);\r\n\r\n      this.pieceDebug.prev = false;\r\n      this.pieceDebug.next = false;\r\n    }\r\n\r\n    this.props.updateTimer(this.totalTimerMillis);\r\n\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.onresize = () => {\r\n      this.props.resize(window.innerWidth, window.innerHeight);\r\n    };\r\n    window.onresize();\r\n\r\n    document.addEventListener(\"keydown\", this.keydown, false);\r\n\r\n    setInterval(this.gameLoop, 33);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keydown\", this.keydown);\r\n  }\r\n\r\n  render() {\r\n    if (this.props.gameState === GAMESTATE_MENU) {\r\n      return (\r\n        <MenuScreen\r\n          menu={this.props.menu}\r\n          start={this.start} />\r\n      );\r\n    }\r\n\r\n    if (this.props.gameState === GAMESTATE_END) {\r\n      return (\r\n        <EndScreen\r\n          gameMode={this.props.gameMode}\r\n          blockCount={this.props.blockCount}\r\n          linesCleared={this.props.linesCleared}\r\n          reset={this.start}\r\n          mainMenu={this.mainMenu}\r\n          timerMillis={this.props.timerMillis}\r\n        />\r\n      );\r\n    }\r\n\r\n    return (\r\n      <Canvas\r\n        gameState={this.props.gameState}\r\n        activePosition={this.props.activePosition}\r\n        orientationSelectors={this.orientationSelectors}\r\n        previewSlots={this.previewSlots}\r\n        nextPieces={this.props.nextPieces}\r\n        fieldDimensions={this.fieldDimensions}\r\n        currentPiece={this.props.currentPiece}\r\n        orientation={this.props.orientation}\r\n        placeable={this.props.placeable}\r\n        blocks={this.props.field.blocks}\r\n        config={this.props.config}\r\n        linesCleared={this.props.linesCleared}\r\n        blockCount={this.props.blockCount}\r\n        lineTarget={this.props.lineTarget}\r\n        timerMillis={this.props.timerMillis}\r\n        gameMode={this.props.gameMode}\r\n        reset={this.start}\r\n        mainMenu={this.mainMenu}\r\n        pause={this.pause}\r\n        touchStart={this.touchStart}\r\n        touchMove={this.touchMove}\r\n        touchEnd={this.touchEnd}\r\n        mouseDown={this.mouseDown}\r\n        mouseMove={this.mouseMove}\r\n        mouseUp={this.mouseUp}\r\n        windowWidth={this.props.windowWidth}\r\n        windowHeight={this.props.windowHeight}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import { connect } from 'react-redux';\r\n\r\nimport App from '../App';\r\nimport {\r\n  setActiveGridPosition,\r\n  cyclePieces,\r\n  selectOrientation,\r\n  nextPiece,\r\n  placeBlock,\r\n  updateStats,\r\n  checkPlaceability,\r\n  reset,\r\n  resize,\r\n  setGameState,\r\n  setGameMode,\r\n  updateTimer,\r\n  loadConfig,\r\n} from '../actions/index';\r\n\r\nconst mapStateToProps = state => ({\r\n  menu: state.menu,\r\n  config: state.config,\r\n  gameState: state.gameState,\r\n  gameMode: state.gameMode,\r\n  activePosition: state.activePosition,\r\n  currentPiece: state.currentPiece,\r\n  nextPieces: state.nextPieces,\r\n  previewLength: state.previewLength,\r\n  orientation: state.orientation,\r\n  field: state.field,\r\n  blockCount: state.blockCount,\r\n  placeable: state.placeable,\r\n  linesCleared: state.linesCleared,\r\n  lineTarget: state.lineTarget,\r\n  windowWidth: state.windowWidth,\r\n  windowHeight: state.windowHeight,\r\n  timerMillis: state.timerMillis,\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  setActiveGridPosition: (param) => {\r\n    dispatch(setActiveGridPosition(param));\r\n  },\r\n  cyclePieces: (param) => {\r\n    dispatch(cyclePieces(param));\r\n  },\r\n  selectOrientation: (param) => {\r\n    dispatch(selectOrientation(param));\r\n  },\r\n  nextPiece: (np, nps) => {\r\n    dispatch(nextPiece(np, nps));\r\n  },\r\n  placeBlock: (field) => {\r\n    dispatch(placeBlock(field));\r\n  },\r\n  checkPlaceability: (x, y, piece, orientation, field) => {\r\n    dispatch(checkPlaceability(x, y, piece, orientation, field));\r\n  },\r\n  updateStats: (linesCleared) => {\r\n    dispatch(updateStats(linesCleared));\r\n  },\r\n  reset: () => {\r\n    dispatch(reset());\r\n  },\r\n  resize: (newWidth, newHeight) => {\r\n    dispatch(resize(newWidth, newHeight));\r\n  },\r\n  setGameState: (newGameState) => {\r\n    dispatch(setGameState(newGameState));\r\n  },\r\n  setGameMode: (newMode) => {\r\n    dispatch(setGameMode(newMode));\r\n  },\r\n  updateTimer: (timerMillis) => {\r\n    dispatch(updateTimer(timerMillis));\r\n  },\r\n  loadConfig: () => {\r\n    dispatch(loadConfig());\r\n  },\r\n});\r\n\r\nconst Game = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps,\r\n)(App);\r\n\r\nexport default Game;\r\n","function setActiveGridPosition(state, action) {\r\n  if (state.activePosition.row === action.activePosition.row &&\r\n      state.activePosition.col === action.activePosition.col) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    activePosition: {\r\n        ...action.activePosition\r\n    },\r\n  };\r\n}\r\n\r\nexport default setActiveGridPosition;\r\n","function cyclePieces(state, action) {\r\n  if (!action.next && !action.prev) {\r\n    return state;\r\n  }\r\n\r\n  var currentPiece;\r\n  if (action.next) {\r\n    currentPiece = state.currentPiece + 1;\r\n  } else if (action.prev) {\r\n    currentPiece = state.currentPiece - 1;\r\n  }\r\n\r\n  // Wrap around with -1 in the middle (no piece)\r\n  if (currentPiece > 6) {\r\n    currentPiece = -1;\r\n  } else if (currentPiece < -1) {\r\n    currentPiece = 6;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    currentPiece: currentPiece,\r\n  };\r\n}\r\n\r\n// replace with a dummy function in prod builds\r\n// so we don't have to worry about \"leaving\" it\r\n// in somehow.\r\nconst exportFn = ((process.env.NODE_ENV === 'production')\r\n  ? (function() {})\r\n  : cyclePieces);\r\n\r\nexport default exportFn;\r\n","function selectOrientation(state, action) {\r\n  if (state.orientation === action.orientation) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    orientation: action.orientation,\r\n  };\r\n}\r\n\r\nexport default selectOrientation;\r\n","function nextPiece(state, action) {\r\n  return {\r\n    ...state,\r\n    currentPiece: action.nextPiece,\r\n    // Note: We require this to be a \"new\" array, but I don't want\r\n    // to create a copy of a copy here.\r\n    nextPieces: action.nextPieces,\r\n  };\r\n}\r\n\r\nexport default nextPiece;\r\n","function getChangedRows(oldField, newField) {\r\n  const changedRows = [];\r\n  const numRows = oldField.length;\r\n  for (let r = 0; r < numRows; r++) {\r\n    const newRow = newField[r];\r\n    const oldRow = oldField[r];\r\n\r\n    const numCols = newRow.length;\r\n    for (let c = 0; c < numCols; c++) {\r\n      const newBlock = newRow[c];\r\n      const oldBlock = oldRow[c];\r\n\r\n      if (oldBlock !== newBlock) {\r\n        changedRows.push(r);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return changedRows;\r\n}\r\n\r\nfunction placeBlock(state, data) {\r\n  const newField = data.field.blocks;\r\n  var changedRows = getChangedRows(state.field.blocks, newField);\r\n  if (changedRows.length === 0) {\r\n    return state;\r\n  }\r\n\r\n  const blocks = [...state.field.blocks];\r\n  for (let r of changedRows) {\r\n    blocks[r] = [...newField[r]];\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    field: {\r\n      ...state.field,\r\n      blocks: blocks,\r\n    },\r\n    blockCount: state.blockCount + 1,\r\n  };\r\n}\r\n\r\nexport default placeBlock;\r\n","// TODO: I think this is probably bad style to be in the component...\r\nimport { checkPlaceability } from '../components/Piece';\r\n\r\nexport default (state, data) => {\r\n  const { x, y, piece, orientation, field } = data;\r\n  const oldPlaceable = state.placeable;\r\n  const newPlaceable = checkPlaceability(x, y, piece, orientation, field);\r\n\r\n  if (oldPlaceable === newPlaceable) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    placeable: newPlaceable,\r\n  };\r\n};\r\n","function updateStats(state, action) {\r\n  if (state.linesCleared === action.linesCleared) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    linesCleared: action.linesCleared,\r\n  };\r\n}\r\n\r\nexport default updateStats;\r\n","export default (state, action) => {\r\n  if (state.timerMillis === action.timerMillis) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    timerMillis: action.timerMillis,\r\n  };\r\n};\r\n","function resize(state, action) {\r\n  return {\r\n    ...state,\r\n    windowWidth: action.newWidth,\r\n    windowHeight: action.newHeight,\r\n  }\r\n}\r\n\r\nexport default resize;\r\n\r\n","import {\r\n  GAMESTATE_PLAYING, GAMESTATE_PAUSED,\r\n} from '../constants';\r\n\r\nexport default (state, action) => {\r\n  let newState = action.gameState;\r\n  if (action.gameState === GAMESTATE_PAUSED) {\r\n    if (state.gameState === GAMESTATE_PAUSED) {\r\n      newState = GAMESTATE_PLAYING;\r\n    }\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    gameState: newState,\r\n  };\r\n};\r\n","export default (state, action) => {\r\n  return {\r\n    ...state,\r\n    gameMode: action.gameMode,\r\n  };\r\n};\r\n","export default (state, action) => {\r\n  return {\r\n    ...state,\r\n    menu: action.menu,\r\n  };\r\n};\r\n","import {\r\n  SET_ACTIVE_GRID_POSITION,\r\n  CYCLE_PIECES,\r\n  SELECT_ORIENTATION,\r\n  NEXT_PIECE,\r\n  PLACE_BLOCK,\r\n  CHECK_PLACEABILITY,\r\n  UPDATE_STATS,\r\n  UPDATE_TIMER,\r\n  UPDATE_CONFIG,\r\n  LOAD_CONFIG,\r\n  RESET,\r\n  RESIZE,\r\n  SET_GAME_STATE,\r\n  SET_GAME_MODE,\r\n  SET_MENU,\r\n} from '../actions';\r\n\r\nimport setActiveGridPosition from './setActiveGridPosition';\r\nimport cyclePieces from './cyclePieces';\r\nimport selectOrientation from './selectOrientation';\r\nimport nextPiece from './nextPiece';\r\nimport placeBlock from './placeBlock';\r\nimport checkPlaceability from './checkPlaceability';\r\nimport updateStats from './updateStats';\r\nimport updateTimer from './updateTimer';\r\nimport { loadConfig, updateConfig } from './config';\r\nimport resize from './resize';\r\nimport setGameState from './setGameState';\r\nimport setGameMode from './setGameMode';\r\nimport setMenu from './setMenu';\r\n\r\n// TODO: I think this is probably bad style to be in the component...\r\nimport { PIECE_NONE, ORIENTATION_NONE } from '../components/Piece';\r\n\r\nimport {\r\n  fieldWidthInBlocks, fieldHeightInBlocks,\r\n  GAMESTATE_MENU, GAMESTATE_PLAYING,\r\n  defaultStyles,\r\n} from '../constants'\r\n\r\nconst initialState = {\r\n  gameState: GAMESTATE_MENU,\r\n  activePosition: {\r\n    row: -1,\r\n    col: -1,\r\n  },\r\n  currentPiece: PIECE_NONE,\r\n  previewLength: 5,\r\n  nextPieces: [],\r\n  orientation: ORIENTATION_NONE,\r\n  placeable: false,\r\n  blockCount: 0,\r\n  linesCleared: 0,\r\n  lineTarget: 40,\r\n  timerMillis: 0,\r\n  field: {\r\n    blocks :\r\n      Array(fieldHeightInBlocks).fill(0).map(r =>\r\n        Array(fieldWidthInBlocks).fill(PIECE_NONE))\r\n  },\r\n  config: {\r\n    version: 0,\r\n    blockStyles: defaultStyles,\r\n  },\r\n};\r\n\r\nfunction reducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case SET_ACTIVE_GRID_POSITION:\r\n      return setActiveGridPosition(state, action);\r\n    case CYCLE_PIECES:\r\n      return cyclePieces(state, action);\r\n    case SELECT_ORIENTATION:\r\n      return selectOrientation(state, action);\r\n    case NEXT_PIECE:\r\n      return nextPiece(state, action);\r\n    case PLACE_BLOCK:\r\n      return placeBlock(state, action);\r\n    case CHECK_PLACEABILITY:\r\n      return checkPlaceability(state, action);\r\n    case UPDATE_STATS:\r\n      return updateStats(state, action);\r\n    case UPDATE_TIMER:\r\n      return updateTimer(state, action);\r\n    case UPDATE_CONFIG:\r\n      return updateConfig(state, action);\r\n    case LOAD_CONFIG:\r\n      return loadConfig(state);\r\n    case RESIZE:\r\n      return resize(state, action);\r\n    case SET_GAME_STATE:\r\n      return setGameState(state, action);\r\n    case SET_GAME_MODE:\r\n      return setGameMode(state, action);\r\n    case SET_MENU:\r\n      return setMenu(state, action);\r\n    case RESET:\r\n      // TODO: take some game options that\r\n      // override the initial state?\r\n      return {\r\n        ...initialState,\r\n        config: state.config,\r\n        windowWidth: state.windowWidth,\r\n        windowHeight: state.windowHeight,\r\n        gameMode: state.gameMode,\r\n        gameState: GAMESTATE_PLAYING,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default reducer;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport { Provider } from 'react-redux';\r\nimport { createStore } from 'redux';\r\n\r\n// Polyfills\r\n// Required for Safari\r\nimport 'core-js/fn/object/assign';\r\nimport 'core-js/fn/object/values';\r\nimport 'core-js/es6/set';\r\nimport 'core-js/es6/symbol';\r\n\r\nimport './index.css';\r\nimport Game from './containers/Game';\r\nimport reducer from './reducers';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nconst store = createStore(\r\n  reducer,\r\n);\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <Game />\r\n  </Provider>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}